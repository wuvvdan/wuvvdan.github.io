<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title></title>
    <link href="/2021/12/29/%E6%9C%AC%E5%9C%B0%E5%A4%9A%E5%A4%84%E7%90%86%E4%B8%AA%60SSH%20key%60/"/>
    <url>/2021/12/29/%E6%9C%AC%E5%9C%B0%E5%A4%9A%E5%A4%84%E7%90%86%E4%B8%AA%60SSH%20key%60/</url>
    
    <content type="html"><![CDATA[<hr><p>title : æœ¬åœ°å¤šå¤„ç†ä¸ª<code>SSH key</code></p><p>date: 2021å¹´12æœˆ29æ—¥11:14:54</p><p>tags: </p><ul><li> git</li><li>å¼€å‘æŠ€å·§<br>categories:</li><li>å¼€å‘æŠ€å·§</li></ul><hr><h4 id="ä¸€ã€åˆ›å»ºæ–¹å¼"><a href="#ä¸€ã€åˆ›å»ºæ–¹å¼" class="headerlink" title="ä¸€ã€åˆ›å»ºæ–¹å¼"></a>ä¸€ã€åˆ›å»ºæ–¹å¼</h4><p>åˆ›å»ºé»˜è®¤<code>id_rsa</code>:<code>ssh-keygen -t rsa -C &#39;é‚®ç®±åœ°å€&#39;</code></p><p>åˆ›å»ºç‰¹æ®Šéœ€è¦çš„<code>ssh key</code>å‘½åä¾‹å¦‚<code>test</code>ï¼Œåˆ›å»ºæ–¹å¼ä¸º<code>ssh-keygen -t rsa -C &#39;é‚®ç®±åœ°å€&#39; -f ~/.ssh/test</code></p><h4 id="äºŒã€è®¾ç½®é…ç½®"><a href="#äºŒã€è®¾ç½®é…ç½®" class="headerlink" title="äºŒã€è®¾ç½®é…ç½®"></a>äºŒã€è®¾ç½®é…ç½®</h4><p>åœ¨ç›®<code>~/.ssh</code>ä¸‹åˆ›å»º<code>config</code>æ–‡ä»¶ï¼Œé‡Œé¢å¡«å……å†…å®¹å®ä¾‹ï¼š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># é»˜è®¤ id_rsa</span><br>Host github.com<br>HostName github.com<br>PreferredAuthentications publickey<br>IdentityFile ~<span class="hljs-regexp">/.ssh/id</span>_rsa<br><br><span class="hljs-comment"># ç‰¹æ®Šéœ€è¦ key åç§°ä¸ºtest</span><br>Host test.github.com<br>HostName github.com<br>PreferredAuthentications publickey<br>IdentityFile ~<span class="hljs-regexp">/.ssh/test</span><br></code></pre></td></tr></table></figure><h4 id="ä¸‰ã€æ·»åŠ åˆ°github"><a href="#ä¸‰ã€æ·»åŠ åˆ°github" class="headerlink" title="ä¸‰ã€æ·»åŠ åˆ°github"></a>ä¸‰ã€æ·»åŠ åˆ°<code>github</code></h4><p>æ­¤å¤„å°±æ­£å¸¸çš„åœ¨ github-&gt; settings-&gt;SSH And GPG keysä¸­æ·»åŠ å°±å¥½</p><h4 id="å››ã€ä½¿ç”¨"><a href="#å››ã€ä½¿ç”¨" class="headerlink" title="å››ã€ä½¿ç”¨"></a>å››ã€ä½¿ç”¨</h4><h4 id="1-æ‹‰å–ä»£ç "><a href="#1-æ‹‰å–ä»£ç " class="headerlink" title="1. æ‹‰å–ä»£ç "></a>1. æ‹‰å–ä»£ç </h4><p>é»˜è®¤<code>id_rsa</code>: </p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">git clone git<span class="hljs-variable">@github</span>.<span class="hljs-symbol">com:</span>ä»“åº“åç§° <span class="hljs-comment">#ä¾‹å¦‚ï¼šgit<span class="hljs-doctag">@github</span>.com:name/name.github.io.git</span><br></code></pre></td></tr></table></figure><p>ç‰¹æ®Š<code>test</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">git clone git<span class="hljs-variable">@test</span>.github.<span class="hljs-symbol">com:</span>ä»“åº“åç§° <span class="hljs-comment">#ä¾‹å¦‚ï¼šgit<span class="hljs-doctag">@test</span>.github.com:name/name.github.io.git</span><br></code></pre></td></tr></table></figure><h4 id="2-æœ¬åœ°å…³è”è¿œç¨‹"><a href="#2-æœ¬åœ°å…³è”è¿œç¨‹" class="headerlink" title="2. æœ¬åœ°å…³è”è¿œç¨‹"></a>2. æœ¬åœ°å…³è”è¿œç¨‹</h4><p>é»˜è®¤<code>id_rsa</code>: </p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">git remote add origin git<span class="hljs-variable">@github</span>.<span class="hljs-symbol">com:</span>ä»“åº“åç§° <span class="hljs-comment">#ä¾‹å¦‚ï¼šgit<span class="hljs-doctag">@github</span>.com:name/name.github.io.git</span><br></code></pre></td></tr></table></figure><p>ç‰¹æ®Š<code>test</code></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">git remote add origin git<span class="hljs-variable">@test</span>.github.<span class="hljs-symbol">com:</span>ä»“åº“åç§° <span class="hljs-comment">#ä¾‹å¦‚ï¼šgit<span class="hljs-doctag">@test</span>.github.com:name/name.github.io.git</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Vue ä¹‹Elementï¼ˆé¥¿äº†å— Web æ¡†æ¶ï¼‰ä½¿ç”¨-1</title>
    <link href="/2021/10/11/Vue%20%E4%B9%8BElement%EF%BC%88%E9%A5%BF%E4%BA%86%E5%90%97%20Web%20%E6%A1%86%E6%9E%B6%EF%BC%89%E4%BD%BF%E7%94%A8-1/"/>
    <url>/2021/10/11/Vue%20%E4%B9%8BElement%EF%BC%88%E9%A5%BF%E4%BA%86%E5%90%97%20Web%20%E6%A1%86%E6%9E%B6%EF%BC%89%E4%BD%BF%E7%94%A8-1/</url>
    
    <content type="html"><![CDATA[<h3 id="ä¸€ã€å¯¼å…¥"><a href="#ä¸€ã€å¯¼å…¥" class="headerlink" title="ä¸€ã€å¯¼å…¥"></a>ä¸€ã€å¯¼å…¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i element-ui -S<br></code></pre></td></tr></table></figure><h3 id="äºŒã€ä½¿ç”¨"><a href="#äºŒã€ä½¿ç”¨" class="headerlink" title="äºŒã€ä½¿ç”¨"></a>äºŒã€ä½¿ç”¨</h3><p>éœ€è¦åœ¨<code>main.js</code>ä¸­å¯¼å…¥å¤´æ–‡ä»¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> ElementUI <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span><br></code></pre></td></tr></table></figure><p>å¹¶ä½¿ç”¨<code>ElementUI</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript">Vue.use(ElementUI)<br></code></pre></td></tr></table></figure><h3 id="ä¸‰ã€å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨äº†"><a href="#ä¸‰ã€å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨äº†" class="headerlink" title="ä¸‰ã€å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨äº†"></a>ä¸‰ã€å¯ä»¥æ„‰å¿«çš„ä½¿ç”¨äº†</h3><p>å®ä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Vue">&lt;div&gt;<br>&lt;el-radio v-model=&quot;radio&quot; label=&quot;1&quot;&gt;å¤‡é€‰é¡¹&lt;/el-radio&gt;<br>&lt;el-radio v-model=&quot;radio&quot; label=&quot;2&quot;&gt;å¤‡é€‰é¡¹&lt;/el-radio&gt;<br>&lt;/div&gt;<br></code></pre></td></tr></table></figure><p>æ•ˆæœï¼š</p><p><img src="https://wuvdan.oss-cn-hangzhou.aliyuncs.com/blog/20211011142402.jpg" alt="æ•ˆæœ"></p>]]></content>
    
    
    <categories>
      
      <category>Vue</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ç°åº¦æ›´æ–°</title>
    <link href="/2020/11/01/%E7%81%B0%E5%BA%A6%E6%9B%B4%E6%96%B0/"/>
    <url>/2020/11/01/%E7%81%B0%E5%BA%A6%E6%9B%B4%E6%96%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="ç°åº¦æ›´æ–°"><a href="#ç°åº¦æ›´æ–°" class="headerlink" title="ç°åº¦æ›´æ–°"></a>ç°åº¦æ›´æ–°</h1><h3 id="ç¬¬ä¸‰æ–¹"><a href="#ç¬¬ä¸‰æ–¹" class="headerlink" title="ç¬¬ä¸‰æ–¹"></a>ç¬¬ä¸‰æ–¹</h3><ol><li>ç›´æ¥ä½¿ç”¨è¯¥è´¦å·æ‰“åŒ…</li><li>ä¸Šä¼ è‡³ç¬¬ä¸‰æ–¹å¹³å°ï¼Œç”ŸæˆäºŒç»´ç </li><li>æ‰«æäºŒç»´ç ä¸‹è½½</li><li>å»è®¾ç½®ä¸­åŒæ„æè¿°æ–‡ä»¶</li></ol><ul><li>å¹³å°</li></ul><ol><li><a href="https://www.pgyer.com/">è’²å…¬è‹±</a></li><li><a href="fir.im">fir</a></li></ol><ul><li>è´¦å·</li></ul><ol><li>ä¼ä¸šçº§è´¦å·ï¼ˆ$299ï¼‰ï¼Œæµ‹è¯•ç”¨æˆ·æ²¡æœ‰æ•°é‡é™åˆ¶</li><li>å…¬å¸ç°æœ‰è´¦å·ï¼Œæµ‹è¯•ç”¨æˆ·æœ€å¤§ä¸º100ï¼Œéœ€è¦åœ¨æ‰“åŒ…å‰æ·»åŠ ç”¨æˆ·æ‰‹æœºçš„UDID</li></ol><ul><li>æ•ˆæœå›¾<br><br><img src="https://www.pgyer.com/app/qrcode/Dmvo" alt="æ•ˆæœå›¾"></li></ul><h3 id="è‹¹æœçš„Test-Flight"><a href="#è‹¹æœçš„Test-Flight" class="headerlink" title="è‹¹æœçš„Test Flight"></a>è‹¹æœçš„Test Flight</h3><p>éœ€è¦ç”¨æˆ·å®‰è£…<code>Test Flight</code> App</p><ol><li>å°†æ‰“åŒ…å¥½çš„ <code>ipa</code> æ–‡ä»¶ä¸Šä¼ åˆ° <code>iTunes Connect</code></li><li>ç™»å½•åˆ° <code>iTunes Connect</code> è¿›å…¥<code>æˆ‘çš„APP</code>ï¼Œé€‰æ‹©ä½ çš„APP</li><li>åˆ° <code>TestFlight</code> æ¨¡å—ä¸‹ï¼Œå¦‚æœ <code>App Store</code> æœ‰æäº¤è¿‡çš„ç‰ˆæœ¬ï¼Œå†…éƒ¨æµ‹è¯•å‘˜å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ å†…éƒ¨æµ‹è¯•å‘˜ç”¨æˆ·å³å¯</li><li>æ¥ä¸‹æ¥æ”¶é‚®ä»¶ï¼Œå°±æ˜¯åˆšåˆšæ·»åŠ çš„é‚£ä¸ªç”¨æˆ·é‚®ç®±ï¼Œä¼šæ”¶åˆ°é‚®ä»¶</li><li>ç‚¹å‡» <code>View in TestFlight</code> è·å–é‚€è¯·ç </li><li>æ·»åŠ å¤–åŒ…æµ‹è¯•äººå‘˜ï¼Œç¬¬äº”æ­¥â€ç‚¹å‡» View in TestFlight è·å–é‚€è¯·ç â€æ—¶ï¼Œå¯ä»¥æ‹¿åˆ°ä¸€ä¸ªURLï¼Œé€šè¿‡URLå¯ä»¥åœ¨Appä¸­è¿›è¡Œæ“ä½œã€‚</li><li>ç‚¹å‡»æ›´æ–°ä¼šè·³è½¬åˆ°<code>Test Flight</code>ä¸­æ›´æ–°</li><li>æ•ˆæœå›¾<br><br><img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1568178285309&di=661c69f86a092c8a2ac90949179eb87b&imgtype=0&src=http://hbimg.b0.upaiyun.com/6aa7b9c8dffeda919f91e32ad4c7cd260e8df2651b5da-WggNsA_fw658" alt="æ•ˆæœå›¾"></li></ol>]]></content>
    
    
    <categories>
      
      <category>å¼€å‘æŠ€å·§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘æŠ€å·§</tag>
      
      <tag>ç°åº¦æ›´æ–°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSä»£ç å—(Snippet)</title>
    <link href="/2020/10/01/iOS%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/"/>
    <url>/2020/10/01/iOS%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-4eef772205a43353.jpeg" alt="é•‡æ¥¼ä¸“ç”¨"></p><h2 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h2><p>ä»¥æµ‹è¯•ViewControllerä¸ºä¾‹ã€‚</p><h5 id="ViewController-hæ–‡ä»¶"><a href="#ViewController-hæ–‡ä»¶" class="headerlink" title="ViewController.hæ–‡ä»¶"></a>ViewController.hæ–‡ä»¶</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">ViewController</span> : <span class="hljs-title">UIViewController</span></span><br><span class="hljs-comment">/** é€»è¾‘æµ‹è¯• */</span><br>- (<span class="hljs-keyword">int</span>)getSumWithNum1:(<span class="hljs-keyword">int</span>)a num2:(<span class="hljs-keyword">int</span>)b;<br><span class="hljs-comment">/** å¼‚æ­¥æµ‹è¯• */</span><br>- (<span class="hljs-keyword">void</span>)loadDataComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-keyword">id</span> info))complete;<br><span class="hljs-comment">/** æ€§èƒ½æµ‹è¯• */</span><br>- (<span class="hljs-keyword">void</span>)openCamera;<br><br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><h5 id="ViewController-mæ–‡ä»¶"><a href="#ViewController-mæ–‡ä»¶" class="headerlink" title="ViewController.mæ–‡ä»¶"></a>ViewController.mæ–‡ä»¶</h5><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">- (<span class="hljs-keyword">int</span>)getSumWithNum1:(<span class="hljs-keyword">int</span>)a num2:(<span class="hljs-keyword">int</span>)b &#123;<br>    <span class="hljs-keyword">return</span> a + b;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)loadDataComplete:(<span class="hljs-keyword">void</span> (^)(<span class="hljs-keyword">id</span>))complete &#123;    <br>    <span class="hljs-built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), ^&#123;<br>        sleep(<span class="hljs-number">2</span>);<br>        <span class="hljs-built_in">NSString</span> *data = <span class="hljs-string">@&quot;ğŸ˜&quot;</span>;<br>        <span class="hljs-built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;<br>            complete(data);<br>        &#125;);<br>    &#125;);<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)openCamera &#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; ++i) &#123;<br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²%d&quot;</span>, i);<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)viewDidLoad &#123;<br>    [<span class="hljs-keyword">super</span> viewDidLoad];<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†è¿›è¡Œå•å…ƒåŒ–æµ‹è¯•ï¼Œæ‰€ä»¥æ–°å»ºä¸€ä¸ª<code>ViewControllerTest</code>æ–‡ä»¶ã€‚<br>æ­¥éª¤<br><img src="https://upload-images.jianshu.io/upload_images/3334769-c0d1455212a740ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ–°å»ºæ–‡ä»¶"></p><ul><li>å¯¼å…¥æµ‹è¯•å¤´æ–‡ä»¶<code>#import &quot;ViewController.h&quot;</code></li><li>å£°æ˜å±æ€§<code>@property (nonatomic, strong) ViewController *vc;</code></li><li>åœ¨<code>- (void)setUp;</code>è¿›è¡Œåˆå§‹åŒ–ä»£ç <figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csharp">- (<span class="hljs-keyword">void</span>)setUp &#123;<br>    self.vc = [[ViewController alloc] <span class="hljs-keyword">init</span>];<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1ã€é€»è¾‘æµ‹è¯•"><a href="#1ã€é€»è¾‘æµ‹è¯•" class="headerlink" title="1ã€é€»è¾‘æµ‹è¯•"></a>1ã€é€»è¾‘æµ‹è¯•</h3></li></ul><ol><li><p>ç»™å‡ºæµ‹è¯•æ•°æ®</p></li><li><p>è¿›è¡Œæµ‹è¯•</p></li><li><p>ä½¿ç”¨æ–­è¨€è¿›è¡Œåˆ¤å®š</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs axapta">- (<span class="hljs-keyword">void</span>)testSum &#123;<br>    <span class="hljs-comment">// 1. given</span><br>    <span class="hljs-built_in">int</span> a = <span class="hljs-number">10</span>;<br>    <span class="hljs-built_in">int</span> b = <span class="hljs-number">22</span>;<br>    <span class="hljs-comment">// 2. when</span><br>    <span class="hljs-built_in">int</span> <span class="hljs-keyword">sum</span> = [self.vc getSumWithNum1:a num2:b];<br>    <span class="hljs-comment">// 3. then</span><br>    XCTAssertEqual(<span class="hljs-keyword">sum</span>, <span class="hljs-number">32</span>, @<span class="hljs-string">&quot;é”™è¯¯&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2ã€å¼‚æ­¥æµ‹è¯•"><a href="#2ã€å¼‚æ­¥æµ‹è¯•" class="headerlink" title="2ã€å¼‚æ­¥æµ‹è¯•"></a>2ã€å¼‚æ­¥æµ‹è¯•</h3></li><li><p>åˆ›å»º<code>XCTestExpectation</code>ï¼Œè®¾ç½®é”™è¯¯æç¤º</p></li><li><p>è°ƒç”¨æ–¹æ³•ï¼Œåœ¨å¼‚æ­¥ä¸­è°ƒç”¨<code>fulfill</code></p></li><li><p>è¿›è¡Œåˆ¤æ–­æ—¶é—´ï¼Œæ˜¯å¦åœ¨é¢„æœŸæ—¶é—´å†…å®¹</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-built_in">XCTestExpectation</span> *exp = [<span class="hljs-keyword">self</span> expectationWithDescription:<span class="hljs-string">@&quot;è¶…è¿‡é¢„æœŸæ—¶é—´&quot;</span>];<br>[<span class="hljs-keyword">self</span>.vc loadDataComplete:^(<span class="hljs-keyword">id</span> info) &#123;<br>    <span class="hljs-built_in">XCTAssertNil</span>(info, <span class="hljs-string">@&quot;æ•°æ®ä¸ºç©º&quot;</span>);<br>    [exp fulfill];<br>&#125;];<br>[<span class="hljs-keyword">self</span> waitForExpectationsWithTimeout:<span class="hljs-number">4</span> handler:^(<span class="hljs-built_in">NSError</span> * _Nullable error) &#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, error);<br>&#125;];<br></code></pre></td></tr></table></figure><h3 id="3ã€æ€§èƒ½æµ‹è¯•"><a href="#3ã€æ€§èƒ½æµ‹è¯•" class="headerlink" title="3ã€æ€§èƒ½æµ‹è¯•"></a>3ã€æ€§èƒ½æµ‹è¯•</h3><p><img src="https://upload-images.jianshu.io/upload_images/3334769-96f0facc7307a744.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ€§èƒ½æµ‹è¯•"></p></li><li><p>è®¾ç½®Baselineæ—¶é—´</p></li><li><p>Max STDDEV æœ€å¤§æ ·æœ¬æ ‡å‡†åå·®æ¯”ä¾‹</p></li></ol><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lasso">- (<span class="hljs-literal">void</span>)testPerformanceExample &#123;<br>    <span class="hljs-meta">[</span><span class="hljs-built_in">self</span> measureBlock:^&#123;<br>        <span class="hljs-meta">[</span><span class="hljs-built_in">self</span>.vc openCamera<span class="hljs-meta">]</span>;<br>    &#125;];<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="UIæµ‹è¯•"><a href="#UIæµ‹è¯•" class="headerlink" title="UIæµ‹è¯•"></a>UIæµ‹è¯•</h2><p><img src="https://upload-images.jianshu.io/upload_images/3334769-0dc163b565bdcbf6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="è„šæœ¬å½•åˆ¶"></p><p>1ã€å½•åˆ¶è„šæœ¬<br><br>2ã€ç¼–è¾‘è„šæœ¬<br><br>3ã€è‡ªåŠ¨åŒ–æµ‹è¯•</p><h2 id="è·å–ä»£ç è¦†ç›–ç‡"><a href="#è·å–ä»£ç è¦†ç›–ç‡" class="headerlink" title="è·å–ä»£ç è¦†ç›–ç‡"></a>è·å–ä»£ç è¦†ç›–ç‡</h2><p>1ã€ç‚¹å‡»<code>Edit Secheme</code><br><img src="https://upload-images.jianshu.io/upload_images/3334769-4a5476214d38ea7d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Edit Secheme"></p><p>2ã€é€‰æ‹©<code>Test</code>-&gt;<code>Options</code>-&gt;<code>Code Coverage</code>å‹¾èµ·<br><img src="https://upload-images.jianshu.io/upload_images/3334769-b1b529d4111e737b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Code Coverage"></p><p>3ã€è¿è¡Œä»£ç æŸ¥çœ‹ç»“æœ<br><img src="https://upload-images.jianshu.io/upload_images/3334769-01e76835566d7ae7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æŸ¥çœ‹ç»“æœ"></p>]]></content>
    
    
    <categories>
      
      <category>å¼€å‘æŠ€å·§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Snippet</tag>
      
      <tag>å¼€å‘æŠ€å·§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>KVO</title>
    <link href="/2020/09/01/iOS%E5%BA%95%E5%B1%82-KVO/"/>
    <url>/2020/09/01/iOS%E5%BA%95%E5%B1%82-KVO/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-0c2f7bf66b38a01a.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><h3 id="ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ"><a href="#ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ" class="headerlink" title="ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ"></a>ç±»çš„å•ä¸ªå±æ€§è§‚å¯Ÿ</h3><p>è§‚å¯Ÿå€¼çš„4ä¸­æ¨¡å¼</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown">/<span class="hljs-strong">**</span><br><span class="hljs-strong"> <span class="hljs-emphasis">*  NSKeyValueObservingOptionNew     æ–°å€¼</span></span><br><span class="hljs-emphasis"><span class="hljs-strong"> *</span>  NSKeyValueObservingOptionOld     æ—§å€¼</span><br><span class="hljs-strong"> <span class="hljs-emphasis">*  NSKeyValueObservingOptionInitial æ³¨å†Œå‘é€é€šçŸ¥ï¼Œæ”¹å˜æ—¶å‘é€é€šçŸ¥</span></span><br><span class="hljs-emphasis"><span class="hljs-strong"> *</span>  NSKeyValueObservingOptionPrior   æ”¹å˜ä¹‹å‰å‘é€é€šçŸ¥ï¼Œæ”¹å˜åå‘é€é€šçŸ¥</span><br><span class="hljs-strong"> <span class="hljs-emphasis">*/</span></span><br></code></pre></td></tr></table></figure><p>é’ˆå¯¹<code>Person</code>ç±»é‡Œé¢çš„<code>name</code>å±æ€§è¿›è¡Œè§‚å¯Ÿ</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">[person addObserver:<span class="hljs-keyword">self</span> forKeyPath:<span class="hljs-string">@&quot;name&quot;</span> options:<span class="hljs-built_in">NSKeyValueObservingOptionNew</span> context:<span class="hljs-literal">nil</span>];<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹è§‚å¯Ÿ</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">- (<span class="hljs-keyword">void</span>)observeValueForKeyPath:(<span class="hljs-built_in">NSString</span> *)keyPath ofObject:(<span class="hljs-keyword">id</span>)object change:(<span class="hljs-built_in">NSDictionary</span>&lt;<span class="hljs-built_in">NSKeyValueChangeKey</span>,<span class="hljs-keyword">id</span>&gt; *)change context:(<span class="hljs-keyword">void</span> *)context &#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, change);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰“å°æ•ˆæœ</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">2019-03-22</span> <span class="hljs-number">09</span>:<span class="hljs-number">20</span>:<span class="hljs-number">16.875033</span>+<span class="hljs-number">0800</span> KVO[<span class="hljs-number">1844:81256</span>] &#123;<br>    kind = <span class="hljs-number">1</span><span class="hljs-comment">;</span><br>    new = <span class="hljs-number">0</span><span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ"><a href="#ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ" class="headerlink" title="ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ"></a>ç±»çš„é‡Œé¢åµŒå¥—å…¶ä»–çš„å±æ€§è§‚å¯Ÿ</h3><p>è§‚å¯Ÿ<code>Person</code>é‡Œé¢<code>Dog</code>ç±»çš„<code>age</code>ï¼Œé€šè¿‡ç‚¹è¯­æ³•ç›´æ¥ç›‘å¬</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">[person addObserver:<span class="hljs-keyword">self</span> forKeyPath:<span class="hljs-string">@&quot;dog.age&quot;</span> options:<span class="hljs-built_in">NSKeyValueObservingOptionNew</span> context:<span class="hljs-literal">nil</span>];<br></code></pre></td></tr></table></figure><p>è¾“å…¥ç»“æœ</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">2019-03-22</span> <span class="hljs-number">09</span>:<span class="hljs-number">23</span>:<span class="hljs-number">25.854859</span>+<span class="hljs-number">0800</span> KVO[<span class="hljs-number">1876:84141</span>] &#123;<br>    kind = <span class="hljs-number">1</span><span class="hljs-comment">;</span><br>    new = <span class="hljs-number">11</span><span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼"><a href="#ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼" class="headerlink" title="ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼"></a>ä¸€æ¬¡æ€§è§‚å¯Ÿå¤šä¸ªå€¼</h3><p>ä¾‹å¦‚è§‚å¯Ÿ<code>Person</code>é‡Œé¢çš„<code>Dog</code>çš„<code>age</code>å’Œ<code>level</code>ï¼Œåˆ™åœ¨<code>Person</code>ç±»ä¸­é‡æ–°<code>+ (NSSet&lt;NSString *&gt; *)keyPathsForValuesAffectingValueForKey:(NSString *)key</code></p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-operator">+</span> (<span class="hljs-type">NSSet</span>&lt;<span class="hljs-type">NSString</span> *&gt; <span class="hljs-operator">*</span>)keyPathsForValuesAffectingValueForKey:(<span class="hljs-type">NSString</span> <span class="hljs-operator">*</span>)key &#123;<br>    <span class="hljs-type">NSSet</span> <span class="hljs-operator">*</span>keyPaths <span class="hljs-operator">=</span> [<span class="hljs-keyword">super</span> keyPathsForValuesAffectingValueForKey:key];<br>    <span class="hljs-keyword">if</span> ([key isEqualToString:@<span class="hljs-string">&quot;dog&quot;</span>]) &#123;<br>        <span class="hljs-type">NSArray</span> <span class="hljs-operator">*</span>array <span class="hljs-operator">=</span> @[@<span class="hljs-string">&quot;_dog.name&quot;</span>, @<span class="hljs-string">&quot;_dog.level&quot;</span>];<br>        keyPaths <span class="hljs-operator">=</span> [keyPaths setByAddingObjectsFromArray:array];<br>    &#125;<br>    <span class="hljs-keyword">return</span> keyPaths;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›´æ¥è§‚å¯Ÿ<code>Dog</code>ç±»</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">[person addObserver:<span class="hljs-keyword">self</span> forKeyPath:<span class="hljs-string">@&quot;dog&quot;</span> options:<span class="hljs-built_in">NSKeyValueObservingOptionNew</span> context:<span class="hljs-literal">nil</span>];<br></code></pre></td></tr></table></figure><p>æ‰“å°ç»“æœ</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">2019-03-22</span> <span class="hljs-number">09</span>:<span class="hljs-number">27:11.485240</span>+<span class="hljs-number">0800</span> KVO[<span class="hljs-number">1929:87568</span>] &#123;<br>    kind = <span class="hljs-number">1</span><span class="hljs-comment">;</span><br>    new = &quot;&lt;Dog: <span class="hljs-number">0</span>x60<span class="hljs-number">00027c0b80</span>&gt;&quot;<span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ‰‹åŠ¨æ¨¡å¼"><a href="#æ‰‹åŠ¨æ¨¡å¼" class="headerlink" title="æ‰‹åŠ¨æ¨¡å¼"></a>æ‰‹åŠ¨æ¨¡å¼</h3><p>åœ¨Personç±»ä¸­é‡å†™<code>+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key</code></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">+ (<span class="hljs-built_in">BOOL</span>)automaticallyNotifiesObserversForKey:(<span class="hljs-built_in">NSString</span> *)key &#123;<br>    <span class="hljs-comment">// ä¿®æ”¹ä¸ºæ‰‹åŠ¨æ¨¡å¼</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NO</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ‰‹åŠ¨è§¦å‘</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clojure">[self.person willChangeValueForKey:@<span class="hljs-string">&quot;name&quot;</span>]<span class="hljs-comment">;</span><br>[self.person didChangeValueForKey:@<span class="hljs-string">&quot;name&quot;</span>]<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h3 id="è§‚å¯Ÿå®¹å™¨ç±»"><a href="#è§‚å¯Ÿå®¹å™¨ç±»" class="headerlink" title="è§‚å¯Ÿå®¹å™¨ç±»"></a>è§‚å¯Ÿå®¹å™¨ç±»</h3><p>éœ€è¦åˆ©ç”¨<code>KVC</code><br>ä¾‹å¦‚è§‚å¯Ÿ<code>person</code>ä¸­çš„<code>array</code></p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clojure">[[self.person mutableArrayValueForKey:@<span class="hljs-string">&quot;array&quot;</span>] addObject:@<span class="hljs-string">&quot;obj&quot;</span>]<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">2019-03-22</span> <span class="hljs-number">11</span>:<span class="hljs-number">02</span>:<span class="hljs-number">13.996095</span>+<span class="hljs-number">0800</span> KVO[<span class="hljs-number">5521:170395</span>] &#123;<br>    indexes = &quot;&lt;_NSCachedIndexSet: <span class="hljs-number">0</span>x<span class="hljs-number">600002216160</span>&gt;[number of indexes: <span class="hljs-number">1</span> (in <span class="hljs-number">1</span> ranges), indexes: (<span class="hljs-number">0</span>)]&quot;<span class="hljs-comment">;</span><br>    kind = <span class="hljs-number">2</span><span class="hljs-comment">;</span><br>    new =     (<br>        obj<br>    )<span class="hljs-comment">;</span><br>&#125;<br></code></pre></td></tr></table></figure><hr><h3 id="KVOçš„åº•å±‚å®ç°"><a href="#KVOçš„åº•å±‚å®ç°" class="headerlink" title="KVOçš„åº•å±‚å®ç°"></a>KVOçš„åº•å±‚å®ç°</h3><p>å®è´¨ï¼šè§‚å¯Ÿå€¼çš„setteræ–¹æ³•<br>é€šè¿‡runtimeï¼Œæ–°å»ºä¸€ä¸ªå­ç±»ç»§æ‰¿äºè§‚å¯Ÿç±»ï¼ˆNSKVONotifing_ç±»åï¼‰ï¼ŒåŠ¨æ€çš„ä¿®æ”¹äº†è§‚å¯Ÿç±»çš„ç±»å‹ä¸ºå­ç±»çš„ç±»å‹,åœ¨å­ç±»é‡Œé¢é‡å†™setæ–¹æ³•ï¼Œè°ƒç”¨</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">setName</span>:(NSString *)<span class="hljs-selector-tag">name</span> &#123;<br>    <span class="hljs-selector-attr">[self willChangeValueForKey:@<span class="hljs-string">&quot;name&quot;</span>]</span>;<br>    <span class="hljs-selector-attr">[super setName:name]</span>;<br>    <span class="hljs-selector-attr">[self didChangeValueForKey:@<span class="hljs-string">&quot;name&quot;</span>]</span>;   <br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åº•å±‚</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Block</title>
    <link href="/2020/08/01/iOS%E5%BA%95%E5%B1%82-Block/"/>
    <url>/2020/08/01/iOS%E5%BA%95%E5%B1%82-Block/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-cd0f22bd52a1e015.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><h3 id="Blockçš„å®è´¨"><a href="#Blockçš„å®è´¨" class="headerlink" title="Blockçš„å®è´¨"></a>Blockçš„å®è´¨</h3><p>æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ªOCå¯¹è±¡ï¼Œä»–å†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ªisaæŒ‡é’ˆã€‚Blockæ˜¯å°è£…äº†å‡½æ•°è°ƒç”¨ä»¥åŠå‡½æ•°è°ƒç”¨ç¯å¢ƒçš„OCå¯¹è±¡ã€‚</p><h3 id="Blockä¸‰ç§ç±»å‹"><a href="#Blockä¸‰ç§ç±»å‹" class="headerlink" title="Blockä¸‰ç§ç±»å‹"></a>Blockä¸‰ç§ç±»å‹</h3><table><thead><tr><th>ç±»å‹</th><th>å­˜å‚¨åŒºåŸŸ</th></tr></thead><tbody><tr><td>GlobalBlock</td><td>æ•°æ®åŒº</td></tr><tr><td>StackBlock</td><td>æ ˆåŒº</td></tr><tr><td>MallocBlock</td><td>å †åŒº</td></tr></tbody></table><h3 id="Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼"><a href="#Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼"></a>Blocké¿å…å¾ªç¯å¼•ç”¨çš„ä¸‰ç§æ–¹å¼</h3><p>1ã€åˆ©ç”¨ <code>__weak</code>å’Œ<code>__strong</code></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"> __<span class="hljs-keyword">weak</span> <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;<br><span class="hljs-keyword">self</span>.block = ^&#123;<br>    __<span class="hljs-keyword">strong</span> <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) strongSelf = weakSelf;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, <span class="hljs-built_in">NSStringFromCGRect</span>(strongSelf.view.frame));<br>&#125;;<br><span class="hljs-keyword">self</span>.block();<br></code></pre></td></tr></table></figure><p>2ã€åˆ©ç”¨é€ æˆå¾ªç¯å¼•ç”¨çš„ä¸´æ—¶å˜é‡</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">__block ViewController *vc = <span class="hljs-keyword">self</span>;<br><span class="hljs-keyword">self</span>.block = ^&#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, <span class="hljs-built_in">NSStringFromCGRect</span>(vc.view.frame));<br>    vc = <span class="hljs-literal">nil</span>;<br>&#125;;<br><span class="hljs-keyword">self</span>.block();<br></code></pre></td></tr></table></figure><p>3ã€ç›´æ¥å£°æ˜Blockä¸­æ·»åŠ é€ æˆå¾ªç¯å¼•ç”¨çš„å‚æ•°</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">void</span>(^Block)(<span class="hljs-built_in">UIViewController</span> *vc);<br><br><span class="hljs-keyword">self</span>.block = ^(<span class="hljs-built_in">UIViewController</span> *vc)&#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, <span class="hljs-built_in">NSStringFromCGRect</span>(vc.view.frame));<br>&#125;;<br><span class="hljs-keyword">self</span>.block(<span class="hljs-keyword">self</span>);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åº•å±‚</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Runtime-æ¶ˆæ¯è½¬å‘</title>
    <link href="/2020/07/01/iOS%E5%BA%95%E5%B1%82-Runtime-%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/"/>
    <url>/2020/07/01/iOS%E5%BA%95%E5%B1%82-Runtime-%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91/</url>
    
    <content type="html"><![CDATA[<p>iOS æ–¹æ³•çš„åŠ¨æ€è§£æå’Œæ¶ˆæ¯è½¬å‘</p><p>ä»¥åˆ›å»ºçš„Messageç±»ä¸ºç¤ºä¾‹<br>Message.h</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">Message</span> : <span class="hljs-title">NSObject</span></span><br><br>- (<span class="hljs-keyword">void</span>)sendMessage:(<span class="hljs-built_in">NSString</span> *)message;<br><br>+ (<span class="hljs-keyword">void</span>)sendClassMessage:(<span class="hljs-built_in">NSString</span> *)message;<br><br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><p>Message.m</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@implementation</span> Message<br><br><span class="hljs-variable">@end</span><br></code></pre></td></tr></table></figure><h3 id="åŠ¨æ€æ–¹æ³•è§£æ"><a href="#åŠ¨æ€æ–¹æ³•è§£æ" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æ"></a>åŠ¨æ€æ–¹æ³•è§£æ</h3><p>å¾è¯¢æ¥æ”¶è€…æ‰€å±çš„ç±»ï¼Œæ˜¯å¦éœ€è¦åŠ¨æ€æ·»åŠ ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ï¼Œæ¥å¤„ç†è¿™ä¸ªæœªæ‰¾åˆ°çš„æ–¹æ³•ã€‚</p><ol><li>é¦–å…ˆåˆ¤æ–­æ˜¯å¦å®ç°äº† <code>resolveInstanceMethod</code>ï¼Œå¦‚æœæ²¡æœ‰å®ç°ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼›</li><li>å¦‚æœå®ç°äº†ï¼Œè°ƒç”¨ <code>resolveInstanceMethod</code>ï¼Œè·å–è¿”å›å€¼ï¼›</li><li>å¦‚æœè¿”å›å€¼ä¸º YESï¼Œè¡¨ç¤º <code>resolveInstanceMethod</code> å£°ç§°å®ƒå·²ç»æä¾›äº† <code>selector</code> çš„å®ç°ï¼Œå› æ­¤å†æ¬¡æŸ¥æ‰¾ method listï¼Œå¦‚æœæ‰¾åˆ°å¯¹åº”çš„ <code>IMP</code>ï¼Œåˆ™è¿”å›è¯¥å®ç°ï¼Œå¦åˆ™æç¤ºè­¦å‘Šä¿¡æ¯ï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼›</li><li>å¦‚æœè¿”å›å€¼ä¸º NOï¼Œè¿›å…¥ä¸‹ä¸€æ­¥å¤„ç†ï¼›<h4 id="1-å¯¹è±¡æ–¹æ³•"><a href="#1-å¯¹è±¡æ–¹æ³•" class="headerlink" title="1. å¯¹è±¡æ–¹æ³•"></a>1. å¯¹è±¡æ–¹æ³•</h4>é€šè¿‡<code>+ (BOOL)resolveInstanceMethod:(SEL)sel;</code>æ–¹æ³•è¿›è¡Œè§£æ<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">+ (<span class="hljs-built_in">BOOL</span>)resolveInstanceMethod:(SEL)sel &#123;<br>    <span class="hljs-keyword">if</span> (sel == <span class="hljs-keyword">@selector</span>(sendMessage:)) &#123;<br>        class_addMethod([<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>], sel, (IMP)innerSenderMessageMetod, <span class="hljs-string">&quot;v@:@&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">super</span> resolveInstanceMethod:sel];<br>&#125;<br><br><span class="hljs-keyword">void</span> innerSenderMessageMetod(<span class="hljs-keyword">id</span> obj, SEL _cmd) &#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;å¯¹è±¡æ–¹æ³•ï¼ŒåŠ¨æ€è§£æ&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-ç±»æ–¹æ³•"><a href="#2-ç±»æ–¹æ³•" class="headerlink" title="2. ç±»æ–¹æ³•"></a>2. ç±»æ–¹æ³•</h4>é€šè¿‡<code>+ (BOOL)resolveClassMethod:(SEL)sel;</code>æ–¹æ³•è¿›è¡Œè§£æ<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">+ (<span class="hljs-built_in">BOOL</span>)resolveClassMethod:(SEL)sel &#123;<br>    <span class="hljs-keyword">if</span> (sel == <span class="hljs-keyword">@selector</span>(sendClassMessage:)) &#123;<br>        class_addMethod(object_getClass(<span class="hljs-keyword">self</span>), sel, (IMP)innerSenderClassMessageMetod, <span class="hljs-string">&quot;v@:@&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">super</span> resolveClassMethod:sel];<br>&#125;<br><br><span class="hljs-keyword">void</span> innerSenderClassMessageMetod(<span class="hljs-keyword">id</span> obj, SEL _cmd) &#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;ç±»æ–¹æ³•ï¼ŒåŠ¨æ€è§£æ&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h3>å¦‚æœæ²¡æœ‰åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œåˆ™ä¼šè¿›å…¥æ­¤é˜¶æ®µï¼Œæ­¤æ—¶è¯¢é—®æ˜¯å¦è¦å°†è¿™æ¡æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–çš„å¯¹è±¡ï¼Œæ¥å¤„ç†è¿™ä¸ªæ–¹æ³•ã€‚å¦‚æœè¿”å›nilï¼Œå³è¡¨ç¤ºä¸è½¬å‘ç»™å…¶ä»–å¯¹è±¡ï¼Œæ­¤æ—¶ä¼šè¿›å…¥ç¬¬3é˜¶æ®µ<br>åˆ›å»ºäº†ä¸€ä¸ªå¤‡ç”¨ç±»<code>MessageTemp</code><br>MessageTemp.h<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">MessageTemp</span> : <span class="hljs-title">NSObject</span></span><br><br>- (<span class="hljs-keyword">void</span>)sendMessage:(<span class="hljs-built_in">NSString</span> *)message;<br>- (<span class="hljs-keyword">void</span>)sendClassMessage:(<span class="hljs-built_in">NSString</span> *)message;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure>MessageTemp.m<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">MessageTemp</span></span><br>- (<span class="hljs-keyword">void</span>)sendMessage:(<span class="hljs-built_in">NSString</span> *)message &#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;å¤‡ç”¨Messageï¼Œè§£æå¯¹è±¡æ–¹æ³•&quot;</span>);<br>&#125;<br>- (<span class="hljs-keyword">void</span>)sendClassMessage:(<span class="hljs-built_in">NSString</span> *)message &#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;å¤‡ç”¨Messageï¼Œè§£æç±»æ–¹æ³•&quot;</span>);<br>&#125;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><h4 id="1-å¯¹è±¡æ–¹æ³•-1"><a href="#1-å¯¹è±¡æ–¹æ³•-1" class="headerlink" title="1. å¯¹è±¡æ–¹æ³•"></a>1. å¯¹è±¡æ–¹æ³•</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">-</span> (id)<span class="hljs-selector-tag">forwardingTargetForSelector</span>:(SEL)<span class="hljs-selector-tag">aSelector</span> &#123;<br>    <span class="hljs-selector-tag">if</span> (aSelector == <span class="hljs-variable">@selector</span>(<span class="hljs-attribute">sendMessage</span>:)) &#123;<br>        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-attr">[MessageTemp new]</span>;<br>    &#125;<br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-attr">[super forwardingTargetForSelector:aSelector]</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-ç±»æ–¹æ³•-1"><a href="#2-ç±»æ–¹æ³•-1" class="headerlink" title="2. ç±»æ–¹æ³•"></a>2. ç±»æ–¹æ³•</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">+ (id)forwardingTargetForSelector:(SEL)aSelector &#123;<br>    <span class="hljs-keyword">if</span> (aSelector == <span class="hljs-meta">@selector(sendClassMessage:)</span>) &#123;<br>        <span class="hljs-keyword">return</span> [MessageTemp new];<br>    &#125;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">super</span> forwardingTargetForSelector:aSelector];<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ¶ˆæ¯è½¬å‘"><a href="#æ¶ˆæ¯è½¬å‘" class="headerlink" title="æ¶ˆæ¯è½¬å‘"></a>æ¶ˆæ¯è½¬å‘</h3>å½“ <code>forwardingTargetForSelector:</code> æ–¹æ³•æœªåšå‡ºä»»ä½•å“åº”çš„è¯ï¼Œä¼šæ¥åˆ°æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚æ¶ˆæ¯è½¬å‘æ—¶ä¼šé¦–å…ˆè°ƒç”¨ <code>methodSignatureForSelector:</code> æ–¹æ³•ï¼Œåœ¨æ–¹æ³•å†…éƒ¨ç”Ÿæˆ <code>NSMethodSignature</code> ç±»å‹çš„æ–¹æ³•ç­¾åå¯¹è±¡ã€‚åœ¨ç”Ÿæˆç­¾åå¯¹è±¡æ—¶ï¼Œå¯ä»¥æŒ‡å®š <code>target</code> å’Œ <code>SEL</code>ï¼Œå¯ä»¥å°†è¿™ä¸¤ä¸ªå‚æ•°æ¢æˆå…¶ä»–å‚æ•°ï¼Œå°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚<h4 id="1-å¯¹è±¡æ–¹æ³•-2"><a href="#1-å¯¹è±¡æ–¹æ³•-2" class="headerlink" title="1. å¯¹è±¡æ–¹æ³•"></a>1. å¯¹è±¡æ–¹æ³•</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">forwardInvocation</span>:(NSInvocation *)<span class="hljs-selector-tag">anInvocation</span> &#123;<br>    <span class="hljs-selector-tag">if</span> ([anInvocation selector] == <span class="hljs-variable">@selector</span>(<span class="hljs-attribute">sendMessage</span>:)) &#123;<br>        <span class="hljs-selector-attr">[anInvocation invokeWithTarget:[MessageTemp new]</span>];<br>    &#125; <span class="hljs-selector-tag">else</span> &#123;<br>        <span class="hljs-selector-attr">[super forwardInvocation:anInvocation]</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-selector-tag">-</span> (NSMethodSignature *)<span class="hljs-selector-tag">methodSignatureForSelector</span>:(SEL)<span class="hljs-selector-tag">aSelector</span> &#123;<br>    <span class="hljs-selector-tag">if</span> (aSelector == <span class="hljs-variable">@selector</span>(<span class="hljs-attribute">sendMessage</span>:)) &#123;<br>        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-attr">[NSMethodSignature signatureWithObjCTypes:<span class="hljs-string">&quot;v@:@&quot;</span>]</span>;<br>    &#125;<br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-attr">[super methodSignatureForSelector:aSelector]</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-ç±»æ–¹æ³•-2"><a href="#2-ç±»æ–¹æ³•-2" class="headerlink" title="2. ç±»æ–¹æ³•"></a>2. ç±»æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">+ (<span class="hljs-keyword">void</span>)forwardInvocation:(NSInvocation *)anInvocation &#123;<br>    <span class="hljs-keyword">if</span> ([anInvocation selector] == <span class="hljs-meta">@selector(sendClassMessage:)</span>) &#123;<br>        [anInvocation invokeWithTarget:[MessageTemp <span class="hljs-keyword">new</span>]];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        [<span class="hljs-keyword">super</span> forwardInvocation:anInvocation];<br>    &#125;<br>&#125;<br><br>+ (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123;<br>    <span class="hljs-keyword">if</span> (aSelector == <span class="hljs-meta">@selector(sendClassMessage:)</span>) &#123;<br>        <span class="hljs-keyword">return</span> [NSMethodSignature signatureWithObjCTypes:<span class="hljs-string">&quot;v@:@&quot;</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">super</span> methodSignatureForSelector:aSelector];<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="headerlink" title="åº”ç”¨åœºæ™¯"></a>åº”ç”¨åœºæ™¯</h3></li></ol><ul><li>é€‚ç”¨äºæŠŠæ“ä½œç»™å¦å¤–ä¸€ä¸ªç±»æ¥å®ç°</li><li>åˆ©ç”¨åˆ†ç±»ï¼Œé˜²æ­¢åº”ç”¨ç¨‹åºå› ä¸ºæœªå¤„ç†æ¶ˆæ¯è€Œå´©æºƒ</li><li>Jspatch </li><li>Aspects</li><li>BlocksKit</li></ul>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åº•å±‚</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSåº•å±‚-RunLoop</title>
    <link href="/2020/07/01/iOS%E5%BA%95%E5%B1%82-RunLoop/"/>
    <url>/2020/07/01/iOS%E5%BA%95%E5%B1%82-RunLoop/</url>
    
    <content type="html"><![CDATA[<h1 id="RunLoop"><a href="#RunLoop" class="headerlink" title="RunLoop"></a>RunLoop</h1><h2 id="ä¸€ã€æ¦‚å¿µ"><a href="#ä¸€ã€æ¦‚å¿µ" class="headerlink" title="ä¸€ã€æ¦‚å¿µ"></a>ä¸€ã€æ¦‚å¿µ</h2><p>RunLoopæ˜¯é€šè¿‡å†…éƒ¨ç»´æŠ¤çš„<code>äº‹ä»¶å¾ªç¯(Event Loop)</code>æ¥å¯¹<code>äº‹ä»¶/æ¶ˆæ¯è¿›è¡Œç®¡ç†</code>çš„ä¸€ä¸ªå¯¹è±¡ã€‚</p><p>1ã€æ²¡æœ‰æ¶ˆæ¯å¤„ç†æ—¶ï¼Œä¼‘çœ å·²é¿å…èµ„æºå ç”¨ï¼Œç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€(CPU-å†…æ ¸æ€å’Œç”¨æˆ·æ€)<br><br>2ã€æœ‰æ¶ˆæ¯éœ€è¦å¤„ç†æ—¶ï¼Œç«‹åˆ»è¢«å”¤é†’ï¼Œç”±å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€</p><p><strong>ä¸ºä»€ä¹ˆmainå‡½æ•°ä¸ä¼šé€€å‡ºï¼Ÿ</strong></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-keyword">int</span> main(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * argv[]) &#123;<br>    <span class="hljs-keyword">@autoreleasepool</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">UIApplicationMain</span>(argc, argv, <span class="hljs-literal">nil</span>, <span class="hljs-built_in">NSStringFromClass</span>([AppDelegate <span class="hljs-keyword">class</span>]));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>UIApplicationMainå†…éƒ¨é»˜è®¤å¼€å¯äº†ä¸»çº¿ç¨‹çš„RunLoopï¼Œå¹¶æ‰§è¡Œäº†ä¸€æ®µæ— é™å¾ªç¯çš„ä»£ç ï¼ˆä¸æ˜¯ç®€å•çš„forå¾ªç¯æˆ–whileå¾ªç¯ï¼‰</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-comment">//æ— é™å¾ªç¯ä»£ç æ¨¡å¼(ä¼ªä»£ç )</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> * argv[])</span> </span>&#123;        <br>    BOOL running = YES;<br>    <span class="hljs-keyword">do</span> &#123;<br>        <span class="hljs-comment">// æ‰§è¡Œå„ç§ä»»åŠ¡ï¼Œå¤„ç†å„ç§äº‹ä»¶</span><br>        <span class="hljs-comment">// ......</span><br>    &#125; <span class="hljs-keyword">while</span> (running);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>UIApplicationMainå‡½æ•°ä¸€ç›´æ²¡æœ‰è¿”å›ï¼Œè€Œæ˜¯ä¸æ–­åœ°æ¥æ”¶å¤„ç†æ¶ˆæ¯ä»¥åŠç­‰å¾…ä¼‘çœ ï¼Œæ‰€ä»¥è¿è¡Œç¨‹åºä¹‹åä¼šä¿æŒæŒç»­è¿è¡ŒçŠ¶æ€ã€‚</p><h2 id="äºŒã€RunLoopçš„æ•°æ®ç»“æ„"><a href="#äºŒã€RunLoopçš„æ•°æ®ç»“æ„" class="headerlink" title="äºŒã€RunLoopçš„æ•°æ®ç»“æ„"></a>äºŒã€RunLoopçš„æ•°æ®ç»“æ„</h2><p><code>NSRunLoop(Foundation)</code>æ˜¯<code>CFRunLoop(CoreFoundation)</code>çš„å°è£…ï¼Œæä¾›äº†é¢å‘å¯¹è±¡çš„API<br>RunLoop ç›¸å…³çš„ä¸»è¦æ¶‰åŠäº”ä¸ªç±»ï¼š</p><p><code>CFRunLoop</code>ï¼šRunLoopå¯¹è±¡<br><code>CFRunLoopMode</code>ï¼šè¿è¡Œæ¨¡å¼<br><code>CFRunLoopSource</code>ï¼šè¾“å…¥æº/äº‹ä»¶æº<br><code>CFRunLoopTimer</code>ï¼šå®šæ—¶æº<br><code>CFRunLoopObserver</code>ï¼šè§‚å¯Ÿè€…</p><p><strong>1ã€CFRunLoop</strong></p><p>ç”±<code>pthread</code>(çº¿ç¨‹å¯¹è±¡ï¼Œè¯´æ˜RunLoopå’Œçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„)ã€<code>currentMode</code>(å½“å‰æ‰€å¤„çš„è¿è¡Œæ¨¡å¼)ã€<code>modes</code>(å¤šä¸ªè¿è¡Œæ¨¡å¼çš„é›†åˆ)ã€<code>commonModes</code>(æ¨¡å¼åç§°å­—ç¬¦ä¸²é›†åˆ)ã€<code>commonModelItems</code>(Observer,Timer,Sourceé›†åˆ)æ„æˆ</p><p><strong>2ã€CFRunLoopMode</strong></p><p>ç”±nameã€source0ã€source1ã€observersã€timersæ„æˆ</p><p><strong>3ã€CFRunLoopSource</strong></p><p>åˆ†ä¸ºsource0å’Œsource1ä¸¤ç§</p><ul><li><code>source0:</code><br>å³éåŸºäºportçš„ï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·è§¦å‘çš„äº‹ä»¶ã€‚éœ€è¦æ‰‹åŠ¨å”¤é†’çº¿ç¨‹ï¼Œå°†å½“å‰çº¿ç¨‹ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€</li></ul><ul><li><code>source1:</code><br>åŸºäºportçš„ï¼ŒåŒ…å«ä¸€ä¸ª mach_port å’Œä¸€ä¸ªå›è°ƒï¼Œå¯ç›‘å¬ç³»ç»Ÿç«¯å£å’Œé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹å‘é€çš„æ¶ˆæ¯ï¼Œèƒ½ä¸»åŠ¨å”¤é†’RunLoopï¼Œæ¥æ”¶åˆ†å‘ç³»ç»Ÿäº‹ä»¶ã€‚<br>å…·å¤‡å”¤é†’çº¿ç¨‹çš„èƒ½åŠ›</li></ul><p><strong>4ã€CFRunLoopTimer</strong></p><p>åŸºäºæ—¶é—´çš„è§¦å‘å™¨ï¼ŒåŸºæœ¬ä¸Šè¯´çš„å°±æ˜¯NSTimerã€‚åœ¨é¢„è®¾çš„æ—¶é—´ç‚¹å”¤é†’RunLoopæ‰§è¡Œå›è°ƒã€‚å› ä¸ºå®ƒæ˜¯åŸºäºRunLoopçš„ï¼Œå› æ­¤å®ƒä¸æ˜¯å®æ—¶çš„ï¼ˆå°±æ˜¯NSTimer æ˜¯ä¸å‡†ç¡®çš„ã€‚ å› ä¸ºRunLoopåªè´Ÿè´£åˆ†å‘æºçš„æ¶ˆæ¯ã€‚å¦‚æœçº¿ç¨‹å½“å‰æ­£åœ¨å¤„ç†ç¹é‡çš„ä»»åŠ¡ï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´Timeræœ¬æ¬¡å»¶æ—¶ï¼Œæˆ–è€…å°‘æ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚</p><p><strong>5ã€CFRunLoopObserver</strong></p><p>ç›‘å¬ä»¥ä¸‹æ—¶é—´ç‚¹:<code>CFRunLoopActivity</code></p><ul><li><p><code>kCFRunLoopEntry</code><br>RunLoopå‡†å¤‡å¯åŠ¨</p></li><li><p><code>kCFRunLoopBeforeTimers</code><br>RunLoopå°†è¦å¤„ç†ä¸€äº›Timerç›¸å…³äº‹ä»¶</p></li><li><p><code>kCFRunLoopBeforeSources</code><br>RunLoopå°†è¦å¤„ç†ä¸€äº›Sourceäº‹ä»¶</p></li><li><p><code>kCFRunLoopBeforeWaiting</code><br>RunLoopå°†è¦è¿›è¡Œä¼‘çœ çŠ¶æ€,å³å°†ç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€</p></li><li><p><code>kCFRunLoopAfterWaiting</code><br>RunLoopè¢«å”¤é†’ï¼Œå³ä»å†…æ ¸æ€åˆ‡æ¢åˆ°ç”¨æˆ·æ€å</p></li><li><p><code>kCFRunLoopExit</code><br>RunLoopé€€å‡º</p></li><li><p><code>kCFRunLoopAllActivities</code><br>ç›‘å¬æ‰€æœ‰çŠ¶æ€</p></li></ul><p><strong>6ã€å„æ•°æ®ç»“æ„ä¹‹é—´çš„è”ç³»</strong></p><p>çº¿ç¨‹å’ŒRunLoopä¸€ä¸€å¯¹åº”ï¼Œ RunLoopå’ŒModeæ˜¯ä¸€å¯¹å¤šçš„ï¼ŒModeå’Œsourceã€timerã€observerä¹Ÿæ˜¯ä¸€å¯¹å¤šçš„</p><h2 id="ä¸‰ã€RunLoopçš„Mode"><a href="#ä¸‰ã€RunLoopçš„Mode" class="headerlink" title="ä¸‰ã€RunLoopçš„Mode"></a>ä¸‰ã€RunLoopçš„Mode</h2><p>å…³äºModeé¦–å…ˆè¦çŸ¥é“ä¸€ä¸ªRunLoop å¯¹è±¡ä¸­å¯èƒ½åŒ…å«å¤šä¸ªModeï¼Œä¸”æ¯æ¬¡è°ƒç”¨ RunLoop çš„ä¸»å‡½æ•°æ—¶ï¼Œåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª Mode(CurrentMode)ã€‚åˆ‡æ¢ Modeï¼Œéœ€è¦é‡æ–°æŒ‡å®šä¸€ä¸ª Mode ã€‚ä¸»è¦æ˜¯ä¸ºäº†åˆ†éš”å¼€ä¸åŒçš„ Sourceã€Timerã€Observerï¼Œè®©å®ƒä»¬ä¹‹é—´äº’ä¸å½±å“ã€‚</p><p>å½“RunLoopè¿è¡Œåœ¨Mode1ä¸Šæ—¶ï¼Œæ˜¯æ— æ³•æ¥å—å¤„ç†Mode2æˆ–Mode3ä¸Šçš„Sourceã€Timerã€Observeräº‹ä»¶çš„</p><p>æ€»å…±æ˜¯æœ‰äº”ç§<code>CFRunLoopMode</code>:</p><ul><li><code>kCFRunLoopDefaultMode</code>ï¼šé»˜è®¤æ¨¡å¼ï¼Œä¸»çº¿ç¨‹æ˜¯åœ¨è¿™ä¸ªè¿è¡Œæ¨¡å¼ä¸‹è¿è¡Œ</li><li><code>UITrackingRunLoopMode</code>ï¼šè·Ÿè¸ªç”¨æˆ·äº¤äº’äº‹ä»¶ï¼ˆç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»–Modeå½±å“ï¼‰</li><li><code>UIInitializationRunLoopMode</code>ï¼šåœ¨åˆšå¯åŠ¨Appæ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª Modeï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨</li><li><code>GSEventReceiveRunLoopMode</code>ï¼šæ¥å—ç³»ç»Ÿå†…éƒ¨äº‹ä»¶ï¼Œé€šå¸¸ç”¨ä¸åˆ°</li><li><code>kCFRunLoopCommonModes</code>ï¼šä¼ªæ¨¡å¼ï¼Œä¸æ˜¯ä¸€ç§çœŸæ­£çš„è¿è¡Œæ¨¡å¼ï¼Œæ˜¯åŒæ­¥Source/Timer/Observeråˆ°å¤šä¸ªModeä¸­çš„ä¸€ç§è§£å†³æ–¹æ¡ˆ</li></ul><h2 id="å››ã€RunLoopçš„å®ç°æœºåˆ¶"><a href="#å››ã€RunLoopçš„å®ç°æœºåˆ¶" class="headerlink" title="å››ã€RunLoopçš„å®ç°æœºåˆ¶"></a>å››ã€RunLoopçš„å®ç°æœºåˆ¶</h2><p>å¯¹äºRunLoopè€Œè¨€æœ€æ ¸å¿ƒçš„äº‹æƒ…å°±æ˜¯ä¿è¯çº¿ç¨‹åœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ä¼‘çœ ï¼Œåœ¨æœ‰æ¶ˆæ¯æ—¶å”¤é†’ï¼Œä»¥æé«˜ç¨‹åºæ€§èƒ½ã€‚RunLoopè¿™ä¸ªæœºåˆ¶æ˜¯ä¾é ç³»ç»Ÿå†…æ ¸æ¥å®Œæˆçš„ï¼ˆè‹¹æœæ“ä½œç³»ç»Ÿæ ¸å¿ƒç»„ä»¶Darwinä¸­çš„Machï¼‰ã€‚</p><p>RunLoopé€šè¿‡<code>mach_msg()</code>å‡½æ•°æ¥æ”¶ã€å‘é€æ¶ˆæ¯ã€‚å®ƒçš„æœ¬è´¨æ˜¯è°ƒç”¨å‡½æ•°<code>mach_msg_trap()</code>ï¼Œç›¸å½“äºæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œä¼šè§¦å‘å†…æ ¸çŠ¶æ€åˆ‡æ¢ã€‚åœ¨ç”¨æˆ·æ€è°ƒç”¨ <code>mach_msg_trap()</code>æ—¶ä¼šåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼›å†…æ ¸æ€ä¸­å†…æ ¸å®ç°çš„<code>mach_msg()</code>å‡½æ•°ä¼šå®Œæˆå®é™…çš„å·¥ä½œã€‚<br>å³åŸºäºportçš„source1ï¼Œç›‘å¬ç«¯å£ï¼Œç«¯å£æœ‰æ¶ˆæ¯å°±ä¼šè§¦å‘å›è°ƒï¼›è€Œsource0ï¼Œè¦æ‰‹åŠ¨æ ‡è®°ä¸ºå¾…å¤„ç†å’Œæ‰‹åŠ¨å”¤é†’RunLoop</p><p><a href="https://www.jianshu.com/p/a764aad31847">Machæ¶ˆæ¯å‘é€æœºåˆ¶</a><br>å¤§è‡´é€»è¾‘ä¸ºï¼š<br>1ã€é€šçŸ¥è§‚å¯Ÿè€… RunLoop å³å°†å¯åŠ¨ã€‚<br>2ã€é€šçŸ¥è§‚å¯Ÿè€…å³å°†è¦å¤„ç†Timeräº‹ä»¶ã€‚<br>3ã€é€šçŸ¥è§‚å¯Ÿè€…å³å°†è¦å¤„ç†source0äº‹ä»¶ã€‚<br>4ã€å¤„ç†source0äº‹ä»¶ã€‚<br>5ã€å¦‚æœåŸºäºç«¯å£çš„æº(Source1)å‡†å¤‡å¥½å¹¶å¤„äºç­‰å¾…çŠ¶æ€ï¼Œè¿›å…¥æ­¥éª¤9ã€‚<br>6ã€é€šçŸ¥è§‚å¯Ÿè€…çº¿ç¨‹å³å°†è¿›å…¥ä¼‘çœ çŠ¶æ€ã€‚<br>7ã€å°†çº¿ç¨‹ç½®äºä¼‘çœ çŠ¶æ€ï¼Œç”±ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œç›´åˆ°ä¸‹é¢çš„ä»»ä¸€äº‹ä»¶å‘ç”Ÿæ‰å”¤é†’çº¿ç¨‹ã€‚</p><ul><li>ä¸€ä¸ªåŸºäº port çš„Source1 çš„äº‹ä»¶(å›¾é‡Œåº”è¯¥æ˜¯source0)ã€‚</li><li>ä¸€ä¸ª Timer åˆ°æ—¶é—´äº†ã€‚</li><li>RunLoop è‡ªèº«çš„è¶…æ—¶æ—¶é—´åˆ°äº†ã€‚</li><li>è¢«å…¶ä»–è°ƒç”¨è€…æ‰‹åŠ¨å”¤é†’ã€‚</li></ul><p>8ã€é€šçŸ¥è§‚å¯Ÿè€…çº¿ç¨‹å°†è¢«å”¤é†’ã€‚<br>9ã€å¤„ç†å”¤é†’æ—¶æ”¶åˆ°çš„äº‹ä»¶ã€‚</p><ul><li>å¦‚æœç”¨æˆ·å®šä¹‰çš„å®šæ—¶å™¨å¯åŠ¨ï¼Œå¤„ç†å®šæ—¶å™¨äº‹ä»¶å¹¶é‡å¯RunLoopã€‚è¿›å…¥æ­¥éª¤2ã€‚</li><li>å¦‚æœè¾“å…¥æºå¯åŠ¨ï¼Œä¼ é€’ç›¸åº”çš„æ¶ˆæ¯ã€‚</li><li>å¦‚æœRunLoopè¢«æ˜¾ç¤ºå”¤é†’è€Œä¸”æ—¶é—´è¿˜æ²¡è¶…æ—¶ï¼Œé‡å¯RunLoopã€‚è¿›å…¥æ­¥éª¤2</li></ul><p>10ã€é€šçŸ¥è§‚å¯Ÿè€…RunLoopç»“æŸã€‚</p><h2 id="äº”ã€RunLoopä¸NSTimer"><a href="#äº”ã€RunLoopä¸NSTimer" class="headerlink" title="äº”ã€RunLoopä¸NSTimer"></a>äº”ã€RunLoopä¸NSTimer</h2><p>ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„é—®é¢˜ï¼šæ»‘åŠ¨tableViewæ—¶ï¼Œå®šæ—¶å™¨è¿˜ä¼šç”Ÿæ•ˆå—ï¼Ÿ<br>é»˜è®¤æƒ…å†µä¸‹RunLoopè¿è¡Œåœ¨<code>kCFRunLoopDefaultMode</code>ä¸‹ï¼Œè€Œå½“æ»‘åŠ¨tableViewæ—¶ï¼ŒRunLoopåˆ‡æ¢åˆ°<code>UITrackingRunLoopMode</code>ï¼Œè€ŒTimeræ˜¯åœ¨<code>kCFRunLoopDefaultMode</code>ä¸‹çš„ï¼Œå°±æ— æ³•æ¥å—å¤„ç†Timerçš„äº‹ä»¶ã€‚<br>æ€ä¹ˆå»è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼ŸæŠŠTimeræ·»åŠ åˆ°UITrackingRunLoopModeä¸Šå¹¶ä¸èƒ½è§£å†³é—®é¢˜ï¼Œå› ä¸ºè¿™æ ·åœ¨é»˜è®¤æƒ…å†µä¸‹å°±æ— æ³•æ¥å—å®šæ—¶å™¨äº‹ä»¶äº†ã€‚<br>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠTimeråŒæ—¶æ·»åŠ åˆ°<code>UITrackingRunLoopMode</code>å’Œ<code>kCFRunLoopDefaultMode</code>ä¸Šã€‚<br>é‚£ä¹ˆå¦‚ä½•æŠŠtimeråŒæ—¶æ·»åŠ åˆ°å¤šä¸ªmodeä¸Šå‘¢ï¼Ÿå°±è¦ç”¨åˆ°<code>NSRunLoopCommonModes</code>äº†</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clojure">[[NSRunLoop currentRunLoop] addTimer:timer forMode:NSRunLoopCommonModes]<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>Timerå°±è¢«æ·»åŠ åˆ°å¤šä¸ªmodeä¸Šï¼Œè¿™æ ·å³ä½¿RunLoopç”±<code>kCFRunLoopDefaultMode</code>åˆ‡æ¢åˆ°<code>UITrackingRunLoopMode</code>ä¸‹ï¼Œä¹Ÿä¸ä¼šå½±å“æ¥æ”¶Timeräº‹ä»¶</p><h2 id="å…­ã€RunLoopå’Œçº¿ç¨‹"><a href="#å…­ã€RunLoopå’Œçº¿ç¨‹" class="headerlink" title="å…­ã€RunLoopå’Œçº¿ç¨‹"></a>å…­ã€RunLoopå’Œçº¿ç¨‹</h2><ul><li>çº¿ç¨‹å’ŒRunLoopæ˜¯ä¸€ä¸€å¯¹åº”çš„,å…¶æ˜ å°„å…³ç³»æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„ Dictionary é‡Œ</li><li>è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯RunLoopçš„</li></ul><p><strong>1ã€æ€ä¹ˆåˆ›å»ºä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿ</strong></p><p>1ã€ä¸ºå½“å‰çº¿ç¨‹å¼€å¯ä¸€ä¸ªRunLoopï¼ˆç¬¬ä¸€æ¬¡è°ƒç”¨ [NSRunLoop currentRunLoop]æ–¹æ³•æ—¶å®é™…æ˜¯ä¼šå…ˆå»åˆ›å»ºä¸€ä¸ªRunLoopï¼‰<br>2ã€å‘å½“å‰RunLoopä¸­æ·»åŠ ä¸€ä¸ªPort/Sourceç­‰ç»´æŒRunLoopçš„äº‹ä»¶å¾ªç¯ï¼ˆå¦‚æœRunLoopçš„modeä¸­ä¸€ä¸ªiteméƒ½æ²¡æœ‰ï¼ŒRunLoopä¼šé€€å‡ºï¼‰<br>3ã€å¯åŠ¨è¯¥RunLoop</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-keyword">@autoreleasepool</span> &#123;<br>      <br>      <span class="hljs-built_in">NSRunLoop</span> *runLoop = [<span class="hljs-built_in">NSRunLoop</span> currentRunLoop];<br>      <br>      [[<span class="hljs-built_in">NSRunLoop</span> currentRunLoop] addPort:[<span class="hljs-built_in">NSMachPort</span> port] forMode:<span class="hljs-built_in">NSDefaultRunLoopMode</span>];<br>      <br>      [runLoop run];<br>      <br>  &#125;<br></code></pre></td></tr></table></figure><p><strong>2ã€è¾“å‡ºä¸‹è¾¹ä»£ç çš„æ‰§è¡Œé¡ºåº</strong></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;1&quot;</span>);<br><br><span class="hljs-built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), ^&#123;<br>    <br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;2&quot;</span>);<br><br>    [<span class="hljs-keyword">self</span> performSelector:<span class="hljs-keyword">@selector</span>(test) withObject:<span class="hljs-literal">nil</span> afterDelay:<span class="hljs-number">10</span>];<br>    <br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;3&quot;</span>);<br>&#125;);<br><br><span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;4&quot;</span>);<br><br>- (<span class="hljs-keyword">void</span>)test<br>&#123;<br>    <br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;5&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>ç­”æ¡ˆæ˜¯1423ï¼Œtestæ–¹æ³•å¹¶ä¸ä¼šæ‰§è¡Œã€‚<br>åŸå› æ˜¯å¦‚æœæ˜¯å¸¦afterDelayçš„å»¶æ—¶å‡½æ•°ï¼Œä¼šåœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ª NSTimerï¼Œç„¶åæ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„RunLoopä¸­ã€‚ä¹Ÿå°±æ˜¯å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰å¼€å¯RunLoopï¼Œè¯¥æ–¹æ³•ä¼šå¤±æ•ˆã€‚<br>é‚£ä¹ˆæˆ‘ä»¬æ”¹æˆ:</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), ^&#123;<br>        <br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;2&quot;</span>);<br>        <br>        [[<span class="hljs-built_in">NSRunLoop</span> currentRunLoop] run];<br>        <br>        [<span class="hljs-keyword">self</span> performSelector:<span class="hljs-keyword">@selector</span>(test) withObject:<span class="hljs-literal">nil</span> afterDelay:<span class="hljs-number">10</span>];<br>  <br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;3&quot;</span>);<br>    &#125;);<br></code></pre></td></tr></table></figure><p>ç„¶è€Œtestæ–¹æ³•ä¾ç„¶ä¸æ‰§è¡Œã€‚<br>åŸå› æ˜¯å¦‚æœRunLoopçš„modeä¸­ä¸€ä¸ªiteméƒ½æ²¡æœ‰ï¼ŒRunLoopä¼šé€€å‡ºã€‚å³åœ¨è°ƒç”¨RunLoopçš„runæ–¹æ³•åï¼Œç”±äºå…¶modeä¸­æ²¡æœ‰æ·»åŠ ä»»ä½•itemå»ç»´æŒRunLoopçš„æ—¶é—´å¾ªç¯ï¼ŒRunLoopéšå³è¿˜æ˜¯ä¼šé€€å‡ºã€‚<br>æ‰€ä»¥æˆ‘ä»¬è‡ªå·±å¯åŠ¨RunLoopï¼Œä¸€å®šè¦åœ¨æ·»åŠ itemå</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), ^&#123;<br>        <br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;2&quot;</span>);<br>        <br>        [<span class="hljs-keyword">self</span> performSelector:<span class="hljs-keyword">@selector</span>(test) withObject:<span class="hljs-literal">nil</span> afterDelay:<span class="hljs-number">10</span>];<br>        <br>        [[<span class="hljs-built_in">NSRunLoop</span> currentRunLoop] run];<br>  <br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;3&quot;</span>);<br>    &#125;);<br></code></pre></td></tr></table></figure><p><strong>3ã€æ€æ ·ä¿è¯å­çº¿ç¨‹æ•°æ®å›æ¥æ›´æ–°UIçš„æ—¶å€™ä¸æ‰“æ–­ç”¨æˆ·çš„æ»‘åŠ¨æ“ä½œï¼Ÿ</strong></p><p>å½“æˆ‘ä»¬åœ¨å­è¯·æ±‚æ•°æ®çš„åŒæ—¶æ»‘åŠ¨æµè§ˆå½“å‰é¡µé¢ï¼Œå¦‚æœæ•°æ®è¯·æ±‚æˆåŠŸè¦åˆ‡å›ä¸»çº¿ç¨‹æ›´æ–°UIï¼Œé‚£ä¹ˆå°±ä¼šå½±å“å½“å‰æ­£åœ¨æ»‘åŠ¨çš„ä½“éªŒã€‚<br>æˆ‘ä»¬å°±å¯ä»¥å°†æ›´æ–°UIäº‹ä»¶æ”¾åœ¨ä¸»çº¿ç¨‹çš„<code>NSDefaultRunLoopMode</code>ä¸Šæ‰§è¡Œå³å¯ï¼Œè¿™æ ·å°±ä¼šç­‰ç”¨æˆ·ä¸å†æ»‘åŠ¨é¡µé¢ï¼Œä¸»çº¿ç¨‹RunLoopç”±<code>UITrackingRunLoopMode</code>åˆ‡æ¢åˆ°<code>NSDefaultRunLoopMode</code>æ—¶å†å»æ›´æ–°UI</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">[<span class="hljs-keyword">self</span> performSelectorOnMainThread:<span class="hljs-keyword">@selector</span>(reloadData) withObject:<span class="hljs-literal">nil</span> waitUntilDone:<span class="hljs-literal">NO</span> modes:@[<span class="hljs-built_in">NSDefaultRunLoopMode</span>]];<br></code></pre></td></tr></table></figure><h2 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h2><h4 id="1-å¦‚ä½•ä½¿ç”¨-Runloop-å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿè¿™ç§çº¿ç¨‹ä¸€èˆ¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#1-å¦‚ä½•ä½¿ç”¨-Runloop-å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿè¿™ç§çº¿ç¨‹ä¸€èˆ¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="1. å¦‚ä½•ä½¿ç”¨ Runloop å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿè¿™ç§çº¿ç¨‹ä¸€èˆ¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>1. å¦‚ä½•ä½¿ç”¨ <code>Runloop</code> å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Ÿè¿™ç§çº¿ç¨‹ä¸€èˆ¬æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h4><p>ä¸€èˆ¬åšæ³•æ˜¯å‘ <code>Runloop</code> ä¸­æ”¾ä¸€ä¸ª <code>port</code>ã€‚<br><br>åˆ›å»ºä¸€æ¡å¸¸é©»çš„åå°çº¿ç¨‹ï¼Œåšä»»ä½•ä½ æƒ³åšçš„äº‹ã€‚</p><h4 id="2-ä¸ºä»€ä¹ˆ-NSTimer-æœ‰æ—¶å€™ä¸å¥½ä½¿ï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆ-NSTimer-æœ‰æ—¶å€™ä¸å¥½ä½¿ï¼Ÿ" class="headerlink" title="2. ä¸ºä»€ä¹ˆ NSTimer æœ‰æ—¶å€™ä¸å¥½ä½¿ï¼Ÿ"></a>2. ä¸ºä»€ä¹ˆ <code>NSTimer</code> æœ‰æ—¶å€™ä¸å¥½ä½¿ï¼Ÿ</h4><p>å› ä¸ºåˆ›å»ºçš„  <code>NSTimer</code> é»˜è®¤æ˜¯è¢«åŠ å…¥åˆ°äº† <code>defaultMode</code>ï¼Œæ‰€ä»¥å½“ <code>Runloop</code> çš„ <code>Mode</code> å˜åŒ–æ—¶ï¼Œå½“å‰çš„ <code>NSTimer</code> å°±ä¸ä¼šå·¥ä½œäº†ã€‚</p><h4 id="3-autoreleasePool-åœ¨ä½•æ—¶è¢«é‡Šæ”¾ï¼Ÿ"><a href="#3-autoreleasePool-åœ¨ä½•æ—¶è¢«é‡Šæ”¾ï¼Ÿ" class="headerlink" title="3. autoreleasePool åœ¨ä½•æ—¶è¢«é‡Šæ”¾ï¼Ÿ"></a>3. <code>autoreleasePool</code> åœ¨ä½•æ—¶è¢«é‡Šæ”¾ï¼Ÿ</h4><p><code>App</code>å¯åŠ¨åï¼Œè‹¹æœåœ¨ä¸»çº¿ç¨‹ <code>RunLoop</code> é‡Œæ³¨å†Œäº†ä¸¤ä¸ª <code>Observer</code>ï¼Œå…¶å›è°ƒéƒ½æ˜¯ <code>_wrapRunLoopWithAutoreleasePoolHandler()</code>ã€‚</p><p>ç¬¬ä¸€ä¸ª <code>Observer</code> ç›‘è§†çš„äº‹ä»¶æ˜¯ <code>Entry(å³å°†è¿›å…¥Loop)</code>ï¼Œå…¶å›è°ƒå†…ä¼šè°ƒç”¨ <code>_objc_autoreleasePoolPush()</code> åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚å…¶ <code>order</code> æ˜¯ <code>-2147483647</code>ï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼Œä¿è¯åˆ›å»ºé‡Šæ”¾æ± å‘ç”Ÿåœ¨å…¶ä»–æ‰€æœ‰å›è°ƒä¹‹å‰ã€‚</p><p>ç¬¬äºŒä¸ª <code>Observer</code> ç›‘è§†äº†ä¸¤ä¸ªäº‹ä»¶ï¼š <code>BeforeWaiting</code>(å‡†å¤‡è¿›å…¥ä¼‘çœ ) æ—¶è°ƒç”¨<code>_objc_autoreleasePoolPop()</code>  å’Œ <code>_objc_autoreleasePoolPush()</code> é‡Šæ”¾æ—§çš„æ± å¹¶åˆ›å»ºæ–°æ± ï¼›<code>Exit</code>(å³å°†é€€å‡ºLoop) æ—¶è°ƒç”¨ <code>_objc_autoreleasePoolPop()</code> æ¥é‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± ã€‚è¿™ä¸ª <code>Observer</code> çš„ <code>order</code> æ˜¯ <code>2147483647</code>ï¼Œä¼˜å…ˆçº§æœ€ä½ï¼Œä¿è¯å…¶é‡Šæ”¾æ± å­å‘ç”Ÿåœ¨å…¶ä»–æ‰€æœ‰å›è°ƒä¹‹åã€‚</p><p>åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œé€šå¸¸æ˜¯å†™åœ¨è¯¸å¦‚äº‹ä»¶å›è°ƒã€<code>Timer</code>å›è°ƒå†…çš„ã€‚è¿™äº›å›è°ƒä¼šè¢« <code>RunLoop</code> åˆ›å»ºå¥½çš„ <code>AutoreleasePool</code> ç¯ç»•ç€ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼Œå¼€å‘è€…ä¹Ÿä¸å¿…æ˜¾ç¤ºåˆ›å»º <code>Pool</code> äº†ã€‚</p><h4 id="4-PerformSelector-çš„å®ç°åŸç†ï¼Ÿ"><a href="#4-PerformSelector-çš„å®ç°åŸç†ï¼Ÿ" class="headerlink" title="4. PerformSelector çš„å®ç°åŸç†ï¼Ÿ"></a>4. <code>PerformSelector</code> çš„å®ç°åŸç†ï¼Ÿ</h4><p>å½“è°ƒç”¨ NSObject çš„ performSelecter:afterDelay: åï¼Œå®é™…ä¸Šå…¶å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ª Timer å¹¶æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„ RunLoop ä¸­ã€‚æ‰€ä»¥å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰ RunLoopï¼Œåˆ™è¿™ä¸ªæ–¹æ³•ä¼šå¤±æ•ˆã€‚</p><p>å½“è°ƒç”¨ performSelector:onThread: æ—¶ï¼Œå®é™…ä¸Šå…¶ä¼šåˆ›å»ºä¸€ä¸ª Timer åŠ åˆ°å¯¹åº”çš„çº¿ç¨‹å»ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœå¯¹åº”çº¿ç¨‹æ²¡æœ‰ RunLoop è¯¥æ–¹æ³•ä¹Ÿä¼šå¤±æ•ˆã€‚</p><h4 id="5-PerformSelector-afterDelay-è¿™ä¸ªæ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­æ˜¯å¦èµ·ä½œç”¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#5-PerformSelector-afterDelay-è¿™ä¸ªæ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­æ˜¯å¦èµ·ä½œç”¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="5. PerformSelector:afterDelay:è¿™ä¸ªæ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­æ˜¯å¦èµ·ä½œç”¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ"></a>5. <code>PerformSelector:afterDelay:</code>è¿™ä¸ªæ–¹æ³•åœ¨å­çº¿ç¨‹ä¸­æ˜¯å¦èµ·ä½œç”¨ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ</h4><p>ä¸èµ·ä½œç”¨ï¼Œå­çº¿ç¨‹é»˜è®¤æ²¡æœ‰ <code>Runloop</code>ï¼Œä¹Ÿå°±æ²¡æœ‰ <code>Timer</code>ã€‚<br><br>è§£å†³çš„åŠæ³•æ˜¯å¯ä»¥ä½¿ç”¨ <code>GCD</code> æ¥å®ç°ï¼š<code>Dispatch_after</code></p><h4 id="6-è®²ä¸€ä¸‹-Observer-ï¼Ÿ"><a href="#6-è®²ä¸€ä¸‹-Observer-ï¼Ÿ" class="headerlink" title="6. è®²ä¸€ä¸‹ Observer ï¼Ÿ"></a>6. è®²ä¸€ä¸‹ <code>Observer</code> ï¼Ÿ</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs objc"><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">CF_OPTIONS</span>(<span class="hljs-built_in">CFOptionFlags</span>, <span class="hljs-built_in">CFRunLoopActivity</span>) &#123;<br>    kCFRunLoopEntry         = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">0</span>), <span class="hljs-comment">// å³å°†è¿›å…¥Loop</span><br>    kCFRunLoopBeforeTimers  = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">1</span>), <span class="hljs-comment">// å³å°†å¤„ç† Timer</span><br>    kCFRunLoopBeforeSources = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">2</span>), <span class="hljs-comment">// å³å°†å¤„ç† Source</span><br>    kCFRunLoopBeforeWaiting = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">5</span>), <span class="hljs-comment">// å³å°†è¿›å…¥ä¼‘çœ </span><br>    kCFRunLoopAfterWaiting  = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">6</span>), <span class="hljs-comment">// åˆšä»ä¼‘çœ ä¸­å”¤é†’</span><br>    kCFRunLoopExit          = (<span class="hljs-number">1</span>UL &lt;&lt; <span class="hljs-number">7</span>), <span class="hljs-comment">// å³å°†é€€å‡ºLoop</span><br>&#125;;<br></code></pre></td></tr></table></figure><h4 id="7-è§£é‡Šä¸€ä¸‹-äº‹ä»¶å“åº”-çš„è¿‡ç¨‹ï¼Ÿ"><a href="#7-è§£é‡Šä¸€ä¸‹-äº‹ä»¶å“åº”-çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="7. è§£é‡Šä¸€ä¸‹ äº‹ä»¶å“åº” çš„è¿‡ç¨‹ï¼Ÿ"></a>7. è§£é‡Šä¸€ä¸‹ <code>äº‹ä»¶å“åº”</code> çš„è¿‡ç¨‹ï¼Ÿ</h4><p>è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª <code>Source1</code> (åŸºäº <code>mach port</code> çš„) ç”¨æ¥æ¥æ”¶ç³»ç»Ÿäº‹ä»¶ï¼Œå…¶å›è°ƒå‡½æ•°ä¸º <code>__IOHIDEventSystemClientQueueCallback()</code>ã€‚</p><p>å½“ä¸€ä¸ªç¡¬ä»¶äº‹ä»¶(è§¦æ‘¸/é”å±/æ‘‡æ™ƒç­‰)å‘ç”Ÿåï¼Œé¦–å…ˆç”± <code>IOKit.framework</code> ç”Ÿæˆä¸€ä¸ª <code>IOHIDEvent</code> äº‹ä»¶å¹¶ç”± <code>SpringBoard</code> æ¥æ”¶ã€‚è¿™ä¸ªè¿‡ç¨‹çš„è¯¦ç»†æƒ…å†µå¯ä»¥å‚è€ƒè¿™é‡Œã€‚<code>SpringBoard</code> åªæ¥æ”¶æŒ‰é”®(é”å±/é™éŸ³ç­‰)ï¼Œè§¦æ‘¸ï¼ŒåŠ é€Ÿï¼Œæ¥è¿‘ä¼ æ„Ÿå™¨ç­‰å‡ ç§ <code>Event</code>ï¼Œéšåç”¨ <code>mach port</code> è½¬å‘ç»™éœ€è¦çš„ <code>App</code> è¿›ç¨‹ã€‚éšåè‹¹æœæ³¨å†Œçš„é‚£ä¸ª <code>Source1</code> å°±ä¼šè§¦å‘å›è°ƒï¼Œå¹¶è°ƒç”¨ <code>_UIApplicationHandleEventQueue()</code> è¿›è¡Œåº”ç”¨å†…éƒ¨çš„åˆ†å‘ã€‚</p><p><code>_UIApplicationHandleEventQueue()</code> ä¼šæŠŠ <code>IOHIDEvent</code> å¤„ç†å¹¶åŒ…è£…æˆ <code>UIEvent</code> è¿›è¡Œå¤„ç†æˆ–åˆ†å‘ï¼Œå…¶ä¸­åŒ…æ‹¬è¯†åˆ« <code>UIGesture</code>/å¤„ç†å±å¹•æ—‹è½¬/å‘é€ç»™ <code>UIWindow</code> ç­‰ã€‚é€šå¸¸äº‹ä»¶æ¯”å¦‚ <code>UIButton ç‚¹å‡»</code>ã€<code>touchesBegin/Move/End/Cancel</code> äº‹ä»¶éƒ½æ˜¯åœ¨è¿™ä¸ªå›è°ƒä¸­å®Œæˆçš„ã€‚</p><h4 id="8-è§£é‡Šä¸€ä¸‹-æ‰‹åŠ¿è¯†åˆ«-çš„è¿‡ç¨‹ï¼Ÿ"><a href="#8-è§£é‡Šä¸€ä¸‹-æ‰‹åŠ¿è¯†åˆ«-çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="8. è§£é‡Šä¸€ä¸‹ æ‰‹åŠ¿è¯†åˆ« çš„è¿‡ç¨‹ï¼Ÿ"></a>8. è§£é‡Šä¸€ä¸‹ <code>æ‰‹åŠ¿è¯†åˆ«</code> çš„è¿‡ç¨‹ï¼Ÿ</h4><p>å½“ä¸Šé¢çš„ <code>_UIApplicationHandleEventQueue() </code>è¯†åˆ«äº†ä¸€ä¸ªæ‰‹åŠ¿æ—¶ï¼Œå…¶é¦–å…ˆä¼šè°ƒç”¨ <code>Cancel</code> å°†å½“å‰çš„ <code>touchesBegin/Move/End</code> ç³»åˆ—å›è°ƒæ‰“æ–­ã€‚éšåç³»ç»Ÿå°†å¯¹åº”çš„ <code>UIGestureRecognizer</code> æ ‡è®°ä¸ºå¾…å¤„ç†ã€‚</p><p>è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª <code>Observer</code> ç›‘æµ‹ <code>BeforeWaiting</code> (Loopå³å°†è¿›å…¥ä¼‘çœ ) äº‹ä»¶ï¼Œè¿™ä¸ª <code>Observer</code> çš„å›è°ƒå‡½æ•°æ˜¯ <code>_UIGestureRecognizerUpdateObserver()</code>ï¼Œå…¶å†…éƒ¨ä¼šè·å–æ‰€æœ‰åˆšè¢«æ ‡è®°ä¸ºå¾…å¤„ç†çš„ <code>GestureRecognizer</code>ï¼Œå¹¶æ‰§è¡Œ<code>GestureRecognizer</code> çš„å›è°ƒã€‚</p><p>å½“æœ‰ <code>UIGestureRecognizer</code> çš„å˜åŒ–(åˆ›å»º/é”€æ¯/çŠ¶æ€æ”¹å˜)æ—¶ï¼Œè¿™ä¸ªå›è°ƒéƒ½ä¼šè¿›è¡Œç›¸åº”å¤„ç†ã€‚</p><h4 id="9-è§£é‡Šä¸€ä¸‹-GCD-åœ¨-Runloop-ä¸­çš„ä½¿ç”¨ï¼Ÿ"><a href="#9-è§£é‡Šä¸€ä¸‹-GCD-åœ¨-Runloop-ä¸­çš„ä½¿ç”¨ï¼Ÿ" class="headerlink" title="9. è§£é‡Šä¸€ä¸‹ GCD åœ¨ Runloop ä¸­çš„ä½¿ç”¨ï¼Ÿ"></a>9. è§£é‡Šä¸€ä¸‹ <code>GCD</code> åœ¨ <code>Runloop</code> ä¸­çš„ä½¿ç”¨ï¼Ÿ</h4><p><code>GCD</code>ç”± å­çº¿ç¨‹ è¿”å›åˆ° ä¸»çº¿ç¨‹,åªæœ‰åœ¨è¿™ç§æƒ…å†µä¸‹æ‰ä¼šè§¦å‘ RunLoopã€‚ä¼šè§¦å‘ RunLoop çš„ Source 1 äº‹ä»¶ã€‚</p><h4 id="10-è§£é‡Šä¸€ä¸‹-NSTimerã€‚"><a href="#10-è§£é‡Šä¸€ä¸‹-NSTimerã€‚" class="headerlink" title="10. è§£é‡Šä¸€ä¸‹ NSTimerã€‚"></a>10. è§£é‡Šä¸€ä¸‹ <code>NSTimer</code>ã€‚</h4><p><code>NSTimer</code> å…¶å®å°±æ˜¯ <code>CFRunLoopTimerRef</code>ï¼Œä»–ä»¬ä¹‹é—´æ˜¯ <code>toll-free bridged</code> çš„ã€‚ä¸€ä¸ª <code>NSTimer</code> æ³¨å†Œåˆ° <code>RunLoop</code> åï¼Œ<code>RunLoop</code> ä¼šä¸ºå…¶é‡å¤çš„æ—¶é—´ç‚¹æ³¨å†Œå¥½äº‹ä»¶ã€‚ä¾‹å¦‚ <code>10:00</code>, <code>10:10</code>, <code>10:20</code> è¿™å‡ ä¸ªæ—¶é—´ç‚¹ã€‚<code>RunLoop</code> ä¸ºäº†èŠ‚çœèµ„æºï¼Œå¹¶ä¸ä¼šåœ¨éå¸¸å‡†ç¡®çš„æ—¶é—´ç‚¹å›è°ƒè¿™ä¸ª<code>Timer</code>ã€‚<code>Timer</code> æœ‰ä¸ªå±æ€§å«åš <code>Tolerance</code> (å®½å®¹åº¦)ï¼Œæ ‡ç¤ºäº†å½“æ—¶é—´ç‚¹åˆ°åï¼Œå®¹è®¸æœ‰å¤šå°‘æœ€å¤§è¯¯å·®ã€‚</p><p>å¦‚æœæŸä¸ªæ—¶é—´ç‚¹è¢«é”™è¿‡äº†ï¼Œä¾‹å¦‚æ‰§è¡Œäº†ä¸€ä¸ªå¾ˆé•¿çš„ä»»åŠ¡ï¼Œåˆ™é‚£ä¸ªæ—¶é—´ç‚¹çš„å›è°ƒä¹Ÿä¼šè·³è¿‡å»ï¼Œä¸ä¼šå»¶åæ‰§è¡Œã€‚å°±æ¯”å¦‚ç­‰å…¬äº¤ï¼Œå¦‚æœ 10:10 æ—¶æˆ‘å¿™ç€ç©æ‰‹æœºé”™è¿‡äº†é‚£ä¸ªç‚¹çš„å…¬äº¤ï¼Œé‚£æˆ‘åªèƒ½ç­‰ 10:20 è¿™ä¸€è¶Ÿäº†ã€‚</p><p><code>CADisplayLink</code> æ˜¯ä¸€ä¸ªå’Œå±å¹•åˆ·æ–°ç‡ä¸€è‡´çš„å®šæ—¶å™¨ï¼ˆä½†å®é™…å®ç°åŸç†æ›´å¤æ‚ï¼Œå’Œ NSTimer å¹¶ä¸ä¸€æ ·ï¼Œå…¶å†…éƒ¨å®é™…æ˜¯æ“ä½œäº†ä¸€ä¸ª <code>Source</code>ï¼‰ã€‚å¦‚æœåœ¨ä¸¤æ¬¡å±å¹•åˆ·æ–°ä¹‹é—´æ‰§è¡Œäº†ä¸€ä¸ªé•¿ä»»åŠ¡ï¼Œé‚£å…¶ä¸­å°±ä¼šæœ‰ä¸€å¸§è¢«è·³è¿‡å»ï¼ˆå’Œ <code>NSTimer</code> ç›¸ä¼¼ï¼‰ï¼Œé€ æˆç•Œé¢å¡é¡¿çš„æ„Ÿè§‰ã€‚åœ¨å¿«é€Ÿæ»‘åŠ¨ <code>TableView</code> æ—¶ï¼Œå³ä½¿ä¸€å¸§çš„å¡é¡¿ä¹Ÿä¼šè®©ç”¨æˆ·æœ‰æ‰€å¯Ÿè§‰ã€‚<code>Facebook</code> å¼€æºçš„ <code>AsyncDisplayLink</code> å°±æ˜¯ä¸ºäº†è§£å†³ç•Œé¢å¡é¡¿çš„é—®é¢˜ï¼Œå…¶å†…éƒ¨ä¹Ÿç”¨åˆ°äº† <code>RunLoop</code>ã€‚</p><h4 id="11-åˆ©ç”¨-runloop-è§£é‡Šä¸€ä¸‹é¡µé¢çš„æ¸²æŸ“çš„è¿‡ç¨‹ï¼Ÿ"><a href="#11-åˆ©ç”¨-runloop-è§£é‡Šä¸€ä¸‹é¡µé¢çš„æ¸²æŸ“çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="11. åˆ©ç”¨ runloop è§£é‡Šä¸€ä¸‹é¡µé¢çš„æ¸²æŸ“çš„è¿‡ç¨‹ï¼Ÿ"></a>11. åˆ©ç”¨ <code>runloop</code> è§£é‡Šä¸€ä¸‹é¡µé¢çš„æ¸²æŸ“çš„è¿‡ç¨‹ï¼Ÿ</h4><p>å½“æˆ‘ä»¬è°ƒç”¨ <code>[UIView setNeedsDisplay]</code> æ—¶ï¼Œè¿™æ—¶ä¼šè°ƒç”¨å½“å‰ <code>View.layer</code> çš„ <code>[view.layer setNeedsDisplay]</code>æ–¹æ³•ã€‚</p><p>è¿™ç­‰äºç»™å½“å‰çš„ <code>layer</code> æ‰“ä¸Šäº†ä¸€ä¸ªè„æ ‡è®°ï¼Œè€Œæ­¤æ—¶å¹¶æ²¡æœ‰ç›´æ¥è¿›è¡Œç»˜åˆ¶å·¥ä½œã€‚è€Œæ˜¯ä¼šåˆ°å½“å‰çš„ <code>Runloop</code> å³å°†ä¼‘çœ ï¼Œä¹Ÿå°±æ˜¯ <code>beforeWaiting</code> æ—¶æ‰ä¼šè¿›è¡Œç»˜åˆ¶å·¥ä½œã€‚</p><p>ç´§æ¥ç€ä¼šè°ƒç”¨ <code>[CALayer display]</code>ï¼Œè¿›å…¥åˆ°çœŸæ­£ç»˜åˆ¶çš„å·¥ä½œã€‚<code>CALayer</code> å±‚ä¼šåˆ¤æ–­è‡ªå·±çš„ <code>delegate</code> æœ‰æ²¡æœ‰å®ç°å¼‚æ­¥ç»˜åˆ¶çš„ä»£ç†æ–¹æ³• <code>displayer:</code>ï¼Œè¿™ä¸ªä»£ç†æ–¹æ³•æ˜¯å¼‚æ­¥ç»˜åˆ¶çš„å…¥å£ï¼Œå¦‚æœæ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆä¼šç»§ç»­è¿›è¡Œç³»ç»Ÿç»˜åˆ¶çš„æµç¨‹ï¼Œç„¶åç»˜åˆ¶ç»“æŸã€‚</p><p><code>CALayer</code> å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ª <code>Backing Store</code>ï¼Œç”¨æ¥è·å–å›¾å½¢ä¸Šä¸‹æ–‡ã€‚æ¥ä¸‹æ¥ä¼šåˆ¤æ–­è¿™ä¸ª <code>layer</code> æ˜¯å¦æœ‰ delegateã€‚</p><p>å¦‚æœæœ‰çš„è¯ï¼Œä¼šè°ƒç”¨ <code>[layer.delegate drawLayer:inContext:]</code>ï¼Œå¹¶ä¸”ä¼šè¿”å›ç»™æˆ‘ä»¬ <code>[UIView DrawRect:]</code> çš„å›è°ƒï¼Œè®©æˆ‘ä»¬åœ¨ç³»ç»Ÿç»˜åˆ¶çš„åŸºç¡€ä¹‹ä¸Šå†åšä¸€äº›äº‹æƒ…ã€‚</p><p>å¦‚æœæ²¡æœ‰ <code>delegate</code>ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨ <code>[CALayer drawInContext:]</code>ã€‚</p><p>ä»¥ä¸Šä¸¤ä¸ªåˆ†æ”¯ï¼Œæœ€ç»ˆ <code>CALayer</code> éƒ½ä¼šå°†ä½å›¾æäº¤åˆ° <code>Backing Store</code>ï¼Œæœ€åæäº¤ç»™ <code>GPU</code>ã€‚</p><p>è‡³æ­¤ç»˜åˆ¶çš„è¿‡ç¨‹ç»“æŸã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åº•å±‚</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSä»£ç å—(Snippet)</title>
    <link href="/2020/06/01/%E4%BB%A3%E7%A0%81%E5%9D%97(Snippet)/"/>
    <url>/2020/06/01/%E4%BB%A3%E7%A0%81%E5%9D%97(Snippet)/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-b07622a36a646add.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><p>ä»£ç å—(Snippet)ï¼Œæ–¹ä¾¿äº†ä»£ç å¿«é€Ÿåˆ›å»ºã€‚</p><h4 id="ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’"><a href="#ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’" class="headerlink" title="ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’"></a>ç®¡ç†ï¼šåœ¨æ–°ç‰ˆXcodeä¸­ç®¡ç†é¡µé¢åœ¨ç¼–è¯‘å™¨çš„å³ä¸Šè§’</h4><p><img src="https://upload-images.jianshu.io/upload_images/3334769-80379a923c19ef74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä»£ç å—ç®¡ç†"></p><h4 id="æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»"><a href="#æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»" class="headerlink" title="æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»"></a>æ·»åŠ ï¼šé€‰ä¸­ä»£ç é¼ æ ‡å³å‡»</h4><p><img src="https://upload-images.jianshu.io/upload_images/3334769-52aa3439524de38c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ·»åŠ "></p><h4 id="ç¼–è¾‘"><a href="#ç¼–è¾‘" class="headerlink" title="ç¼–è¾‘"></a>ç¼–è¾‘</h4><p><img src="https://upload-images.jianshu.io/upload_images/3334769-df39d293cbb6e8b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç¼–è¾‘"></p><ol><li><p>Titleï¼šæ ‡é¢˜ã€‚ </p></li><li><p>Summaryï¼šæè¿°æ–‡å­—ã€‚ </p></li><li><p>Platformï¼šå¯ä»¥ä½¿ç”¨çš„å¹³å°ï¼ˆå¦‚iOSã€Mac OSï¼‰ã€‚ </p></li><li><p>Languageï¼šå¯ä»¥åœ¨å“ªäº›è¯­è¨€ä¸­ä½¿ç”¨ï¼ˆå¦‚ Objective-Cã€Swiftï¼‰ã€‚ </p></li><li><p>Completion Shortcutï¼šå¿«æ·æ–¹å¼ï¼Œä»¥å­—æ¯å¼€å¤´ï¼ˆæ”¯æŒå°‘æ•°ç¬¦å·ï¼Œå¦‚@ï¼‰ã€‚ </p></li><li><p>Completion Scopesï¼šä½œç”¨èŒƒå›´ï¼Œä¸€èˆ¬å†™åœ¨æ­£ç¡®çš„ä½ç½®æ‹–åŠ¨å³å¯ï¼ŒXcodeä¼šè‡ªè¡Œé€‰æ‹©å¥½ã€‚</p><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clean">@property (nonatomic, strong) &lt;#ClassName#&gt; *&lt;#<span class="hljs-keyword">class</span>#&gt;; <span class="hljs-comment">///&lt; &lt;#æ³¨é‡Š#&gt;</span><br>@property (nonatomic, assign) &lt;#DataType#&gt; &lt;#name#&gt;; <span class="hljs-comment">///&lt; &lt;#æ³¨é‡Š#&gt;</span><br>@property (nonatomic, copy) &lt;#ClassName#&gt; *&lt;#name#&gt;; <span class="hljs-comment">///&lt; &lt;#æ³¨é‡Š#&gt;</span><br>@property (nonatomic, weak) id&lt;&lt;#delegateOrDataSouce#&gt;&gt; &lt;#delegateOrDataSouce#&gt;; <span class="hljs-comment">///&lt; &lt;#æ³¨é‡Š#&gt;</span><br>@property (nonatomic, weak) &lt;#Class#&gt; *&lt;#name#&gt;; <span class="hljs-comment">///&lt; &lt;#æ³¨é‡Š#&gt;</span><br></code></pre></td></tr></table></figure><h4 id="å¸¸ç”¨æ³¨é‡Š"><a href="#å¸¸ç”¨æ³¨é‡Š" class="headerlink" title="å¸¸ç”¨æ³¨é‡Š"></a>å¸¸ç”¨æ³¨é‡Š</h4></li><li><p>é¡¶éƒ¨æ³¨é‡Š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/** &lt;#å±æ€§æ³¨é‡Š#&gt; */</span><br></code></pre></td></tr></table></figure></li><li><p>å³ä¾§æ³¨é‡Š</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment"><span class="hljs-doctag">///</span><span class="hljs-doctag">&lt; &lt;#æ³¨é‡Š#&gt;</span></span><br></code></pre></td></tr></table></figure></li><li><p>ç®€è¿°é¡¶éƒ¨æ³¨é‡Š</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c">/** &lt;<span class="hljs-meta">#ç®€è¦æè¿°#&gt;</span><br> * &lt;<span class="hljs-meta">#è¯¦ç»†æè¿°#&gt;</span><br> */<br></code></pre></td></tr></table></figure></li><li><p>Pragma</p></li></ol><ul><li>æœ‰åˆ†å‰²çº¿<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark <span class="hljs-meta-string">&lt;#mark#&gt;</span></span><br></code></pre></td></tr></table></figure></li><li>æ— åˆ†å‰²çº¿<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - <span class="hljs-meta-string">&lt;#mark&gt;</span> æˆ– <span class="hljs-comment">// MARK: &lt;#mark#&gt;</span></span><br></code></pre></td></tr></table></figure></li></ul><ol start="5"><li><p>Warning(è­¦å‘Š)</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-meta">#<span class="hljs-meta-keyword">warning</span> <span class="hljs-meta-string">&lt;#message#&gt;</span></span><br></code></pre></td></tr></table></figure></li><li><p>???(ä¸ç¡®å®š)</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> ???: &lt;<span class="hljs-comment">#???#&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>!!!(è­¦å‘Š)</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> !!!: &lt;<span class="hljs-comment">#???#&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>FIXME(éœ€è¦ä¿®æ”¹çš„åœ°æ–¹)</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> FIXME: &lt;<span class="hljs-comment">#Fixè¯¦æƒ…#&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>å¸¸ç”¨æ–¹æ³•</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - é¡µé¢æ§ä»¶é…ç½®</span><br>- (<span class="hljs-keyword">void</span>)setupSubViewsProperties &#123;<br>    <br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - é¡µé¢æ§ä»¶å¸ƒå±€</span><br>- (<span class="hljs-keyword">void</span>)setupSubViewsConstraint &#123;<br>    <br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æšä¸¾</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs elm">typedef <span class="hljs-type">NS_ENUM</span>(<span class="hljs-type">NSInteger</span>, &lt;#<span class="hljs-type">TypeName</span>#&gt;) &#123;<br>    <br>&#125;;<br><br>typedef <span class="hljs-type">NS_OPTIONS</span>(<span class="hljs-type">NSUInteger</span>, &lt;#<span class="hljs-type">TypeName</span>#&gt;) &#123;<br>                <br>&#125;;<br></code></pre></td></tr></table></figure></li><li><p>IFDEBUG</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs clean">#<span class="hljs-keyword">if</span> DEBUG<br>&lt;#TODO#&gt;<br>#else<br>&lt;#TODO#&gt;<br>#endif<br></code></pre></td></tr></table></figure></li><li><p>å¿«æ·åˆå§‹åŒ–UILabel</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs nix">UILabel *<span class="hljs-attr">l</span> = [[UILabel alloc] init];<br>l.<span class="hljs-attr">font</span> = [UIFont &lt;<span class="hljs-comment">#font#&gt;];</span><br>l.<span class="hljs-attr">text</span> = @<span class="hljs-string">&quot;&lt;#conent#&gt;&quot;</span>;<br>l.<span class="hljs-attr">textColor</span> = [UIColor &lt;<span class="hljs-comment">#textColor#&gt;];</span><br>l.<span class="hljs-attr">numberOfLines</span> = <span class="hljs-number">0</span>;<br>[&lt;<span class="hljs-comment">#view#&gt; addSubview:l];</span><br></code></pre></td></tr></table></figure></li><li><p>å¿«æ·åˆå§‹åŒ–UIButton</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">UIButton *<span class="hljs-keyword">b </span>= [UIButton <span class="hljs-keyword">buttonWithType:UIButtonTypeCustom];</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">b.backgroundColor </span>= [UIColor &lt;<span class="hljs-comment">#backgroundColor#&gt;];</span><br><span class="hljs-keyword">b.titleLabel.font </span>= [UIFont &lt;<span class="hljs-comment">#font#&gt;];</span><br>[<span class="hljs-keyword">b </span>setTitle:&lt;<span class="hljs-comment">#title#&gt; forState:UIControlStateNormal];</span><br>[<span class="hljs-keyword">b </span>setTitleColor:[UIColor &lt;<span class="hljs-comment">#titleColor#&gt;] forState:UIControlStateNormal];</span><br>[<span class="hljs-keyword">b </span>setImage:[UIImage imageNamed:&lt;<span class="hljs-comment">#(nonnull NSString *)#&gt;] forState:UIControlStateNormal]</span><br>[<span class="hljs-keyword">b </span><span class="hljs-keyword">addTarget:self </span>action:@selector(<span class="hljs-keyword">didTapped&lt;#Button </span>Name<span class="hljs-comment">#&gt;:) forControlEvents:UIControlEventTouchUpInside];</span><br>[&lt;<span class="hljs-comment">#view#&gt; addSubview:b];</span><br></code></pre></td></tr></table></figure></li><li><p>UIButton ç‚¹å‡»äº‹ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/** &lt;#ButtonName#&gt;ç‚¹å‡»äº‹ä»¶ */</span><br>- (void)didTapped&lt;<span class="hljs-comment">#ButtonName#&gt;:(UIButton *)sender &#123;</span><br>    <br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>Notificationäº‹ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/** &lt;#Notification Name#&gt;é€šçŸ¥äº‹ä»¶ */</span><br>- (void)didReceive&lt;<span class="hljs-comment">#Notification Name#&gt;:(NSNotification *)notification &#123;</span><br>    <br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>UIGestureRecognizerè§¦æ‘¸äº‹ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/** &lt;#GestureRecognizer Name#&gt;è§¦æ‘¸äº‹ä»¶ */</span><br>- (void)didRecognized&lt;<span class="hljs-comment">#GestureRecognizer Name#&gt;:(UIGestureRecognizer *)recognizer &#123;</span><br>    <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h4><p>è¿™ä¹Ÿæ˜¯ä¸ºäº†ä¸ªäººæ„è§ï¼Œå…¶ä»–è¿˜æœ‰å¾ˆå¤šå¯ä»¥åšæˆä»£ç å—çš„ï¼Œä¾‹å¦‚CGDï¼ŒTableViewDataSourceç­‰ç­‰ï¼Œå¸Œæœ›çŸ­çŸ­çš„æ–‡ç« å¯ä»¥è®©ä½ ä»£ç å¯ä»¥å†™çš„æ›´å¥½ã€‚</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>å¼€å‘æŠ€å·§</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Snippet</tag>
      
      <tag>å¼€å‘æŠ€å·§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨UIDocumentä¿å­˜æ•°æ®</title>
    <link href="/2020/06/01/%E5%88%A9%E7%94%A8UIDocument%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/"/>
    <url>/2020/06/01/%E5%88%A9%E7%94%A8UIDocument%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE/</url>
    
    <content type="html"><![CDATA[<p>ç»§æ‰¿UIDocument</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDDocument</span> : <span class="hljs-title">UIDocument</span></span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">strong</span>, <span class="hljs-keyword">nonatomic</span>) <span class="hljs-built_in">NSData</span> *data;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br><br></code></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;WDDocument.h&quot;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">WDDocument</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - é‡å†™çˆ¶ç±»æ–¹æ³•</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  ä¿å­˜æ—¶è°ƒç”¨</span><br><span class="hljs-comment"> *  @param typeName æ–‡æ¡£æ–‡ä»¶ç±»å‹åç¼€</span><br><span class="hljs-comment"> *  @param outError é”™è¯¯ä¿¡æ¯è¾“å‡º</span><br><span class="hljs-comment"> *  @return æ–‡æ¡£æ•°æ®</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">id</span>)contentsForType:(<span class="hljs-built_in">NSString</span> *)typeName<br>                error:(<span class="hljs-built_in">NSError</span> *__autoreleasing *)outError<br>&#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">self</span>.data) &#123;<br>        <span class="hljs-keyword">self</span>.data = [<span class="hljs-built_in">NSData</span> data];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.data;<br>&#125;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  è¯»å–æ•°æ®æ—¶è°ƒç”¨</span><br><span class="hljs-comment"> *  @param contents æ–‡æ¡£æ•°æ®</span><br><span class="hljs-comment"> *  @param typeName æ–‡æ¡£æ–‡ä»¶ç±»å‹åç¼€</span><br><span class="hljs-comment"> *  @param outError é”™è¯¯ä¿¡æ¯è¾“å‡º</span><br><span class="hljs-comment"> *  @return è¯»å–æ˜¯å¦æˆåŠŸ</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-built_in">BOOL</span>)loadFromContents:(<span class="hljs-keyword">id</span>)contents<br>                  ofType:(<span class="hljs-built_in">NSString</span> *)typeName<br>                   error:(<span class="hljs-built_in">NSError</span> *__autoreleasing *)outError<br>&#123;<br>    <span class="hljs-keyword">self</span>.data = [contents <span class="hljs-keyword">copy</span>];<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><span class="hljs-keyword">@end</span><br><br></code></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  å–å¾—äº‘ç«¯å­˜å‚¨æ–‡ä»¶çš„åœ°å€</span><br><span class="hljs-comment"> *  @param fileName æ–‡ä»¶åï¼Œå¦‚æœæ–‡ä»¶åä¸ºnilï¼Œåˆ™é‡æ–°åˆ›å»ºä¸€ä¸ªURL</span><br><span class="hljs-comment"> *  @return æ–‡ä»¶åœ°å€</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-built_in">NSURL</span> *)getUbiquityFileURL:(<span class="hljs-built_in">NSString</span> *)fileName&#123;<br>    <span class="hljs-comment">//å–å¾—äº‘ç«¯URLåŸºåœ°å€(å‚æ•°ä¸­ä¼ å…¥nilåˆ™ä¼šé»˜è®¤è·å–ç¬¬ä¸€ä¸ªå®¹å™¨)ï¼Œéœ€è¦ä¸€ä¸ªå®¹å™¨æ ‡ç¤º</span><br>    <span class="hljs-built_in">NSFileManager</span> *manager = [<span class="hljs-built_in">NSFileManager</span> defaultManager];<br>    <span class="hljs-built_in">NSURL</span> *url = [manager URLForUbiquityContainerIdentifier:<span class="hljs-string">@&quot;kContainerIdentifier&quot;</span>];<br>    <span class="hljs-comment">//å–å¾—Documentsç›®å½•</span><br>    url = [url URLByAppendingPathComponent:<span class="hljs-string">@&quot;Documents&quot;</span>];<br>    <span class="hljs-comment">//å–å¾—æœ€ç»ˆåœ°å€</span><br>    url = [url URLByAppendingPathComponent:fileName];<br>    <span class="hljs-keyword">return</span> url;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">// è·å–ä¸Šä¼ æ–‡ä»¶çš„è·¯å¾„</span><br><span class="hljs-built_in">NSDictionary</span> *dic = [<span class="hljs-built_in">NSDictionary</span> dictionaryWithContentsOfFile:[[<span class="hljs-built_in">NSBundle</span> mainBundle] pathForResource:<span class="hljs-string">@&quot;MyData&quot;</span> ofType:<span class="hljs-string">@&quot;plist&quot;</span>]];<br><span class="hljs-built_in">NSString</span> *text = <span class="hljs-string">@&quot;Test&quot;</span>;<br><span class="hljs-built_in">NSString</span> *fileName = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%@.txt&quot;</span>,text];<br><br><span class="hljs-comment">// ä¿å­˜æ–‡ä»¶</span><br>WDDocument *doucument = [[WDDocument alloc] initWithFileURL:[<span class="hljs-keyword">self</span> getUbiquityFileURL:fileName]];<br>doucument.data = [<span class="hljs-built_in">NSJSONSerialization</span> dataWithJSONObject:dic options:<span class="hljs-built_in">NSJSONWritingPrettyPrinted</span> error:<span class="hljs-literal">nil</span>];<br>[doucument saveToURL:[<span class="hljs-keyword">self</span> getUbiquityFileURL:fileName]<br>    forSaveOperation:<span class="hljs-built_in">UIDocumentSaveForOverwriting</span><br>   completionHandler:^(<span class="hljs-built_in">BOOL</span> success) &#123;<br>    <span class="hljs-comment">// ä¸Šä¼ ç»“æœ</span><br>&#125;];<br><br><span class="hljs-comment">// ä¸‹è½½æ–‡ä»¶</span><br><span class="hljs-built_in">NSURLSession</span> *session = [<span class="hljs-built_in">NSURLSession</span> sharedSession];<br>[[session downloadTaskWithURL:[<span class="hljs-keyword">self</span> getUbiquityFileURL:fileName] completionHandler:^(<span class="hljs-built_in">NSURL</span> * _Nullable location, <span class="hljs-built_in">NSURLResponse</span> * _Nullable response, <span class="hljs-built_in">NSError</span> * _Nullable error) &#123;<br>    <span class="hljs-comment">// è·å–åˆ°æ–‡ä»¶è·¯å¾„</span><br>&#125;] resume];<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å¼€å‘æŠ€å·§</category>
      
      <category>iOS</category>
      
      <category>Objective-C</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘æŠ€å·§</tag>
      
      <tag>Objective-C</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JavaScriptä¸åŸç”Ÿäº¤äº’</title>
    <link href="/2020/05/01/JavaScript%E4%B8%8E%E5%8E%9F%E7%94%9F%E4%BA%A4%E4%BA%92/"/>
    <url>/2020/05/01/JavaScript%E4%B8%8E%E5%8E%9F%E7%94%9F%E4%BA%A4%E4%BA%92/</url>
    
    <content type="html"><![CDATA[<p> <img src="https://upload-images.jianshu.io/upload_images/3334769-b397461b46272052.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®ä¾‹æ ·å¼"></p><p>åŸç”Ÿé¡µé¢ä¸HTMLé¡µé¢è¿›è¡Œç›¸äº’è°ƒç”¨<br>æ–¹å¼ | é€‚ç”¨å¯¹è±¡<br>â€”|â€”<br>æ‹¦æˆªURL | <code>UIWebView</code>å’Œ<code>WKWebView</code><br>JavaScriptCore | <code>UIWebView</code><br>MessageHandler | <code>WKWebView</code><br>WebViewJavascriptBridge| <code>UIWebView</code>å’Œ<code>WKWebView</code></p><h3 id="å®ä¾‹HTMLä»£ç "><a href="#å®ä¾‹HTMLä»£ç " class="headerlink" title="å®ä¾‹HTMLä»£ç "></a>å®ä¾‹HTMLä»£ç </h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">&lt;body&gt;<br>    &lt;h2&gt;æŒ‰é’®ç‚¹å‡»&lt;/h2&gt;<br>    &lt;button <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;submit&quot;</span> onclick=<span class="hljs-string">&quot;buttonEvent()&quot;</span> id=<span class="hljs-string">&quot;submitButto&quot;</span>&gt;æäº¤&lt;/button&gt;<br>    &lt;h2&gt;æ–‡ä»¶ä¸Šä¼ &lt;/h2&gt;<br>    &lt;input <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;file&quot;</span> /&gt;<br>    &lt;h2&gt;åŸç”Ÿæ³¨å…¥æ•°æ®&lt;/h2&gt;<br>    &lt;input <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;text&quot;</span> id=<span class="hljs-string">&quot;textField&quot;</span>&gt;<br>    &lt;input <span class="hljs-keyword">type</span>=<span class="hljs-string">&quot;button&quot;</span> onclick=<span class="hljs-string">&quot;getTextEvent()&quot;</span> value=<span class="hljs-string">&quot;å¼€å§‹æ³¨å…¥&quot;</span>&gt;<br>    &lt;script&gt;<br>        <span class="hljs-keyword">function</span> load<span class="hljs-constructor">URL(<span class="hljs-params">url</span>)</span> &#123;<br>            var iFrame;<br>            iFrame = document.create<span class="hljs-constructor">Element(<span class="hljs-string">&quot;iframe&quot;</span>)</span>;<br>            iFrame.set<span class="hljs-constructor">Attribute(<span class="hljs-string">&quot;src&quot;</span>, <span class="hljs-params">url</span>)</span>;<br>            iFrame.set<span class="hljs-constructor">Attribute(<span class="hljs-string">&quot;style&quot;</span>, <span class="hljs-string">&quot;display:none;&quot;</span>)</span>;<br>            iFrame.set<span class="hljs-constructor">Attribute(<span class="hljs-string">&quot;height&quot;</span>, <span class="hljs-string">&quot;0px&quot;</span>)</span>;<br>            iFrame.set<span class="hljs-constructor">Attribute(<span class="hljs-string">&quot;width&quot;</span>, <span class="hljs-string">&quot;0px&quot;</span>)</span>;<br>            iFrame.set<span class="hljs-constructor">Attribute(<span class="hljs-string">&quot;frameborder&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>)</span>;<br>            document.body.append<span class="hljs-constructor">Child(<span class="hljs-params">iFrame</span>)</span>;<br>            iFrame.parentNode.remove<span class="hljs-constructor">Child(<span class="hljs-params">iFrame</span>)</span>;<br>            iFrame = null;<br>        &#125;<br>        <span class="hljs-keyword">function</span> button<span class="hljs-constructor">Event()</span>&#123;<br>            load<span class="hljs-constructor">URL(<span class="hljs-string">&quot;/buttonEvent&quot;</span>)</span>;<br>            button<span class="hljs-constructor">DidPapped()</span>;<br>        &#125;<br>    <br>        <span class="hljs-keyword">function</span> get<span class="hljs-constructor">TextEvent()</span> &#123;<br>            load<span class="hljs-constructor">URL(<span class="hljs-string">&quot;/getText&quot;</span>)</span>;<br>            get<span class="hljs-constructor">TextButtonDidPapped()</span>;<br>        &#125;<br>        <span class="hljs-keyword">function</span> get<span class="hljs-constructor">Text(<span class="hljs-params">text</span>)</span>&#123;<br>            document.get<span class="hljs-constructor">ElementById(<span class="hljs-string">&quot;textField&quot;</span>)</span>.value = text;<br>        &#125;<br>    &lt;/script&gt;<br>&lt;/body&gt;       <br></code></pre></td></tr></table></figure><h2 id="æ‹¦æˆªURL"><a href="#æ‹¦æˆªURL" class="headerlink" title="æ‹¦æˆªURL"></a>æ‹¦æˆªURL</h2><h4 id="UIWebView"><a href="#UIWebView" class="headerlink" title="UIWebView"></a>UIWebView</h4><p>éµå¾ª<code>UIWebViewDelegate</code>è°ƒç”¨<code>- (BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType </code>æ–¹æ³•ï¼Œåˆ¤æ–­è·å–çš„Urlåœ°å€</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">// è°ƒç”¨JS</span><br><span class="hljs-keyword">if</span> ([request.URL.absoluteString hasSuffix:<span class="hljs-string">@&quot;buttonEvent&quot;</span>]) &#123;<br>    <span class="hljs-built_in">UIAlertController</span> *vc = [<span class="hljs-built_in">UIAlertControlleralertControllerWithTitle</span>:<span class="hljs-string">@&quot;æ¸©é¦¨æç¤º&quot;</span> message:<span class="hljs-string">@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot;</span> preferredStyle:<span class="hljs-built_in">UIAlertControllerStyleAlert</span>];<br>        [vc addAction:[<span class="hljs-built_in">UIAlertAction</span> actionWithTitle:<span class="hljs-string">@&quot;ç¡®å®š&quot;</span> style:<span class="hljs-built_in">UIAlertActionStyleDefault</span> handler:^(<span class="hljs-built_in">UIAlertAction</span> * _Nonnull action) &#123;<br>            <br>    &#125;]];<br>    [<span class="hljs-keyword">self</span> presentViewController:vc animated:<span class="hljs-literal">true</span> completion:<span class="hljs-literal">nil</span>];  <br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">NO</span>;<br>&#125; <br><span class="hljs-comment">// æ³¨å…¥æ•°æ®ç»™JS</span><br><span class="hljs-keyword">if</span> ([request.URL.absoluteString hasSuffix:<span class="hljs-string">@&quot;getText&quot;</span>]) &#123; <br>    [webView stringByEvaluatingJavaScriptFromString:<span class="hljs-string">@&quot;getText(&#x27;å“ˆå“ˆ&#x27;)&quot;</span>];<br>     <span class="hljs-keyword">return</span> <span class="hljs-literal">NO</span>;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;<br></code></pre></td></tr></table></figure><h4 id="WKWebView"><a href="#WKWebView" class="headerlink" title="WKWebView"></a>WKWebView</h4><p>éµå¾ª<code>WKNavigationDelegate</code>è°ƒç”¨<code>- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler</code>æ–¹æ³•åˆ¤æ–­è·å–çš„åœ°å€</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-built_in">NSString</span> *strRequest = [navigationAction.request.URL.absoluteString stringByRemovingPercentEncoding];<br><span class="hljs-comment">// è°ƒç”¨JS</span><br><span class="hljs-keyword">if</span> ([strRequest hasSuffix:<span class="hljs-string">@&quot;buttonEvent&quot;</span>]) &#123;<br>    <span class="hljs-built_in">UIAlertController</span> *vc = [<span class="hljs-built_in">UIAlertController</span> alertControllerWithTitle:<span class="hljs-string">@&quot;æ¸©é¦¨æç¤º&quot;</span> message:<span class="hljs-string">@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot;</span> preferredStyle:<span class="hljs-built_in">UIAlertControllerStyleAlert</span>];<br>    [vc addAction:[<span class="hljs-built_in">UIAlertAction</span> actionWithTitle:<span class="hljs-string">@&quot;ç¡®å®š&quot;</span> style:<span class="hljs-built_in">UIAlertActionStyleDefault</span> handler:^(<span class="hljs-built_in">UIAlertAction</span> * _Nonnull action) &#123;<br>            <br>    &#125;]];<br>    [<span class="hljs-keyword">self</span> presentViewController:vc animated:<span class="hljs-literal">true</span> completion:<span class="hljs-literal">nil</span>];<br>    decisionHandler(<span class="hljs-built_in">WKNavigationActionPolicyCancel</span>);<br>&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([strRequest hasSuffix:<span class="hljs-string">@&quot;getText&quot;</span>]) &#123; <span class="hljs-comment">// æ³¨å…¥æ•°æ®ç»™JS</span><br>    [webView evaluateJavaScript:<span class="hljs-string">@&quot;getText(&#x27;å“ˆå“ˆ&#x27;)&quot;</span> completionHandler:^(<span class="hljs-keyword">id</span> _Nullable info, <span class="hljs-built_in">NSError</span> * _Nullable error) &#123;<br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;Error--%@, info--%@&quot;</span>, error, info);<br>    &#125;];<br>    decisionHandler(<span class="hljs-built_in">WKNavigationActionPolicyCancel</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    decisionHandler(<span class="hljs-built_in">WKNavigationActionPolicyAllow</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="JavaScriptCore"><a href="#JavaScriptCore" class="headerlink" title="JavaScriptCore"></a>JavaScriptCore</h2><ol><li>å¯¼å…¥<code>&lt;JavaScriptCore/JavaScriptCore.h&gt;</code></li><li>éµå¾ª<code>&lt;UIWebViewDelegate&gt;</code>å¹¶å®ç°<code>- (void)webViewDidFinishLoad:(UIWebView *)webView</code>æ–¹æ³•ã€‚<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">// å¯¹JSContextå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–</span><br>JSContext *context = [<span class="hljs-keyword">self</span>.webView valueForKeyPath:<span class="hljs-string">@&quot;documentView.webView.mainFrame.javaScriptContext&quot;</span>];<br><span class="hljs-comment">// éªŒè¯JSContextå¯¹è±¡æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ</span><br>context.exceptionHandler = ^(JSContext *context, JSValue *exceptionValue)&#123;<br>    context.exception = exceptionValue;<br>&#125;;<br> <br><span class="hljs-comment">// è°ƒç”¨JS  </span><br>context[<span class="hljs-string">@&quot;buttonDidPapped&quot;</span>] = ^&#123;<br>    <span class="hljs-built_in">UIAlertController</span> *vc = [<span class="hljs-built_in">UIAlertController</span> alertControllerWithTitle:<span class="hljs-string">@&quot;æ¸©é¦¨æç¤º&quot;</span> message:<span class="hljs-string">@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot;</span> preferredStyle:<span class="hljs-built_in">UIAlertControllerStyleAlert</span>];<br>    [vc addAction:[<span class="hljs-built_in">UIAlertAction</span> actionWithTitle:<span class="hljs-string">@&quot;ç¡®å®š&quot;</span> style:<span class="hljs-built_in">UIAlertActionStyleDefault</span> handler:^(<span class="hljs-built_in">UIAlertAction</span> * _Nonnull action) &#123;<br>            <br>    &#125;]];<br>    [<span class="hljs-keyword">self</span> presentViewController:vc animated:<span class="hljs-literal">true</span> completion:<span class="hljs-literal">nil</span>];<br>&#125;;<br> <br><span class="hljs-comment">// æ³¨å…¥æ•°æ®ç»™JS   </span><br>context[<span class="hljs-string">@&quot;getTextButtonDidPapped&quot;</span>] = ^&#123;<br>    <span class="hljs-built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;<br>      [<span class="hljs-keyword">self</span>.webView stringByEvaluatingJavaScriptFromString:<span class="hljs-string">@&quot;getText(&#x27;å“ˆå“ˆ&#x27;)&quot;</span>];<br>        &#125;);<br>&#125;;<br></code></pre></td></tr></table></figure></li></ol><h2 id="MessageHandler"><a href="#MessageHandler" class="headerlink" title="MessageHandler"></a>MessageHandler</h2><ol><li>ä¿®æ”¹jsä¸­çš„æ–¹æ³•ï¼Œ é€šè¿‡<code>window.webkit.messageHandlers</code>+æ“ä½œæ–¹æ³•<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buttonEvent</span>(<span class="hljs-params"></span>)</span>&#123;<br>    <span class="hljs-built_in">window</span>.webkit.messageHandlers.buttonEvent.postMessage(<span class="hljs-literal">null</span>);<br>&#125;<br>        <br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTextEvent</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-built_in">window</span>.webkit.messageHandlers.getTextEvent.postMessage(<span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li>éµå¾ª<code>WKScriptMessageHandler</code></li><li>åœ¨<code>- (void)viewWillAppear:(BOOL)animated </code>ä¸­æ·»åŠ <code>scriptMessageHandler</code></li><li>åœ¨<code>- (void)viewWillDisappear:(BOOL)animated</code>ä¸­ç§»é™¤<code>scriptMessageHandler</code></li><li>å®ç°<code>WKScriptMessageHandler</code>æ–¹æ³•<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">- (<span class="hljs-keyword">void</span>)viewWillAppear:(<span class="hljs-built_in">BOOL</span>)animated &#123;<br>    [<span class="hljs-keyword">super</span> viewWillAppear:animated];<br>    [<span class="hljs-keyword">self</span>.webView.configuration.userContentController addScriptMessageHandler:<span class="hljs-keyword">self</span> name:<span class="hljs-string">@&quot;buttonEvent&quot;</span>];<br>    [<span class="hljs-keyword">self</span>.webView.configuration.userContentController addScriptMessageHandler:<span class="hljs-keyword">self</span> name:<span class="hljs-string">@&quot;getTextEvent&quot;</span>];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)viewWillDisappear:(<span class="hljs-built_in">BOOL</span>)animated &#123;<br>    [<span class="hljs-keyword">super</span> viewWillDisappear:animated];<br>    [<span class="hljs-keyword">self</span>.webView.configuration.userContentController removeScriptMessageHandlerForName:<span class="hljs-string">@&quot;buttonEvent&quot;</span>];<br>    [<span class="hljs-keyword">self</span>.webView.configuration.userContentController removeScriptMessageHandlerForName:<span class="hljs-string">@&quot;getTextEvent&quot;</span>];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - WKScriptMessageHandler Method</span><br>- (<span class="hljs-keyword">void</span>)userContentController:(<span class="hljs-built_in">WKUserContentController</span> *)userContentController didReceiveScriptMessage:(<span class="hljs-built_in">WKScriptMessage</span> *)message &#123;<br>    <span class="hljs-comment">// è°ƒç”¨JS</span><br>    <span class="hljs-keyword">if</span> ([message.name isEqualToString:<span class="hljs-string">@&quot;buttonEvent&quot;</span>]) &#123;<br>        <span class="hljs-built_in">UIAlertController</span> *vc = [<span class="hljs-built_in">UIAlertController</span> alertControllerWithTitle:<span class="hljs-string">@&quot;æ¸©é¦¨æç¤º&quot;</span> message:<span class="hljs-string">@&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot;</span> preferredStyle:<span class="hljs-built_in">UIAlertControllerStyleAlert</span>];<br>        [vc addAction:[<span class="hljs-built_in">UIAlertAction</span> actionWithTitle:<span class="hljs-string">@&quot;ç¡®å®š&quot;</span> style:<span class="hljs-built_in">UIAlertActionStyleDefault</span> handler:^(<span class="hljs-built_in">UIAlertAction</span> * _Nonnull action) &#123;<br>            <br>        &#125;]];<br>        [<span class="hljs-keyword">self</span> presentViewController:vc animated:<span class="hljs-literal">true</span> completion:<span class="hljs-literal">nil</span>];<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ³¨å…¥æ•°æ®ç»™JS</span><br>    <span class="hljs-keyword">if</span>  ([message.name isEqualToString:<span class="hljs-string">@&quot;getTextEvent&quot;</span>]) &#123;<br>        [<span class="hljs-keyword">self</span>.webView evaluateJavaScript:<span class="hljs-string">@&quot;getText(&#x27;å“ˆå“ˆ&#x27;)&quot;</span> completionHandler:^(<span class="hljs-keyword">id</span> _Nullable info, <span class="hljs-built_in">NSError</span> * _Nullable error) &#123;<br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;Error--%@, info--%@&quot;</span>, error, info);<br>        &#125;];<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="WebViewJavascriptBridge"><a href="#WebViewJavascriptBridge" class="headerlink" title="WebViewJavascriptBridge"></a>WebViewJavascriptBridge</h2><p>HTMLä»£ç </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æŒ‰é’®ç‚¹å‡»<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span> = <span class="hljs-string">&#x27;submitBtn&#x27;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æäº¤æŒ‰é’®&quot;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;submitClick()&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æ–‡ä»¶é€‰æ‹©<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;image&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>æ³¨å…¥æ•°æ®<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getTextField&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;å¼€å§‹è·å–&quot;</span> <span class="hljs-attr">id</span> = <span class="hljs-string">&#x27;startGet&#x27;</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;getTextClick()&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"></span><br><span class="javascript">        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setupWebViewJavascriptBridge</span>(<span class="hljs-params">callback</span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.WebViewJavascriptBridge) &#123; <span class="hljs-keyword">return</span> callback(WebViewJavascriptBridge); &#125;</span><br><span class="javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.WVJBCallbacks) &#123; <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.WVJBCallbacks.push(callback); &#125;</span><br><span class="javascript">        <span class="hljs-built_in">window</span>.WVJBCallbacks = [callback];</span><br><span class="javascript">        <span class="hljs-keyword">var</span> WVJBIframe = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;iframe&#x27;</span>);</span><br><span class="javascript">        WVJBIframe.style.display = <span class="hljs-string">&#x27;none&#x27;</span>;</span><br><span class="javascript">        WVJBIframe.src = <span class="hljs-string">&#x27;https://__bridge_loaded__&#x27;</span>;</span><br><span class="javascript">        <span class="hljs-built_in">document</span>.documentElement.appendChild(WVJBIframe);</span><br><span class="javascript">        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123; <span class="hljs-built_in">document</span>.documentElement.removeChild(WVJBIframe) &#125;, <span class="hljs-number">0</span>)</span><br><span class="javascript">        &#125;</span><br><span class="javascript"></span><br><span class="javascript">        setupWebViewJavascriptBridge(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">bridge</span>) </span>&#123;</span><br><span class="javascript"></span><br><span class="javascript">        &#125;)</span><br><span class="javascript"></span><br><span class="javascript">        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">submitClick</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">            WebViewJavascriptBridge.callHandler(<span class="hljs-string">&#x27;submitClick&#x27;</span>, <span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>&#123;</span><br><span class="javascript">                </span><br><span class="javascript">            &#125;);</span><br><span class="javascript">        &#125;</span><br><span class="javascript">        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTextClick</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">            WebViewJavascriptBridge.callHandler(<span class="hljs-string">&#x27;getTextClick&#x27;</span>, <span class="hljs-literal">null</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>&#123;</span><br><span class="javascript">                <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;getTextField&quot;</span>).value = response;</span><br><span class="javascript">            &#125;);</span><br><span class="javascript">        &#125;</span><br><span class="javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ–¹åº“ï¼š<a href="https://github.com/marcuswestin/WebViewJavascriptBridge">åœ°å€</a></p><ol><li>æ·»åŠ <code>WebViewJavascriptBridge</code>åº“</li><li>å¯¼å…¥å¤´æ–‡ä»¶<code>#import &lt;WebViewJavascriptBridge.h&gt;</code></li><li>å£°æ˜æ–¹æ³•<code>@property WebViewJavascriptBridge* bridge;</code></li><li>ä¸WebViewå…³è”<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">_bridge</span> = [WebViewJavascriptBridge bridgeForWebView:self.webView]<span class="hljs-comment">;</span><br><br><span class="hljs-section">[_bridge setWebViewDelegate:self]</span><span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></li><li>è°ƒç”¨js<figure class="highlight hy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs hy">[_bridge registerHandler:@<span class="hljs-string">&quot;submitClick&quot;</span> handler:^(<span class="hljs-name"><span class="hljs-builtin-name">id</span></span> data, WVJBResponseCallback responseCallback) &#123;<br>        UIAlertController *vc = [UIAlertController alertControllerWithTitle:@<span class="hljs-string">&quot;æ¸©é¦¨æç¤º&quot;</span> message:@<span class="hljs-string">&quot;ç‚¹å‡»äº†æäº¤æŒ‰é’®&quot;</span> preferredStyle:UIAlertControllerStyleAlert]<span class="hljs-comment">;</span><br>        [vc addAction:[UIAlertAction actionWithTitle:@<span class="hljs-string">&quot;ç¡®å®š&quot;</span> style:UIAlertActionStyleDefault handler:^(<span class="hljs-name">UIAlertAction</span> * _Nonnull action) &#123;<br>            <br>        &#125;]]<span class="hljs-comment">;</span><br>        [self presentViewController:vc animated:true completion:nil]<span class="hljs-comment">;</span><br>&#125;]<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></li><li>æ³¨å…¥æ•°æ®<figure class="highlight hy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs hy">[_bridge registerHandler:@<span class="hljs-string">&quot;getTextClick&quot;</span> handler:^(<span class="hljs-name"><span class="hljs-builtin-name">id</span></span> data, WVJBResponseCallback responseCallback) &#123;<br>        responseCallback(@<span class="hljs-string">&quot;å“ˆå“ˆå“ˆ&quot;</span>)<span class="hljs-comment">;</span><br>&#125;]<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></li></ol>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
      <category>WebView</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WebView</tag>
      
      <tag>JavaScript</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSç¬¬ä¸‰æ–¹åº“-YYCache</title>
    <link href="/2020/04/01/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-YYCache/"/>
    <url>/2020/04/01/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-YYCache/</url>
    
    <content type="html"><![CDATA[<h1 id="YYCache"><a href="#YYCache" class="headerlink" title="YYCache"></a>YYCache</h1><h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>ä¸€ä¸ªé«˜æ€§èƒ½ iOS ç¼“å­˜æ¡†æ¶ã€‚</p><p>ä¸»è¦ç”±<code>YYDiskCache</code>ä¸<code>YYMemoryCache</code>ç»„æˆã€‚å…¶ä¸­<code>YYDiskCache</code>æ˜¯ä½œä¸ºæŒä¹…åŒ–å‚¨å­˜ï¼Œé€šè¿‡<code>sqlite</code>çš„å½¢å¼å‚¨å­˜åœ¨æ²™ç›’ä¸­<code>Library/Caches/&lt;ç¼“å­˜åœ°å€åç§°&gt;</code>ã€‚<br>ç¼“å­˜çš„å¯¹è±¡éœ€è¦éµå¾ª<code>NSCoding</code>åè®®ï¼Œå¹¶å®ç°åè®®æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡<code>YYModel</code>ä¸€é”®å½’æ¡£ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">- (<span class="hljs-keyword">void</span>)encodeWithCoder:(<span class="hljs-built_in">NSCoder</span>*)aCoder &#123;<br>    [<span class="hljs-keyword">self</span> yy_modelEncodeWithCoder:aCoder];<br>&#125;<br><br>- (<span class="hljs-keyword">id</span>)initWithCoder:(<span class="hljs-built_in">NSCoder</span>*)aDecoder &#123;<br>    <span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> init];<br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> yy_modelInitWithCoder:aDecoder];<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ¥å£è¯´æ˜"><a href="#æ¥å£è¯´æ˜" class="headerlink" title="æ¥å£è¯´æ˜"></a>æ¥å£è¯´æ˜</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">YYCache</span> : <span class="hljs-title">NSObject</span></span><br><br><span class="hljs-comment">/** ç¼“å­˜çš„åç§° */</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">copy</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">NSString</span> *name;<br><br><span class="hljs-comment">/** å†…å­˜ç¼“å­˜ */</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">strong</span>, <span class="hljs-keyword">readonly</span>) YYMemoryCache *memoryCache;<br><br><span class="hljs-comment">/** ç£ç›˜ç¼“å­˜ */</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">strong</span>, <span class="hljs-keyword">readonly</span>) YYDiskCache *diskCache;<br><br><span class="hljs-comment">/** åˆå§‹åŒ–æ–¹å¼ä¸€ï¼Œè®¾ç½®ç¼“å­˜åç§° */</span><br>- (<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">instancetype</span>)initWithName:(<span class="hljs-built_in">NSString</span> *)name;<br><br><span class="hljs-comment">/** åˆå§‹åŒ–æ–¹å¼äºŒï¼Œè®¾ç½®ç¼“å­˜è·¯å¾„ */</span><br>- (<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">instancetype</span>)initWithPath:(<span class="hljs-built_in">NSString</span> *)path <span class="hljs-built_in">NS_DESIGNATED_INITIALIZER</span>;<br><br><span class="hljs-comment">/** ä¾¿åˆ©æ„é€ åˆå§‹åŒ–ï¼Œè®¾ç½®ç¼“å­˜åç§° */</span><br>+ (<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">instancetype</span>)cacheWithName:(<span class="hljs-built_in">NSString</span> *)name;<br><br><span class="hljs-comment">/** ä¾¿åˆ©æ„é€ åˆå§‹åŒ–ï¼Œè®¾ç½®ç¼“å­˜è·¯å¾„ */</span><br>+ (<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">instancetype</span>)cacheWithPath:(<span class="hljs-built_in">NSString</span> *)path;<br><br><span class="hljs-comment">/** æ–¹æ³•å¤±æ•ˆ */</span><br>- (<span class="hljs-keyword">instancetype</span>)init UNAVAILABLE_ATTRIBUTE;<br><span class="hljs-comment">/** æ–¹æ³•å¤±æ•ˆ */</span><br>+ (<span class="hljs-keyword">instancetype</span>)new UNAVAILABLE_ATTRIBUTE;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Access Methods</span><br><span class="hljs-comment">///=============================================================================</span><br><span class="hljs-comment">/// @name Access Methods</span><br><span class="hljs-comment">///=============================================================================</span><br><br><span class="hljs-comment">/** åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒkeyå€¼çš„æ•°æ® */</span><br>- (<span class="hljs-built_in">BOOL</span>)containsObjectForKey:(<span class="hljs-built_in">NSString</span> *)key;<br><br><span class="hljs-comment">/** å¼‚æ­¥ åˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒkeyå€¼çš„æ•°æ® */</span><br>- (<span class="hljs-keyword">void</span>)containsObjectForKey:(<span class="hljs-built_in">NSString</span> *)key withBlock:(<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSString</span> *key, <span class="hljs-built_in">BOOL</span> contains))block;<br><br><span class="hljs-comment">/** é€šè¿‡keyå€¼è·å–ç¼“å­˜æ•°æ® */</span><br>- (<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">id</span>&lt;<span class="hljs-built_in">NSCoding</span>&gt;)objectForKey:(<span class="hljs-built_in">NSString</span> *)key;<br><br><span class="hljs-comment">/** å¼‚æ­¥é€šè¿‡keyå€¼è·å–ç¼“å­˜æ•°æ® */</span><br>- (<span class="hljs-keyword">void</span>)objectForKey:(<span class="hljs-built_in">NSString</span> *)key withBlock:(<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSString</span> *key, <span class="hljs-keyword">id</span>&lt;<span class="hljs-built_in">NSCoding</span>&gt; object))block;<br><br><span class="hljs-comment">/** é€šè¿‡keyå€¼ï¼Œè®¾ç½®ç¼“å­˜æ•°æ® */</span><br>- (<span class="hljs-keyword">void</span>)setObject:(<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">id</span>&lt;<span class="hljs-built_in">NSCoding</span>&gt;)object forKey:(<span class="hljs-built_in">NSString</span> *)key;<br><br><span class="hljs-comment">/** å¼‚æ­¥é€šè¿‡keyå€¼ï¼Œè®¾ç½®ç¼“å­˜æ•°æ® */</span><br>- (<span class="hljs-keyword">void</span>)setObject:(<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">id</span>&lt;<span class="hljs-built_in">NSCoding</span>&gt;)object forKey:(<span class="hljs-built_in">NSString</span> *)key withBlock:(<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">void</span>(^)(<span class="hljs-keyword">void</span>))block;<br><br><span class="hljs-comment">/** é€šè¿‡keyå€¼ï¼Œæ¸…é™¤ç¼“å­˜æ•°æ® */</span><br>- (<span class="hljs-keyword">void</span>)removeObjectForKey:(<span class="hljs-built_in">NSString</span> *)key;<br><br><span class="hljs-comment">/** å¼‚æ­¥é€šè¿‡keyå€¼ï¼Œæ¸…é™¤ç¼“å­˜æ•°æ®  */</span><br>- (<span class="hljs-keyword">void</span>)removeObjectForKey:(<span class="hljs-built_in">NSString</span> *)key withBlock:(<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSString</span> *key))block;<br><br><span class="hljs-comment">/** æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®  */</span><br>- (<span class="hljs-keyword">void</span>)removeAllObjects;<br><br><span class="hljs-comment">/** å¼‚æ­¥æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®  */</span><br>- (<span class="hljs-keyword">void</span>)removeAllObjectsWithBlock:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-keyword">void</span>))block;<br><br><span class="hljs-comment">/** å¼‚æ­¥æ¸…é™¤æ‰€æœ‰ç¼“å­˜æ•°æ®ï¼Œå¹¶è·å–æ¸…é™¤è¿›ç¨‹å’Œæ˜¯å¦æ¸…é™¤å¤±è´¥  */</span><br>- (<span class="hljs-keyword">void</span>)removeAllObjectsWithProgressBlock:(<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">void</span>(^)(<span class="hljs-keyword">int</span> removedCount, <span class="hljs-keyword">int</span> totalCount))progress<br>                                 endBlock:(<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">BOOL</span> error))end;<br><br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å®ä¾‹<code>Model</code></p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">TestModel</span> : <span class="hljs-title">NSObject</span> &lt;<span class="hljs-title">NSCoding</span>&gt;</span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) <span class="hljs-built_in">NSString</span> *name;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">NSInteger</span> age;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-keyword">bool</span> sex;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br><br><span class="hljs-comment">//--------------------åˆ†ç•Œçº¿--------------------//</span><br><br><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;TestModel.h&quot;</span></span><br><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;YYModel.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">TestModel</span></span><br>- (<span class="hljs-keyword">void</span>)encodeWithCoder:(<span class="hljs-built_in">NSCoder</span>*)aCoder &#123;<br>    [<span class="hljs-keyword">self</span> yy_modelEncodeWithCoder:aCoder];<br>&#125;<br><br>- (<span class="hljs-keyword">id</span>)initWithCoder:(<span class="hljs-built_in">NSCoder</span>*)aDecoder &#123;<br>    <span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> init];<br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> yy_modelInitWithCoder:aDecoder];<br>&#125;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><p>æ·»åŠ åˆ°ç¼“å­˜ä¸­</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs nix">YYCache *<span class="hljs-attr">cache</span> = [YYCache cacheWithName:@<span class="hljs-string">&quot;CacheName&quot;</span>];<br><br>TestModel *<span class="hljs-attr">model</span> = [[TestModel alloc] init];<br>model.<span class="hljs-attr">name</span> = @<span class="hljs-string">&quot;test&quot;</span>;<br>model.<span class="hljs-attr">age</span> = <span class="hljs-number">11</span>;<br>model.<span class="hljs-attr">sex</span> = NO;<br><br>TestModel *<span class="hljs-attr">model1</span> = [[TestModel alloc] init];<br>model1.<span class="hljs-attr">name</span> = @<span class="hljs-string">&quot;tes2&quot;</span>;<br>model1.<span class="hljs-attr">age</span> = <span class="hljs-number">22</span>;<br>model1.<span class="hljs-attr">sex</span> = YES;<br><br>TestModel *<span class="hljs-attr">model2</span> = [[TestModel alloc] init];<br>model2.<span class="hljs-attr">name</span> = @<span class="hljs-string">&quot;tes3&quot;</span>;<br>model2.<span class="hljs-attr">age</span> = <span class="hljs-number">33</span>;<br>model2.<span class="hljs-attr">sex</span> = NO;<br><br>NSArray&lt;TestModel *&gt; *<span class="hljs-attr">array</span> = @[model, model1, model2];<br><br>[cache setObject:array forKey:@<span class="hljs-string">&quot;Test&quot;</span>];<br>NSArray&lt;TestModel *&gt; *<span class="hljs-attr">tArray</span> = [cache objectForKey:@<span class="hljs-string">&quot;Test&quot;</span>];<br><br>for (TestModel *m <span class="hljs-keyword">in</span> tArray) &#123;<br>    NSLog(@<span class="hljs-string">&quot;name:%@----age:%ld---sex:%d&quot;</span>, m.name, m.age, m.sex);<br>&#125;<br></code></pre></td></tr></table></figure><p>è·å–ç¼“å­˜ä¸­çš„æ•°æ®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">16</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">12</span>.<span class="hljs-number">918221</span>+<span class="hljs-number">0800</span> YYKitDemo[<span class="hljs-number">8347</span>:<span class="hljs-number">173145</span>] name:test----age:<span class="hljs-number">11</span>---sex:<span class="hljs-number">0</span><br><span class="hljs-attribute">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">16</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">12</span>.<span class="hljs-number">918342</span>+<span class="hljs-number">0800</span> YYKitDemo[<span class="hljs-number">8347</span>:<span class="hljs-number">173145</span>] name:tes<span class="hljs-number">2</span>----age:<span class="hljs-number">22</span>---sex:<span class="hljs-number">1</span><br><span class="hljs-attribute">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">16</span> <span class="hljs-number">11</span>:<span class="hljs-number">59</span>:<span class="hljs-number">12</span>.<span class="hljs-number">918412</span>+<span class="hljs-number">0800</span> YYKitDemo[<span class="hljs-number">8347</span>:<span class="hljs-number">173145</span>] name:tes<span class="hljs-number">3</span>----age:<span class="hljs-number">33</span>---sex:<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Swift</category>
      
      <category>iOS</category>
      
      <category>SDK</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RxSwiftå­¦ä¹ æ—¥å¸¸ï¼ˆåŸºç¡€ä»‹ç»ï¼‰</title>
    <link href="/2020/03/01/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-RxSwift%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%B8%B8%EF%BC%88%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D%EF%BC%89/"/>
    <url>/2020/03/01/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-RxSwift%E5%AD%A6%E4%B9%A0%E6%97%A5%E5%B8%B8%EF%BC%88%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Observable-ä»‹ç»"><a href="#Observable-ä»‹ç»" class="headerlink" title="Observable ä»‹ç»"></a>Observable ä»‹ç»</h1><h2 id="Observable"><a href="#Observable" class="headerlink" title="Observable"></a>Observable<T></h2><ul><li>Observable<T> è¿™ä¸ªç±»å°±æ˜¯ Rx æ¡†æ¶çš„åŸºç¡€ï¼Œæˆ‘ä»¬å¯ä»¥ç§°å®ƒä¸ºå¯è§‚å¯Ÿåºåˆ—ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯å¯ä»¥å¼‚æ­¥åœ°äº§ç”Ÿä¸€ç³»åˆ—çš„ Eventï¼ˆäº‹ä»¶ï¼‰ï¼Œå³ä¸€ä¸ª Observable<T> å¯¹è±¡ä¼šéšç€æ—¶é—´æ¨ç§»ä¸å®šæœŸåœ°å‘å‡º event(element : T) è¿™æ ·ä¸€ä¸ªä¸œè¥¿ã€‚</li><li>è€Œä¸”è¿™äº› Event è¿˜å¯ä»¥æºå¸¦æ•°æ®ï¼Œå®ƒçš„æ³›å‹ <T> å°±æ˜¯ç”¨æ¥æŒ‡å®šè¿™ä¸ª Event æºå¸¦çš„æ•°æ®çš„ç±»å‹ã€‚</li><li>æœ‰äº†å¯è§‚å¯Ÿåºåˆ—ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æœ‰ä¸€ä¸ª Observerï¼ˆè®¢é˜…è€…ï¼‰æ¥è®¢é˜…å®ƒï¼Œè¿™æ ·è¿™ä¸ªè®¢é˜…è€…æ‰èƒ½æ”¶åˆ° Observable<T> ä¸æ—¶å‘å‡ºçš„ Eventã€‚<h2 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h2>æŸ¥çœ‹ RxSwift æºç å¯ä»¥å‘ç°ï¼Œäº‹ä»¶ Event çš„å®šä¹‰å¦‚ä¸‹ï¼š</li></ul><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> Event&lt;Element&gt; &#123;<br>    <span class="hljs-comment">/// Next element is produced.</span><br>    <span class="hljs-keyword">case</span> next(Element)<br> <br>    <span class="hljs-comment">/// Sequence terminated with an error.</span><br>    <span class="hljs-keyword">case</span> <span class="hljs-keyword">error</span>(Swift.Error)<br> <br>    <span class="hljs-comment">/// Sequence completed successfully.</span><br>    <span class="hljs-keyword">case</span> completed<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° Event å°±æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª Observable æ˜¯å¯ä»¥å‘å‡º 3 ç§ä¸åŒç±»å‹çš„ Event äº‹ä»¶ï¼š</p><ul><li>nextï¼šnext äº‹ä»¶å°±æ˜¯é‚£ä¸ªå¯ä»¥æºå¸¦æ•°æ® <T> çš„äº‹ä»¶ï¼Œå¯ä»¥è¯´å®ƒå°±æ˜¯ä¸€ä¸ªâ€œæœ€æ­£å¸¸â€çš„äº‹ä»¶ã€‚</li><li>errorï¼šerror äº‹ä»¶è¡¨ç¤ºä¸€ä¸ªé”™è¯¯ï¼Œå®ƒå¯ä»¥æºå¸¦å…·ä½“çš„é”™è¯¯å†…å®¹ï¼Œä¸€æ—¦ Observable å‘å‡ºäº† error eventï¼Œåˆ™è¿™ä¸ª Observable å°±ç­‰äºç»ˆæ­¢äº†ï¼Œä»¥åå®ƒå†ä¹Ÿä¸ä¼šå‘å‡º event äº‹ä»¶äº†ã€‚</li><li>completedï¼šcompleted äº‹ä»¶è¡¨ç¤º Observable å‘å‡ºçš„äº‹ä»¶æ­£å¸¸åœ°ç»“æŸäº†ï¼Œè·Ÿ error ä¸€æ ·ï¼Œä¸€æ—¦ Observable å‘å‡ºäº† completed eventï¼Œåˆ™è¿™ä¸ª Observable å°±ç­‰äºç»ˆæ­¢äº†ï¼Œä»¥åå®ƒå†ä¹Ÿä¸ä¼šå‘å‡º event äº‹ä»¶äº†<h2 id="Observable-ä¸-Sequenceæ¯”è¾ƒ"><a href="#Observable-ä¸-Sequenceæ¯”è¾ƒ" class="headerlink" title="Observable ä¸ Sequenceæ¯”è¾ƒ"></a>Observable ä¸ Sequenceæ¯”è¾ƒ</h2>(1)ã€ä¸ºæ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸€ä¸ª Observable çš„å®ä¾‹æƒ³è±¡æˆäºä¸€ä¸ª Swift ä¸­çš„ Sequenceï¼š</li><li>å³ä¸€ä¸ª Observableï¼ˆObservableTypeï¼‰ç›¸å½“äºä¸€ä¸ªåºåˆ— Sequenceï¼ˆSequenceTypeï¼‰ã€‚</li><li>ObservableType.subscribe(_:) æ–¹æ³•å…¶å®å°±ç›¸å½“äº SequenceType.generate()ã€‚</li></ul><p>(2)ã€ä½†å®ƒä»¬ä¹‹é—´è¿˜æ˜¯æœ‰è®¸å¤šåŒºåˆ«çš„ï¼š</p><ul><li>Swift ä¸­çš„ SequenceType æ˜¯åŒæ­¥çš„å¾ªç¯ï¼Œè€Œ Observable æ˜¯å¼‚æ­¥çš„ã€‚</li><li>Observable å¯¹è±¡ä¼šåœ¨æœ‰ä»»ä½• Event æ—¶å€™ï¼Œè‡ªåŠ¨å°† Event ä½œä¸ºä¸€ä¸ªå‚æ•°é€šè¿‡ ObservableType.subscribe(_:) å‘å‡ºï¼Œå¹¶ä¸éœ€è¦ä½¿ç”¨ next æ–¹æ³•ã€‚<h2 id="åˆ›å»º-Observable-åºåˆ—"><a href="#åˆ›å»º-Observable-åºåˆ—" class="headerlink" title="åˆ›å»º Observable åºåˆ—"></a>åˆ›å»º Observable åºåˆ—</h2><h3 id="just-æ–¹æ³•"><a href="#just-æ–¹æ³•" class="headerlink" title="just() æ–¹æ³•"></a>just() æ–¹æ³•</h3>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•é€šè¿‡ä¼ å…¥ä¸€ä¸ªé»˜è®¤å€¼æ¥åˆå§‹åŒ–ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹æˆ‘ä»¬æ˜¾å¼åœ°æ ‡æ³¨å‡ºäº† observable çš„ç±»å‹ä¸º Observable<Int>ï¼Œå³æŒ‡å®šäº†è¿™ä¸ª Observable æ‰€å‘å‡ºçš„äº‹ä»¶æºå¸¦çš„æ•°æ®ç±»å‹å¿…é¡»æ˜¯ Int ç±»å‹çš„ã€‚</li></ul><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">let</span> observable = Observable&lt;<span class="hljs-built_in">Int</span>&gt;.just(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><h3 id="of-æ–¹æ³•"><a href="#of-æ–¹æ³•" class="headerlink" title="of() æ–¹æ³•"></a>of() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•å¯ä»¥æ¥å—å¯å˜æ•°é‡çš„å‚æ•°ï¼ˆå¿…éœ€è¦æ˜¯åŒç±»å‹çš„ï¼‰<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­æˆ‘æ²¡æœ‰æ˜¾å¼åœ°å£°æ˜å‡º Observable çš„æ³›å‹ç±»å‹ï¼ŒSwift ä¹Ÿä¼šè‡ªåŠ¨æ¨æ–­ç±»å‹ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">let</span> observable = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Observable</span>.</span></span><span class="hljs-keyword">of</span>(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="from-æ–¹æ³•"><a href="#from-æ–¹æ³•" class="headerlink" title="from() æ–¹æ³•"></a>from() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•éœ€è¦ä¸€ä¸ªæ•°ç»„å‚æ•°ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­æ•°æ®é‡Œçš„å…ƒç´ å°±ä¼šè¢«å½“åšè¿™ä¸ª Observable æ‰€å‘å‡º event æºå¸¦çš„æ•°æ®å†…å®¹ï¼Œæœ€ç»ˆæ•ˆæœåŒä¸Šé¢é¥¿ of() æ ·ä¾‹æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">let</span> observable = Observable.<span class="hljs-keyword">from</span>([<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>])<br></code></pre></td></tr></table></figure><h3 id="empty-æ–¹æ³•"><a href="#empty-æ–¹æ³•" class="headerlink" title="empty() æ–¹æ³•"></a>empty() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªç©ºå†…å®¹çš„ Observable åºåˆ—ã€‚</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">let</span> observable = Observable<span class="hljs-symbol">&lt;Int&gt;</span>.<span class="hljs-built_in">empty</span>()<br></code></pre></td></tr></table></figure><h3 id="never-æ–¹æ³•"><a href="#never-æ–¹æ³•" class="headerlink" title="never() æ–¹æ³•"></a>never() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ°¸è¿œä¸ä¼šå‘å‡º Eventï¼ˆä¹Ÿä¸ä¼šç»ˆæ­¢ï¼‰çš„ Observable åºåˆ—ã€‚</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clean"><span class="hljs-keyword">let</span> observable = Observable&lt;<span class="hljs-built_in">Int</span>&gt;.never()<br></code></pre></td></tr></table></figure><h3 id="error-æ–¹æ³•"><a href="#error-æ–¹æ³•" class="headerlink" title="error() æ–¹æ³•"></a>error() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªä¸åšä»»ä½•æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥å‘é€ä¸€ä¸ªé”™è¯¯çš„ Observable åºåˆ—ã€‚</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">enum</span> MyError: <span class="hljs-built_in">Error</span> &#123;<br>    <span class="hljs-keyword">case</span> A<br>    <span class="hljs-keyword">case</span> B<br>&#125;<br>         <br><span class="hljs-keyword">let</span> observable = Observable&lt;Int&gt;.error(MyError.A)<br></code></pre></td></tr></table></figure><h3 id="range-æ–¹æ³•"><a href="#range-æ–¹æ³•" class="headerlink" title="range() æ–¹æ³•"></a>range() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•é€šè¿‡æŒ‡å®šèµ·å§‹å’Œç»“æŸæ•°å€¼ï¼Œåˆ›å»ºä¸€ä¸ªä»¥è¿™ä¸ªèŒƒå›´å†…æ‰€æœ‰å€¼ä½œä¸ºåˆå§‹å€¼çš„ Observable åºåˆ—ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­ï¼Œä¸¤ç§æ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//ä½¿ç”¨range()</span><br><span class="hljs-keyword">let</span> observable = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Observable</span>.</span></span>range(start: <span class="hljs-number">1</span>, count: <span class="hljs-number">5</span>)<br> <br><span class="hljs-comment">//ä½¿ç”¨of()</span><br><span class="hljs-keyword">let</span> observable = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Observable</span>.</span></span><span class="hljs-keyword">of</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span> ,<span class="hljs-number">4</span> ,<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><h3 id="repeatElement-æ–¹æ³•"><a href="#repeatElement-æ–¹æ³•" class="headerlink" title="repeatElement() æ–¹æ³•"></a>repeatElement() æ–¹æ³•</h3><p>è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯ä»¥æ— é™å‘å‡ºç»™å®šå…ƒç´ çš„ Event çš„ Observable åºåˆ—ï¼ˆæ°¸ä¸ç»ˆæ­¢ï¼‰ã€‚ </p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">let</span> observable = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Observable</span>.</span></span>repeat<span class="hljs-constructor">Element(1)</span><br></code></pre></td></tr></table></figure><h3 id="generate-æ–¹æ³•"><a href="#generate-æ–¹æ³•" class="headerlink" title="generate() æ–¹æ³•"></a>generate() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•åˆ›å»ºä¸€ä¸ªåªæœ‰å½“æä¾›çš„æ‰€æœ‰çš„åˆ¤æ–­æ¡ä»¶éƒ½ä¸º true çš„æ—¶å€™ï¼Œæ‰ä¼šç»™å‡ºåŠ¨ä½œçš„ Observable åºåˆ—ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ ·ä¾‹ä¸­ï¼Œä¸¤ç§æ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//ä½¿ç”¨generate()æ–¹æ³•</span><br><span class="hljs-keyword">let</span> observable = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Observable</span>.</span></span>generate(<br>    initialState: <span class="hljs-number">0</span>,<br>    condition: &#123; $<span class="hljs-number">0</span> &lt;= <span class="hljs-number">10</span> &#125;,<br>    iterate: &#123; $<span class="hljs-number">0</span> + <span class="hljs-number">2</span> &#125;<br>)<br> <br><span class="hljs-comment">//ä½¿ç”¨of()æ–¹æ³•</span><br><span class="hljs-keyword">let</span> observable = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Observable</span>.</span></span><span class="hljs-keyword">of</span>(<span class="hljs-number">0</span> , <span class="hljs-number">2</span> ,<span class="hljs-number">4</span> ,<span class="hljs-number">6</span> ,<span class="hljs-number">8</span> ,<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><h3 id="create-æ–¹æ³•"><a href="#create-æ–¹æ³•" class="headerlink" title="create() æ–¹æ³•"></a>create() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ª block å½¢å¼çš„å‚æ•°ï¼Œä»»åŠ¡æ˜¯å¯¹æ¯ä¸€ä¸ªè¿‡æ¥çš„è®¢é˜…è¿›è¡Œå¤„ç†ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„æ ·ä¾‹ã€‚ä¸ºæ–¹ä¾¿æ¼”ç¤ºï¼Œè¿™é‡Œå¢åŠ äº†è®¢é˜…ç›¸å…³ä»£ç ï¼ˆå…³äºè®¢é˜…æˆ‘ä¹‹åä¼šè¯¦ç»†ä»‹ç»çš„ï¼‰ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span>è¿™ä¸ªblockæœ‰ä¸€ä¸ªå›è°ƒå‚æ•°observerå°±æ˜¯è®¢é˜…è¿™ä¸ªObservableå¯¹è±¡çš„è®¢é˜…è€…<br><span class="hljs-regexp">//</span>å½“ä¸€ä¸ªè®¢é˜…è€…è®¢é˜…è¿™ä¸ªObservableå¯¹è±¡çš„æ—¶å€™ï¼Œå°±ä¼šå°†è®¢é˜…è€…ä½œä¸ºå‚æ•°ä¼ å…¥è¿™ä¸ªblockæ¥æ‰§è¡Œä¸€äº›å†…å®¹<br>let observable = Observable&lt;String&gt;.create&#123;observer <span class="hljs-keyword">in</span><br>    <span class="hljs-regexp">//</span>å¯¹è®¢é˜…è€…å‘å‡ºäº†.<span class="hljs-keyword">next</span>äº‹ä»¶ï¼Œä¸”æºå¸¦äº†ä¸€ä¸ªæ•°æ®<span class="hljs-string">&quot;hangge.com&quot;</span><br>    observer.onNext(<span class="hljs-string">&quot;hangge.com&quot;</span>)<br>    <span class="hljs-regexp">//</span>å¯¹è®¢é˜…è€…å‘å‡ºäº†.completedäº‹ä»¶<br>    observer.onCompleted()<br>    <span class="hljs-regexp">//</span>å› ä¸ºä¸€ä¸ªè®¢é˜…è¡Œä¸ºä¼šæœ‰ä¸€ä¸ªDisposableç±»å‹çš„è¿”å›å€¼ï¼Œæ‰€ä»¥åœ¨ç»“å°¾ä¸€å®šè¦returenä¸€ä¸ªDisposable<br>    return Disposables.create()<br>&#125;<br> <br><span class="hljs-regexp">//</span>è®¢é˜…æµ‹è¯•<br>observable.subscribe &#123;<br>    print(<span class="hljs-variable">$0</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="deferred-æ–¹æ³•"><a href="#deferred-æ–¹æ³•" class="headerlink" title="deferred() æ–¹æ³•"></a>deferred() æ–¹æ³•</h3><p>è¯¥ä¸ªæ–¹æ³•ç›¸å½“äºæ˜¯åˆ›å»ºä¸€ä¸ª Observable å·¥å‚ï¼Œé€šè¿‡ä¼ å…¥ä¸€ä¸ª block æ¥æ‰§è¡Œå»¶è¿Ÿ Observable åºåˆ—åˆ›å»ºçš„è¡Œä¸ºï¼Œè€Œè¿™ä¸ª block é‡Œå°±æ˜¯çœŸæ­£çš„å®ä¾‹åŒ–åºåˆ—å¯¹è±¡çš„åœ°æ–¹ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">//ç”¨äºæ ‡è®°æ˜¯å¥‡æ•°ã€è¿˜æ˜¯å¶æ•°</span><br><span class="hljs-keyword">var</span> isOdd = <span class="hljs-literal">true</span><br> <br><span class="hljs-comment">//ä½¿ç”¨deferred()æ–¹æ³•å»¶è¿ŸObservableåºåˆ—çš„åˆå§‹åŒ–ï¼Œé€šè¿‡ä¼ å…¥çš„blockæ¥å®ç°Observableåºåˆ—çš„åˆå§‹åŒ–å¹¶ä¸”è¿”å›ã€‚</span><br><span class="hljs-keyword">let</span> factory : Observable&lt;Int&gt; = Observable.deferred &#123;<br>     <br>    <span class="hljs-comment">//è®©æ¯æ¬¡æ‰§è¡Œè¿™ä¸ªblockæ—¶å€™éƒ½ä¼šè®©å¥‡ã€å¶æ•°è¿›è¡Œäº¤æ›¿</span><br>    isOdd = !isOdd<br>     <br>    <span class="hljs-comment">//æ ¹æ®isOddå‚æ•°ï¼Œå†³å®šåˆ›å»ºå¹¶è¿”å›çš„æ˜¯å¥‡æ•°Observableã€è¿˜æ˜¯å¶æ•°Observable</span><br>    <span class="hljs-keyword">if</span> isOdd &#123;<br>        <span class="hljs-keyword">return</span> Observable.of(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span> ,<span class="hljs-number">7</span>)<br>    &#125;<span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> Observable.of(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">8</span>)<br>    &#125;<br>&#125;<br> <br><span class="hljs-comment">//ç¬¬1æ¬¡è®¢é˜…æµ‹è¯•</span><br>factory.subscribe &#123; <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span></span><br><span class="hljs-function">    <span class="hljs-title">print</span>(<span class="hljs-params"><span class="hljs-string">&quot;\(isOdd)&quot;</span>, <span class="hljs-keyword">event</span></span>)</span><br><span class="hljs-function">&#125;</span><br><span class="hljs-function"> </span><br><span class="hljs-function"><span class="hljs-comment">//ç¬¬2æ¬¡è®¢é˜…æµ‹è¯•</span></span><br><span class="hljs-function">factory.subscribe</span> &#123; <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span></span><br><span class="hljs-function">    <span class="hljs-title">print</span>(<span class="hljs-params"><span class="hljs-string">&quot;\(isOdd)&quot;</span>, <span class="hljs-keyword">event</span></span>)</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="interval-æ–¹æ³•"><a href="#interval-æ–¹æ³•" class="headerlink" title="interval() æ–¹æ³•"></a>interval() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¿™ä¸ªæ–¹æ³•åˆ›å»ºçš„ Observable åºåˆ—æ¯éš”ä¸€æ®µè®¾å®šçš„æ—¶é—´ï¼Œä¼šå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°çš„å…ƒç´ ã€‚è€Œä¸”å®ƒä¼šä¸€ç›´å‘é€ä¸‹å»ã€‚<br><br>ï¼ˆ2ï¼‰ä¸‹é¢æ–¹æ³•è®©å…¶æ¯ 1 ç§’å‘é€ä¸€æ¬¡ï¼Œå¹¶ä¸”æ˜¯åœ¨ä¸»çº¿ç¨‹ï¼ˆMainSchedulerï¼‰å‘é€ã€‚</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mel">let observable = Observable&lt;Int&gt;.interval(<span class="hljs-number">1</span>, scheduler: MainScheduler.<span class="hljs-keyword">instance</span>)<br>observable.subscribe &#123; <span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span><br>    <span class="hljs-keyword">print</span>(<span class="hljs-keyword">event</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="timer-æ–¹æ³•"><a href="#timer-æ–¹æ³•" class="headerlink" title="timer() æ–¹æ³•"></a>timer() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ç§ç”¨æ³•ï¼Œä¸€ç§æ˜¯åˆ›å»ºçš„ Observable åºåˆ—åœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œäº§ç”Ÿå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ ã€‚</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-comment">//5ç§’ç§åå‘å‡ºå”¯ä¸€çš„ä¸€ä¸ªå…ƒç´ 0</span><br>let observable = Observable&lt;Int&gt;.timer(<span class="hljs-number">5</span>, scheduler: MainScheduler.<span class="hljs-keyword">instance</span>)<br>observable.subscribe &#123; <span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span><br>    <span class="hljs-keyword">print</span>(<span class="hljs-keyword">event</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å¦ä¸€ç§æ˜¯åˆ›å»ºçš„ Observable åºåˆ—åœ¨ç»è¿‡è®¾å®šçš„ä¸€æ®µæ—¶é—´åï¼Œæ¯éš”ä¸€æ®µæ—¶é—´äº§ç”Ÿä¸€ä¸ªå…ƒç´ ã€‚</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-comment">//å»¶æ—¶5ç§’ç§åï¼Œæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªå…ƒç´ </span><br>let observable = Observable&lt;Int&gt;.timer(<span class="hljs-number">5</span>, period: <span class="hljs-number">1</span>, scheduler: MainScheduler.<span class="hljs-keyword">instance</span>)<br>observable.subscribe &#123; <span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span><br>    <span class="hljs-keyword">print</span>(<span class="hljs-keyword">event</span>)<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="è®¢é˜…-Observable"><a href="#è®¢é˜…-Observable" class="headerlink" title="è®¢é˜… Observable"></a>è®¢é˜… Observable</h1><h3 id="ç¬¬ä¸€ç§ç”¨æ³•ï¼š"><a href="#ç¬¬ä¸€ç§ç”¨æ³•ï¼š" class="headerlink" title="ç¬¬ä¸€ç§ç”¨æ³•ï¼š"></a>ç¬¬ä¸€ç§ç”¨æ³•ï¼š</h3><p>ï¼ˆ1ï¼‰æˆ‘ä»¬ä½¿ç”¨ subscribe() è®¢é˜…äº†ä¸€ä¸ª Observable å¯¹è±¡ï¼Œè¯¥æ–¹æ³•çš„ block çš„å›è°ƒå‚æ•°å°±æ˜¯è¢«å‘å‡ºçš„ event äº‹ä»¶ï¼Œæˆ‘ä»¬å°†å…¶ç›´æ¥æ‰“å°å‡ºæ¥ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">let</span> observable = Observable.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>)<br>         <br>observable.subscribe &#123; <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span></span><br><span class="hljs-function">    <span class="hljs-title">print</span>(<span class="hljs-params"><span class="hljs-keyword">event</span></span>)</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><p>è¾“å…¥ç»“æœå¯ä»¥çœ‹å‡º</p><ul><li>åˆå§‹åŒ– Observable åºåˆ—æ—¶è®¾ç½®çš„é»˜è®¤å€¼éƒ½æŒ‰é¡ºåºé€šè¿‡ .next äº‹ä»¶å‘é€å‡ºæ¥ã€‚</li><li>å½“ Observable åºåˆ—çš„åˆå§‹æ•°æ®éƒ½å‘é€å®Œæ¯•ï¼Œå®ƒè¿˜ä¼šè‡ªåŠ¨å‘ä¸€ä¸ª .completed äº‹ä»¶å‡ºæ¥ã€‚<br></li></ul><p>ï¼ˆ2ï¼‰å¦‚æœæƒ³è¦è·å–åˆ°è¿™ä¸ªäº‹ä»¶é‡Œçš„æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ event.element å¾—åˆ°ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">let</span> observable = Observable.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>)<br>         <br>observable.subscribe &#123; <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span></span><br><span class="hljs-function">    <span class="hljs-title">print</span>(<span class="hljs-params"><span class="hljs-keyword">event</span>.element</span>)</span><br><span class="hljs-function">&#125;</span><br></code></pre></td></tr></table></figure><h3 id="ç¬¬äºŒç§ç”¨æ³•ï¼š"><a href="#ç¬¬äºŒç§ç”¨æ³•ï¼š" class="headerlink" title="ç¬¬äºŒç§ç”¨æ³•ï¼š"></a>ç¬¬äºŒç§ç”¨æ³•ï¼š</h3><p>ï¼ˆ1ï¼‰RxSwift è¿˜æä¾›äº†å¦ä¸€ä¸ª subscribe æ–¹æ³•ï¼Œå®ƒå¯ä»¥æŠŠ event è¿›è¡Œåˆ†ç±»ï¼š</p><ul><li>é€šè¿‡ä¸åŒçš„ block å›è°ƒå¤„ç†ä¸åŒç±»å‹çš„ eventã€‚ï¼ˆå…¶ä¸­ onDisposed è¡¨ç¤ºè®¢é˜…è¡Œä¸ºè¢« dispose åçš„å›è°ƒï¼Œè¿™ä¸ªæˆ‘åé¢ä¼šè¯´ï¼‰</li><li>åŒæ—¶ä¼šæŠŠ event æºå¸¦çš„æ•°æ®ç›´æ¥è§£åŒ…å‡ºæ¥ä½œä¸ºå‚æ•°ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ã€‚<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">let observable = Observable.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>)<br>         <br>observable.subscribe(onNext: &#123; element <span class="hljs-keyword">in</span><br>    <span class="hljs-builtin-name">print</span>(element)<br>&#125;, onError: &#123; <span class="hljs-builtin-name">error</span> <span class="hljs-keyword">in</span><br>    <span class="hljs-builtin-name">print</span>(error)<br>&#125;, onCompleted: &#123;<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;completed&quot;</span>)<br>&#125;, onDisposed: &#123;<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;disposed&quot;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure>2ï¼‰subscribe() æ–¹æ³•çš„ onNextã€onErrorã€onCompleted å’Œ onDisposed è¿™å››ä¸ªå›è°ƒ block å‚æ•°éƒ½æ˜¯æœ‰é»˜è®¤å€¼çš„ï¼Œå³å®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åªå¤„ç† onNext è€Œä¸ç®¡å…¶ä»–çš„æƒ…å†µã€‚<figure class="highlight golo"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs golo"><span class="hljs-keyword">let</span> observable = <span class="hljs-keyword">Observable</span>.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>)<br>         <br>observable.subscribe(onNext: &#123; element <span class="hljs-keyword">in</span><br>    <span class="hljs-keyword">print</span>(element)<br>&#125;)<br></code></pre></td></tr></table></figure><h1 id="ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ"></a>ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h1><h3 id="1ã€-doOn-ä»‹ç»"><a href="#1ã€-doOn-ä»‹ç»" class="headerlink" title="1ã€ doOn ä»‹ç»"></a>1ã€ doOn ä»‹ç»</h3>ï¼ˆ1ï¼‰æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ doOn æ–¹æ³•æ¥ç›‘å¬äº‹ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¼šåœ¨æ¯ä¸€æ¬¡äº‹ä»¶å‘é€å‰è¢«è°ƒç”¨ã€‚<br><br>ï¼ˆ2ï¼‰åŒæ—¶å®ƒå’Œ subscribe ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„ block å›è°ƒå¤„ç†ä¸åŒç±»å‹çš„ eventã€‚æ¯”å¦‚ï¼š</li><li>do(onNext:) æ–¹æ³•å°±æ˜¯åœ¨ subscribe(onNext:) å‰è°ƒç”¨</li><li>è€Œ do(onCompleted:) æ–¹æ³•åˆ™ä¼šåœ¨ subscribe(onCompleted:) å‰é¢è°ƒç”¨ã€‚</li></ul><h3 id="ä½¿ç”¨æ ·ä¾‹"><a href="#ä½¿ç”¨æ ·ä¾‹" class="headerlink" title="ä½¿ç”¨æ ·ä¾‹"></a>ä½¿ç”¨æ ·ä¾‹</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs routeros">let observable = Observable.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>)<br> <br>observable<br>    .<span class="hljs-keyword">do</span>(onNext: &#123; element <span class="hljs-keyword">in</span><br>        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;Intercepted Nextï¼š&quot;</span>, element)<br>    &#125;, onError: &#123; <span class="hljs-builtin-name">error</span> <span class="hljs-keyword">in</span><br>        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;Intercepted Errorï¼š&quot;</span>, error)<br>    &#125;, onCompleted: &#123;<br>        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;Intercepted Completed&quot;</span>)<br>    &#125;, onDispose: &#123;<br>        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;Intercepted Disposed&quot;</span>)<br>    &#125;)<br>    .subscribe(onNext: &#123; element <span class="hljs-keyword">in</span><br>        <span class="hljs-builtin-name">print</span>(element)<br>    &#125;, onError: &#123; <span class="hljs-builtin-name">error</span> <span class="hljs-keyword">in</span><br>        <span class="hljs-builtin-name">print</span>(error)<br>    &#125;, onCompleted: &#123;<br>        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;completed&quot;</span>)<br>    &#125;, onDisposed: &#123;<br>        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;disposed&quot;</span>)<br>    &#125;)<br></code></pre></td></tr></table></figure><h1 id="Observable-çš„é”€æ¯ï¼ˆDisposeï¼‰"><a href="#Observable-çš„é”€æ¯ï¼ˆDisposeï¼‰" class="headerlink" title="Observable çš„é”€æ¯ï¼ˆDisposeï¼‰"></a>Observable çš„é”€æ¯ï¼ˆDisposeï¼‰</h1><h3 id="1ã€Observable-ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹"><a href="#1ã€Observable-ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹" class="headerlink" title="1ã€Observable ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹"></a>1ã€Observable ä»åˆ›å»ºåˆ°ç»ˆç»“æµç¨‹</h3><p>ï¼ˆ1ï¼‰ä¸€ä¸ª Observable åºåˆ—è¢«åˆ›å»ºå‡ºæ¥åå®ƒä¸ä¼šé©¬ä¸Šå°±å¼€å§‹è¢«æ¿€æ´»ä»è€Œå‘å‡º Eventï¼Œè€Œæ˜¯è¦ç­‰åˆ°å®ƒè¢«æŸä¸ªäººè®¢é˜…äº†æ‰ä¼šæ¿€æ´»å®ƒã€‚<br><br>ï¼ˆ2ï¼‰è€Œ Observable åºåˆ—æ¿€æ´»ä¹‹åè¦ä¸€ç›´ç­‰åˆ°å®ƒå‘å‡ºäº† .error æˆ–è€… .completed çš„ event åï¼Œå®ƒæ‰è¢«ç»ˆç»“ã€‚</p><h3 id="2ã€dispose-æ–¹æ³•"><a href="#2ã€dispose-æ–¹æ³•" class="headerlink" title="2ã€dispose() æ–¹æ³•"></a>2ã€dispose() æ–¹æ³•</h3><p>ï¼ˆ1ï¼‰ä½¿ç”¨è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å–æ¶ˆä¸€ä¸ªè®¢é˜…è¡Œä¸ºã€‚<br><br>ï¼ˆ2ï¼‰å¦‚æœæˆ‘ä»¬è§‰å¾—è¿™ä¸ªè®¢é˜…ç»“æŸäº†ä¸å†éœ€è¦äº†ï¼Œå°±å¯ä»¥è°ƒç”¨ dispose() æ–¹æ³•æŠŠè¿™ä¸ªè®¢é˜…ç»™é”€æ¯æ‰ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚<br><br>ï¼ˆ2ï¼‰å½“ä¸€ä¸ªè®¢é˜…è¡Œä¸ºè¢« dispose äº†ï¼Œé‚£ä¹ˆä¹‹å observable å¦‚æœå†å‘å‡º eventï¼Œè¿™ä¸ªå·²ç» dispose çš„è®¢é˜…å°±æ”¶ä¸åˆ°æ¶ˆæ¯äº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ ·ä¾‹ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">let</span> observable = Observable.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>)<br>         <br><span class="hljs-comment">//ä½¿ç”¨subscriptionå¸¸é‡å­˜å‚¨è¿™ä¸ªè®¢é˜…æ–¹æ³•</span><br><span class="hljs-keyword">let</span> subscription = observable.subscribe &#123; <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span></span><br><span class="hljs-function">    <span class="hljs-title">print</span>(<span class="hljs-params"><span class="hljs-keyword">event</span></span>)</span><br><span class="hljs-function">&#125;</span><br><span class="hljs-function">         </span><br><span class="hljs-function"><span class="hljs-comment">//è°ƒç”¨è¿™ä¸ªè®¢é˜…çš„dispose()æ–¹æ³•</span></span><br><span class="hljs-function">subscription.<span class="hljs-title">dispose</span>(<span class="hljs-params"></span>)</span><br></code></pre></td></tr></table></figure><h3 id="3ã€DisposeBag"><a href="#3ã€DisposeBag" class="headerlink" title="3ã€DisposeBag"></a>3ã€DisposeBag</h3><p>é™¤äº† dispose() æ–¹æ³•ä¹‹å¤–ï¼Œæˆ‘ä»¬æ›´ç»å¸¸ç”¨åˆ°çš„æ˜¯ä¸€ä¸ªå« DisposeBag çš„å¯¹è±¡æ¥ç®¡ç†å¤šä¸ªè®¢é˜…è¡Œä¸ºçš„é”€æ¯ï¼š<br>æˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ª DisposeBag å¯¹è±¡çœ‹æˆä¸€ä¸ªåƒåœ¾è¢‹ï¼ŒæŠŠç”¨è¿‡çš„è®¢é˜…è¡Œä¸ºéƒ½æ”¾è¿›å»ã€‚<br>è€Œè¿™ä¸ª DisposeBag å°±ä¼šåœ¨è‡ªå·±å¿«è¦ dealloc çš„æ—¶å€™ï¼Œå¯¹å®ƒé‡Œé¢çš„æ‰€æœ‰è®¢é˜…è¡Œä¸ºéƒ½è°ƒç”¨ dispose() æ–¹æ³•ã€‚<br>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨æ ·ä¾‹ã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">let</span> disposeBag = DisposeBag()<br>         <br><span class="hljs-comment">//ç¬¬1ä¸ªObservableï¼ŒåŠå…¶è®¢é˜…</span><br><span class="hljs-keyword">let</span> observable1 = Observable.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>)<br>observable1.subscribe &#123; <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span></span><br><span class="hljs-function">    <span class="hljs-title">print</span>(<span class="hljs-params"><span class="hljs-keyword">event</span></span>)</span><br><span class="hljs-function">&#125;.<span class="hljs-title">disposed</span>(<span class="hljs-params"><span class="hljs-keyword">by</span>: disposeBag</span>)</span><br><span class="hljs-function"> </span><br><span class="hljs-function"><span class="hljs-comment">//ç¬¬2ä¸ªObservableï¼ŒåŠå…¶è®¢é˜…</span></span><br><span class="hljs-function"><span class="hljs-keyword">let</span> observable2</span> = Observable.of(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>observable2.subscribe &#123; <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span></span><br><span class="hljs-function">    <span class="hljs-title">print</span>(<span class="hljs-params"><span class="hljs-keyword">event</span></span>)</span><br><span class="hljs-function">&#125;.<span class="hljs-title">disposed</span>(<span class="hljs-params"><span class="hljs-keyword">by</span>: disposeBag</span>)</span><br></code></pre></td></tr></table></figure><h1 id="è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»"><a href="#è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»" class="headerlink" title="è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»"></a>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ä»‹ç»</h1><p>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰çš„ä½œç”¨å°±æ˜¯ç›‘å¬äº‹ä»¶ï¼Œç„¶åå¯¹è¿™ä¸ªäº‹ä»¶åšå‡ºå“åº”ã€‚æˆ–è€…è¯´ä»»ä½•å“åº”äº‹ä»¶çš„è¡Œä¸ºéƒ½æ˜¯è§‚å¯Ÿè€…ã€‚æ¯”å¦‚ï¼š</p><ul><li>å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œå¼¹å‡ºä¸€ä¸ªæç¤ºæ¡†â€å°±æ˜¯è§‚å¯Ÿè€… Observer<Void></li><li>å½“æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªè¿œç¨‹çš„ json æ•°æ®åï¼Œå°†å…¶æ‰“å°å‡ºæ¥ã€‚é‚£ä¹ˆè¿™ä¸ªâ€œæ‰“å° json æ•°æ®â€å°±æ˜¯è§‚å¯Ÿè€… Observer<JSON></li></ul><h1 id="ç›´æ¥åœ¨-subscribeã€bind-æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…"><a href="#ç›´æ¥åœ¨-subscribeã€bind-æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…" class="headerlink" title="ç›´æ¥åœ¨ subscribeã€bind æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…"></a>ç›´æ¥åœ¨ subscribeã€bind æ–¹æ³•ä¸­åˆ›å»ºè§‚å¯Ÿè€…</h1><h3 id="1-åœ¨-subscribe-æ–¹æ³•ä¸­åˆ›å»º"><a href="#1-åœ¨-subscribe-æ–¹æ³•ä¸­åˆ›å»º" class="headerlink" title="1. åœ¨ subscribe æ–¹æ³•ä¸­åˆ›å»º"></a>1. åœ¨ subscribe æ–¹æ³•ä¸­åˆ›å»º</h3><p>ï¼ˆ1ï¼‰åˆ›å»ºè§‚å¯Ÿè€…æœ€ç›´æ¥çš„æ–¹æ³•å°±æ˜¯åœ¨ Observable çš„ subscribe æ–¹æ³•åé¢æè¿°å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œéœ€è¦å¦‚ä½•åšå‡ºå“åº”ã€‚<br><br>ï¼ˆ2ï¼‰æ¯”å¦‚ä¸‹é¢çš„æ ·ä¾‹ï¼Œè§‚å¯Ÿè€…å°±æ˜¯ç”±åé¢çš„ onNextï¼ŒonErrorï¼ŒonCompleted è¿™äº›é—­åŒ…æ„å»ºå‡ºæ¥çš„ã€‚</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">let observable = Observable.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>)<br>          <br>observable.subscribe(onNext: &#123; element <span class="hljs-keyword">in</span><br>    <span class="hljs-builtin-name">print</span>(element)<br>&#125;, onError: &#123; <span class="hljs-builtin-name">error</span> <span class="hljs-keyword">in</span><br>    <span class="hljs-builtin-name">print</span>(error)<br>&#125;, onCompleted: &#123;<br>    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">&quot;completed&quot;</span>)<br>&#125;)<br></code></pre></td></tr></table></figure><h3 id="2-åœ¨-bind-æ–¹æ³•ä¸­åˆ›å»º"><a href="#2-åœ¨-bind-æ–¹æ³•ä¸­åˆ›å»º" class="headerlink" title="2. åœ¨ bind æ–¹æ³•ä¸­åˆ›å»º"></a>2. åœ¨ bind æ–¹æ³•ä¸­åˆ›å»º</h3><p>ä¸‹é¢ä»£ç æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®šæ—¶ç”Ÿæˆç´¢å¼•æ•°çš„ Observable åºåˆ—ï¼Œå¹¶å°†ç´¢å¼•æ•°ä¸æ–­æ˜¾ç¤ºåœ¨ label æ ‡ç­¾ä¸Šï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> UIKit<br><span class="hljs-keyword">import</span> RxSwift<br><span class="hljs-keyword">import</span> RxCocoa<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">UIViewController</span> </span>&#123;<br>     <br>    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> label: <span class="hljs-type">UILabel</span>!<br>     <br>    <span class="hljs-keyword">let</span> disposeBag <span class="hljs-operator">=</span> <span class="hljs-type">DisposeBag</span>()<br>     <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span>()</span> &#123;<br>         <br>        <span class="hljs-comment">//Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br>        <span class="hljs-keyword">let</span> observable <span class="hljs-operator">=</span> <span class="hljs-type">Observable</span>&lt;<span class="hljs-type">Int</span>&gt;.interval(<span class="hljs-number">1</span>, scheduler: <span class="hljs-type">MainScheduler</span>.instance)<br> <br>        observable<br>            .map &#123; <span class="hljs-string">&quot;å½“å‰ç´¢å¼•æ•°ï¼š<span class="hljs-subst">\(<span class="hljs-variable">$0</span> )</span>&quot;</span>&#125;<br>            .bind &#123; [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>](text) <span class="hljs-keyword">in</span><br>                <span class="hljs-comment">//æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br>                <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.label.text <span class="hljs-operator">=</span> text<br>            &#125;<br>            .disposed(by: disposeBag)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ä½¿ç”¨-AnyObserver-åˆ›å»ºè§‚å¯Ÿè€…"><a href="#ä½¿ç”¨-AnyObserver-åˆ›å»ºè§‚å¯Ÿè€…" class="headerlink" title="ä½¿ç”¨ AnyObserver åˆ›å»ºè§‚å¯Ÿè€…"></a>ä½¿ç”¨ AnyObserver åˆ›å»ºè§‚å¯Ÿè€…</h1><p>AnyObserver å¯ä»¥ç”¨æ¥æå™ä»»æ„ä¸€ç§è§‚å¯Ÿè€…ã€‚</p><h3 id="1ã€é…åˆ-subscribe-æ–¹æ³•ä½¿ç”¨"><a href="#1ã€é…åˆ-subscribe-æ–¹æ³•ä½¿ç”¨" class="headerlink" title="1ã€é…åˆ subscribe æ–¹æ³•ä½¿ç”¨"></a>1ã€é…åˆ subscribe æ–¹æ³•ä½¿ç”¨</h3><p>æ¯”å¦‚ä¸Šé¢ç¬¬ä¸€ä¸ªæ ·ä¾‹æˆ‘ä»¬å¯ä»¥æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-comment">//è§‚å¯Ÿè€…</span><br>let observer: AnyObserver&lt;String&gt; = AnyObserver &#123; (<span class="hljs-keyword">event</span>) <span class="hljs-keyword">in</span><br>    <span class="hljs-keyword">switch</span> <span class="hljs-keyword">event</span> &#123;<br>    <span class="hljs-keyword">case</span> .next(let data):<br>        <span class="hljs-keyword">print</span>(data)<br>    <span class="hljs-keyword">case</span> .<span class="hljs-keyword">error</span>(let <span class="hljs-keyword">error</span>):<br>        <span class="hljs-keyword">print</span>(<span class="hljs-keyword">error</span>)<br>    <span class="hljs-keyword">case</span> .completed:<br>        <span class="hljs-keyword">print</span>(<span class="hljs-string">&quot;completed&quot;</span>)<br>    &#125;<br>&#125;<br> <br>let observable = Observable.of(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>)<br>observable.subscribe(observer)<br></code></pre></td></tr></table></figure><h3 id="2ã€é…åˆ-bindTo-æ–¹æ³•ä½¿ç”¨"><a href="#2ã€é…åˆ-bindTo-æ–¹æ³•ä½¿ç”¨" class="headerlink" title="2ã€é…åˆ bindTo æ–¹æ³•ä½¿ç”¨"></a>2ã€é…åˆ bindTo æ–¹æ³•ä½¿ç”¨</h3><p>ä¹Ÿå¯é…åˆ Observable çš„æ•°æ®ç»‘å®šæ–¹æ³•ï¼ˆbindToï¼‰ä½¿ç”¨ã€‚æ¯”å¦‚ä¸Šé¢çš„ç¬¬äºŒä¸ªæ ·ä¾‹æˆ‘å¯ä»¥æ”¹æˆå¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> UIKit<br><span class="hljs-keyword">import</span> RxSwift<br><span class="hljs-keyword">import</span> RxCocoa<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">UIViewController</span> </span>&#123;<br>     <br>    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> label: <span class="hljs-type">UILabel</span>!<br>     <br>    <span class="hljs-keyword">let</span> disposeBag <span class="hljs-operator">=</span> <span class="hljs-type">DisposeBag</span>()<br>     <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span>()</span> &#123;<br>         <br>        <span class="hljs-comment">//è§‚å¯Ÿè€…</span><br>        <span class="hljs-keyword">let</span> observer: <span class="hljs-type">AnyObserver</span>&lt;<span class="hljs-type">String</span>&gt; <span class="hljs-operator">=</span> <span class="hljs-type">AnyObserver</span> &#123; [<span class="hljs-keyword">weak</span> <span class="hljs-keyword">self</span>] (event) <span class="hljs-keyword">in</span><br>            <span class="hljs-keyword">switch</span> event &#123;<br>            <span class="hljs-keyword">case</span> .next(<span class="hljs-keyword">let</span> text):<br>                <span class="hljs-comment">//æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br>                <span class="hljs-keyword">self</span><span class="hljs-operator">?</span>.label.text <span class="hljs-operator">=</span> text<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-keyword">break</span><br>            &#125;<br>        &#125;<br>         <br>        <span class="hljs-comment">//Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br>        <span class="hljs-keyword">let</span> observable <span class="hljs-operator">=</span> <span class="hljs-type">Observable</span>&lt;<span class="hljs-type">Int</span>&gt;.interval(<span class="hljs-number">1</span>, scheduler: <span class="hljs-type">MainScheduler</span>.instance)<br>        observable<br>            .map &#123; <span class="hljs-string">&quot;å½“å‰ç´¢å¼•æ•°ï¼š<span class="hljs-subst">\(<span class="hljs-variable">$0</span> )</span>&quot;</span>&#125;<br>            .bind(to: observer)<br>            .disposed(by: disposeBag)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ä½¿ç”¨-Binder-åˆ›å»ºè§‚å¯Ÿè€…"><a href="#ä½¿ç”¨-Binder-åˆ›å»ºè§‚å¯Ÿè€…" class="headerlink" title="ä½¿ç”¨ Binder åˆ›å»ºè§‚å¯Ÿè€…"></a>ä½¿ç”¨ Binder åˆ›å»ºè§‚å¯Ÿè€…</h1><h3 id="1ã€åŸºæœ¬ä»‹ç»"><a href="#1ã€åŸºæœ¬ä»‹ç»" class="headerlink" title="1ã€åŸºæœ¬ä»‹ç»"></a>1ã€åŸºæœ¬ä»‹ç»</h3><p>ï¼ˆ1ï¼‰ç›¸è¾ƒäº AnyObserver çš„å¤§è€Œå…¨ï¼ŒBinder æ›´ä¸“æ³¨äºç‰¹å®šçš„åœºæ™¯ã€‚Binder ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹å¾ï¼š</p><ul><li>ä¸ä¼šå¤„ç†é”™è¯¯äº‹ä»¶</li><li>ç¡®ä¿ç»‘å®šéƒ½æ˜¯åœ¨ç»™å®š Scheduler ä¸Šæ‰§è¡Œï¼ˆé»˜è®¤ MainSchedulerï¼‰</li></ul><p>ï¼ˆ2ï¼‰ä¸€æ—¦äº§ç”Ÿé”™è¯¯äº‹ä»¶ï¼Œåœ¨è°ƒè¯•ç¯å¢ƒä¸‹å°†æ‰§è¡Œ fatalErrorï¼Œåœ¨å‘å¸ƒç¯å¢ƒä¸‹å°†æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚</p><h3 id="ä½¿ç”¨æ ·ä¾‹-1"><a href="#ä½¿ç”¨æ ·ä¾‹-1" class="headerlink" title="ä½¿ç”¨æ ·ä¾‹"></a>ä½¿ç”¨æ ·ä¾‹</h3><p>ï¼ˆ1ï¼‰åœ¨ä¸Šé¢åºåˆ—æ•°æ˜¾ç¤ºæ ·ä¾‹ä¸­ï¼Œlabel æ ‡ç­¾çš„æ–‡å­—æ˜¾ç¤ºå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ UI è§‚å¯Ÿè€…ã€‚å®ƒåœ¨å“åº”äº‹ä»¶æ—¶ï¼Œåªä¼šå¤„ç† next äº‹ä»¶ï¼Œè€Œä¸”æ›´æ–° UI çš„æ“ä½œéœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹æ›´å¥½çš„æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨ Binderã€‚<br><br>ï¼ˆ2ï¼‰ä¸Šé¢çš„æ ·ä¾‹æˆ‘ä»¬æ”¹ç”¨ Binder ä¼šç®€å•è®¸å¤šï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> UIKit<br><span class="hljs-keyword">import</span> RxSwift<br><span class="hljs-keyword">import</span> RxCocoa<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">UIViewController</span> </span>&#123;<br>     <br>    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> label: <span class="hljs-type">UILabel</span>!<br>     <br>    <span class="hljs-keyword">let</span> disposeBag <span class="hljs-operator">=</span> <span class="hljs-type">DisposeBag</span>()<br>     <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span>()</span> &#123;<br>                 <br>        <span class="hljs-comment">//è§‚å¯Ÿè€…</span><br>        <span class="hljs-keyword">let</span> observer: <span class="hljs-type">Binder</span>&lt;<span class="hljs-type">String</span>&gt; <span class="hljs-operator">=</span> <span class="hljs-type">Binder</span>(label) &#123; (view, text) <span class="hljs-keyword">in</span><br>            <span class="hljs-comment">//æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br>            view.text <span class="hljs-operator">=</span> text<br>        &#125;<br>         <br>        <span class="hljs-comment">//Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br>        <span class="hljs-keyword">let</span> observable <span class="hljs-operator">=</span> <span class="hljs-type">Observable</span>&lt;<span class="hljs-type">Int</span>&gt;.interval(<span class="hljs-number">1</span>, scheduler: <span class="hljs-type">MainScheduler</span>.instance)<br>        observable<br>            .map &#123; <span class="hljs-string">&quot;å½“å‰ç´¢å¼•æ•°ï¼š<span class="hljs-subst">\(<span class="hljs-variable">$0</span> )</span>&quot;</span>&#125;<br>            .bind(to: observer)<br>            .disposed(by: disposeBag)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é™„ï¼šBinder-åœ¨-RxCocoa-ä¸­çš„åº”ç”¨"><a href="#é™„ï¼šBinder-åœ¨-RxCocoa-ä¸­çš„åº”ç”¨" class="headerlink" title="é™„ï¼šBinder åœ¨ RxCocoa ä¸­çš„åº”ç”¨"></a>é™„ï¼šBinder åœ¨ RxCocoa ä¸­çš„åº”ç”¨</h3><p>ï¼ˆ1ï¼‰å…¶å® RxCocoa åœ¨å¯¹è®¸å¤š UI æ§ä»¶è¿›è¡Œæ‰©å±•æ—¶ï¼Œå°±åˆ©ç”¨ Binder å°†æ§ä»¶å±æ€§å˜æˆè§‚æŸ¥è€…ï¼Œæ¯”å¦‚ UIControl+Rx.swift ä¸­çš„ isEnabled å±æ€§ä¾¿æ˜¯ä¸€ä¸ª observer ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> RxSwift<br><span class="hljs-keyword">import</span> UIKit<br> <br><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">Reactive</span> <span class="hljs-title">where</span> <span class="hljs-title">Base</span>: <span class="hljs-title">UIControl</span> </span>&#123;<br>     <br>    <span class="hljs-comment">/// Bindable sink for `enabled` property.</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> isEnabled: <span class="hljs-type">Binder</span>&lt;<span class="hljs-type">Bool</span>&gt; &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-type">Binder</span>(<span class="hljs-keyword">self</span>.base) &#123; control, value <span class="hljs-keyword">in</span><br>            control.isEnabled <span class="hljs-operator">=</span> value<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰å› æ­¤æˆ‘ä»¬å¯ä»¥å°†åºåˆ—ç›´æ¥ç»‘å®šåˆ°å®ƒä¸Šé¢ã€‚æ¯”å¦‚ä¸‹é¢æ ·ä¾‹ï¼Œbutton ä¼šåœ¨å¯ç”¨ã€ä¸å¯ç”¨è¿™ä¸¤ç§çŠ¶æ€é—´äº¤æ›¿å˜æ¢ï¼ˆæ¯éš”ä¸€ç§’ï¼‰ã€‚</p><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-comment">//Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br><span class="hljs-keyword">let</span> observable = Observable&lt;Int&gt;.interval(<span class="hljs-number">1</span>, scheduler: MainScheduler.instance)<br>observable<br>    .<span class="hljs-built_in">map</span> &#123; $<span class="hljs-number">0</span> % <span class="hljs-number">2</span> == <span class="hljs-number">0</span> &#125;<br>    .bind(<span class="hljs-keyword">to</span>: button.<span class="hljs-literal">rx</span>.isEnabled)<br>    .disposed(<span class="hljs-keyword">by</span>: disposeBag)<br></code></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§"><a href="#è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§" class="headerlink" title="è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§"></a>è‡ªå®šä¹‰å¯ç»‘å®šå±æ€§</h1><p>æœ‰æ—¶æˆ‘ä»¬æƒ³è®© UI æ§ä»¶åˆ›å»ºå‡ºæ¥åé»˜è®¤å°±æœ‰ä¸€äº›è§‚å¯Ÿè€…ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½ä¸ºå®ƒä»¬å•ç‹¬å»åˆ›å»ºè§‚å¯Ÿè€…ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³è¦è®©æ‰€æœ‰çš„ UIlabel éƒ½æœ‰ä¸ª fontSize å¯ç»‘å®šå±æ€§ï¼Œå®ƒä¼šæ ¹æ®äº‹ä»¶å€¼è‡ªåŠ¨æ”¹å˜æ ‡ç­¾çš„å­—ä½“å¤§å°ã€‚</p><h3 id="æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹-UI-ç±»è¿›è¡Œæ‰©å±•"><a href="#æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹-UI-ç±»è¿›è¡Œæ‰©å±•" class="headerlink" title="æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹ UI ç±»è¿›è¡Œæ‰©å±•"></a>æ–¹å¼ä¸€ï¼šé€šè¿‡å¯¹ UI ç±»è¿›è¡Œæ‰©å±•</h3><p>è¿™é‡Œæˆ‘ä»¬é€šè¿‡å¯¹ UILabel è¿›è¡Œæ‰©å±•ï¼Œå¢åŠ äº†ä¸€ä¸ª fontSize å¯ç»‘å®šå±æ€§ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> UIKit<br><span class="hljs-keyword">import</span> RxSwift<br><span class="hljs-keyword">import</span> RxCocoa<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">UIViewController</span> </span>&#123;<br>     <br>    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> label: <span class="hljs-type">UILabel</span>!<br>     <br>    <span class="hljs-keyword">let</span> disposeBag <span class="hljs-operator">=</span> <span class="hljs-type">DisposeBag</span>()<br>     <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span>()</span> &#123;<br>         <br>        <span class="hljs-comment">//Observableåºåˆ—ï¼ˆæ¯éš”0.5ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br>        <span class="hljs-keyword">let</span> observable <span class="hljs-operator">=</span> <span class="hljs-type">Observable</span>&lt;<span class="hljs-type">Int</span>&gt;.interval(<span class="hljs-number">0.5</span>, scheduler: <span class="hljs-type">MainScheduler</span>.instance)<br>        observable<br>            .map &#123; <span class="hljs-type">CGFloat</span>(<span class="hljs-variable">$0</span>) &#125;<br>            .bind(to: label.fontSize) <span class="hljs-comment">//æ ¹æ®ç´¢å¼•æ•°ä¸æ–­å˜æ”¾å¤§å­—ä½“</span><br>            .disposed(by: disposeBag)<br>    &#125;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">UILabel</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> fontSize: <span class="hljs-type">Binder</span>&lt;<span class="hljs-type">CGFloat</span>&gt; &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-type">Binder</span>(<span class="hljs-keyword">self</span>) &#123; label, fontSize <span class="hljs-keyword">in</span><br>            label.font <span class="hljs-operator">=</span> <span class="hljs-type">UIFont</span>.systemFont(ofSize: fontSize)<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ–¹å¼äºŒï¼šé€šè¿‡å¯¹-Reactive-ç±»è¿›è¡Œæ‰©å±•"><a href="#æ–¹å¼äºŒï¼šé€šè¿‡å¯¹-Reactive-ç±»è¿›è¡Œæ‰©å±•" class="headerlink" title="æ–¹å¼äºŒï¼šé€šè¿‡å¯¹ Reactive ç±»è¿›è¡Œæ‰©å±•"></a>æ–¹å¼äºŒï¼šé€šè¿‡å¯¹ Reactive ç±»è¿›è¡Œæ‰©å±•</h3><p>æ—¢ç„¶ä½¿ç”¨äº† RxSwiftï¼Œé‚£ä¹ˆæ›´è§„èŒƒçš„å†™æ³•åº”è¯¥æ˜¯å¯¹ Reactive è¿›è¡Œæ‰©å±•ã€‚è¿™é‡ŒåŒæ ·æ˜¯ç»™ UILabel å¢åŠ äº†ä¸€ä¸ª fontSize å¯ç»‘å®šå±æ€§ã€‚<br><br>ï¼ˆæ³¨æ„ï¼šè¿™ç§æ–¹å¼ä¸‹ï¼Œæˆ‘ä»¬ç»‘å®šå±æ€§æ—¶è¦å†™æˆ label.rx.fontSizeï¼‰</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> UIKit<br><span class="hljs-keyword">import</span> RxSwift<br><span class="hljs-keyword">import</span> RxCocoa<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">UIViewController</span> </span>&#123;<br>     <br>    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> label: <span class="hljs-type">UILabel</span>!<br>     <br>    <span class="hljs-keyword">let</span> disposeBag <span class="hljs-operator">=</span> <span class="hljs-type">DisposeBag</span>()<br>     <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span>()</span> &#123;<br>         <br>        <span class="hljs-comment">//Observableåºåˆ—ï¼ˆæ¯éš”0.5ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br>        <span class="hljs-keyword">let</span> observable <span class="hljs-operator">=</span> <span class="hljs-type">Observable</span>&lt;<span class="hljs-type">Int</span>&gt;.interval(<span class="hljs-number">0.5</span>, scheduler: <span class="hljs-type">MainScheduler</span>.instance)<br>        observable<br>            .map &#123; <span class="hljs-type">CGFloat</span>(<span class="hljs-variable">$0</span>) &#125;<br>            .bind(to: label.rx.fontSize) <span class="hljs-comment">//æ ¹æ®ç´¢å¼•æ•°ä¸æ–­å˜æ”¾å¤§å­—ä½“</span><br>            .disposed(by: disposeBag)<br>    &#125;<br>&#125;<br> <br><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">Reactive</span> <span class="hljs-title">where</span> <span class="hljs-title">Base</span>: <span class="hljs-title">UILabel</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> fontSize: <span class="hljs-type">Binder</span>&lt;<span class="hljs-type">CGFloat</span>&gt; &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-type">Binder</span>(<span class="hljs-keyword">self</span>.base) &#123; label, fontSize <span class="hljs-keyword">in</span><br>            label.font <span class="hljs-operator">=</span> <span class="hljs-type">UIFont</span>.systemFont(ofSize: fontSize)<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="RxSwift-è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI-è§‚å¯Ÿè€…ï¼‰"><a href="#RxSwift-è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI-è§‚å¯Ÿè€…ï¼‰" class="headerlink" title="RxSwift è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI è§‚å¯Ÿè€…ï¼‰"></a>RxSwift è‡ªå¸¦çš„å¯ç»‘å®šå±æ€§ï¼ˆUI è§‚å¯Ÿè€…ï¼‰</h1><p>ï¼ˆ1ï¼‰å…¶å® RxSwift å·²ç»ä¸ºæˆ‘ä»¬æä¾›è®¸å¤šå¸¸ç”¨çš„å¯ç»‘å®šå±æ€§ã€‚æ¯”å¦‚ UILabel å°±æœ‰ text å’Œ attributedText è¿™ä¸¤ä¸ªå¯ç»‘å®šå±æ€§ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> RxSwift<br><span class="hljs-keyword">import</span> UIKit<br> <br><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">Reactive</span> <span class="hljs-title">where</span> <span class="hljs-title">Base</span>: <span class="hljs-title">UILabel</span> </span>&#123;<br>     <br>    <span class="hljs-comment">/// Bindable sink for `text` property.</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> text: <span class="hljs-type">Binder</span>&lt;<span class="hljs-type">String</span>?&gt; &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-type">Binder</span>(<span class="hljs-keyword">self</span>.base) &#123; label, text <span class="hljs-keyword">in</span><br>            label.text <span class="hljs-operator">=</span> text<br>        &#125;<br>    &#125;<br> <br>    <span class="hljs-comment">/// Bindable sink for `attributedText` property.</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> attributedText: <span class="hljs-type">Binder</span>&lt;<span class="hljs-type">NSAttributedString</span>?&gt; &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-type">Binder</span>(<span class="hljs-keyword">self</span>.base) &#123; label, text <span class="hljs-keyword">in</span><br>            label.attributedText <span class="hljs-operator">=</span> text<br>        &#125;<br>    &#125;<br>     <br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰é‚£ä¹ˆä¸Šæ–‡é‚£ä¸ªå®šæ—¶æ˜¾ç¤ºç´¢å¼•æ•°çš„æ ·ä¾‹ï¼Œæˆ‘ä»¬å…¶å®ä¸éœ€è¦è‡ªå®šä¹‰ UI è§‚å¯Ÿè€…ï¼Œç›´æ¥ä½¿ç”¨ RxSwift æä¾›çš„ç»‘å®šå±æ€§å³å¯ã€‚</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> UIKit<br><span class="hljs-keyword">import</span> RxSwift<br><span class="hljs-keyword">import</span> RxCocoa<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">UIViewController</span> </span>&#123;<br>     <br>    <span class="hljs-keyword">@IBOutlet</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> label: <span class="hljs-type">UILabel</span>!<br>     <br>    <span class="hljs-keyword">let</span> disposeBag <span class="hljs-operator">=</span> <span class="hljs-type">DisposeBag</span>()<br>     <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span>()</span> &#123;<br>         <br>        <span class="hljs-comment">//Observableåºåˆ—ï¼ˆæ¯éš”1ç§’é’Ÿå‘å‡ºä¸€ä¸ªç´¢å¼•æ•°ï¼‰</span><br>        <span class="hljs-keyword">let</span> observable <span class="hljs-operator">=</span> <span class="hljs-type">Observable</span>&lt;<span class="hljs-type">Int</span>&gt;.interval(<span class="hljs-number">1</span>, scheduler: <span class="hljs-type">MainScheduler</span>.instance)<br>        observable<br>            .map &#123; <span class="hljs-string">&quot;å½“å‰ç´¢å¼•æ•°ï¼š<span class="hljs-subst">\(<span class="hljs-variable">$0</span> )</span>&quot;</span>&#125;<br>            .bind(to: label.rx.text) <span class="hljs-comment">//æ”¶åˆ°å‘å‡ºçš„ç´¢å¼•æ•°åæ˜¾ç¤ºåˆ°labelä¸Š</span><br>            .disposed(by: disposeBag)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Subjects-ä»‹ç»"><a href="#Subjects-ä»‹ç»" class="headerlink" title="Subjects ä»‹ç»"></a>Subjects ä»‹ç»</h1><h3 id="Subjects-åŸºæœ¬ä»‹ç»"><a href="#Subjects-åŸºæœ¬ä»‹ç»" class="headerlink" title="Subjects åŸºæœ¬ä»‹ç»"></a>Subjects åŸºæœ¬ä»‹ç»</h3><p>ï¼ˆ1ï¼‰Subjects æ—¢æ˜¯è®¢é˜…è€…ï¼Œä¹Ÿæ˜¯ Observableï¼š</p><ul><li>è¯´å®ƒæ˜¯è®¢é˜…è€…ï¼Œæ˜¯å› ä¸ºå®ƒèƒ½å¤ŸåŠ¨æ€åœ°æ¥æ”¶æ–°çš„å€¼ã€‚</li><li>è¯´å®ƒåˆæ˜¯ä¸€ä¸ª Observableï¼Œæ˜¯å› ä¸ºå½“ Subjects æœ‰äº†æ–°çš„å€¼ä¹‹åï¼Œå°±ä¼šé€šè¿‡ Event å°†æ–°å€¼å‘å‡ºç»™ä»–çš„æ‰€æœ‰è®¢é˜…è€…ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä¸€å…±æœ‰å››ç§ Subjectsï¼Œåˆ†åˆ«ä¸ºï¼šPublishSubjectã€BehaviorSubjectã€ReplaySubjectã€Variableã€‚ä»–ä»¬ä¹‹é—´æ—¢æœ‰å„è‡ªçš„ç‰¹ç‚¹ï¼Œä¹Ÿæœ‰ç›¸åŒä¹‹å¤„ï¼š</p><ul><li>é¦–å…ˆä»–ä»¬éƒ½æ˜¯ Observableï¼Œä»–ä»¬çš„è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°ä»–ä»¬å‘å‡ºçš„æ–°çš„ Eventã€‚</li><li>ç›´åˆ° Subject å‘å‡º .complete æˆ–è€… .error çš„ Event åï¼Œè¯¥ Subject ä¾¿ç»ˆç»“äº†ï¼ŒåŒæ—¶å®ƒä¹Ÿå°±ä¸ä¼šå†å‘å‡º .next äº‹ä»¶ã€‚</li><li> å¯¹äºé‚£äº›åœ¨ Subject ç»ˆç»“åå†è®¢é˜…ä»–çš„è®¢é˜…è€…ï¼Œä¹Ÿèƒ½æ”¶åˆ° subject å‘å‡ºçš„ä¸€æ¡ .complete æˆ– .error çš„ eventï¼Œå‘Šè¯‰è¿™ä¸ªæ–°çš„è®¢é˜…è€…å®ƒå·²ç»ç»ˆç»“äº†ã€‚</li><li>ä»–ä»¬ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åªæ˜¯åœ¨äºï¼šå½“ä¸€ä¸ªæ–°çš„è®¢é˜…è€…åˆšè®¢é˜…å®ƒçš„æ—¶å€™ï¼Œèƒ½ä¸èƒ½æ”¶åˆ° Subject ä»¥å‰å‘å‡ºè¿‡çš„æ—§ Eventï¼Œå¦‚æœèƒ½çš„è¯åˆèƒ½æ”¶åˆ°å¤šå°‘ä¸ªã€‚</li></ul><p>ï¼ˆ3ï¼‰Subject å¸¸ç”¨çš„å‡ ä¸ªæ–¹æ³•ï¼š</p><ul><li>onNext(:)ï¼šæ˜¯ on(.next(:)) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .next äº‹ä»¶ã€‚</li><li>onError(:)ï¼šæ˜¯ on(.error(:)) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .error äº‹ä»¶ã€‚</li><li>onCompleted()ï¼šæ˜¯ on(.completed) çš„ç®€ä¾¿å†™æ³•ã€‚è¯¥æ–¹æ³•ç›¸å½“äº subject æ¥æ”¶åˆ°ä¸€ä¸ª .completed äº‹ä»¶ã€‚</li></ul><h3 id="PublishSubject"><a href="#PublishSubject" class="headerlink" title="PublishSubject"></a>PublishSubject</h3><p>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</p><ul><li>PublishSubject æ˜¯æœ€æ™®é€šçš„ Subjectï¼Œå®ƒä¸éœ€è¦åˆå§‹å€¼å°±èƒ½åˆ›å»ºã€‚</li><li>PublishSubject çš„è®¢é˜…è€…ä»ä»–ä»¬å¼€å§‹è®¢é˜…çš„æ—¶é—´ç‚¹èµ·ï¼Œå¯ä»¥æ”¶åˆ°è®¢é˜…å Subject å‘å‡ºçš„æ–° Eventï¼Œè€Œä¸ä¼šæ”¶åˆ°ä»–ä»¬åœ¨è®¢é˜…å‰å·²å‘å‡ºçš„ Eventã€‚<br>ï¼ˆ2ï¼‰æ—¶åºå›¾</li><li>æœ€ä¸Šé¢ä¸€æ¡æ˜¯ BehaviorSubjectã€‚</li><li>ä¸‹é¢ä¸¤æ¡åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªæ–°çš„è®¢é˜…ï¼Œå®ƒä»¬è®¢é˜…çš„æ—¶é—´ç‚¹ä¸åŒï¼Œå¯ä»¥å‘ç° BehaviorSubject çš„è®¢é˜…è€…ä¸€å¼€å§‹å°±èƒ½æ”¶åˆ° BehaviorSubjects ä¹‹å‰å‘å‡ºçš„ä¸€ä¸ª Eventã€‚<br><img src="https://upload-images.jianshu.io/upload_images/3334769-516513ae6b34d5b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ—¶åºå›¾"><br><br>ï¼ˆ3ï¼‰ä½¿ç”¨æ ·ä¾‹<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">let</span> disposeBag = <span class="hljs-constructor">DisposeBag()</span><br> <br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªBehaviorSubject</span><br><span class="hljs-keyword">let</span> subject = <span class="hljs-constructor">BehaviorSubject(<span class="hljs-params">value</span>: <span class="hljs-string">&quot;111&quot;</span>)</span><br> <br><span class="hljs-comment">//ç¬¬1æ¬¡è®¢é˜…subject</span><br>subject.subscribe &#123; event <span class="hljs-keyword">in</span><br>    print(<span class="hljs-string">&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;</span>, event)<br>&#125;.disposed(by: disposeBag)<br> <br><span class="hljs-comment">//å‘é€nextäº‹ä»¶</span><br>subject.on<span class="hljs-constructor">Next(<span class="hljs-string">&quot;222&quot;</span>)</span><br> <br><span class="hljs-comment">//å‘é€erroräº‹ä»¶</span><br>subject.on<span class="hljs-constructor">Error(NSError(<span class="hljs-params">domain</span>: <span class="hljs-string">&quot;local&quot;</span>, <span class="hljs-params">code</span>: 0, <span class="hljs-params">userInfo</span>: <span class="hljs-params">nil</span>)</span>)<br> <br><span class="hljs-comment">//ç¬¬2æ¬¡è®¢é˜…subject</span><br>subject.subscribe &#123; event <span class="hljs-keyword">in</span><br>    print(<span class="hljs-string">&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;</span>, event)<br>&#125;.disposed(by: disposeBag)<br></code></pre></td></tr></table></figure><h3 id="ReplaySubject"><a href="#ReplaySubject" class="headerlink" title="ReplaySubject"></a>ReplaySubject</h3>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</li><li>ReplaySubject åœ¨åˆ›å»ºæ—¶å€™éœ€è¦è®¾ç½®ä¸€ä¸ª bufferSizeï¼Œè¡¨ç¤ºå®ƒå¯¹äºå®ƒå‘é€è¿‡çš„ event çš„ç¼“å­˜ä¸ªæ•°ã€‚</li><li>æ¯”å¦‚ä¸€ä¸ª ReplaySubject çš„ bufferSize è®¾ç½®ä¸º 2ï¼Œå®ƒå‘å‡ºäº† 3 ä¸ª .next çš„ eventï¼Œé‚£ä¹ˆå®ƒä¼šå°†åä¸¤ä¸ªï¼ˆæœ€è¿‘çš„ä¸¤ä¸ªï¼‰event ç»™ç¼“å­˜èµ·æ¥ã€‚æ­¤æ—¶å¦‚æœæœ‰ä¸€ä¸ª subscriber è®¢é˜…äº†è¿™ä¸ª ReplaySubjectï¼Œé‚£ä¹ˆè¿™ä¸ª subscriber å°±ä¼šç«‹å³æ”¶åˆ°å‰é¢ç¼“å­˜çš„ä¸¤ä¸ª .next çš„ eventã€‚</li><li>å¦‚æœä¸€ä¸ª subscriber è®¢é˜…å·²ç»ç»“æŸçš„ ReplaySubjectï¼Œé™¤äº†ä¼šæ”¶åˆ°ç¼“å­˜çš„ .next çš„ event å¤–ï¼Œè¿˜ä¼šæ”¶åˆ°é‚£ä¸ªç»ˆç»“çš„ .error æˆ–è€… .complete çš„ eventã€‚</li></ul><p>ï¼ˆ2ï¼‰æ—¶åºå›¾</p><ul><li>æœ€ä¸Šé¢ä¸€æ¡æ˜¯ ReplaySubjectï¼ˆbufferSize è®¾ä¸ºä¸º 2ï¼‰ã€‚</li><li>ä¸‹é¢ä¸¤æ¡åˆ†åˆ«è¡¨ç¤ºä¸¤ä¸ªæ–°çš„è®¢é˜…ï¼Œå®ƒä»¬è®¢é˜…çš„æ—¶é—´ç‚¹ä¸åŒã€‚å¯ä»¥å‘ç° ReplaySubject çš„è®¢é˜…è€…ä¸€å¼€å§‹å°±èƒ½æ”¶åˆ° ReplaySubject ä¹‹å‰å‘å‡ºçš„ä¸¤ä¸ª Eventï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/3334769-4dec2ddcf714e9ac.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ—¶åºå›¾"><br><br>ï¼ˆ3ï¼‰ä½¿ç”¨æ ·ä¾‹<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-keyword">let</span> disposeBag = DisposeBag()<br> <br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªbufferSizeä¸º2çš„ReplaySubject</span><br><span class="hljs-keyword">let</span> subject = ReplaySubject&lt;String&gt;.create(bufferSize: <span class="hljs-number">2</span>)<br> <br><span class="hljs-comment">//è¿ç»­å‘é€3ä¸ªnextäº‹ä»¶</span><br>subject.onNext(<span class="hljs-string">&quot;111&quot;</span>)<br>subject.onNext(<span class="hljs-string">&quot;222&quot;</span>)<br>subject.onNext(<span class="hljs-string">&quot;333&quot;</span>)<br> <br><span class="hljs-comment">//ç¬¬1æ¬¡è®¢é˜…subject</span><br>subject.subscribe &#123; <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span></span><br><span class="hljs-function">    <span class="hljs-title">print</span>(<span class="hljs-params"><span class="hljs-string">&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;</span>, <span class="hljs-keyword">event</span></span>)</span><br><span class="hljs-function">&#125;.<span class="hljs-title">disposed</span>(<span class="hljs-params"><span class="hljs-keyword">by</span>: disposeBag</span>)</span><br><span class="hljs-function"> </span><br><span class="hljs-function"><span class="hljs-comment">//å†å‘é€1ä¸ªnextäº‹ä»¶</span></span><br><span class="hljs-function">subject.<span class="hljs-title">onNext</span>(<span class="hljs-params"><span class="hljs-string">&quot;444&quot;</span></span>)</span><br><span class="hljs-function"> </span><br><span class="hljs-function"><span class="hljs-comment">//ç¬¬2æ¬¡è®¢é˜…subject</span></span><br><span class="hljs-function">subject.subscribe</span> &#123; <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span></span><br><span class="hljs-function">    <span class="hljs-title">print</span>(<span class="hljs-params"><span class="hljs-string">&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;</span>, <span class="hljs-keyword">event</span></span>)</span><br><span class="hljs-function">&#125;.<span class="hljs-title">disposed</span>(<span class="hljs-params"><span class="hljs-keyword">by</span>: disposeBag</span>)</span><br><span class="hljs-function"> </span><br><span class="hljs-function"><span class="hljs-comment">//è®©subjectç»“æŸ</span></span><br><span class="hljs-function">subject.<span class="hljs-title">onCompleted</span>(<span class="hljs-params"></span>)</span><br><span class="hljs-function"> </span><br><span class="hljs-function"><span class="hljs-comment">//ç¬¬3æ¬¡è®¢é˜…subject</span></span><br><span class="hljs-function">subject.subscribe</span> &#123; <span class="hljs-function"><span class="hljs-keyword">event</span> <span class="hljs-keyword">in</span></span><br><span class="hljs-function">    <span class="hljs-title">print</span>(<span class="hljs-params"><span class="hljs-string">&quot;ç¬¬3æ¬¡è®¢é˜…ï¼š&quot;</span>, <span class="hljs-keyword">event</span></span>)</span><br><span class="hljs-function">&#125;.<span class="hljs-title">disposed</span>(<span class="hljs-params"><span class="hljs-keyword">by</span>: disposeBag</span>)</span><br></code></pre></td></tr></table></figure><h3 id="Variable"><a href="#Variable" class="headerlink" title="Variable"></a>Variable</h3>ï¼ˆæ³¨æ„ï¼šç”±äº Variable åœ¨ä¹‹åç‰ˆæœ¬ä¸­å°†è¢«åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨ Varible çš„åœ°æ–¹éƒ½æ”¹ç”¨ä¸‹é¢ä»‹ç»çš„ BehaviorRelay ä½œä¸ºæ›¿ä»£ã€‚ï¼‰<br><br>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</li><li>Variable å…¶å®å°±æ˜¯å¯¹ BehaviorSubject çš„å°è£…ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¿…é¡»è¦é€šè¿‡ä¸€ä¸ªé»˜è®¤çš„åˆå§‹å€¼è¿›è¡Œåˆ›å»ºã€‚</li><li>Variable å…·æœ‰ BehaviorSubject çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå‘å®ƒçš„è®¢é˜…è€…å‘å‡ºä¸Šä¸€ä¸ª event ä»¥åŠä¹‹åæ–°åˆ›å»ºçš„ eventã€‚</li><li>ä¸åŒçš„æ˜¯ï¼ŒVariable è¿˜æŠŠä¼šæŠŠå½“å‰å‘å‡ºçš„å€¼ä¿å­˜ä¸ºè‡ªå·±çš„çŠ¶æ€ã€‚åŒæ—¶å®ƒä¼šåœ¨é”€æ¯æ—¶è‡ªåŠ¨å‘é€ .complete çš„ eventï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½æ‰‹åŠ¨ç»™ Variables å‘é€ completed æˆ–è€… error äº‹ä»¶æ¥ç»“æŸå®ƒã€‚</li><li>ç®€å•åœ°è¯´å°±æ˜¯ Variable æœ‰ä¸€ä¸ª value å±æ€§ï¼Œæˆ‘ä»¬æ”¹å˜è¿™ä¸ª value å±æ€§çš„å€¼å°±ç›¸å½“äºè°ƒç”¨ä¸€èˆ¬ Subjects çš„ onNext() æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæœ€æ–°çš„ onNext() çš„å€¼å°±è¢«ä¿å­˜åœ¨ value å±æ€§é‡Œäº†ï¼Œç›´åˆ°æˆ‘ä»¬å†æ¬¡ä¿®æ”¹å®ƒã€‚<blockquote><p>æ³¨æ„ï¼š<br><br>Variables æœ¬èº«æ²¡æœ‰ subscribe() æ–¹æ³•ï¼Œä½†æ˜¯æ‰€æœ‰ Subjects éƒ½æœ‰ä¸€ä¸ª asObservable() æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿”å›è¿™ä¸ª Variable çš„ Observable ç±»å‹ï¼Œæ‹¿åˆ°è¿™ä¸ª Observable ç±»å‹æˆ‘ä»¬å°±èƒ½è®¢é˜…å®ƒäº†ã€‚</p></blockquote></li></ul><p>ï¼ˆ2ï¼‰ä½¿ç”¨æ ·ä¾‹</p><figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs ceylon"><span class="hljs-keyword">import</span> UIKit<br><span class="hljs-keyword">import</span> RxSwift<br><span class="hljs-keyword">import</span> RxCocoa<br> <br><span class="hljs-keyword">class</span> ViewController: UIViewController &#123;<br>     <br>    override func viewDidLoad() &#123;<br>        <span class="hljs-keyword">super</span>.viewDidLoad()<br> <br>        <span class="hljs-keyword">let</span> disposeBag = DisposeBag()<br>         <br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸º111çš„Variable</span><br>        <span class="hljs-keyword">let</span> <span class="hljs-keyword">variable</span> = Variable(<span class="hljs-string">&quot;111&quot;</span>)<br>         <br>        <span class="hljs-comment">//ä¿®æ”¹valueå€¼</span><br>        <span class="hljs-keyword">variable</span>.<span class="hljs-keyword">value</span> = <span class="hljs-string">&quot;222&quot;</span><br>         <br>        <span class="hljs-comment">//ç¬¬1æ¬¡è®¢é˜…</span><br>        <span class="hljs-keyword">variable</span>.asObservable().subscribe &#123;<br>            print(<span class="hljs-string">&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;</span>, <span class="hljs-number">$0</span>)<br>        &#125;.disposed(<span class="hljs-meta">by</span>: disposeBag)<br>         <br>        <span class="hljs-comment">//ä¿®æ”¹valueå€¼</span><br>        <span class="hljs-keyword">variable</span>.<span class="hljs-keyword">value</span> = <span class="hljs-string">&quot;333&quot;</span><br>         <br>        <span class="hljs-comment">//ç¬¬2æ¬¡è®¢é˜…</span><br>        <span class="hljs-keyword">variable</span>.asObservable().subscribe &#123;<br>            print(<span class="hljs-string">&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;</span>, <span class="hljs-number">$0</span>)<br>        &#125;.disposed(<span class="hljs-meta">by</span>: disposeBag)<br>         <br>        <span class="hljs-comment">//ä¿®æ”¹valueå€¼</span><br>        <span class="hljs-keyword">variable</span>.<span class="hljs-keyword">value</span> = <span class="hljs-string">&quot;444&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="BehaviorRelay"><a href="#BehaviorRelay" class="headerlink" title="BehaviorRelay"></a>BehaviorRelay</h3><p>ï¼ˆ1ï¼‰åŸºæœ¬ä»‹ç»</p><ul><li>BehaviorRelay æ˜¯ä½œä¸º Variable çš„æ›¿ä»£è€…å‡ºç°çš„ã€‚å®ƒçš„æœ¬è´¨å…¶å®ä¹Ÿæ˜¯å¯¹ BehaviorSubject çš„å°è£…ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¿…é¡»è¦é€šè¿‡ä¸€ä¸ªé»˜è®¤çš„åˆå§‹å€¼è¿›è¡Œåˆ›å»ºã€‚</li><li>BehaviorRelay å…·æœ‰ BehaviorSubject çš„åŠŸèƒ½ï¼Œèƒ½å¤Ÿå‘å®ƒçš„è®¢é˜…è€…å‘å‡ºä¸Šä¸€ä¸ª event ä»¥åŠä¹‹åæ–°åˆ›å»ºçš„ eventã€‚</li><li>ä¸ BehaviorSubject ä¸åŒçš„æ˜¯ï¼Œä¸éœ€è¦ä¹Ÿä¸èƒ½æ‰‹åŠ¨ç»™ BehaviorReply å‘é€ completed æˆ–è€… error äº‹ä»¶æ¥ç»“æŸå®ƒï¼ˆBehaviorRelay ä¼šåœ¨é”€æ¯æ—¶ä¹Ÿä¸ä¼šè‡ªåŠ¨å‘é€ .complete çš„ eventï¼‰ã€‚</li><li>BehaviorRelay æœ‰ä¸€ä¸ª value å±æ€§ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªå±æ€§å¯ä»¥è·å–æœ€æ–°å€¼ã€‚è€Œé€šè¿‡å®ƒçš„ accept() æ–¹æ³•å¯ä»¥å¯¹å€¼è¿›è¡Œä¿®æ”¹ã€‚</li></ul><p>ï¼ˆ2ï¼‰ä¸Šé¢çš„ Variable æ ·ä¾‹æˆ‘ä»¬å¯ä»¥æ”¹ç”¨æˆ BehaviorRelayï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> UIKit<br><span class="hljs-keyword">import</span> RxSwift<br><span class="hljs-keyword">import</span> RxCocoa<br> <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ViewController</span>: <span class="hljs-title">UIViewController</span> </span>&#123;<br>     <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewDidLoad</span>()</span> &#123;<br>        <span class="hljs-keyword">super</span>.viewDidLoad()<br>         <br>        <span class="hljs-keyword">let</span> disposeBag <span class="hljs-operator">=</span> <span class="hljs-type">DisposeBag</span>()<br>         <br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸º111çš„BehaviorRelay</span><br>        <span class="hljs-keyword">let</span> subject <span class="hljs-operator">=</span> <span class="hljs-type">BehaviorRelay</span>&lt;<span class="hljs-type">String</span>&gt;(value: <span class="hljs-string">&quot;111&quot;</span>)<br>         <br>        <span class="hljs-comment">//ä¿®æ”¹valueå€¼</span><br>        subject.accept(<span class="hljs-string">&quot;222&quot;</span>)<br>         <br>        <span class="hljs-comment">//ç¬¬1æ¬¡è®¢é˜…</span><br>        subject.asObservable().subscribe &#123;<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;</span>, <span class="hljs-variable">$0</span>)<br>            &#125;.disposed(by: disposeBag)<br>         <br>        <span class="hljs-comment">//ä¿®æ”¹valueå€¼</span><br>        subject.accept(<span class="hljs-string">&quot;333&quot;</span>)<br>         <br>        <span class="hljs-comment">//ç¬¬2æ¬¡è®¢é˜…</span><br>        subject.asObservable().subscribe &#123;<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;</span>, <span class="hljs-variable">$0</span>)<br>            &#125;.disposed(by: disposeBag)<br>         <br>        <span class="hljs-comment">//ä¿®æ”¹valueå€¼</span><br>        subject.accept(<span class="hljs-string">&quot;444&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰å¦‚æœæƒ³å°†æ–°å€¼åˆå¹¶åˆ°åŸå€¼ä¸Šï¼Œå¯ä»¥é€šè¿‡ accept() æ–¹æ³•ä¸ value å±æ€§é…åˆæ¥å®ç°ã€‚ï¼ˆè¿™ä¸ªå¸¸ç”¨åœ¨è¡¨æ ¼ä¸Šæ‹‰åŠ è½½åŠŸèƒ½ä¸Šï¼ŒBehaviorRelay ç”¨æ¥ä¿å­˜æ‰€æœ‰åŠ è½½åˆ°çš„æ•°æ®ï¼‰</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs stylus">import UIKit<br>import RxSwift<br>import RxCocoa<br> <br>class ViewController: UIViewController &#123;<br>     <br>    override func viewDidLoad() &#123;<br>        super<span class="hljs-selector-class">.viewDidLoad</span>()<br>         <br>        let disposeBag = DisposeBag()<br>         <br>        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªåˆå§‹å€¼ä¸ºåŒ…å«ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„çš„BehaviorRelay</span><br>        let subject = BehaviorRelay&lt;<span class="hljs-selector-attr">[String]</span>&gt;(value: <span class="hljs-selector-attr">[<span class="hljs-string">&quot;1&quot;</span>]</span>)<br>         <br>        <span class="hljs-comment">//ä¿®æ”¹valueå€¼</span><br>        subject<span class="hljs-selector-class">.accept</span>(subject<span class="hljs-selector-class">.value</span> + <span class="hljs-selector-attr">[<span class="hljs-string">&quot;2&quot;</span>, <span class="hljs-string">&quot;3&quot;</span>]</span>)<br>         <br>        <span class="hljs-comment">//ç¬¬1æ¬¡è®¢é˜…</span><br>        subject<span class="hljs-selector-class">.asObservable</span>()<span class="hljs-selector-class">.subscribe</span> &#123;<br>            print(<span class="hljs-string">&quot;ç¬¬1æ¬¡è®¢é˜…ï¼š&quot;</span>, $<span class="hljs-number">0</span>)<br>            &#125;<span class="hljs-selector-class">.disposed</span>(by: disposeBag)<br>         <br>        <span class="hljs-comment">//ä¿®æ”¹valueå€¼</span><br>        subject<span class="hljs-selector-class">.accept</span>(subject<span class="hljs-selector-class">.value</span> + <span class="hljs-selector-attr">[<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-string">&quot;5&quot;</span>]</span>)<br>         <br>        <span class="hljs-comment">//ç¬¬2æ¬¡è®¢é˜…</span><br>        subject<span class="hljs-selector-class">.asObservable</span>()<span class="hljs-selector-class">.subscribe</span> &#123;<br>            print(<span class="hljs-string">&quot;ç¬¬2æ¬¡è®¢é˜…ï¼š&quot;</span>, $<span class="hljs-number">0</span>)<br>            &#125;<span class="hljs-selector-class">.disposed</span>(by: disposeBag)<br>         <br>        <span class="hljs-comment">//ä¿®æ”¹valueå€¼</span><br>        subject<span class="hljs-selector-class">.accept</span>(subject<span class="hljs-selector-class">.value</span> + <span class="hljs-selector-attr">[<span class="hljs-string">&quot;6&quot;</span>, <span class="hljs-string">&quot;7&quot;</span>]</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Swift</category>
      
      <category>iOS</category>
      
      <category>SDK</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSç¬¬ä¸‰æ–¹åº“-FMDB-æ¨¡å‹è¿›è¡Œå­˜å–(Model)</title>
    <link href="/2020/02/01/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-FMDB-%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%8F%96(Model)/"/>
    <url>/2020/02/01/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-FMDB-%E6%A8%A1%E5%9E%8B%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%8F%96(Model)/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-db9208d961eb67c2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼å›¾"></p><p>å†™è¿™ä¸ªBlogçš„ç›®çš„æ˜¯ä¸ºäº†è®°å½•çš„å­¦ä¹ ç»å†ï¼Œä»£ç å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œå¸Œæœ›è¯»è€…ç†è§£ã€‚<br>æ—¥å¸¸å¯¹æ•°æ®åº“çš„æ“ä½œï¼Œéœ€è¦è®¾è®¡å­—æ®µï¼Œæ„Ÿè§‰å¤ªç¹çäº†ï¼Œæƒ³æ‰¾ä¸ªç®€åŒ–çš„æ–¹æ³•ï¼Œå°±æƒ³é€šè¿‡è¿™æ ·è¿›è¡Œå®ç°ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸€ç§æ€è€ƒæ–¹å¼ã€‚å®é™…å®ç°è¿˜æ˜¯çœ‹éœ€æ±‚ã€‚å…·ä½“çœ‹ä»£ç ï¼š<br>1ã€å¯¼å…¥FMDB</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs elm"><span class="hljs-keyword">import</span> FMDB<br></code></pre></td></tr></table></figure><p>2ã€ä½¿ç”¨å•åˆ©æ¨¡å¼å’Œå¿…è¦å±æ€§</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs livescript"><span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> defaultManger = WDDataBaseManager()<br>typealias <span class="hljs-function"><span class="hljs-title">successBlock</span> = <span class="hljs-params">()</span> -&gt;</span>Void<br>typealias <span class="hljs-function"><span class="hljs-title">failBlock</span> = <span class="hljs-params">()</span> -&gt;</span>Void<br>private <span class="hljs-keyword">var</span> tableName:<span class="hljs-built_in">String</span>?<br></code></pre></td></tr></table></figure><p>3ã€æ‡’åŠ è½½åˆ›å»ºæ•°æ®åº“ï¼ˆåç§°æˆ‘éšä¾¿å–å¾—ï¼‰</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">lazy</span> var fmdb:FMDatabase = &#123;<br>        <span class="hljs-keyword">let</span> path = <span class="hljs-constructor">NSHomeDirectory()</span>.appending(<span class="hljs-string">&quot;/Documents/testDB.db&quot;</span>)<br>        <span class="hljs-keyword">let</span> db = <span class="hljs-constructor">FMDatabase(<span class="hljs-params">path</span>: <span class="hljs-params">path</span>)</span><br>        return db<br>    &#125;<span class="hljs-literal">()</span><br></code></pre></td></tr></table></figure><p>4ã€åˆ›å»ºè¡¨</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">creatTable</span>(<span class="hljs-params">tableName</span>:<span class="hljs-type">String</span>)</span> -&gt; <span class="hljs-type">Void</span> &#123;<br>        fmdb.open()<br>        <span class="hljs-keyword">self</span>.tableName <span class="hljs-operator">=</span> tableName<br>        <span class="hljs-keyword">let</span> creatSql <span class="hljs-operator">=</span> <span class="hljs-string">&quot;create table if not exists <span class="hljs-subst">\(tableName)</span> (id integer primary key autoincrement,model BLOB)&quot;</span><br>        <span class="hljs-keyword">let</span> result <span class="hljs-operator">=</span> fmdb.executeUpdate(creatSql, withArgumentsIn:[])<br>        <span class="hljs-keyword">if</span> result&#123;<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åˆ›å»ºè¡¨æˆåŠŸ&quot;</span>)<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>5ã€åˆ é™¤è¡¨</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs livescript">func dropTable<span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span> Void &#123;<br>       <span class="hljs-keyword">let</span> sql = <span class="hljs-string">&quot;drop table if exists &quot;</span> + tableName!<br>       <span class="hljs-keyword">let</span> result = fmdb.executeUpdate(sql, withArgumentsIn:[])<br>       <span class="hljs-keyword">if</span> result&#123;<br>           <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åˆ é™¤è¡¨æˆåŠŸ&quot;</span>)<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure><p>6ã€æ’å…¥æ•°æ®</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">func insert(model:NSObject, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123;<br>        <span class="hljs-keyword">let</span> modelData = <span class="hljs-keyword">try</span>! <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NSKeyedArchiver</span>.</span></span>archived<span class="hljs-constructor">Data(<span class="hljs-params">withRootObject</span>: <span class="hljs-params">model</span>, <span class="hljs-params">requiringSecureCoding</span>: <span class="hljs-params">false</span>)</span><br>        <span class="hljs-keyword">let</span> insertSql = <span class="hljs-string">&quot;insert into &quot;</span> + tableName! + <span class="hljs-string">&quot; (model) values(?)&quot;</span><br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-keyword">try</span> fmdb.execute<span class="hljs-constructor">Update(<span class="hljs-params">insertSql</span>, <span class="hljs-params">values</span>: [<span class="hljs-params">modelData</span>])</span><br>            success<span class="hljs-constructor">Block()</span><br>        &#125; catch &#123;<br>            print(fmdb.last<span class="hljs-constructor">Error()</span>)<br>            fail<span class="hljs-constructor">Block()</span><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>7ã€æ›´æ–°è¡¨</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">func update(model:NSObject,uid:Int32, successBlock: successBlock, failBlock: failBlock) -&gt; Void &#123;<br>        <span class="hljs-keyword">let</span> modelData = <span class="hljs-keyword">try</span>! <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">NSKeyedArchiver</span>.</span></span>archived<span class="hljs-constructor">Data(<span class="hljs-params">withRootObject</span>: <span class="hljs-params">model</span>, <span class="hljs-params">requiringSecureCoding</span>: <span class="hljs-params">false</span>)</span><br>        <span class="hljs-keyword">let</span> updateSql = <span class="hljs-string">&quot;update &quot;</span> + tableName! + <span class="hljs-string">&quot; set model = ? where id = ?&quot;</span><br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-keyword">try</span> fmdb.execute<span class="hljs-constructor">Update(<span class="hljs-params">updateSql</span>, <span class="hljs-params">values</span>: [<span class="hljs-params">modelData</span>, <span class="hljs-params">uid</span>])</span><br>            success<span class="hljs-constructor">Block()</span><br>        &#125; catch &#123;<br>            print(fmdb.last<span class="hljs-constructor">Error()</span>)<br>            fail<span class="hljs-constructor">Block()</span><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>8ã€æŸ¥è¯¢æ•°æ®ï¼ˆè¿™æ˜¯æŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼Œå…¶ä»–æŒ‰éœ€æ±‚è®¾è®¡ï¼‰</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">selectAll</span>()</span> -&gt; [<span class="hljs-type">NSObject</span>] &#123;<br>        <span class="hljs-keyword">var</span> tmpArr <span class="hljs-operator">=</span> [<span class="hljs-type">NSObject</span>]()<br>        <span class="hljs-keyword">let</span> selectSql <span class="hljs-operator">=</span> <span class="hljs-string">&quot;select * from &quot;</span> <span class="hljs-operator">+</span> tableName<span class="hljs-operator">!</span><br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-keyword">let</span> rs <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> fmdb.executeQuery(selectSql, values:<span class="hljs-literal">nil</span>)<br>            <span class="hljs-keyword">while</span> rs.next() &#123;<br>                <span class="hljs-keyword">var</span> model <span class="hljs-operator">=</span> <span class="hljs-type">NSObject</span>()<br>                <span class="hljs-keyword">let</span> modelData  <span class="hljs-operator">=</span> rs.data(forColumn:<span class="hljs-string">&quot;model&quot;</span>)<br>                <span class="hljs-keyword">let</span> id <span class="hljs-operator">=</span> rs.int(forColumn: <span class="hljs-string">&quot;id&quot;</span>)<br>                model <span class="hljs-operator">=</span> <span class="hljs-keyword">try!</span> <span class="hljs-type">NSKeyedUnarchiver</span>.unarchiveTopLevelObjectWithData(modelData<span class="hljs-operator">!</span>) <span class="hljs-keyword">as!</span> <span class="hljs-type">NSObject</span><br>                model.wd_fmdb_id <span class="hljs-operator">=</span> id<br>                tmpArr.append(model)<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> &#123;<br>            <span class="hljs-built_in">print</span>(fmdb.lastError())<br>        &#125;<br>        <span class="hljs-keyword">return</span> tmpArr<br>    &#125;<br></code></pre></td></tr></table></figure><p>9ã€åˆ é™¤æ•°æ®ï¼ˆè¿™æ˜¯æ ¹æ®Idåˆ é™¤çš„ï¼‰</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">delete</span>(<span class="hljs-params">uid</span>:<span class="hljs-type">Int32</span>, <span class="hljs-params">successBlock</span>: successBlock, <span class="hljs-params">failBlock</span>: failBlock)</span> -&gt; <span class="hljs-type">Void</span> &#123;<br>        <span class="hljs-keyword">let</span> deleteSql <span class="hljs-operator">=</span> <span class="hljs-string">&quot;delete from &quot;</span> <span class="hljs-operator">+</span> tableName<span class="hljs-operator">!</span> <span class="hljs-operator">+</span> <span class="hljs-string">&quot; where id = ?&quot;</span><br>        <span class="hljs-keyword">do</span> &#123;<br>            <span class="hljs-keyword">try</span> fmdb.executeUpdate(deleteSql, values: [uid])<br>            successBlock()<br>        &#125; <span class="hljs-keyword">catch</span> &#123;<br>            <span class="hljs-built_in">print</span>(fmdb.lastError())<br>            failBlock()<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>10ã€æ–°å¢åˆ†ç±»æ·»åŠ é»˜è®¤Id</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">private</span> var wd_id_key: String = <span class="hljs-string">&quot;key&quot;</span><br><br>extension NSObject &#123;<br>    <span class="hljs-keyword">open</span> var wd_fmdb_id:Int32? &#123;<br>        get &#123;<br>            return (objc<span class="hljs-constructor">_getAssociatedObject(<span class="hljs-params">self</span>, &amp;<span class="hljs-params">wd_id_key</span>)</span> <span class="hljs-keyword">as</span>? Int32)<br>        &#125; set(newValue) &#123;<br>            objc<span class="hljs-constructor">_setAssociatedObject(<span class="hljs-params">self</span>, &amp;<span class="hljs-params">wd_id_key</span>, <span class="hljs-params">newValue</span>, <span class="hljs-params">objc_AssociationPolicy</span>.OBJC_ASSOCIATION_ASSIGN)</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>11ã€ä½¿ç”¨æ–¹æ³•</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">//1. åœ¨Appdelegateä¸­æ‰“å¼€æ•°æ®åº“</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">application</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>, <span class="hljs-params">didFinishLaunchingWithOptions</span> <span class="hljs-params">launchOptions</span>: [<span class="hljs-type">UIApplication</span>.<span class="hljs-params">LaunchOptionsKey</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span>)</span> -&gt; <span class="hljs-type">Bool</span> &#123;<br>        <span class="hljs-type">DataBaseManager</span>.defaultManger.creatTable()<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span><br> &#125;<br><span class="hljs-comment">//2ã€æ·»åŠ æ•°æ®</span><br><span class="hljs-type">WDDataBaseManager</span>.defaultManger.insert(model: model, successBlock: &#123;<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æˆåŠŸ&quot;</span>)<br>            &#125;, failBlock: &#123;<br>                 <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¤±è´¥&quot;</span>)<br>            &#125;)<br><span class="hljs-comment">//3ã€ä¿®æ”¹æ•°æ®</span><br><span class="hljs-type">WDDataBaseManager</span>.defaultManger.update(model: model, uid: <span class="hljs-keyword">self</span>.model<span class="hljs-operator">!</span>.wd_fmdb_id<span class="hljs-operator">!</span>, successBlock: &#123;<br>               <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æˆåŠŸ&quot;</span>)<br>            &#125;, failBlock: &#123;<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¤±è´¥&quot;</span>)<br>            &#125;)<br><span class="hljs-comment">//4ã€åˆ é™¤æ•°æ®</span><br><span class="hljs-type">WDDataBaseManager</span>.defaultManger.delete(uid: model.wd_fmdb_id<span class="hljs-operator">!</span>, successBlock: &#123;<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æˆåŠŸ&quot;</span>)<br>            &#125;, failBlock: &#123;<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å¤±è´¥&quot;</span>)<br>            &#125;)<br><span class="hljs-comment">// 5ã€æŸ¥è¯¢æ•°æ®</span><br><span class="hljs-type">WDDataBaseManager</span>.defaultManger.selectAll()<br></code></pre></td></tr></table></figure><ul><li>éµå¾ªNSCoding é‡å†™ä¸‰ä¸ªæ–¹æ³•<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> UIKit<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Model</span>: <span class="hljs-title">NSObject</span> , <span class="hljs-title">NSCoding</span></span>&#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> name:<span class="hljs-type">String</span>?<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> phone:<span class="hljs-type">String</span>?<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> addres:<span class="hljs-type">String</span>?<br>    <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">init</span>()</span> &#123;<br>        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>()<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">encode</span>(<span class="hljs-params">with</span> <span class="hljs-params">aCoder</span>: <span class="hljs-type">NSCoder</span>)</span> &#123;<br>        aCoder.encode(name, forKey: <span class="hljs-string">&quot;name&quot;</span>)<br>        aCoder.encode(phone, forKey: <span class="hljs-string">&quot;phone&quot;</span>)<br>        aCoder.encode(addres, forKey: <span class="hljs-string">&quot;addres&quot;</span>)<br>    &#125;<br>    <br>    <span class="hljs-keyword">required</span> <span class="hljs-function"><span class="hljs-keyword">init?</span>(<span class="hljs-params">coder</span> <span class="hljs-params">aDecoder</span>: <span class="hljs-type">NSCoder</span>)</span> &#123;<br>        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>()<br>        <span class="hljs-keyword">self</span>.name <span class="hljs-operator">=</span> aDecoder.decodeObject(forKey: <span class="hljs-string">&quot;name&quot;</span>) <span class="hljs-keyword">as?</span> <span class="hljs-type">String</span><br>        <span class="hljs-keyword">self</span>.addres <span class="hljs-operator">=</span> aDecoder.decodeObject(forKey: <span class="hljs-string">&quot;addres&quot;</span>) <span class="hljs-keyword">as?</span> <span class="hljs-type">String</span><br>        <span class="hljs-keyword">self</span>.phone <span class="hljs-operator">=</span> aDecoder.decodeObject(forKey: <span class="hljs-string">&quot;phone&quot;</span>) <span class="hljs-keyword">as?</span> <span class="hljs-type">String</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>12ã€æ•ˆæœå›¾</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/3334769-309b5904357f7e30.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾"></p><p>13ã€Demoåœ°å€:<a href="https://github.com/wudan-ios/FMDB-Model.git">https://github.com/wudan-ios/FMDB-Model.git</a></p><hr><p>è¡¥å……Objective-Cç‰ˆæœ¬<br>1ã€æ¥å£æ–‡ä»¶</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">NSObject</span> (<span class="hljs-title">addId</span>)</span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>) <span class="hljs-built_in">NSInteger</span> wd_fmdb_id;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">void</span>(^successBlock)(<span class="hljs-keyword">void</span>);<br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">void</span>(^failBlock)(<span class="hljs-keyword">void</span>);<br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDDataBaseManager</span> : <span class="hljs-title">NSObject</span></span><br><br>+ (<span class="hljs-keyword">instancetype</span>)manager;<br><span class="hljs-comment">/** åˆ›å»ºè¡¨ */</span><br>- (<span class="hljs-keyword">void</span>)createTableWithName:(<span class="hljs-built_in">NSString</span> *)name;<br><span class="hljs-comment">/** åˆ é™¤è¡¨ */</span><br>- (<span class="hljs-keyword">void</span>)dropTable;<br><span class="hljs-comment">/** æ·»åŠ æ•°æ® */</span><br>- (<span class="hljs-keyword">void</span>)insertDataWithModel:(<span class="hljs-built_in">NSObject</span> *)model successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;<br><span class="hljs-comment">/** æ›´æ–°æ•°æ® */</span><br>- (<span class="hljs-keyword">void</span>)updateDataWithModel:(<span class="hljs-built_in">NSObject</span> *)model uid:(<span class="hljs-built_in">NSInteger</span>)aUid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;<br><span class="hljs-comment">/** åˆ é™¤æ•°æ® */</span><br>- (<span class="hljs-keyword">void</span>)deleteDataWithUid:(<span class="hljs-built_in">NSInteger</span>)uid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock;<br><span class="hljs-comment">/** æŸ¥è¯¢å…¨éƒ¨æ•°æ® */</span><br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSObject</span> *&gt; *)queryAllData;<br><br><span class="hljs-keyword">@end</span><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br></code></pre></td></tr></table></figure><p>2ã€å®ç°æ–‡ä»¶</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;WDDataBaseManager.h&quot;</span></span><br><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;FMDB.h&gt;</span></span><br><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;objc/runtime.h&gt;</span></span><br><br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> *wd_id_key = <span class="hljs-string">&quot;key&quot;</span>;<br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">NSObject</span> (<span class="hljs-title">addId</span>)</span><br><br>- (<span class="hljs-built_in">NSInteger</span>)wd_fmdb_id &#123;<br>    <span class="hljs-built_in">NSNumber</span> *numberValue = objc_getAssociatedObject(<span class="hljs-keyword">self</span>, wd_id_key);<br>    <span class="hljs-keyword">return</span> numberValue.integerValue;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)setWd_fmdb_id:(<span class="hljs-built_in">NSInteger</span>)wd_fmdb_id &#123;<br>    objc_setAssociatedObject(<span class="hljs-keyword">self</span>, wd_id_key, @(wd_fmdb_id), OBJC_ASSOCIATION_ASSIGN);<br>&#125;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDDataBaseManager</span> ()</span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) FMDatabase *fmdb;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) <span class="hljs-built_in">NSString</span> *tableName;<br><br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">WDDataBaseManager</span></span><br><br>+ (<span class="hljs-keyword">instancetype</span>)manager &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_once_t</span> onceToken;<br>    <span class="hljs-keyword">static</span> WDDataBaseManager *manager = <span class="hljs-literal">nil</span>;<br>    <span class="hljs-built_in">dispatch_once</span>(&amp;onceToken, ^&#123;<br>        manager = [[WDDataBaseManager alloc] init];<br>    &#125;);<br>    <span class="hljs-keyword">return</span> manager;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)createTableWithName:(<span class="hljs-built_in">NSString</span> *)name &#123;<br>    [<span class="hljs-keyword">self</span>.fmdb open];<br>    <span class="hljs-keyword">self</span>.tableName = name;<br>    <span class="hljs-built_in">NSString</span> *sql = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;create table if not exists %@ (id integer primary key autoincrement,model BLOB)&quot;</span>, name];<br>    <span class="hljs-built_in">BOOL</span> result = [<span class="hljs-keyword">self</span>.fmdb executeUpdate:sql];<br>    <span class="hljs-keyword">if</span> (result) &#123;<br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;è¡¨åˆ›å»ºæˆåŠŸ&quot;</span>);<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)dropTable &#123;<br>    <span class="hljs-built_in">NSString</span> *sql = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;drop table if exists %@&quot;</span>, <span class="hljs-keyword">self</span>.tableName];<br>    <span class="hljs-built_in">BOOL</span> result = [<span class="hljs-keyword">self</span>.fmdb executeUpdate:sql];<br>    <span class="hljs-keyword">if</span> (result) &#123;<br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;è¡¨åˆ é™¤æˆåŠŸ&quot;</span>);<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)insertDataWithModel:(<span class="hljs-built_in">NSObject</span> *)model successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123;<br>    <span class="hljs-built_in">NSData</span> *modelData = [<span class="hljs-built_in">NSKeyedArchiver</span> archivedDataWithRootObject:model];<br>    <span class="hljs-built_in">NSString</span> *sql = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;insert into %@ (model) values(?)&quot;</span>, <span class="hljs-keyword">self</span>.tableName];<br>    <span class="hljs-built_in">BOOL</span> result = [<span class="hljs-keyword">self</span>.fmdb executeUpdate:sql withArgumentsInArray:@[modelData]];<br>    <span class="hljs-keyword">if</span> (result) &#123;<br>        aSuccessBlock();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        aFailBlock();<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)updateDataWithModel:(<span class="hljs-built_in">NSObject</span> *)model uid:(<span class="hljs-built_in">NSInteger</span>)aUid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123;<br>    <span class="hljs-built_in">NSData</span> *modelData = [<span class="hljs-built_in">NSKeyedArchiver</span> archivedDataWithRootObject:model];<br>    <span class="hljs-built_in">NSString</span> *sql = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;update %@ set model = ? where id = ?&quot;</span>, <span class="hljs-keyword">self</span>.tableName];<br>    <span class="hljs-built_in">BOOL</span> result = [<span class="hljs-keyword">self</span>.fmdb executeUpdate:sql withArgumentsInArray:@[modelData, @(aUid)]];<br>    <span class="hljs-keyword">if</span> (result) &#123;<br>        aSuccessBlock();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        aFailBlock();<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)deleteDataWithUid:(<span class="hljs-built_in">NSInteger</span>)uid successBlock:(successBlock)aSuccessBlock failBlock:(failBlock)aFailBlock &#123;<br>    <span class="hljs-built_in">NSString</span> *sql = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;delete from %@ where id = ?&quot;</span>, <span class="hljs-keyword">self</span>.tableName];<br>    <span class="hljs-built_in">BOOL</span> result = [<span class="hljs-keyword">self</span>.fmdb executeUpdate:sql withArgumentsInArray:@[@(uid)]];<br>    <span class="hljs-keyword">if</span> (result) &#123;<br>        aSuccessBlock();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        aFailBlock();<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSObject</span> *&gt; *)queryAllData &#123;<br>    <span class="hljs-built_in">NSMutableArray</span> *array = [<span class="hljs-built_in">NSMutableArray</span> array];<br>    <span class="hljs-built_in">NSString</span> *sql = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;select * from %@&quot;</span>,<span class="hljs-keyword">self</span>.tableName];<br>    <span class="hljs-keyword">@try</span> &#123;<br>        FMResultSet *rs = [<span class="hljs-keyword">self</span>.fmdb executeQuery:sql];<br>        <span class="hljs-keyword">while</span> (rs.next) &#123;<br>            <span class="hljs-built_in">NSObject</span> *model = [[<span class="hljs-built_in">NSObject</span> alloc] init];<br>            <span class="hljs-built_in">NSData</span> *modelData = [rs dataForColumn:<span class="hljs-string">@&quot;model&quot;</span>];<br>            <span class="hljs-keyword">int</span> uid = [rs intForColumn:<span class="hljs-string">@&quot;id&quot;</span>];<br>            <br>            model = [<span class="hljs-built_in">NSKeyedUnarchiver</span> unarchiveObjectWithData:modelData];<br>            model.wd_fmdb_id = uid;<br>            [array addObject:model];<br>        &#125;<br>    &#125; <span class="hljs-keyword">@catch</span> (<span class="hljs-built_in">NSException</span> *exception) &#123;<br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, <span class="hljs-keyword">self</span>.fmdb.lastError);<br>    &#125; <span class="hljs-keyword">@finally</span> &#123;<br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;æŸ¥è¯¢æ•°æ®&quot;</span>);<br>    &#125;<br>    <br>   <span class="hljs-keyword">return</span> array;<br>&#125;<br><br>- (FMDatabase *)fmdb &#123;<br>    <span class="hljs-keyword">if</span> (!_fmdb) &#123;<br>        <span class="hljs-built_in">NSString</span> *path = [<span class="hljs-built_in">NSHomeDirectory</span>() stringByAppendingString:<span class="hljs-string">@&quot;/Documents/testDB.db&quot;</span>];<br>        _fmdb = [[FMDatabase alloc] initWithPath:path];<br>    &#125;<br>    <span class="hljs-keyword">return</span> _fmdb;<br>&#125;<br><br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><p>3ã€ä½¿ç”¨æ–¹æ³•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> <span class="hljs-number">1</span>ã€æ‰“å¼€æ•°æ®åº“ï¼Œå¹¶åˆ›å»ºè¡¨<br>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;<br>    <br>    [[WDDataBaseManager manager] createTableWithName:@<span class="hljs-string">&quot;test&quot;</span>];<br>    <br>    return YES;<br>&#125;<br><span class="hljs-regexp">//</span> <span class="hljs-number">2</span>ã€æ·»åŠ æ•°æ®<br> [[WDDataBaseManager manager] insertDataWithModel:model successBlock:^&#123;<br>        <span class="hljs-regexp">//</span> TODO:<br>    &#125; failBlock:^&#123;<br>        <span class="hljs-regexp">//</span> TODO:<br>    &#125;];<br><span class="hljs-regexp">//</span> <span class="hljs-number">3</span>ã€æŸ¥è¯¢æ•°æ®<br>[[WDDataBaseManager manager] queryAllData]<br><span class="hljs-regexp">//</span> <span class="hljs-number">4</span>ã€ä¿®æ”¹æ•°æ®<br>[[WDDataBaseManager manager] updateDataWithModel:model uid:self.model.wd_fmdb_id successBlock:^&#123;<br>        <span class="hljs-regexp">//</span> TODO:<br>    &#125; failBlock:^&#123;<br>         <span class="hljs-regexp">//</span> TODO:<br>    &#125;];<br><span class="hljs-regexp">//</span> <span class="hljs-number">5</span>ã€åˆ é™¤æ•°æ®<br>[[WDDataBaseManager manager] deleteDataWithUid:model.wd_fmdb_id successBlock:^&#123;<br>            <span class="hljs-regexp">//</span> TODO:<br>        &#125; failBlock:^&#123;<br>            <span class="hljs-regexp">//</span> TODO:<br>        &#125;];<br><span class="hljs-regexp">//</span> <span class="hljs-number">6</span>ã€åˆ é™¤è¡¨<br>[[WDDataBaseManager manager] dropTable];<br></code></pre></td></tr></table></figure><ul><li>æ’å…¥è¡¨ä¸­çš„Modeléœ€è¦éµå¾ª<NSCoding>(å®ä¾‹ä»£ç )<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">- (<span class="hljs-keyword">void</span>)encodeWithCoder:(<span class="hljs-keyword">nonnull</span> <span class="hljs-built_in">NSCoder</span> *)aCoder &#123;<br>    [aCoder encodeObject:<span class="hljs-keyword">self</span>.name forKey:<span class="hljs-string">@&quot;name&quot;</span>];<br>    [aCoder encodeObject:<span class="hljs-keyword">self</span>.phone forKey:<span class="hljs-string">@&quot;phone&quot;</span>];<br>    [aCoder encodeObject:<span class="hljs-keyword">self</span>.address forKey:<span class="hljs-string">@&quot;address&quot;</span>];<br>&#125;<br><br>- (<span class="hljs-keyword">nullable</span> <span class="hljs-keyword">instancetype</span>)initWithCoder:(<span class="hljs-keyword">nonnull</span> <span class="hljs-built_in">NSCoder</span> *)aDecoder &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span> == [<span class="hljs-keyword">super</span> init]) &#123;<br>        <span class="hljs-keyword">self</span>.name = [aDecoder decodeObjectForKey:<span class="hljs-string">@&quot;name&quot;</span>] ;<br>        <span class="hljs-keyword">self</span>.phone = [aDecoder decodeObjectForKey:<span class="hljs-string">@&quot;phone&quot;</span>];<br>        <span class="hljs-keyword">self</span>.address = [aDecoder decodeObjectForKey:<span class="hljs-string">@&quot;address&quot;</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
      <category>SDK</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSç¬¬ä¸‰æ–¹åº“-AFNetworking&amp;SDWebImageåŸç†</title>
    <link href="/2020/01/01/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-AFNetworking&amp;SDWebImage%E5%8E%9F%E7%90%86/"/>
    <url>/2020/01/01/iOS%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-AFNetworking&amp;SDWebImage%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="AFNetworking"><a href="#AFNetworking" class="headerlink" title="AFNetworking"></a>AFNetworking</h2><p>NSURLSession</p><blockquote><ul><li>NSURLSession</li><li>NSURLSessionConfiguation</li><li>NSURLSessionTask</li></ul></blockquote><p>NSURLSessionTask</p><blockquote><ul><li>NSURLSessionDataTask </li><li>NSURLSessionDownLoadTask </li><li>NSURLSessionUploadTask</li></ul></blockquote><p>ç½‘ç»œè¯·æ±‚çš„è¿‡ç¨‹</p><blockquote><ul><li>åˆ›å»ºNSURLSessionConfigå¯¹è±¡â€“ç”¨åˆ›å»ºçš„configå¯¹è±¡é…ç½®åˆå§‹åŒ–NSURLSessionâ€“åˆ›å»ºNSURLSessionTaskå¯¹è±¡å¹¶resumeæ‰§è¡Œï¼Œç”¨delegateæˆ–è€…blockå›è°ƒè¿”å›æ•°æ®ã€‚</li><li>AFURLSessionManagerå°è£…äº†ä¸Šè¿°ç½‘ç»œäº¤äº’åŠŸèƒ½ </li><li>AFURLSessionManagerè¯·æ±‚è¿‡ç¨‹ </li><li>1.åˆå§‹åŒ–AFURLSessionManagerã€‚ </li><li>2.è·å–AFURLSessionManagerçš„Taskå¯¹è±¡ </li><li>3.å¯åŠ¨Task</li></ul></blockquote><p>AFNetworkingç”±äº”ä¸ªæ¨¡å—ç»„æˆï¼š</p><blockquote><ul><li>NSURLSessionï¼šç½‘ç»œé€šä¿¡æ¨¡å—ï¼ˆæ ¸å¿ƒæ¨¡å—ï¼‰ å¯¹åº” AFNetworkingä¸­çš„AFURLSessionManagerå’Œå¯¹HTTPåè®®è¿›è¡Œç‰¹åŒ–å¤„ç†çš„AFHTTPSessionManager,AFHTTPSessionManageræ˜¯ç»§æ‰¿äºAFURLSessionmanager</li><li>Securityï¼šç½‘ç»œé€šè®¯å®‰å…¨ç­–ç•¥æ¨¡å— å¯¹åº” AFSecurityPolicy</li><li>Reachabilityï¼šç½‘ç»œçŠ¶æ€ç›‘å¬æ¨¡å— å¯¹åº”AFNetworkReachabilityManager</li><li>Seriaalizationï¼šç½‘ç»œé€šä¿¡ä¿¡æ¯åºåˆ—åŒ–ã€ååºåˆ—åŒ–æ¨¡å— å¯¹åº” AFURLResponseSerialization</li><li>UIKitï¼šå¯¹äºIOSUIKitçš„æ‰©å±•åº“</li></ul></blockquote><hr><h2 id="SDWebImage"><a href="#SDWebImage" class="headerlink" title="SDWebImage"></a>SDWebImage</h2><h4 id="å›¾ç‰‡è§£é‡Šï¼š"><a href="#å›¾ç‰‡è§£é‡Šï¼š" class="headerlink" title="å›¾ç‰‡è§£é‡Šï¼š"></a>å›¾ç‰‡è§£é‡Šï¼š</h4><blockquote><ul><li>å†…å­˜å±‚é¢çš„ç›¸å½“æ˜¯ä¸ªç¼“å­˜å™¨ï¼Œä»¥Key-Valueçš„å½¢å¼å­˜å‚¨å›¾ç‰‡ã€‚</li><li>å½“å†…å­˜ä¸å¤Ÿçš„æ—¶å€™ä¼šæ¸…é™¤æ‰€æœ‰ç¼“å­˜å›¾ç‰‡ã€‚</li><li>ç”¨æœç´¢æ–‡ä»¶ç³»ç»Ÿçš„æ–¹å¼åšç®¡ç†ï¼Œæ–‡ä»¶æ›¿æ¢æ–¹å¼æ˜¯ä»¥æ—¶é—´ä¸ºå•ä½ï¼Œå‰”é™¤æ—¶é—´å¤§äºä¸€å‘¨çš„å›¾ç‰‡æ–‡ä»¶ã€‚</li><li>å½“SDWebImageManagerå‘SDImageCacheè¦èµ„æºæ—¶ï¼Œå…ˆæœç´¢å†…å­˜å±‚é¢çš„æ•°æ®ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰çš„è¯å»è®¿é—®ç£ç›˜ï¼Œå°†å›¾ç‰‡ä»ç£ç›˜è¯»å–å‡ºæ¥ï¼Œç„¶ååšDecoderï¼Œå°†å›¾ç‰‡å¯¹è±¡æ”¾åˆ°å†…å­˜å±‚é¢åšå¤‡ä»½ï¼Œå†è¿”å›è°ƒç”¨å±‚ã€‚</li></ul></blockquote><h4 id="å®ç°è¿‡ç¨‹"><a href="#å®ç°è¿‡ç¨‹" class="headerlink" title="å®ç°è¿‡ç¨‹"></a>å®ç°è¿‡ç¨‹</h4><blockquote><p>1ã€å…¥å£ setImageWithURL:placeholderImage:options: ä¼šå…ˆæŠŠ placeholderImage æ˜¾ç¤ºï¼Œç„¶å SDWebImageManager æ ¹æ® URL å¼€å§‹å¤„ç†å›¾ç‰‡ã€‚</p><p>2ã€è¿›å…¥ SDWebImageManager-downloadWithURL:delegate:options:userInfo:ï¼Œäº¤ç»™ SDImageCache ä»ç¼“å­˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ä¸‹è½½ queryDiskCacheForKey:delegate:userInfo:.</p><p>3ã€å¦‚æœå†…å­˜ä¸­å·²ç»æœ‰å›¾ç‰‡ç¼“å­˜ï¼ŒSDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo: åˆ° SDWebImageManagerã€‚</p><p>4ã€SDWebImageManagerDelegate å›è°ƒ webImageManager:didFinishWithImage: åˆ° UIImageView+WebCache ç­‰å‰ç«¯å±•ç¤ºå›¾ç‰‡ã€‚</p><p>5ã€å¦‚æœå†…å­˜ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œç”Ÿæˆ NSInvocationOperation æ·»åŠ åˆ°é˜Ÿåˆ—å¼€å§‹ä»ç¡¬ç›˜æŸ¥æ‰¾å›¾ç‰‡æ˜¯å¦å·²ç»ç¼“å­˜ã€‚</p><p>6ã€æ ¹æ® URLKey åœ¨ç¡¬ç›˜ç¼“å­˜ç›®å½•ä¸‹å°è¯•è¯»å–å›¾ç‰‡æ–‡ä»¶ã€‚è¿™ä¸€æ­¥æ˜¯åœ¨ NSOperation è¿›è¡Œçš„æ“ä½œï¼Œæ‰€ä»¥å›ä¸»çº¿ç¨‹è¿›è¡Œç»“æœå›è°ƒ notifyDelegate:ã€‚</p><p>7ã€å¦‚æœç¡¬ç›˜ä¸­æœ‰è¯¥å›¾ç‰‡ï¼Œå°†å›¾ç‰‡æ·»åŠ åˆ°å†…å­˜ç¼“å­˜ä¸­ï¼ˆå¦‚æœç©ºé—²å†…å­˜è¿‡å°ï¼Œä¼šå…ˆæ¸…ç©ºå†…å­˜ç¼“å­˜ï¼‰ã€‚SDImageCacheDelegate å›è°ƒ imageCache:didFindImage:forKey:userInfo:ã€‚è¿›è€Œå›è°ƒå±•ç¤ºå›¾ç‰‡ã€‚</p><p>8ã€å¦‚æœä»ç¡¬ç›˜ç¼“å­˜ç›®å½•è¯»å–ä¸åˆ°å›¾ç‰‡ï¼Œè¯´æ˜æ‰€æœ‰ç¼“å­˜éƒ½ä¸å­˜åœ¨è¯¥å›¾ç‰‡ï¼Œéœ€è¦ä¸‹è½½å›¾ç‰‡ï¼Œå›è°ƒ imageCache:didNotFindImageForKey:userInfo:ã€‚</p><p>9ã€å…±äº«æˆ–é‡æ–°ç”Ÿæˆä¸€ä¸ªä¸‹è½½å™¨ SDWebImageDownloader å¼€å§‹ä¸‹è½½å›¾ç‰‡ã€‚</p><p>10ã€å›¾ç‰‡ä¸‹è½½ç”± NSURLConnection æ¥åšï¼Œå®ç°ç›¸å…³ delegate æ¥åˆ¤æ–­å›¾ç‰‡ä¸‹è½½ä¸­ã€ä¸‹è½½å®Œæˆå’Œä¸‹è½½å¤±è´¥ã€‚</p><p>11ã€imageDownloader:didFinishWithImage: å›è°ƒç»™ SDWebImageManager å‘ŠçŸ¥å›¾ç‰‡ä¸‹è½½å®Œæˆã€‚</p><p>12ã€é€šçŸ¥æ‰€æœ‰çš„ downloadDelegates ä¸‹è½½å®Œæˆï¼Œå›è°ƒç»™éœ€è¦çš„åœ°æ–¹å±•ç¤ºå›¾ç‰‡ã€‚</p><p>13ã€å°†å›¾ç‰‡ä¿å­˜åˆ° SDImageCache ä¸­ï¼Œå†…å­˜ç¼“å­˜å’Œç¡¬ç›˜ç¼“å­˜åŒæ—¶ä¿å­˜ã€‚å†™æ–‡ä»¶åˆ°ç¡¬ç›˜ä¹Ÿåœ¨ä»¥å•ç‹¬ NSInvocationOperation å®Œæˆï¼Œé¿å…æ‹–æ…¢ä¸»çº¿ç¨‹ã€‚SDImageCache åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šæ³¨å†Œä¸€äº›æ¶ˆæ¯é€šçŸ¥ï¼Œåœ¨å†…å­˜è­¦å‘Šæˆ–é€€åˆ°åå°çš„æ—¶å€™æ¸…ç†å†…å­˜å›¾ç‰‡ç¼“å­˜ï¼Œåº”ç”¨ç»“æŸçš„æ—¶å€™æ¸…ç†è¿‡æœŸå›¾ç‰‡ã€‚</p></blockquote><hr>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
      <category>SDK</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSå¼€å‘æŠ€å·§-ä¸æ–­æ›´æ–°ä¸­</title>
    <link href="/2020/01/01/iOS%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/"/>
    <url>/2020/01/01/iOS%E5%BC%80%E5%8F%91%E6%8A%80%E5%B7%A7/</url>
    
    <content type="html"><![CDATA[<p>1ã€PrefixHeaderå¯¼å…¥ä½ç½®å†™æ³•</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">$(SRCROOT)</span>/<span class="hljs-constructor">$(PROJECT_NAME)</span>/&lt;#æ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹åç§°#&gt;/<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">PrefixHeader</span>.</span></span>pch<br></code></pre></td></tr></table></figure><p>2ã€éšè—å¯¼èˆªæ çš„ä¸¤ç§æ–¹å¼</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">//æ–¹å¼ä¸€ ã€Šæ¨èã€‹</span><br><span class="hljs-comment">//åœ¨éœ€è¦éšè—çš„viewControllerä¸­éµå¾ª&lt;UINavigationControllerDelegate&gt;</span><br>- (<span class="hljs-keyword">void</span>)viewDidLoad &#123;<br>    [<span class="hljs-keyword">super</span> viewDidLoad];<br> <span class="hljs-comment">// è®¾ç½®å¯¼èˆªæ§åˆ¶å™¨çš„ä»£ç†ä¸ºself</span><br>    <span class="hljs-keyword">self</span>.navigationController.delegate = <span class="hljs-keyword">self</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - UINavigationControllerDelegate</span><br><span class="hljs-comment">// å°†è¦æ˜¾ç¤ºæ§åˆ¶å™¨</span><br>- (<span class="hljs-keyword">void</span>)navigationController:(<span class="hljs-built_in">UINavigationController</span> *)navigationController willShowViewController:(<span class="hljs-built_in">UIViewController</span> *)viewController animated:(<span class="hljs-built_in">BOOL</span>)animated &#123;<br>    <span class="hljs-comment">// åˆ¤æ–­è¦æ˜¾ç¤ºçš„æ§åˆ¶å™¨æ˜¯å¦æ˜¯è‡ªå·±</span><br>    <span class="hljs-built_in">BOOL</span> isShowHomePage = [viewController isKindOfClass:[<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>]];<br>    <br>    [<span class="hljs-keyword">self</span>.navigationController setNavigationBarHidden:isShowHomePage animated:<span class="hljs-literal">YES</span>];<br>&#125;<br><br><span class="hljs-comment">//æ–¹å¼äºŒ</span><br>- (<span class="hljs-keyword">void</span>)viewWillAppear:(<span class="hljs-built_in">BOOL</span>)animated &#123;<br>    [<span class="hljs-keyword">super</span> viewWillAppear:animated];<br><br>    [<span class="hljs-keyword">self</span>.navigationController setNavigationBarHidden:<span class="hljs-literal">YES</span> animated:<span class="hljs-literal">YES</span>];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)viewWillDisappear:(<span class="hljs-built_in">BOOL</span>)animated &#123;<br>    [<span class="hljs-keyword">super</span> viewWillDisappear:animated];<br><br>    [<span class="hljs-keyword">self</span>.navigationController setNavigationBarHidden:<span class="hljs-literal">NO</span> animated:<span class="hljs-literal">YES</span>];<br>&#125;<br></code></pre></td></tr></table></figure><p>3ã€TabBarItemè¦æ±‚åªæ˜¾ç¤ºå›¾ç‰‡ä¸æ˜¾ç¤ºæ–‡å­—</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">// self è¡¨ç¤ºéœ€è¦è®¾ç½®æ ·å¼çš„æ§åˆ¶å™¨</span><br>[<span class="hljs-keyword">self</span>.tabBarItem setImageInsets:<span class="hljs-built_in">UIEdgeInsetsMake</span>(<span class="hljs-number">6</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-6</span>, <span class="hljs-number">0</span>)];<br></code></pre></td></tr></table></figure><p>4ã€TableViewæˆ–CollectionViewå•é€‰</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-comment">&lt;!--æ­¥éª¤ä¸€ã€ å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡--&gt;</span></span><br><span class="xml">@property (nonatomic, assign) NSInteger selectedIndex;</span><br><span class="xml"><span class="hljs-comment">&lt;!--æ­¥éª¤äºŒã€TableViewæˆ–CollectionViewç‚¹å‡»äº‹ä»¶çš„æ–¹æ³•ä¸­ä¿å­˜ç‚¹å‡»çš„indexï¼Œå¹¶åˆ·æ–°--&gt;</span></span><br><span class="xml">self.selectedIndex = indexPath.row;</span><br><span class="xml">[collectionView reloadData];æˆ–[tableView reloadData];</span><br><span class="xml"><span class="hljs-comment">&lt;!--æ­¥éª¤ä¸‰ã€åœ¨cellForItemAtIndexPathæˆ–cellForRowAtIndexPathæ–¹æ³•ä¸­åˆ¤æ–­æ˜¯å¦æ˜¯æ‰€ä¿å­˜çš„index--&gt;</span></span><br><span class="xml">if (self.selectedIndex == indexPath.row) </span><span class="hljs-template-variable">&#123;</span><br><span class="hljs-template-variable">    // è®¾ç½®é€‰ä¸­æ ·å¼</span><br><span class="hljs-template-variable">&#125;</span><span class="xml"> else </span><span class="hljs-template-variable">&#123;</span><br><span class="hljs-template-variable">    // è®¾ç½®æˆé»˜è®¤æ ·å¼    </span><br><span class="hljs-template-variable">&#125;</span><span class="xml"></span><br><span class="xml"></span><br></code></pre></td></tr></table></figure><p>5ã€æ€ä¹ˆåŒºåˆ†çœŸæœºè¿˜æ˜¯æ¨¡æ‹Ÿå™¨</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> TARGET_IPHONE_SIMULATOR  </span><br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;run on simulator&quot;</span>);  <br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SIMULATOR_TEST</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span>  </span><br><span class="hljs-comment">//ä¸å®šä¹‰SIMULATOR_TESTè¿™ä¸ªå®</span><br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;run on device&quot;</span>);  <br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br></code></pre></td></tr></table></figure><p>6ã€if Debug</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment">#ifdef DEBUG    </span><br><span class="hljs-regexp">//</span> <span class="hljs-keyword">do</span> sth<br><span class="hljs-comment">#else   </span><br><span class="hljs-regexp">//</span> <span class="hljs-keyword">do</span> sth<br><span class="hljs-comment">#endif</span><br></code></pre></td></tr></table></figure><p>7ã€ä¸€é”®æ¸…ç†æ‰€æœ‰æ¨¡æ‹Ÿå™¨å®‰è£…è¿‡çš„APP</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> å…ˆå…³é—­æ‰€æœ‰æ¨¡æ‹Ÿå™¨ åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä¸‹é¢å‘½ä»¤å³å¯<br>xcrun simctl erase all<br></code></pre></td></tr></table></figure><p>8ã€SDWebImageæ¸…ç†ç¼“å­˜</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs inform7">- (void)didReceiveMemoryWarning &#123;<br>    <span class="hljs-comment">[super didReceiveMemoryWarning]</span>;<br>    <span class="hljs-comment">[<span class="hljs-comment">[<span class="hljs-comment">[SDWebImageManager sharedManager]</span> imageCache]</span> clearMemory]</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>9ã€UITableViewçš„HeaderViewä¸‹æ‹‰æ”¾å¤§</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-number">1</span>ã€View1:ä½œä¸ºæ˜¾ç¤ºView<br><span class="hljs-number">2</span>ã€View2:ä½œä¸ºtableViewçš„tableHeaderViewï¼Œå¹¶æ·»åŠ View1ï¼ŒView2çš„å¤§å°å’ŒView1å¤§å°ç›¸åŒ.<br><span class="hljs-number">3</span>ã€åœ¨<span class="hljs-built_in">UIScrollViewDelegate</span>æ–¹æ³•ä¸­è¿›è¡Œè®¾è®¡<br>- (<span class="hljs-keyword">void</span>)scrollViewDidScroll:(<span class="hljs-built_in">UIScrollView</span> *)scrollView &#123;<br>    <span class="hljs-built_in">CGFloat</span> width = <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width;<br>    <span class="hljs-built_in">CGFloat</span> viewHeight = kScreenWidth * <span class="hljs-number">0.5</span>; <span class="hljs-comment">// View1çš„åˆå§‹é«˜åº¦</span><br>    <span class="hljs-built_in">CGFloat</span> yOffset = scrollView.contentOffset.y;<br>    <span class="hljs-keyword">if</span> (yOffset &lt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-built_in">CGFloat</span> totalOffset = viewHeight + ABS(yOffset);<br>        <span class="hljs-built_in">CGFloat</span> f = totalOffset / viewHeight;<br>        <span class="hljs-keyword">self</span>.headerView.frame = <span class="hljs-built_in">CGRectMake</span>(- (width * f - width) / <span class="hljs-number">2</span>, yOffset, width * f, totalOffset);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>10ã€Masonryåˆ¶ä½œå°±å®«æ ¼</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">//Objective-C ----&gt; Masonry</span><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> å¤šè§†å›¾å¸ƒå±€</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param viewArray è§†å›¾æ•°ç»„</span><br><span class="hljs-comment"> @param column åˆ—æ•°</span><br><span class="hljs-comment"> @param tbSpeace è§†å›¾ä¸Šä¸‹é—´è·</span><br><span class="hljs-comment"> @param lrSpeace è§†å›¾å·¦å³é—´è·</span><br><span class="hljs-comment"> @param topSpeace å’Œçˆ¶è§†å›¾ä¸Šé—´è·</span><br><span class="hljs-comment"> @param lrSuperViewSpeace çˆ¶è§†å›¾å·¦å³é—´è·</span><br><span class="hljs-comment"> @param superView çˆ¶è§†å›¾</span><br><span class="hljs-comment"> @param viewHeight è§†å›¾é«˜åº¦</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)wd_masLayoutSubViewsWithViewArray:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">UIView</span> *&gt; *)viewArray<br>                              columnOfRow:(<span class="hljs-built_in">NSInteger</span>)column<br>                    topBottomOfItemSpeace:(<span class="hljs-built_in">CGFloat</span>)tbSpeace<br>                      leftRightItemSpeace:(<span class="hljs-built_in">CGFloat</span>)lrSpeace<br>                     topOfSuperViewSpeace:(<span class="hljs-built_in">CGFloat</span>)topSpeace<br>                 leftRightSuperViewSpeace:(<span class="hljs-built_in">CGFloat</span>)lrSuperViewSpeace<br>                          addToSubperView:(<span class="hljs-built_in">UIView</span> *)superView<br>                               viewHeight:(<span class="hljs-built_in">CGFloat</span>)viewHeight&#123;<br>  <br>                    <span class="hljs-built_in">CGFloat</span> viewWidth = superView.bounds.size.width;<br>                    <span class="hljs-built_in">CGFloat</span> itemWidth = (viewWidth - lrSuperViewSpeace * <span class="hljs-number">2</span> - (column - <span class="hljs-number">1</span>) * lrSpeace) / column * <span class="hljs-number">1.0</span>f;<br>                    <span class="hljs-built_in">CGFloat</span> itemHeight = viewHeight;<br>                    <span class="hljs-built_in">UIView</span> *last = <span class="hljs-literal">nil</span>;<br>  <br>                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; viewArray.count; i++) &#123;<br>                        <span class="hljs-built_in">UIView</span> *item = viewArray[i];<br>                        [superView addSubview:item];<br><br>                        [item mas_makeConstraints:^(MASConstraintMaker *make) &#123;<br>                            make.width.mas_equalTo(itemWidth);<br>                            make.height.mas_equalTo(itemHeight);<br>                          <br>                            <span class="hljs-built_in">CGFloat</span> top = topSpeace + (i / column) * (itemHeight + tbSpeace);<br>                            make.top.mas_offset(top);<br>                            <span class="hljs-keyword">if</span> (!last || (i % column) == <span class="hljs-number">0</span>) &#123;<br>                                make.left.mas_offset(lrSuperViewSpeace);<br>                            &#125;<span class="hljs-keyword">else</span>&#123;<br>                                make.left.mas_equalTo(last.mas_right).mas_offset(lrSpeace);<br>                            &#125;<br>                        &#125;];<br>                      <br>                        last = item;<br>                    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>11ã€Snapkitåˆ¶ä½œä¹å®«æ ¼</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">//Swift ----&gt; SnapKit</span><br>    <br>    <span class="hljs-comment">/// å¤šè§†å›¾å¸ƒå±€</span><br>    <span class="hljs-comment">///</span><br>    <span class="hljs-comment">/// - Parameters:</span><br>    <span class="hljs-comment">///   - viewArray: è§†å›¾æ•°ç»„</span><br>    <span class="hljs-comment">///   - columnOfRow: åˆ—æ•°</span><br>    <span class="hljs-comment">///   - topBottomOfItemSpeace: è§†å›¾ä¸Šä¸‹é—´è·</span><br>    <span class="hljs-comment">///   - leftRightItemSpeace: è§†å›¾å·¦å³é—´è·</span><br>    <span class="hljs-comment">///   - topOfSuperViewSpeace: å’Œçˆ¶è§†å›¾ä¸Šé—´è·</span><br>    <span class="hljs-comment">///   - leftRightSuperViewSpeace: çˆ¶è§†å›¾å·¦å³é—´è·</span><br>    <span class="hljs-comment">///   - addToSubperView: çˆ¶è§†å›¾</span><br>    <span class="hljs-comment">///   - viewHeight: è§†å›¾é«˜åº¦</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">wd_masLayoutSubViews</span>(<span class="hljs-params">viewArray</span>:<span class="hljs-type">Array</span>&lt;<span class="hljs-type">UIView</span>&gt;,</span><br><span class="hljs-function">                              <span class="hljs-params">columnOfRow</span>:<span class="hljs-type">Int</span>,</span><br><span class="hljs-function">                              <span class="hljs-params">topBottomOfItemSpeace</span>:<span class="hljs-type">CGFloat</span>,</span><br><span class="hljs-function">                              <span class="hljs-params">leftRightItemSpeace</span>:<span class="hljs-type">CGFloat</span>,</span><br><span class="hljs-function">                              <span class="hljs-params">topOfSuperViewSpeace</span>:<span class="hljs-type">CGFloat</span>,</span><br><span class="hljs-function">                              <span class="hljs-params">leftRightSuperViewSpeace</span>:<span class="hljs-type">CGFloat</span>,</span><br><span class="hljs-function">                              <span class="hljs-params">addToSubperView</span>:<span class="hljs-type">UIView</span>,</span><br><span class="hljs-function">                              <span class="hljs-params">viewHeight</span>:<span class="hljs-type">CGFloat</span>)</span> -&gt; <span class="hljs-type">Void</span> &#123;<br>        <br>        <br>        <span class="hljs-keyword">let</span> viewWidth <span class="hljs-operator">=</span> addToSubperView.bounds.width<br>        <span class="hljs-keyword">let</span> tempW <span class="hljs-operator">=</span> leftRightSuperViewSpeace <span class="hljs-operator">*</span> <span class="hljs-number">2</span> <span class="hljs-operator">+</span> <span class="hljs-type">CGFloat</span>(columnOfRow <span class="hljs-operator">-</span> <span class="hljs-number">1</span>) <span class="hljs-operator">*</span> leftRightItemSpeace<br>        <span class="hljs-keyword">let</span> itemWidth <span class="hljs-operator">=</span> (viewWidth <span class="hljs-operator">-</span> tempW) <span class="hljs-operator">/</span> <span class="hljs-type">CGFloat</span>(columnOfRow)<br>        <span class="hljs-keyword">let</span> itemHeight <span class="hljs-operator">=</span> viewHeight<br>        <br>        <span class="hljs-built_in">print</span>(leftRightSuperViewSpeace,leftRightItemSpeace,itemWidth)<br>        <br>        <span class="hljs-keyword">var</span> lastView:<span class="hljs-type">UIView</span>?<br>        <br>        <span class="hljs-keyword">for</span> (index) <span class="hljs-keyword">in</span> viewArray.enumerated() &#123;<br>            <br>            <span class="hljs-keyword">let</span> item <span class="hljs-operator">=</span> viewArray[i]<br>            addToSubperView.addSubview(item)<br>            <br>            item.snp.makeConstraints &#123; (make) <span class="hljs-keyword">in</span><br>                make.width.equalTo(itemWidth)<br>                make.height.equalTo(itemHeight)<br>                <span class="hljs-keyword">let</span> top <span class="hljs-operator">=</span> topOfSuperViewSpeace <span class="hljs-operator">+</span> <span class="hljs-type">CGFloat</span>(i <span class="hljs-operator">/</span> columnOfRow) <span class="hljs-operator">*</span> (itemHeight <span class="hljs-operator">+</span> topBottomOfItemSpeace)<br>                make.top.equalTo(top)<br>                <br>                <span class="hljs-keyword">if</span> <span class="hljs-operator">!</span>(lastView <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span>) <span class="hljs-operator">||</span> i<span class="hljs-operator">%</span>columnOfRow <span class="hljs-operator">==</span> <span class="hljs-number">0</span> &#123;<br>                    make.left.equalTo(leftRightSuperViewSpeace)<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    make.left.equalTo((lastView<span class="hljs-operator">?</span>.snp.right)<span class="hljs-operator">!</span>).offset(leftRightItemSpeace)<br>                &#125;<br>                <br>                lastView <span class="hljs-operator">=</span> item<br>            &#125;<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure><p>12ã€æ²‰æµ¸å¼TableView(ScrollViewã€CollectionView)</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">if</span> (<span class="hljs-keyword">@available</span>(<span class="hljs-keyword">iOS</span> <span class="hljs-number">11.0</span>, <span class="hljs-operator">*</span>)) &#123;<br>    <span class="hljs-keyword">self</span>.tableView.contentInsetAdjustmentBehavior <span class="hljs-operator">=</span> <span class="hljs-type">UIScrollViewContentInsetAdjustmentNever</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">self</span>.automaticallyAdjustsScrollViewInsets <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>13ã€é€šè¿‡èº«ä»½è¯è®¡ç®—å¹´é¾„</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/** é€šè¿‡èº«ä»½è¯è®¡ç®—å¹´é¾„ */</span><br>- (<span class="hljs-built_in">NSString</span> *)calculationAgeWithBirthday: (<span class="hljs-built_in">NSString</span> *)birthday &#123;<br>    <span class="hljs-built_in">NSCalendar</span> *calendar = [<span class="hljs-built_in">NSCalendar</span> currentCalendar];<br>    <span class="hljs-built_in">NSDate</span> *nowDate = [<span class="hljs-built_in">NSDate</span> date];<br>    <span class="hljs-built_in">NSString</span> *birth = birthday;<br>    <span class="hljs-built_in">NSDateFormatter</span> *dateFormatter = [[<span class="hljs-built_in">NSDateFormatter</span> alloc]init];<br>    [dateFormatter setDateFormat:<span class="hljs-string">@&quot;yyyy-MM-dd&quot;</span>];<br>    <span class="hljs-built_in">NSDate</span> *birthDay = [dateFormatter dateFromString:birth];<br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> unitFlags = <span class="hljs-built_in">NSCalendarUnitYear</span> | <span class="hljs-built_in">NSCalendarUnitMonth</span> | <span class="hljs-built_in">NSCalendarUnitDay</span>;<br>    <span class="hljs-built_in">NSDateComponents</span> *date = [calendar components:unitFlags fromDate:birthDay toDate:nowDate options:<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">if</span> ([date year] &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%ldå²&quot;</span>, (<span class="hljs-keyword">long</span>)[date year]];<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>([date month] &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%ldæœˆ&quot;</span>, (<span class="hljs-keyword">long</span>)[date month]];<br>    &#125;  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>([date day] &gt; <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%ldå¤©&quot;</span>, (<span class="hljs-keyword">long</span>)[date day]];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">@&quot;0å¤©&quot;</span>;<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-built_in">NSString</span> *)ageStrFromIdentityCard:(<span class="hljs-built_in">NSString</span> *)numberStr &#123;<br>    <span class="hljs-built_in">NSString</span> *dateSt;<br>    <span class="hljs-built_in">NSMutableString</span> *dateS;<br>    <span class="hljs-keyword">if</span> (numberStr.length &gt; <span class="hljs-number">15</span>) &#123;<br>        dateSt = [numberStr substringWithRange:<span class="hljs-built_in">NSMakeRange</span>(<span class="hljs-number">6</span>, <span class="hljs-number">8</span>)];<br>        dateS = [<span class="hljs-built_in">NSMutableString</span> stringWithFormat:<span class="hljs-string">@&quot;%@&quot;</span>, dateSt];<br>        [dateS insertString:<span class="hljs-string">@&quot;-&quot;</span> atIndex:<span class="hljs-number">4</span>];<br>        [dateS insertString:<span class="hljs-string">@&quot;-&quot;</span> atIndex:<span class="hljs-number">7</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// åªè€ƒè™‘ 19å¼€å¤´çš„15ä½çš„èº«ä»½è¯å·</span><br>        dateSt = [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;19%@&quot;</span>,[numberStr substringWithRange:<span class="hljs-built_in">NSMakeRange</span>(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)]];<br>        dateS = [<span class="hljs-built_in">NSMutableString</span> stringWithFormat:<span class="hljs-string">@&quot;%@&quot;</span>, dateSt];<br>        [dateS insertString:<span class="hljs-string">@&quot;-&quot;</span> atIndex:<span class="hljs-number">4</span>];<br>        [dateS insertString:<span class="hljs-string">@&quot;-&quot;</span> atIndex:<span class="hljs-number">7</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> calculationAgeWithBirthday:dateS];<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶-TableViewã€CollectionViewç©ºæ•°æ®å ä½å›¾</title>
    <link href="/2019/12/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-TableView%E3%80%81CollectionView%E7%A9%BA%E6%95%B0%E6%8D%AE%E5%8D%A0%E4%BD%8D%E5%9B%BE/"/>
    <url>/2019/12/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-TableView%E3%80%81CollectionView%E7%A9%BA%E6%95%B0%E6%8D%AE%E5%8D%A0%E4%BD%8D%E5%9B%BE/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-9a4a4958fdf67cb6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼å›¾.jpg"></p><p>æœ€è¿‘ç”±äºä¸šåŠ¡éœ€æ±‚ï¼Œéœ€è¦å°è£…è¿™æ ·çš„ä¸€ä¸ªæç¤ºé¡µé¢ã€‚çœ‹äº†ç½‘ä¸Šæ–¹æ³•æ„Ÿè§‰éƒ½å¤§åŒå°å¼‚ï¼Œå…¶ä¸­<a href="https://link.jianshu.com/?t=https://github.com/dzenbot/DZNEmptyDataSet">DZNEmptyDataSet</a>æ˜¯å¾ˆå¥½çš„ä¸€ä¸ªåº“ï¼Œä½†æ˜¯å¯¹æˆ‘ä¸ªäººè€Œè¨€æœ‰ç‚¹å¤§è´¢å°ç”¨äº†ã€‚æ‰€ä»¥å°±å€Ÿé‰´ä¸€ä¸‹å…¶æ–¹æ³•ï¼Œè‡ªå·±å°è£…ä¸€ä¸ªã€‚æ„Ÿè§‰æœ‰æ›´é«˜çš„è‡ªå®šä¹‰æ€§å§ã€‚ï¼ˆæˆ‘æ˜¯åˆå­¦è€…ï¼Œè¯·å¤§ä½¬çˆ±æŠ¤ï¼Œå‹¿å–·ï¼‰<br>ä¸€ã€å°è£…ä»£ç ï¼šåˆ©ç”¨UIScrollViewçš„åˆ†ç±»å®ç°</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">UIScrollView</span> (<span class="hljs-title">WD_NoData</span>)</span><br><span class="hljs-comment">// éœ€è¦æ˜¾ç¤ºçš„å ä½é¡µé¢</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIView</span> *noDataView;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br><br></code></pre></td></tr></table></figure><p>å®ç°ä»£ç </p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;UIScrollView+WD_NoData.h&quot;</span></span><br><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;objc/runtime.h&gt;</span></span><br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">char</span> *noDataViewKey = <span class="hljs-string">&quot;noDataViewKey&quot;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">UIScrollView</span> (<span class="hljs-title">WD_NoData</span>)</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> äº¤æ¢æ–¹æ³•</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param sel1 åŸæ–¹æ³•</span><br><span class="hljs-comment"> @param sel2 è‡ªå®šä¹‰æ–¹æ³•</span><br><span class="hljs-comment"> @param cls ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">void</span> exchangeSelector(SEL sel1, SEL sel2, Class cls) &#123;<br>    Class <span class="hljs-keyword">class</span> = [cls <span class="hljs-keyword">class</span>];<br>    Method originalMethod = class_getInstanceMethod(<span class="hljs-keyword">class</span>, sel1);<br>    Method swizzledMethod = class_getInstanceMethod(<span class="hljs-keyword">class</span>, sel2);<br>    <span class="hljs-built_in">BOOL</span> success = class_addMethod(<span class="hljs-keyword">class</span>, sel1, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod));<br>    <span class="hljs-keyword">if</span> (success) &#123;<br>        class_replaceMethod(<span class="hljs-keyword">class</span>, sel2, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        method_exchangeImplementations(originalMethod, swizzledMethod);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== Setter ===============</span><br>- (<span class="hljs-keyword">void</span>)setNoDataView:(<span class="hljs-built_in">UIView</span> *)noDataView &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_once_t</span> onceToken;<br>    <span class="hljs-built_in">dispatch_once</span>(&amp;onceToken, ^&#123;<br>        exchangeSelector(<span class="hljs-keyword">@selector</span>(reloadData), <span class="hljs-keyword">@selector</span>(wd_reloadData), [<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>]);<br>    &#125;);<br>    <br>    objc_setAssociatedObject(<span class="hljs-keyword">self</span>, noDataViewKey, noDataView, OBJC_ASSOCIATION_RETAIN_NONATOMIC);<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== Getter ===============</span><br>- (<span class="hljs-built_in">UIView</span> *)noDataView &#123;<br>    <span class="hljs-built_in">UIView</span> *noDataView = objc_getAssociatedObject(<span class="hljs-keyword">self</span>, noDataViewKey);<br>    noDataView.frame = <span class="hljs-keyword">self</span>.frame;<br>    <span class="hljs-keyword">return</span> noDataView;<br>&#125;<br><br><br>- (<span class="hljs-keyword">void</span>)wd_reloadData &#123;<br>    [<span class="hljs-keyword">self</span> wd_reloadData];<br>    [<span class="hljs-keyword">self</span> wd_checkData];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== è·å–æ•°æ® ===============</span><br>- (<span class="hljs-keyword">void</span>)wd_checkData &#123;<br>    <span class="hljs-built_in">NSInteger</span> items = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-keyword">if</span> (![<span class="hljs-keyword">self</span> respondsToSelector:<span class="hljs-keyword">@selector</span>(dataSource)]) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// UITableView support</span><br>    <span class="hljs-keyword">if</span> ([<span class="hljs-keyword">self</span> isKindOfClass:[<span class="hljs-built_in">UITableView</span> <span class="hljs-keyword">class</span>]]) &#123;<br>        <br>        <span class="hljs-built_in">UITableView</span> *tableView = (<span class="hljs-built_in">UITableView</span> *)<span class="hljs-keyword">self</span>;<br>        <span class="hljs-keyword">id</span> &lt;<span class="hljs-built_in">UITableViewDataSource</span>&gt; dataSource = tableView.dataSource;<br>        <br>        <span class="hljs-built_in">NSInteger</span> sections = <span class="hljs-number">1</span>;<br>        <br>        <span class="hljs-keyword">if</span> (dataSource &amp;&amp; [dataSource respondsToSelector:<span class="hljs-keyword">@selector</span>(numberOfSectionsInTableView:)]) &#123;<br>            sections = [dataSource numberOfSectionsInTableView:tableView];<br>        &#125;<br>        <br>        <span class="hljs-keyword">if</span> (dataSource &amp;&amp; [dataSource respondsToSelector:<span class="hljs-keyword">@selector</span>(tableView:numberOfRowsInSection:)]) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">NSInteger</span> section = <span class="hljs-number">0</span>; section &lt; sections; section++) &#123;<br>                items += [dataSource tableView:tableView numberOfRowsInSection:section];<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// UICollectionView support</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-keyword">self</span> isKindOfClass:[<span class="hljs-built_in">UICollectionView</span> <span class="hljs-keyword">class</span>]]) &#123;<br>        <br>        <span class="hljs-built_in">UICollectionView</span> *collectionView = (<span class="hljs-built_in">UICollectionView</span> *)<span class="hljs-keyword">self</span>;<br>        <span class="hljs-keyword">id</span> &lt;<span class="hljs-built_in">UICollectionViewDataSource</span>&gt; dataSource = collectionView.dataSource;<br>        <br>        <span class="hljs-built_in">NSInteger</span> sections = <span class="hljs-number">1</span>;<br>        <br>        <span class="hljs-keyword">if</span> (dataSource &amp;&amp; [dataSource respondsToSelector:<span class="hljs-keyword">@selector</span>(numberOfSectionsInCollectionView:)]) &#123;<br>            sections = [dataSource numberOfSectionsInCollectionView:collectionView];<br>        &#125;<br>        <br>        <span class="hljs-keyword">if</span> (dataSource &amp;&amp; [dataSource respondsToSelector:<span class="hljs-keyword">@selector</span>(collectionView:numberOfItemsInSection:)]) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">NSInteger</span> section = <span class="hljs-number">0</span>; section &lt; sections; section++) &#123;<br>                items += [dataSource collectionView:collectionView numberOfItemsInSection:section];<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> ( items == <span class="hljs-number">0</span> ) &#123;<br>        [<span class="hljs-keyword">self</span>.superview addSubview:<span class="hljs-keyword">self</span>.noDataView];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        [<span class="hljs-keyword">self</span>.noDataView removeFromSuperview];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><p>äºŒã€ä½¿ç”¨æ–¹æ³•</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs clean">#<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;UIScrollView+WD_NoData.h&quot;</span><br><span class="hljs-comment">// è‡ªå®šä¹‰é¡µé¢</span><br>#<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;WDTestEmptyView.h&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">//ç¤ºä¾‹çš„è§†å›¾</span><br> WDTestEmptyView *view = [<span class="hljs-built_in">NSBundle</span>.mainBundle loadNibNamed:<span class="hljs-string">@&quot;WDTestEmptyView&quot;</span> owner:<span class="hljs-keyword">self</span> options:<span class="hljs-literal">nil</span>].firstObject;<br><span class="hljs-comment">// è®¾ç½®è§†å›¾</span><br><span class="hljs-keyword">self</span>.tableView.noDataView = view;<br></code></pre></td></tr></table></figure><p>ä¸‰ã€æ•ˆæœå›¾</p><p><img src="https://upload-images.jianshu.io/upload_images/3334769-9aecbb692ded171f.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾.gif"></p>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶ï¼šPopMenu</title>
    <link href="/2019/12/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-PopMenu/"/>
    <url>/2019/12/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-PopMenu/</url>
    
    <content type="html"><![CDATA[<p>ç°åœ¨å¾ˆå¤šçš„åº”ç”¨éƒ½æœ‰ç±»ä¼¼çš„å¼¹çª—æ§ä»¶ï¼Œæœ€å‡ºååº”è¯¥æ˜¯ä¼é¹…å’Œå¾®ä¿¡äº†å§ã€‚æƒ³ç€ä¸ºäº†æ»¡è¶³è‡ªå·±çš„æ•ˆæœå°±åŠ¨æ‰‹å†™äº†è¿™ä¸ªã€‚é¦–å…ˆè¦æ„Ÿè°¢å†™å‡ºå¼¹çª—ç®­å¤´çš„ä»£ç çš„äºº<a href="https://github.com/iHandle/BubbleLayer">iHandle</a>ï¼Œè¿™æ–¹é¢çš„çŸ¥è¯†æˆ‘å¾ˆæ¬ ç¼ºï¼Œä»¥åæ‰¾æœºä¼šæ¶è¡¥ä¸€ä¸‹ã€‚<br>å…ˆä¸Šä¸¤å¼ å‡ºåçš„æ•ˆæœå›¾ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/3334769-4581178013f647fe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/375" alt="ğŸ§"></p><p><img src="https://upload-images.jianshu.io/upload_images/3334769-a4a9758369b0cfa6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/375" alt="å¾®ä¿¡"></p><h2 id="æ ·å¼å®šä¹‰"><a href="#æ ·å¼å®šä¹‰" class="headerlink" title="æ ·å¼å®šä¹‰"></a>æ ·å¼å®šä¹‰</h2><p>ä¸»è¦ä»¥UITableViewä½œä¸ºå®¹å™¨æ˜¾ç¤ºæ ·å¼</p><ol><li>èƒŒæ™¯é¢œè‰²</li><li>æ–‡å­—æ ·å¼ï¼šé¢œè‰²ï¼Œå­—ä½“å¤§å°ï¼Œå¯¹é½æ–¹å¼</li><li>æ˜¾ç¤ºç±»å‹ï¼šä»…æ–‡å­—ï¼Œä»…å›¾æ ‡ï¼Œæ–‡å­— + å›¾æ ‡</li><li>æ˜¯å¦æ˜¾ç¤ºä¸‹åˆ’çº¿</li><li>ç®­å¤´æ–¹å‘</li><li>å¼¹çª—å®½åº¦</li><li>å•å…ƒæ ¼çš„é«˜åº¦ </li></ol><h2 id="ç®­å¤´ç”Ÿæˆ"><a href="#ç®­å¤´ç”Ÿæˆ" class="headerlink" title="ç®­å¤´ç”Ÿæˆ"></a>ç®­å¤´ç”Ÿæˆ</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">NS_ENUM</span>(<span class="hljs-built_in">NSInteger</span>, ArrowDirection) &#123;<br>    ArrowDirectionRight = <span class="hljs-number">0</span>,<br>    ArrowDirectionBottom,<br>    ArrowDirectionLeft,<br>    ArrowDirectionTop,<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> CORNER_RADIUS   8   <span class="hljs-comment">// é»˜è®¤çŸ©å½¢æ¡†åœ†è§’åŠå¾„</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ARROW_WIDTH     30  <span class="hljs-comment">// é»˜è®¤ç®­å¤´å®½å¸¦</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ARROW_HEIGHT    12  <span class="hljs-comment">// é»˜è®¤ç®­å¤´é«˜åº¦</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ARROW_DIRECTION 1   <span class="hljs-comment">// é»˜è®¤ç®­å¤´æ–¹å‘ï¼Œå‘ä¸‹</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ARROW_POSITION  0.5 <span class="hljs-comment">// é»˜è®¤ç®­å¤´ç›¸å¯¹ä½ç½®ï¼Œå±…ä¸­</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ARROW_RADIUS    3   <span class="hljs-comment">// é»˜è®¤ç®­å¤´æŒ‡å‘å¤„çš„åœ†è§’åŠå¾„</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WudanLayer</span> : <span class="hljs-title">NSObject</span></span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> cornerRadius;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> arrowRadius;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> arrowHeight;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> arrowWidth;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) ArrowDirection arrowDirection;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> arrowPosition;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGSize</span> size;<br><br>- (<span class="hljs-keyword">instancetype</span>)initWithSize:(<span class="hljs-built_in">CGSize</span>)size;<br>- (<span class="hljs-built_in">CAShapeLayer</span> *)layer;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">WudanLayer</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - preparation</span><br>- (<span class="hljs-built_in">NSMutableArray</span> *)keyPoints &#123;<br>    <span class="hljs-built_in">NSMutableArray</span> *points = [<span class="hljs-built_in">NSMutableArray</span> array];<br>    <span class="hljs-built_in">CGPoint</span> beginPoint;<br>    <span class="hljs-built_in">CGPoint</span> topPoint;<br>    <span class="hljs-built_in">CGPoint</span> endPoint;<br>    <span class="hljs-built_in">CGFloat</span> validWidthForTopPoint = _size.width - <span class="hljs-number">2</span> * _cornerRadius - _arrowWidth;<br>    <span class="hljs-built_in">CGFloat</span> validHeightForTopPoint = _size.height - <span class="hljs-number">2</span> * _cornerRadius - _arrowWidth;<br>    <span class="hljs-built_in">CGFloat</span> x = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">CGFloat</span> width = _size.width, height = _size.height;<br>    <br>    <span class="hljs-keyword">switch</span> (_arrowDirection)<br>    &#123;<br>        <span class="hljs-keyword">case</span> ArrowDirectionRight:<br>        &#123;<br>            width -= _arrowHeight;<br>            topPoint = <span class="hljs-built_in">CGPointMake</span>(_size.width , _size.height / <span class="hljs-number">2</span> + validHeightForTopPoint*(_arrowPosition - <span class="hljs-number">0.5</span>));<br>            beginPoint = <span class="hljs-built_in">CGPointMake</span>(topPoint.x - _arrowHeight, topPoint.y - _arrowWidth/<span class="hljs-number">2</span>);<br>            endPoint = <span class="hljs-built_in">CGPointMake</span>(beginPoint.x, beginPoint.y + _arrowWidth);<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> ArrowDirectionBottom:<br>        &#123;<br>            height -= _arrowHeight;<br>            <br>            topPoint = <span class="hljs-built_in">CGPointMake</span>(_size.width / <span class="hljs-number">2</span> + validWidthForTopPoint*(_arrowPosition - <span class="hljs-number">0.5</span>), _size.height);<br>            beginPoint = <span class="hljs-built_in">CGPointMake</span>(topPoint.x + _arrowWidth/<span class="hljs-number">2</span>, topPoint.y - _arrowHeight);<br>            endPoint = <span class="hljs-built_in">CGPointMake</span>(beginPoint.x - _arrowWidth, beginPoint.y);<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> ArrowDirectionLeft:<br>        &#123;<br>            x = _arrowHeight;<br>            width -= _arrowHeight;<br>            <br>            topPoint = <span class="hljs-built_in">CGPointMake</span>(<span class="hljs-number">0</span>, _size.height / <span class="hljs-number">2</span> + validHeightForTopPoint*(_arrowPosition - <span class="hljs-number">0.5</span>));<br>            beginPoint = <span class="hljs-built_in">CGPointMake</span>(topPoint.x + _arrowHeight, topPoint.y + _arrowWidth/<span class="hljs-number">2</span>);<br>            endPoint = <span class="hljs-built_in">CGPointMake</span>(beginPoint.x, beginPoint.y - _arrowWidth);<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> ArrowDirectionTop:<br>        &#123;<br>            y = _arrowHeight;<br>            height -= _arrowHeight;<br>            <br>            topPoint = <span class="hljs-built_in">CGPointMake</span>(_size.width / <span class="hljs-number">2</span> + validWidthForTopPoint*(_arrowPosition - <span class="hljs-number">0.5</span>), <span class="hljs-number">0</span>);<br>            beginPoint = <span class="hljs-built_in">CGPointMake</span>(topPoint.x - _arrowWidth/<span class="hljs-number">2</span>, topPoint.y + _arrowHeight);<br>            endPoint = <span class="hljs-built_in">CGPointMake</span>(beginPoint.x + _arrowWidth, beginPoint.y);<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <br>    points = [<span class="hljs-built_in">NSMutableArray</span> arrayWithObjects: [<span class="hljs-built_in">NSValue</span> valueWithCGPoint:beginPoint],<br>              [<span class="hljs-built_in">NSValue</span> valueWithCGPoint:topPoint],<br>              [<span class="hljs-built_in">NSValue</span> valueWithCGPoint:endPoint],<br>              <span class="hljs-literal">nil</span>];<br>    <span class="hljs-built_in">CGPoint</span> bottomRight = <span class="hljs-built_in">CGPointMake</span>(x + width, y + height);<br>    <span class="hljs-built_in">CGPoint</span> bottomLeft = <span class="hljs-built_in">CGPointMake</span>(x, y + height);<br>    <span class="hljs-built_in">CGPoint</span> topLeft = <span class="hljs-built_in">CGPointMake</span>(x, y);<br>    <span class="hljs-built_in">CGPoint</span> topRight = <span class="hljs-built_in">CGPointMake</span>(x + width, y);<br>    <span class="hljs-built_in">NSMutableArray</span> *rectPoints = [<span class="hljs-built_in">NSMutableArray</span> arrayWithObjects: [<span class="hljs-built_in">NSValue</span> valueWithCGPoint:bottomRight],<br>                                  [<span class="hljs-built_in">NSValue</span> valueWithCGPoint:bottomLeft],<br>                                  [<span class="hljs-built_in">NSValue</span> valueWithCGPoint:topLeft],<br>                                  [<span class="hljs-built_in">NSValue</span> valueWithCGPoint:topRight],<br>                                  <span class="hljs-literal">nil</span>];<br>    <span class="hljs-keyword">int</span> rectPointIndex = (<span class="hljs-keyword">int</span>)_arrowDirection;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++i) &#123;<br>        [points addObject:[rectPoints objectAtIndex:rectPointIndex]];<br>        rectPointIndex = (rectPointIndex + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> points;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Draw bubblePath</span><br>- (<span class="hljs-built_in">CGPathRef</span>)bubblePath &#123;<br>    <span class="hljs-built_in">UIGraphicsBeginImageContextWithOptions</span>(<span class="hljs-keyword">self</span>.size, <span class="hljs-literal">NO</span>, <span class="hljs-number">0.0</span>);<br>    <span class="hljs-built_in">CGContextRef</span> ctx = <span class="hljs-built_in">UIGraphicsGetCurrentContext</span>();<br>    <span class="hljs-built_in">NSMutableArray</span> *points = [<span class="hljs-keyword">self</span> keyPoints];<br>    <span class="hljs-built_in">CGPoint</span> currentPoint = [[points objectAtIndex:<span class="hljs-number">6</span>] <span class="hljs-built_in">CGPointValue</span>];<br>    <span class="hljs-built_in">CGContextMoveToPoint</span>(ctx, currentPoint.x, currentPoint.y);<br>    <span class="hljs-built_in">CGPoint</span> pointA, pointB;<br>    <span class="hljs-built_in">CGFloat</span> radius;<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">6</span>)<br>            <span class="hljs-keyword">break</span>;<br>        radius = i &lt; <span class="hljs-number">3</span> ?  _arrowRadius : _cornerRadius;<br>        pointA = [[points objectAtIndex:i] <span class="hljs-built_in">CGPointValue</span>];<br>        pointB = [[points objectAtIndex:(i + <span class="hljs-number">1</span>) % <span class="hljs-number">7</span>] <span class="hljs-built_in">CGPointValue</span>];<br>        <span class="hljs-built_in">CGContextAddArcToPoint</span>(ctx, pointA.x, pointA.y, pointB.x, pointB.y, radius);<br>        i = i + <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-built_in">CGContextClosePath</span>(ctx);<br>    <span class="hljs-built_in">CGPathRef</span> path = <span class="hljs-built_in">CGContextCopyPath</span>(ctx);<br>    <span class="hljs-built_in">CGContextRelease</span>(ctx);<br>    <span class="hljs-keyword">return</span> path;<br>&#125;<br><br>- (<span class="hljs-built_in">CAShapeLayer</span> *)layer&#123;<br>    <span class="hljs-built_in">CAShapeLayer</span> *layer = [<span class="hljs-built_in">CAShapeLayer</span> layer];<br>    layer.path = [<span class="hljs-keyword">self</span> bubblePath];<br>    <span class="hljs-keyword">return</span> layer;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Setup</span><br>- (<span class="hljs-keyword">void</span>)setDefaultProperty &#123;<br>    _cornerRadius   = CORNER_RADIUS;<br>    _arrowWidth     = ARROW_WIDTH;<br>    _arrowHeight    = ARROW_HEIGHT;<br>    _arrowDirection = ARROW_DIRECTION;<br>    _arrowPosition  = ARROW_POSITION;<br>    _arrowRadius    = ARROW_RADIUS;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Init</span><br>- (<span class="hljs-keyword">instancetype</span>)initWithSize:(<span class="hljs-built_in">CGSize</span>)size &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> init]) &#123;<br>        [<span class="hljs-keyword">self</span> setDefaultProperty];<br>        _size = size;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><h2 id="å•å…ƒæ ¼é»˜è®¤æ ·å¼"><a href="#å•å…ƒæ ¼é»˜è®¤æ ·å¼" class="headerlink" title="å•å…ƒæ ¼é»˜è®¤æ ·å¼"></a>å•å…ƒæ ¼é»˜è®¤æ ·å¼</h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">NS_ENUM</span>(<span class="hljs-built_in">NSInteger</span>, WDPopMenuType) &#123;<br>    WDPopMenuTypeNormal,<br>    WDPopMenuTypeOnlyTitle,<br>    WDPopMenuTypeOnlyIcon,<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDPopMenuCell</span> : <span class="hljs-title">UITableViewCell</span></span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIImageView</span> *iconImageView;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UILabel</span> *titleLabel;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) WDPopMenuType showType;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">WDPopMenuCell</span></span><br><br>- (<span class="hljs-keyword">instancetype</span>)initWithStyle:(<span class="hljs-built_in">UITableViewCellStyle</span>)style reuseIdentifier:(<span class="hljs-built_in">NSString</span> *)reuseIdentifier &#123;<br>    <span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> initWithStyle:style reuseIdentifier:reuseIdentifier];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) &#123;<br>        [<span class="hljs-keyword">self</span> setupSubViewsProperties];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)setupSubViewsProperties &#123;<br>    <span class="hljs-keyword">self</span>.iconImageView                                           = [[<span class="hljs-built_in">UIImageView</span> alloc] init];<br>    <span class="hljs-keyword">self</span>.iconImageView.contentMode                               = <span class="hljs-built_in">UIViewContentModeScaleAspectFit</span>;<br>    <span class="hljs-keyword">self</span>.iconImageView.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal">NO</span>;<br>    [<span class="hljs-keyword">self</span>.contentView addSubview:<span class="hljs-keyword">self</span>.iconImageView];<br><br>    <span class="hljs-keyword">self</span>.titleLabel                                              = [[<span class="hljs-built_in">UILabel</span> alloc] init];<br>    <span class="hljs-keyword">self</span>.titleLabel.font                                         = [<span class="hljs-built_in">UIFont</span> systemFontOfSize:<span class="hljs-number">15</span>];<br>    <span class="hljs-keyword">self</span>.titleLabel.textColor                                    = [<span class="hljs-built_in">UIColor</span> blackColor];<br>    <span class="hljs-keyword">self</span>.titleLabel.translatesAutoresizingMaskIntoConstraints    = <span class="hljs-literal">NO</span>;<br>    [<span class="hljs-keyword">self</span>.contentView addSubview:<span class="hljs-keyword">self</span>.titleLabel];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)setShowType:(WDPopMenuType)showType &#123;<br>    _showType = showType;<br>    [<span class="hljs-keyword">self</span> setupSubViewsConstraint];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)setTitleLabel:(<span class="hljs-built_in">UILabel</span> *)titleLabel &#123;<br>    _titleLabel = titleLabel;<br>    titleLabel.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal">NO</span>;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)setupSubViewsConstraint &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.showType == WDPopMenuTypeNormal) &#123;<br>        <span class="hljs-keyword">self</span>.titleLabel.textAlignment = <span class="hljs-built_in">NSTextAlignmentLeft</span>;<br>        <br>        [<span class="hljs-keyword">self</span>.contentView addConstraints:@[<br>                                           [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:<span class="hljs-keyword">self</span>.iconImageView attribute:<span class="hljs-built_in">NSLayoutAttributeLeading</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span>.contentView attribute:<span class="hljs-built_in">NSLayoutAttributeLeading</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">15</span>],<br>                                           [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:<span class="hljs-keyword">self</span>.iconImageView attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span>.contentView attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>                                           ]];<br>        <br>        [<span class="hljs-keyword">self</span>.contentView addConstraints:@[<br>                                           [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:<span class="hljs-keyword">self</span>.titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeLeading</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span>.iconImageView attribute:<span class="hljs-built_in">NSLayoutAttributeTrailing</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">10</span>],<br>                                           [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:<span class="hljs-keyword">self</span>.titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span>.contentView attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>                                           ]];<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.showType == WDPopMenuTypeOnlyTitle)&#123;<br>        <span class="hljs-keyword">self</span>.titleLabel.textAlignment = <span class="hljs-built_in">NSTextAlignmentCenter</span>;<br>        [<span class="hljs-keyword">self</span>.contentView addConstraints:@[<br>                                           [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:<span class="hljs-keyword">self</span>.titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span>.contentView attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>                                           [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:<span class="hljs-keyword">self</span>.titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span>.contentView attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>                                           ]];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        [<span class="hljs-keyword">self</span>.contentView addConstraints:@[<br>                                           [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:<span class="hljs-keyword">self</span>.iconImageView attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span>.contentView attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>                                           [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:<span class="hljs-keyword">self</span>.iconImageView attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span>.contentView attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>                                           ]];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><h2 id="æ¥å£ä»£ç "><a href="#æ¥å£ä»£ç " class="headerlink" title="æ¥å£ä»£ç "></a>æ¥å£ä»£ç </h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDPopMenu</span> : <span class="hljs-title">UIView</span></span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *titles;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *iconImageNames;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> ä»…æ˜¾ç¤ºå›¾æ ‡ + é»˜è®¤æ ·å¼</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment"> @param iconImageNames å›¾æ ‡æ•°ç»„</span><br><span class="hljs-comment"> @param position åˆå§‹ä½ç½®</span><br><span class="hljs-comment"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="hljs-comment"> */</span><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)iconImageNames<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> ä»…æ˜¾ç¤ºå›¾æ ‡ + é»˜è®¤æ ·å¼</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment"> @param iconImageNames å›¾æ ‡æ•°ç»„</span><br><span class="hljs-comment"> @param position åˆå§‹ä½ç½®</span><br><span class="hljs-comment"> @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿</span><br><span class="hljs-comment"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="hljs-comment"> */</span><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)iconImageNames<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                    needSeparatorLine:(<span class="hljs-built_in">BOOL</span>)isNeedSeparatorLine<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete;<br><br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> ä»…æ˜¾ç¤ºæ ‡é¢˜ + é»˜è®¤æ ·å¼</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment"> @param titles æ ‡é¢˜æ•°ç»„</span><br><span class="hljs-comment"> @param position åˆå§‹ä½ç½®</span><br><span class="hljs-comment"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="hljs-comment"> */</span><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithTitles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)titles<br>               originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>         selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> ä»…æ˜¾ç¤ºæ ‡é¢˜ + é»˜è®¤æ ·å¼</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment"> @param titles æ ‡é¢˜æ•°ç»„</span><br><span class="hljs-comment"> @param position åˆå§‹ä½ç½®</span><br><span class="hljs-comment"> @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿</span><br><span class="hljs-comment"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="hljs-comment"> */</span><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithTitles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)titles<br>               originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>            needSeparatorLine:(<span class="hljs-built_in">BOOL</span>)isNeedSeparatorLine<br>         selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete;<br><br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> æ˜¾ç¤ºæ–‡å­—å’Œå›¾æ ‡ + é»˜è®¤æ ·å¼</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment"> @param iconImageNames å›¾æ ‡æ•°ç»„</span><br><span class="hljs-comment"> @param titles æ ‡é¢˜æ•°ç»„</span><br><span class="hljs-comment"> @param position åˆå§‹ä½ç½®</span><br><span class="hljs-comment"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="hljs-comment"> */</span><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)iconImageNames<br>                               titles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)titles<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> æ˜¾ç¤ºæ–‡å­—å’Œå›¾æ ‡ + é»˜è®¤æ ·å¼</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment"> @param iconImageNames å›¾æ ‡æ•°ç»„</span><br><span class="hljs-comment"> @param titles æ ‡é¢˜æ•°ç»„</span><br><span class="hljs-comment"> @param position åˆå§‹ä½ç½®</span><br><span class="hljs-comment"> @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿</span><br><span class="hljs-comment"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="hljs-comment"> */</span><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)iconImageNames<br>                               titles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)titles<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                    needSeparatorLine:(<span class="hljs-built_in">BOOL</span>)isNeedSeparatorLine<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete;<br><br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> å¯é€‰æ˜¾ç¤ºå›¾æ ‡ã€æ ‡é¢˜</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment"> @param iconImageNames å›¾ç‰‡æ•°ç»„ å¯ä»¥ä¸ºç©º</span><br><span class="hljs-comment"> @param titles æ ‡é¢˜æ•°ç»„ å¯ä»¥ä¸ºç©º</span><br><span class="hljs-comment"> @param position åˆå§‹ä½ç½®</span><br><span class="hljs-comment"> @param height å•ä¸ªitemé«˜åº¦ é»˜è®¤ä¸º45</span><br><span class="hljs-comment"> @param width æ˜¾ç¤ºViewçš„é«˜åº¦ é»˜è®¤ä¸ºå±å¹•å®½åº¦çš„ä¸€åŠ</span><br><span class="hljs-comment"> @param color æ˜¾ç¤ºViewçš„èƒŒæ™¯é¢œè‰²</span><br><span class="hljs-comment"> @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿</span><br><span class="hljs-comment"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="hljs-comment"> */</span><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)iconImageNames<br>                               titles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)titles<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                         heightOfItem:(<span class="hljs-built_in">CGFloat</span>)height<br>                          widthOfView:(<span class="hljs-built_in">CGFloat</span>)width<br>                backgroundColorOfView:(<span class="hljs-built_in">UIColor</span> *)color<br>                    needSeparatorLine:(<span class="hljs-built_in">BOOL</span>)isNeedSeparatorLine<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete;<br><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> å¯é€‰æ˜¾ç¤ºå›¾æ ‡ã€æ ‡é¢˜</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment"> @param iconImageNames å›¾ç‰‡æ•°ç»„ å¯ä»¥ä¸ºç©º</span><br><span class="hljs-comment"> @param titles æ ‡é¢˜æ•°ç»„ å¯ä»¥ä¸ºç©º</span><br><span class="hljs-comment"> @param position åˆå§‹ä½ç½®</span><br><span class="hljs-comment"> @param height å•ä¸ªitemé«˜åº¦ é»˜è®¤ä¸º45</span><br><span class="hljs-comment"> @param width æ˜¾ç¤ºViewçš„é«˜åº¦ é»˜è®¤ä¸ºå±å¹•å®½åº¦çš„ä¸€åŠ</span><br><span class="hljs-comment"> @param color æ˜¾ç¤ºViewçš„èƒŒæ™¯é¢œè‰²</span><br><span class="hljs-comment"> @param isNeedSeparatorLine æ˜¯å¦æ˜¾ç¤ºåˆ†å‰²çº¿</span><br><span class="hljs-comment"> @param titleLabel è‡ªå®šä¹‰Itemçš„Labelæ ·å¼</span><br><span class="hljs-comment"> @param complete ç‚¹å‡»å›è°ƒ</span><br><span class="hljs-comment"> */</span><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)iconImageNames<br>                               titles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)titles<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                         heightOfItem:(<span class="hljs-built_in">CGFloat</span>)height<br>                          widthOfView:(<span class="hljs-built_in">CGFloat</span>)width<br>                backgroundColorOfView:(<span class="hljs-built_in">UIColor</span> *)color<br>                     titleLabelOfItem:(<span class="hljs-built_in">UILabel</span> * _Nullable)titleLabel<br>                    needSeparatorLine:(<span class="hljs-built_in">BOOL</span>)isNeedSeparatorLine<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br></code></pre></td></tr></table></figure><h2 id="å®ç°ä»£ç "><a href="#å®ç°ä»£ç " class="headerlink" title="å®ç°ä»£ç "></a>å®ç°ä»£ç </h2><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WD_SCREEN_WIDTH ([[UIScreen mainScreen] bounds].size.width)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> WD_SCREEN_HEIGHT ([[UIScreen mainScreen] bounds].size.height)</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDPopMenu</span> () &lt;<span class="hljs-title">UITableViewDataSource</span>, <span class="hljs-title">UITableViewDelegate</span>&gt;</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) <span class="hljs-keyword">void</span> (^selectedItemComplete)(<span class="hljs-built_in">NSInteger</span> currentIndex);<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIView</span> *backgroundView;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UITableView</span> *tableView;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UILabel</span> *titleLabel;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> viewWidth;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> itemHeight;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGPoint</span> beginPosition;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIColor</span> *cellColor;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>, <span class="hljs-keyword">readwrite</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *titles;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>, <span class="hljs-keyword">readwrite</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *iconImageNames;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">WDPopMenu</span></span><br><br>- (<span class="hljs-keyword">instancetype</span>)init &#123;<br>    <span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> init];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) &#123;<br>        [<span class="hljs-keyword">self</span> addSubview:<span class="hljs-keyword">self</span>.tableView];<br>        <span class="hljs-built_in">UITapGestureRecognizer</span> *tap = [[<span class="hljs-built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(backgroundTappedTarget:)];<br>        [<span class="hljs-keyword">self</span>.backgroundView addGestureRecognizer:tap];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)iconImageNames<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete &#123;<br>    <br>    [<span class="hljs-keyword">self</span> showPopMenuWithIconImageNames:iconImageNames<br>                         originPosition:position<br>                      needSeparatorLine:<span class="hljs-literal">YES</span><br>                   selectedItemComplete:complete];<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)iconImageNames<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                    needSeparatorLine:(<span class="hljs-built_in">BOOL</span>)isNeedSeparatorLine<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete &#123;<br>    <br>    [<span class="hljs-keyword">self</span> showPopMenuWithIconImageNames:iconImageNames<br>                                 titles:<span class="hljs-literal">nil</span><br>                         originPosition:position<br>                      needSeparatorLine:isNeedSeparatorLine<br>                   selectedItemComplete:complete];<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithTitles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)titles<br>               originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>         selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete &#123;<br>    <br>    [<span class="hljs-keyword">self</span> showPopMenuWithTitles:titles<br>                 originPosition:position<br>              needSeparatorLine:<span class="hljs-literal">YES</span><br>           selectedItemComplete:complete];<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithTitles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)titles<br>               originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>            needSeparatorLine:(<span class="hljs-built_in">BOOL</span>)isNeedSeparatorLine<br>         selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete &#123;<br>    <br>    [<span class="hljs-keyword">self</span> showPopMenuWithIconImageNames:<span class="hljs-literal">nil</span><br>                                 titles:titles<br>                         originPosition:position<br>                      needSeparatorLine:isNeedSeparatorLine<br>                   selectedItemComplete:complete];<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)iconImageNames<br>                               titles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)titles<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete &#123;<br>    <br>    [<span class="hljs-keyword">self</span> showPopMenuWithIconImageNames:iconImageNames<br>                                 titles:titles<br>                         originPosition:position<br>                      needSeparatorLine:<span class="hljs-literal">YES</span><br>                   selectedItemComplete:complete];<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)iconImageNames<br>                               titles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)titles<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                    needSeparatorLine:(<span class="hljs-built_in">BOOL</span>)isNeedSeparatorLine<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete &#123;<br>    <br>    [<span class="hljs-keyword">self</span> showPopMenuWithIconImageNames:iconImageNames<br>                                 titles:titles<br>                         originPosition:position<br>                           heightOfItem:<span class="hljs-number">0</span><br>                            widthOfView:<span class="hljs-number">0</span><br>                  backgroundColorOfView:[<span class="hljs-built_in">UIColor</span> whiteColor]<br>                      needSeparatorLine:isNeedSeparatorLine<br>                   selectedItemComplete:complete];<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)iconImageNames<br>                               titles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)titles<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                         heightOfItem:(<span class="hljs-built_in">CGFloat</span>)height<br>                          widthOfView:(<span class="hljs-built_in">CGFloat</span>)width<br>                backgroundColorOfView:(<span class="hljs-built_in">UIColor</span> *)color<br>                    needSeparatorLine:(<span class="hljs-built_in">BOOL</span>)isNeedSeparatorLine<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete &#123;<br>    <br>    [<span class="hljs-keyword">self</span> showPopMenuWithIconImageNames:iconImageNames<br>                                 titles:titles<br>                         originPosition:position<br>                           heightOfItem:height<br>                            widthOfView:width<br>                  backgroundColorOfView:color<br>                       titleLabelOfItem:<span class="hljs-literal">nil</span><br>                      needSeparatorLine:isNeedSeparatorLine<br>                   selectedItemComplete:complete];<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showPopMenuWithIconImageNames:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)iconImageNames<br>                               titles:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * _Nullable)titles<br>                       originPosition:(<span class="hljs-built_in">CGPoint</span>)position<br>                         heightOfItem:(<span class="hljs-built_in">CGFloat</span>)height<br>                          widthOfView:(<span class="hljs-built_in">CGFloat</span>)width<br>                backgroundColorOfView:(<span class="hljs-built_in">UIColor</span> *)color<br>                     titleLabelOfItem:(<span class="hljs-built_in">UILabel</span> * _Nullable)titleLabel<br>                    needSeparatorLine:(<span class="hljs-built_in">BOOL</span>)isNeedSeparatorLine<br>                 selectedItemComplete:(<span class="hljs-keyword">void</span>(^)(<span class="hljs-built_in">NSInteger</span> currentIndex))complete &#123;<br>    <br>    WDPopMenu *v                = [[WDPopMenu alloc] init];<br>    v.iconImageNames            = iconImageNames;<br>    v.titles                    = titles;<br>    v.beginPosition             = position;<br>    v.itemHeight                = height == <span class="hljs-number">0</span> ? <span class="hljs-number">45</span> : height;<br>    v.viewWidth                 = width == <span class="hljs-number">0</span> ? [[<span class="hljs-built_in">UIScreen</span> mainScreen] bounds].size.width / <span class="hljs-number">2</span> : width;<br>    v.tableView.backgroundColor = color;<br>    v.cellColor                 = color;<br>    v.titleLabel                = titleLabel;<br>    v.selectedItemComplete      = complete;<br>    v.tableView.rowHeight       = v.itemHeight;<br>    <span class="hljs-keyword">if</span> (isNeedSeparatorLine) &#123;<br>        v.tableView.separatorStyle  = <span class="hljs-built_in">UITableViewCellSeparatorStyleSingleLine</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        v.tableView.separatorStyle  = <span class="hljs-built_in">UITableViewCellSeparatorStyleNone</span>;<br>    &#125;<br>    [v.tableView reloadData];<br>    [v showView];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)backgroundTappedTarget:(<span class="hljs-keyword">id</span>)sender &#123;<br>    [<span class="hljs-keyword">self</span> hidenView];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)showView &#123;<br>    [[[<span class="hljs-built_in">UIApplication</span> sharedApplication] keyWindow] addSubview:<span class="hljs-keyword">self</span>.backgroundView];<br>    [[[<span class="hljs-built_in">UIApplication</span> sharedApplication] keyWindow] addSubview:<span class="hljs-keyword">self</span>];<br>    [<span class="hljs-keyword">self</span> setupViewAndArrowShape];<br>    [<span class="hljs-keyword">self</span> showAnimation];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)setupViewAndArrowShape &#123;<br>    <span class="hljs-built_in">CGRect</span> toFrame = <span class="hljs-built_in">CGRectZero</span>;<br>    toFrame.size.width = <span class="hljs-keyword">self</span>.viewWidth;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.iconImageNames.count == <span class="hljs-number">0</span> || <span class="hljs-keyword">self</span>.iconImageNames == <span class="hljs-literal">nil</span>) &#123;<br>        toFrame.size.height = <span class="hljs-keyword">self</span>.itemHeight * <span class="hljs-keyword">self</span>.titles.count + <span class="hljs-number">15</span>;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.titles == <span class="hljs-literal">nil</span> || <span class="hljs-keyword">self</span>.titles.count == <span class="hljs-number">0</span>) &#123;<br>        toFrame.size.height = <span class="hljs-keyword">self</span>.itemHeight * <span class="hljs-keyword">self</span>.iconImageNames.count + <span class="hljs-number">15</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        toFrame.size.height = <span class="hljs-keyword">self</span>.itemHeight * <span class="hljs-keyword">self</span>.titles.count + <span class="hljs-number">15</span>;<br>    &#125;<br>    <br>    WudanLayer *bbLayer = [[WudanLayer alloc] initWithSize:toFrame.size];<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.beginPosition.x + <span class="hljs-keyword">self</span>.viewWidth / <span class="hljs-number">2</span> &gt; WD_SCREEN_WIDTH) &#123;<br>        toFrame.origin.x = WD_SCREEN_WIDTH - <span class="hljs-number">10</span> - <span class="hljs-keyword">self</span>.viewWidth;<br>        bbLayer.arrowDirection = ArrowDirectionTop;<br>        bbLayer.arrowPosition = (<span class="hljs-keyword">self</span>.beginPosition.x - toFrame.origin.x + <span class="hljs-number">15</span>) / <span class="hljs-keyword">self</span>.viewWidth;<br>        <span class="hljs-keyword">self</span>.layer.anchorPoint = <span class="hljs-built_in">CGPointMake</span>(bbLayer.arrowPosition, <span class="hljs-number">0</span>);<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.beginPosition.x - <span class="hljs-keyword">self</span>.viewWidth / <span class="hljs-number">2</span> &lt; <span class="hljs-number">0</span>)&#123;<br>        toFrame.origin.x = <span class="hljs-number">10</span>;<br>        bbLayer.arrowDirection = ArrowDirectionTop;<br>        bbLayer.arrowPosition = (<span class="hljs-keyword">self</span>.beginPosition.x - toFrame.origin.x - <span class="hljs-number">15</span>) / <span class="hljs-keyword">self</span>.viewWidth;<br>        <span class="hljs-keyword">self</span>.layer.anchorPoint = <span class="hljs-built_in">CGPointMake</span>(bbLayer.arrowPosition, <span class="hljs-number">0</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        toFrame.origin.x = <span class="hljs-keyword">self</span>.beginPosition.x - <span class="hljs-keyword">self</span>.viewWidth / <span class="hljs-number">2</span>;<br>        bbLayer.arrowDirection = ArrowDirectionTop;<br>        bbLayer.arrowPosition = (<span class="hljs-keyword">self</span>.beginPosition.x - toFrame.origin.x) / <span class="hljs-keyword">self</span>.viewWidth;<br>        <span class="hljs-keyword">self</span>.layer.anchorPoint = <span class="hljs-built_in">CGPointMake</span>(bbLayer.arrowPosition, <span class="hljs-number">0</span>);<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.beginPosition.y + toFrame.size.height &gt; WD_SCREEN_HEIGHT) &#123;<br>        toFrame.origin.y = <span class="hljs-keyword">self</span>.beginPosition.y - toFrame.size.height - <span class="hljs-number">15</span>;<br>        bbLayer.arrowDirection = ArrowDirectionBottom;<br>        <span class="hljs-keyword">self</span>.layer.anchorPoint = <span class="hljs-built_in">CGPointMake</span>(bbLayer.arrowPosition, <span class="hljs-number">1</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        toFrame.origin.y = <span class="hljs-keyword">self</span>.beginPosition.y + <span class="hljs-number">15</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">self</span>.tableView.frame = <span class="hljs-built_in">CGRectZero</span>;<br>    <span class="hljs-keyword">self</span>.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-keyword">self</span>.beginPosition.x, <span class="hljs-keyword">self</span>.beginPosition.y, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">self</span>.alpha = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">self</span>.frame = toFrame;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.beginPosition.y + toFrame.size.height &gt; WD_SCREEN_HEIGHT) &#123;<br>        <span class="hljs-keyword">self</span>.tableView.contentInset = <span class="hljs-built_in">UIEdgeInsetsZero</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">self</span>.tableView.contentInset = <span class="hljs-built_in">UIEdgeInsetsMake</span>(<span class="hljs-number">15</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">self</span>.tableView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, toFrame.size.width, toFrame.size.height);<br>    <br>    bbLayer.cornerRadius = <span class="hljs-number">8</span>;<br>    bbLayer.arrowHeight = <span class="hljs-number">15</span>;<br>    bbLayer.arrowWidth = <span class="hljs-number">30</span>;<br>    bbLayer.arrowRadius = <span class="hljs-number">0</span>;<br>    [<span class="hljs-keyword">self</span>.layer setMask:[bbLayer layer]];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)showAnimation &#123;<br>    <span class="hljs-keyword">self</span>.layer.affineTransform = <span class="hljs-built_in">CGAffineTransformMakeScale</span>(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>);<br>    [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.35</span> animations:^&#123;<br>        <span class="hljs-keyword">self</span>.backgroundView.backgroundColor = [<span class="hljs-built_in">UIColor</span> colorWithWhite:<span class="hljs-number">0</span> alpha:<span class="hljs-number">0.1</span>];<br>        <span class="hljs-keyword">self</span>.alpha = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">self</span>.layer.affineTransform = <span class="hljs-built_in">CGAffineTransformIdentity</span>;<br>    &#125;];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)hidenView &#123;<br>    [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.35</span> animations:^&#123;<br>        <span class="hljs-keyword">self</span>.alpha = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">self</span>.layer.affineTransform = <span class="hljs-built_in">CGAffineTransformMakeScale</span>(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>);<br>        <span class="hljs-keyword">self</span>.backgroundView.backgroundColor = [<span class="hljs-built_in">UIColor</span> colorWithWhite:<span class="hljs-number">0</span> alpha:<span class="hljs-number">0</span>];<br>    &#125; completion:^(<span class="hljs-built_in">BOOL</span> finished) &#123;<br>        [<span class="hljs-keyword">self</span> removeFromSuperview];<br>        <span class="hljs-keyword">self</span>.layer.affineTransform = <span class="hljs-built_in">CGAffineTransformIdentity</span>;<br>        [<span class="hljs-keyword">self</span>.backgroundView removeFromSuperview];<br>    &#125;];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - UITableView DataSource Method</span><br>- (<span class="hljs-built_in">NSInteger</span>)tableView:(<span class="hljs-built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="hljs-built_in">NSInteger</span>)section &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.titles.count &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.titles.count;<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.iconImageNames.count &gt; <span class="hljs-number">0</span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.iconImageNames.count;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br>- (<span class="hljs-built_in">UITableViewCell</span> *)tableView:(<span class="hljs-built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="hljs-built_in">NSIndexPath</span> *)indexPath &#123;<br>    WDPopMenuCell *cell = [tableView dequeueReusableCellWithIdentifier:<span class="hljs-string">@&quot;WDPopMenuCell&quot;</span>];<br>    <span class="hljs-keyword">if</span> (!cell) &#123;<br>        cell = [[WDPopMenuCell alloc] initWithStyle:<span class="hljs-built_in">UITableViewCellStyleDefault</span> reuseIdentifier:<span class="hljs-string">@&quot;WDPopMenuCell&quot;</span>];<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.iconImageNames.count == <span class="hljs-number">0</span> || <span class="hljs-keyword">self</span>.iconImageNames == <span class="hljs-literal">nil</span>) &#123;<br>        cell.showType = WDPopMenuTypeOnlyTitle;<br>        cell.titleLabel.text = <span class="hljs-keyword">self</span>.titles[indexPath.row];<br>        <br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.titles == <span class="hljs-literal">nil</span> || <span class="hljs-keyword">self</span>.titles.count == <span class="hljs-number">0</span>) &#123;<br>        cell.showType = WDPopMenuTypeOnlyIcon;<br>        cell.iconImageView.image = [<span class="hljs-built_in">UIImage</span> imageNamed:<span class="hljs-keyword">self</span>.iconImageNames[indexPath.row]];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        cell.showType = WDPopMenuTypeNormal;<br>        cell.iconImageView.image = [<span class="hljs-built_in">UIImage</span> imageNamed:<span class="hljs-keyword">self</span>.iconImageNames[indexPath.row]];<br>        cell.titleLabel.text = <span class="hljs-keyword">self</span>.titles[indexPath.row];<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.titleLabel) &#123;<br>        cell.titleLabel.textColor = <span class="hljs-keyword">self</span>.titleLabel.textColor;<br>        cell.titleLabel.textAlignment = <span class="hljs-keyword">self</span>.titleLabel.textAlignment;<br>        cell.titleLabel.font = <span class="hljs-keyword">self</span>.titleLabel.font;<br>    &#125;<br>    <br>    cell.contentView.backgroundColor = <span class="hljs-keyword">self</span>.cellColor;<br>    <br>    <span class="hljs-keyword">if</span> (indexPath.row == [tableView numberOfRowsInSection:indexPath.section] - <span class="hljs-number">1</span>) &#123;<br>        cell.separatorInset = <span class="hljs-built_in">UIEdgeInsetsMake</span>(<span class="hljs-number">0</span>, <span class="hljs-keyword">self</span>.bounds.size.width, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        cell.separatorInset = <span class="hljs-built_in">UIEdgeInsetsMake</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> cell;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - UITableView Delegate Method</span><br>- (<span class="hljs-keyword">void</span>)tableView:(<span class="hljs-built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="hljs-built_in">NSIndexPath</span> *)indexPath &#123;<br>    [tableView deselectRowAtIndexPath:indexPath animated:<span class="hljs-literal">YES</span>];<br>    [<span class="hljs-keyword">self</span> hidenView];<br>    <span class="hljs-keyword">self</span>.selectedItemComplete(indexPath.row);<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Setter</span><br>- (<span class="hljs-built_in">UITableView</span> *)tableView &#123;<br>    <span class="hljs-keyword">if</span> (!_tableView) &#123;<br>        _tableView                 = [[<span class="hljs-built_in">UITableView</span> alloc] initWithFrame:<span class="hljs-built_in">CGRectZero</span> style:<span class="hljs-built_in">UITableViewStylePlain</span>];<br>        _tableView.tableFooterView = [[<span class="hljs-built_in">UIView</span> alloc] init];<br>        _tableView.dataSource      = <span class="hljs-keyword">self</span>;<br>        _tableView.delegate        = <span class="hljs-keyword">self</span>;<br>        _tableView.scrollEnabled   = <span class="hljs-literal">NO</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> _tableView;<br>&#125;<br><br>- (<span class="hljs-built_in">UIView</span> *)backgroundView &#123;<br>    <span class="hljs-keyword">if</span> (!_backgroundView) &#123;<br>        _backgroundView = [[<span class="hljs-built_in">UIView</span> alloc] initWithFrame:[[<span class="hljs-built_in">UIScreen</span> mainScreen] bounds]];<br>    &#125;<br>    <span class="hljs-keyword">return</span> _backgroundView;<br>&#125;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><h2 id="å®ç°æ•ˆæœå›¾"><a href="#å®ç°æ•ˆæœå›¾" class="headerlink" title="å®ç°æ•ˆæœå›¾"></a>å®ç°æ•ˆæœå›¾</h2><p><img src="https://upload-images.jianshu.io/upload_images/3334769-31da61cc372f13af.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾"></p>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶ï¼šè‡ªå®šä¹‰åˆ†ç±»ä¸‹æ‹‰</title>
    <link href="/2019/11/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E7%B1%BB%E4%B8%8B%E6%8B%89/"/>
    <url>/2019/11/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E7%B1%BB%E4%B8%8B%E6%8B%89/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-3e146d3a49636e88.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="å®å„¿å§é•‡æ¥¼"></p><p>æœ€è¿‘è‡ªç”±æ—¶é—´æœ‰ç‚¹å¤šï¼Œå°±å¼€å§‹æ’¸æ§ä»¶ã€‚è¿™ä¸ªæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ä¸ªä¸‹æ‹‰åˆ†ç±»æ§ä»¶ï¼Œçœ‹äº†å¾ˆå¤šåˆ«äººå†™çš„ï¼Œéƒ½æ˜¯ç”¨TableViewæˆ–è€…CollectionViewæ•´åˆåœ¨ä¸€èµ·çš„æ„Ÿè§‰è‡ªå®šä¹‰æ€§æ²¡æœ‰é‚£ä¹ˆå¼ºï¼Œæ‰€ä»¥å°±å°è¯•ç”¨æŠŠTableViewå’ŒCollectionViewæ›¿æ¢æˆUIViewControllerã€‚å…¶ä»–åºŸè¯ä¸å¤šè¯´äº†ã€‚</p><h4 id="1ã€-æ¥å£æ–‡ä»¶"><a href="#1ã€-æ¥å£æ–‡ä»¶" class="headerlink" title="1ã€ æ¥å£æ–‡ä»¶"></a>1ã€ æ¥å£æ–‡ä»¶</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span><br><br><span class="hljs-built_in">UIKIT_EXTERN</span> <span class="hljs-built_in">NSString</span> *lzDropViewNotification;<br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">LZDropView</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">@protocol</span> <span class="hljs-title">LZDropViewDataSource</span> &lt;<span class="hljs-title">NSObject</span>&gt;</span><br><br><span class="hljs-keyword">@required</span><br><br><span class="hljs-comment">/** Height corresponding to controller display */</span><br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSNumber</span> *&gt; *)setupCategoryControllerHeightInDropView:(LZDropView *)dropView;<br><span class="hljs-comment">/** Title corresponding controller array */</span><br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">UIViewController</span> *&gt; *)setupCategoryControllerInDropView:(LZDropView *)dropView;<br><span class="hljs-comment">/** Default display of Title Array */</span><br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)setupCategoryTitleNameInDropView:(LZDropView *)dropView;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@protocol</span> <span class="hljs-title">LZDropViewDelegate</span> &lt;<span class="hljs-title">NSObject</span>&gt;</span><br><br><span class="hljs-comment">/** Click the column and select the information. */</span><br>- (<span class="hljs-keyword">void</span>)dropView:(LZDropView *)dropView didSelectAtColumn:(<span class="hljs-built_in">NSInteger</span>)column info:(<span class="hljs-built_in">NSString</span> *)info;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">LZDropView</span> : <span class="hljs-title">UIView</span></span><br><span class="hljs-comment">/** Simple page configuration */</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">weak</span>) <span class="hljs-keyword">id</span> &lt;LZDropViewDataSource&gt; dataSorce;<br><span class="hljs-comment">/** Click proxy event&lt;##&gt; */</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">weak</span>) <span class="hljs-keyword">id</span> &lt;LZDropViewDelegate&gt; delegate;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br></code></pre></td></tr></table></figure><h4 id="2ã€-å®ç°æ–‡ä»¶"><a href="#2ã€-å®ç°æ–‡ä»¶" class="headerlink" title="2ã€ å®ç°æ–‡ä»¶"></a>2ã€ å®ç°æ–‡ä»¶</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;LZDropView.h&quot;</span></span><br><br><span class="hljs-built_in">NSString</span> *lzDropViewNotification = <span class="hljs-string">@&quot;nitification&quot;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">LZDropView</span> ()</span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">UIViewController</span> *&gt; *controllerArray;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *titleArray;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIButton</span> *containerView;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSNumber</span> *&gt; *controllerHeightArray;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">NSMutableArray</span>&lt;<span class="hljs-built_in">UIButton</span> *&gt; *buttonArray;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">LZDropView</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Release memory</span><br><br>- (<span class="hljs-keyword">void</span>)dealloc &#123;<br>    [[<span class="hljs-built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="hljs-keyword">self</span>];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Initialization</span><br><br>- (<span class="hljs-keyword">instancetype</span>)init &#123;<br>    <span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> init];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) &#123;<br>        [[<span class="hljs-built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="hljs-keyword">self</span> selector:<span class="hljs-keyword">@selector</span>(notificationAction:) name:lzDropViewNotification object:<span class="hljs-literal">nil</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Draw the page</span><br><br>- (<span class="hljs-keyword">void</span>)setupTitleButton:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)array &#123;<br>    <span class="hljs-built_in">CGFloat</span> width = <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width / array.count;<br>    <span class="hljs-keyword">self</span>.buttonArray = [<span class="hljs-built_in">NSMutableArray</span> array];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">NSString</span> *name <span class="hljs-keyword">in</span> array) &#123;<br>        <span class="hljs-built_in">NSInteger</span> index = [array indexOfObject:name];<br>        <span class="hljs-built_in">UIButton</span> *button = [<span class="hljs-built_in">UIButton</span> buttonWithType:<span class="hljs-built_in">UIButtonTypeCustom</span>];<br>        button.titleLabel.font = [<span class="hljs-built_in">UIFont</span> systemFontOfSize:<span class="hljs-number">15</span>];<br>        [button setTitle:[<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%@ â–¼&quot;</span>, name] forState:<span class="hljs-built_in">UIControlStateNormal</span>];<br>        [button setTitle:[<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%@ â–²&quot;</span>, name] forState:<span class="hljs-built_in">UIControlStateSelected</span>];<br>        [button setTitleColor:<span class="hljs-built_in">UIColor</span>.grayColor forState:<span class="hljs-built_in">UIControlStateNormal</span>];<br>        [button setTitleColor:<span class="hljs-built_in">UIColor</span>.orangeColor forState:<span class="hljs-built_in">UIControlStateSelected</span>];<br>        button.frame = <span class="hljs-built_in">CGRectMake</span>(width * index, <span class="hljs-number">0</span>, width, <span class="hljs-number">45</span>);<br>        button.tag = index + <span class="hljs-number">1000</span>;<br>        [button addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(buttonTouched:) forControlEvents:<span class="hljs-built_in">UIControlEventTouchUpInside</span>];<br>        [<span class="hljs-keyword">self</span> addSubview:button];<br>        [<span class="hljs-keyword">self</span>.buttonArray addObject:button];<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Button click event</span><br><br>- (<span class="hljs-keyword">void</span>)buttonTouched:(<span class="hljs-built_in">UIButton</span> *)sender &#123;<br>    <span class="hljs-keyword">if</span> (sender.selected) &#123;<br>        [<span class="hljs-keyword">self</span> closeControllerView];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        [<span class="hljs-keyword">self</span> openControllerViewWithButton:sender];<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)backButtonTouched:(<span class="hljs-built_in">UIButton</span> *)sender &#123;<br>    [<span class="hljs-keyword">self</span> closeControllerView];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Notification event</span><br><br>- (<span class="hljs-keyword">void</span>)notificationAction:(<span class="hljs-built_in">NSNotification</span> *)notification &#123;    <br>    <span class="hljs-keyword">if</span> (![<span class="hljs-keyword">self</span>.controllerArray containsObject:notification.object]) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-built_in">NSInteger</span> index = [<span class="hljs-keyword">self</span>.controllerArray indexOfObject:notification.object];<br>    <span class="hljs-built_in">UIButton</span> *button = <span class="hljs-keyword">self</span>.buttonArray[index];<br>    [button setTitle:[<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%@ â–¼&quot;</span>, notification.userInfo.allValues.firstObject] forState:<span class="hljs-built_in">UIControlStateNormal</span>];<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(dropView:didSelectAtColumn:info:)]) &#123;<br>        [<span class="hljs-keyword">self</span>.delegate dropView:<span class="hljs-keyword">self</span> didSelectAtColumn:index info:notification.userInfo.allValues.firstObject];<br>    &#125;<br>    <br>    [<span class="hljs-keyword">self</span> closeControllerView];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Close all controllers.</span><br><br>- (<span class="hljs-keyword">void</span>)closeControllerView &#123;<br>    <br>    [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.8</span> animations:^&#123;<br>        <span class="hljs-keyword">self</span>.containerView.alpha = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">self</span>.containerView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">CGRectGetMaxY</span>(<span class="hljs-keyword">self</span>.frame), <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, <span class="hljs-number">0</span>);<br>    &#125; completion:^(<span class="hljs-built_in">BOOL</span> finished) &#123;<br>        [<span class="hljs-keyword">self</span>.containerView removeFromSuperview];<br>    &#125;];<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">UIButton</span> *button <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.buttonArray) &#123;<br>        button.selected = <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Open the corresponding controller.</span><br><br>- (<span class="hljs-keyword">void</span>)openControllerViewWithButton:(<span class="hljs-built_in">UIButton</span> *)sender &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">UIButton</span> *button <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.buttonArray) &#123;<br>        button.selected = <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">self</span>.containerView.alpha = <span class="hljs-number">1</span>;<br>    <br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">UIView</span> *view <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.containerView.subviews) &#123;<br>        [view removeFromSuperview];<br>    &#125;<br>    <br>    <span class="hljs-built_in">UIViewController</span> *vc = <span class="hljs-keyword">self</span>.controllerArray[sender.tag - <span class="hljs-number">1000</span>];<br>    <span class="hljs-keyword">double</span> vcHeight = [<span class="hljs-keyword">self</span>.controllerHeightArray[sender.tag - <span class="hljs-number">1000</span>] doubleValue];<br>    <br>    <span class="hljs-keyword">self</span>.containerView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">CGRectGetMaxY</span>(<span class="hljs-keyword">self</span>.frame), <span class="hljs-keyword">self</span>.frame.size.width, <span class="hljs-number">0</span>);<br>    vc.view.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, <span class="hljs-number">0</span>);<br>    [<span class="hljs-keyword">self</span>.superview addSubview:<span class="hljs-keyword">self</span>.containerView];<br>    [<span class="hljs-keyword">self</span>.containerView addSubview:vc.view];<br>    <br>    [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.6</span> animations:^&#123;<br>        <span class="hljs-keyword">self</span>.containerView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">CGRectGetMaxY</span>(<span class="hljs-keyword">self</span>.frame), <span class="hljs-keyword">self</span>.frame.size.width, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.height);<br>        vc.view.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, vcHeight);<br>    &#125; completion:^(<span class="hljs-built_in">BOOL</span> finished) &#123;<br>        <br>    &#125;];<br>    sender.selected = <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Getter</span><br><br>- (<span class="hljs-built_in">UIView</span> *)containerView &#123;<br>    <span class="hljs-keyword">if</span> (!_containerView) &#123;<br>        _containerView = [[<span class="hljs-built_in">UIButton</span> alloc] init];<br>        _containerView.backgroundColor = [<span class="hljs-built_in">UIColor</span> colorWithWhite:<span class="hljs-number">0</span> alpha:<span class="hljs-number">0.1</span>];<br>        [_containerView addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(backButtonTouched:) forControlEvents:<span class="hljs-built_in">UIControlEventTouchUpInside</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> _containerView;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Setter</span><br><br>- (<span class="hljs-keyword">void</span>)setDataSorce:(<span class="hljs-keyword">id</span>&lt;LZDropViewDataSource&gt;)dataSorce &#123;<br>    _dataSorce = dataSorce;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.dataSorce &amp;&amp; [<span class="hljs-keyword">self</span>.dataSorce respondsToSelector:<span class="hljs-keyword">@selector</span>(setupCategoryControllerInDropView:)])&#123;<br>        <span class="hljs-keyword">self</span>.controllerArray = [<span class="hljs-keyword">self</span>.dataSorce setupCategoryControllerInDropView:<span class="hljs-keyword">self</span>];<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.dataSorce &amp;&amp; [<span class="hljs-keyword">self</span>.dataSorce respondsToSelector:<span class="hljs-keyword">@selector</span>(setupCategoryTitleNameInDropView:)])&#123;<br>        <span class="hljs-keyword">self</span>.titleArray = [<span class="hljs-keyword">self</span>.dataSorce setupCategoryTitleNameInDropView:<span class="hljs-keyword">self</span>];<br>        [<span class="hljs-keyword">self</span> setupTitleButton:<span class="hljs-keyword">self</span>.titleArray];<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.dataSorce &amp;&amp; [<span class="hljs-keyword">self</span>.dataSorce respondsToSelector:<span class="hljs-keyword">@selector</span>(setupCategoryControllerHeightInDropView:)]) &#123;<br>        <span class="hljs-keyword">self</span>.controllerHeightArray = [<span class="hljs-keyword">self</span>.dataSorce setupCategoryControllerHeightInDropView:<span class="hljs-keyword">self</span>];<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.controllerArray.count != <span class="hljs-keyword">self</span>.titleArray.count ||<br>        <span class="hljs-keyword">self</span>.controllerArray.count != <span class="hljs-keyword">self</span>.controllerHeightArray.count) &#123;<br>        <span class="hljs-keyword">@throw</span> [<span class="hljs-built_in">NSException</span> exceptionWithName:<span class="hljs-built_in">NSStringFromClass</span>([<span class="hljs-keyword">self</span> <span class="hljs-keyword">class</span>]) reason:<span class="hljs-string">@&quot;The number of corresponding arrays is inconsistent.&quot;</span> userInfo:<span class="hljs-literal">nil</span>];<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h4><p> 1.éµå¾ªåè®®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-section">&lt;LZDropViewDataSource, LZDropViewDelegate&gt;</span><br></code></pre></td></tr></table></figure><p>2.åˆå§‹åŒ–</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs maxima">LZDropView *<span class="hljs-built_in">view</span>     = [[LZDropView alloc] init];<br>    <span class="hljs-built_in">view</span>.dataSorce       = self;<br>    <span class="hljs-built_in">view</span>.delegate        = self;<br>    <span class="hljs-built_in">view</span>.backgroundColor = UIColor.whiteColor;<br>    <span class="hljs-built_in">view</span>.frame           = CGRectMake(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>, UIScreen.mainScreen.bounds.size.<span class="hljs-built_in">width</span>, <span class="hljs-number">45</span>);<br>    [self.<span class="hljs-built_in">view</span> addSubview:<span class="hljs-built_in">view</span>];<br></code></pre></td></tr></table></figure><ol start="3"><li>å®ç°ä»£ç†å’Œæ•°æ®æº<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs swift">#pragma mark <span class="hljs-operator">-</span> <span class="hljs-type">LZDropViewDataSource</span><br><br><span class="hljs-operator">-</span> (<span class="hljs-type">NSArray</span>&lt;<span class="hljs-type">UIViewController</span> *&gt; <span class="hljs-operator">*</span>)setupCategoryControllerInDropView:(<span class="hljs-type">LZDropView</span> <span class="hljs-operator">*</span>)dropView &#123;<br>    <span class="hljs-keyword">return</span> @[[[<span class="hljs-type">TableViewController</span> alloc] <span class="hljs-keyword">init</span>],<br>             [[<span class="hljs-type">TableViewController</span> alloc] <span class="hljs-keyword">init</span>],<br>             [[<span class="hljs-type">TableViewController</span> alloc] <span class="hljs-keyword">init</span>],<br>             [[<span class="hljs-type">TableViewController</span> alloc] <span class="hljs-keyword">init</span>]];<br>&#125;<br><br><span class="hljs-operator">-</span> (<span class="hljs-type">NSArray</span>&lt;<span class="hljs-type">NSString</span> *&gt; <span class="hljs-operator">*</span>)setupCategoryTitleNameInDropView:(<span class="hljs-type">LZDropView</span> <span class="hljs-operator">*</span>)dropView &#123;<br>    <span class="hljs-keyword">return</span> @[@<span class="hljs-string">&quot;å…¨éƒ¨&quot;</span>,<br>             @<span class="hljs-string">&quot;é™„è¿‘&quot;</span>,<br>             @<span class="hljs-string">&quot;åªèƒ½æ’åº&quot;</span>,<br>             @<span class="hljs-string">&quot;ç­›é€‰&quot;</span>];<br>&#125;<br><br><span class="hljs-operator">-</span> (<span class="hljs-type">NSArray</span>&lt;<span class="hljs-type">NSNumber</span> *&gt; <span class="hljs-operator">*</span>)setupCategoryControllerHeightInDropView:(<span class="hljs-type">LZDropView</span> <span class="hljs-operator">*</span>)dropView &#123;<br>    <span class="hljs-keyword">return</span> @[[<span class="hljs-type">NSNumber</span> numberWithFloat:<span class="hljs-number">300</span>],<br>             [<span class="hljs-type">NSNumber</span> numberWithFloat:<span class="hljs-number">400</span>],<br>             [<span class="hljs-type">NSNumber</span> numberWithFloat:<span class="hljs-number">410</span>],<br>             [<span class="hljs-type">NSNumber</span> numberWithFloat:<span class="hljs-number">420</span>]];<br>&#125;<br><br>#pragma mark <span class="hljs-operator">-</span> <span class="hljs-type">LZDropViewDelegate</span><br><br><span class="hljs-operator">-</span> (void)dropView:(<span class="hljs-type">LZDropView</span> <span class="hljs-operator">*</span>)dropView didSelectAtColumn:(<span class="hljs-type">NSInteger</span>)column info:(<span class="hljs-type">NSString</span> <span class="hljs-operator">*</span>)info &#123;<br>    <span class="hljs-type">NSLog</span>(@<span class="hljs-string">&quot;%ld---%@&quot;</span>, column, info);<br>&#125;<br><br></code></pre></td></tr></table></figure></li><li>ç‚¹å‡»controllerä¸­çš„æ•°æ®æ˜¾ç¤ºåœ¨æŒ‰é’®çš„æ ‡é¢˜ä¸­ï¼Œè¿™å› ä¸ºè·¨ç•Œé¢æ˜¾ç¤ºï¼Œæˆ‘æš‚æ—¶æ²¡æœ‰æƒ³åˆ°å¥½çš„åŠæ³•ï¼Œæ‰€ä»¥ä½¿ç”¨å¼ºå¤§çš„é€šçŸ¥ä¼ å€¼ã€‚</li><li>è®°å½•é€‰ä¸­çŠ¶æ€ï¼Œåº”è¯¥æ˜¯æ§åˆ¶å™¨é‡Œé¢çš„æ“ä½œï¼Œè¿™é‡Œå°±æ²¡æœ‰å®ç°<figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs clojure">[[NSNotificationCenter defaultCenter] postNotificationName:lzDropViewNotification object:self userInfo:@&#123;@<span class="hljs-string">&quot;key&quot;</span>:[NSString stringWithFormat:@<span class="hljs-string">&quot;ç¬¬%ldcell&quot;</span>, indexPath.row]&#125;]<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><img src="https://upload-images.jianshu.io/upload_images/3334769-9256553756983ba2.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾"></li></ol><p>å¦‚æœæœ‰ä»€ä¹ˆä¸å¥½å¦‚æœå»ºè®®çš„åœ°æ–¹ï¼Œè¯·æ‰¹è¯„æŒ‡æ­£ï¼</p>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AVPlayerå°è£…</title>
    <link href="/2019/11/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-AVPlayer%E5%B0%81%E8%A3%85/"/>
    <url>/2019/11/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-AVPlayer%E5%B0%81%E8%A3%85/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-066df343391a04f5.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><p>æœ€è¿‘åœ¨å†™å…³äºéŸ³è§†é¢‘æ’­æ”¾çš„æ¡ˆä¾‹ï¼Œæ‰€ä»¥å°±è¶æœºä¼šç ”ç©¶äº†ä¸€ä¸‹AVPlayerçš„å†…å®¹ã€‚æˆ‘å°è£…çš„ç›®å‰åªèƒ½æ’­æ”¾ç½‘ç»œéŸ³è§†é¢‘ã€‚è¿˜æœªæ·»åŠ ç¼“å­˜ï¼Œä»¥åæ‰¾æœºä¼šç ”ç©¶ä¸€ä¸‹å†æ›´æ–°ã€‚ä»£ç ä¸­æä¾›äº†éŸ³è§†é¢‘çš„ä¸Šä¸€æ›²ã€ä¸‹ä¸€æ›²ã€æš‚åœã€å¼€å§‹ã€åœæ­¢ã€å•æ›²æ’­æ”¾ã€é¡ºåºæ’­æ”¾ã€éšæœºæ’­æ”¾ç­‰åŠŸèƒ½ã€‚ä»£ç å†™çš„ä¸å¥½ï¼Œä»…ä¾›å‚è€ƒ~</p><h3 id="ä»£ç æ¥å£æ–‡ä»¶"><a href="#ä»£ç æ¥å£æ–‡ä»¶" class="headerlink" title="ä»£ç æ¥å£æ–‡ä»¶"></a>ä»£ç æ¥å£æ–‡ä»¶</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span><br><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;AVFoundation/AVFoundation.h&gt;</span></span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-comment">// å½“å‰æ’­æ”¾å™¨çš„æ’­æ”¾å½¢å¼</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">NS_ENUM</span>(<span class="hljs-built_in">NSInteger</span>, MediaPlayType) &#123;<br>    MediaPlayTypeCycle,   <span class="hljs-comment">///&lt; é¡ºåº</span><br>    MediaPlayTypeSingle,  <span class="hljs-comment">///&lt; å•æ›²å¾ªç¯</span><br>    MediaPlayTypeRandom   <span class="hljs-comment">///&lt; éšæœºæ’­æ”¾</span><br>&#125;;<br><br><span class="hljs-comment">// å½“å‰æ’­æ”¾å™¨çš„æ’­æ”¾çŠ¶æ€</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">NS_ENUM</span>(<span class="hljs-built_in">NSInteger</span>, MediaPlayStatus) &#123;<br>    MediaPlayStatusStop,        <span class="hljs-comment">///&lt; åœæ­¢æ’­æ”¾</span><br>    MediaPlayStatusPause,       <span class="hljs-comment">///&lt; æš‚åœæ’­æ”¾</span><br>    MediaPlayStatusPlaying      <span class="hljs-comment">///&lt; æ­£åœ¨æ’­æ”¾</span><br>&#125;;<br><br><span class="hljs-comment">// åª’ä½“åŠ è½½çŠ¶æ€</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">NS_ENUM</span>(<span class="hljs-built_in">NSInteger</span>, MediaLoadStatus) &#123;<br>    MediaLoadStatusReadyToPlay,  <span class="hljs-comment">///&lt; å‡†å¤‡æ’­æ”¾</span><br>    MediaLoadStatusUnknown,      <span class="hljs-comment">///&lt; æœªçŸ¥</span><br>    MediaPlayStatusFailed        <span class="hljs-comment">///&lt; å¤±è´¥</span><br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">@class</span> <span class="hljs-title">MediaPlyerManager</span>;</span><br><br><span class="hljs-class"><span class="hljs-keyword">@protocol</span> <span class="hljs-title">MediaPlyerManagerDelegate</span> &lt;<span class="hljs-title">NSObject</span>&gt;</span><br><span class="hljs-keyword">@optional</span><br><span class="hljs-comment">// æ•°æ®åŠ è½½çŠ¶æ€ æ ¹æ®çŠ¶æ€è¿›è¡Œæ’­æ”¾æˆ–å…¶ä»–æ“ä½œ</span><br>- (<span class="hljs-keyword">void</span>)MediaPlayer:(MediaPlyerManager *)playerManager playerItemStatus:(MediaLoadStatus)status;<br><span class="hljs-comment">// ç¼“å†²è¿›åº¦</span><br>- (<span class="hljs-keyword">void</span>)MediaPlayer:(MediaPlyerManager *)playerManager netBufferValue:(<span class="hljs-built_in">CGFloat</span>)value;<br><span class="hljs-comment">// ç¼“å†²æ˜¯å¦è¶³å¤Ÿæ’­æ”¾</span><br>- (<span class="hljs-keyword">void</span>)MediaPlayer:(MediaPlyerManager *)playerManager bufferHasEnough:(<span class="hljs-built_in">BOOL</span>)enough;<br><span class="hljs-comment">// å½“å‰æ’­æ”¾çš„æ—¶é—´</span><br>- (<span class="hljs-keyword">void</span>)MediaPlayer:(MediaPlyerManager *)playerManager currentPlayTime:(<span class="hljs-built_in">NSString</span> *)time currentPlayTimeValue:(<span class="hljs-built_in">CGFloat</span>)value;<br><span class="hljs-comment">// æ’­æ”¾æ€»æ—¶é—´</span><br>- (<span class="hljs-keyword">void</span>)MediaPlayer:(MediaPlyerManager *)playerManager mediaEndTime:(<span class="hljs-built_in">NSString</span> *)time mediaEndTimeValue:(<span class="hljs-built_in">CGFloat</span>)value;<br><span class="hljs-comment">// æ’­æ”¾ç»“æŸ</span><br>- (<span class="hljs-keyword">void</span>)MediaPlayerCurrentMediaPlayFinish:(MediaPlyerManager *)playerManager;<br><span class="hljs-comment">// æ’­æ”¾çŠ¶æ€</span><br>- (<span class="hljs-keyword">void</span>)MediaPlayer:(MediaPlyerManager *)playerManager playeStatus:(MediaPlayStatus)status;<br><span class="hljs-comment">// è·å–æ•°æ®åˆ‡æ¢æ—¶è·å–æ­£åœ¨æ’­æ”¾çš„URLå’Œå½“å‰çš„index</span><br>- (<span class="hljs-keyword">void</span>)MediaPlayer:(MediaPlyerManager *)playerManager currentUrl:(<span class="hljs-built_in">NSString</span> *)url currentIndex:(<span class="hljs-built_in">NSInteger</span>)index;<br><span class="hljs-comment">// ä¸ºäº†é…åˆæ‰‹æœºåå°æ’­æ”¾ å®æ—¶è·å–æ’­æ”¾çš„è¿›åº¦ï¼Œæ€»çš„æ—¶é—´ï¼Œå½“å‰çš„index&lt;é€šè¿‡indexè·å–å›¾ç‰‡ç­‰ä¿¡æ¯&gt;</span><br>- (<span class="hljs-keyword">void</span>)MediaPlayer:(MediaPlyerManager *)playerManager currentProgressValue:(<span class="hljs-built_in">CGFloat</span>)value totalValue:(<span class="hljs-built_in">CGFloat</span>)totalValue currentIndex:(<span class="hljs-built_in">NSInteger</span>)index;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-keyword">typedef</span> MediaPlyerManager *(^playerCurrentTime)(<span class="hljs-built_in">NSString</span> *time);<br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">MediaPlyerManager</span> : <span class="hljs-title">NSObject</span></span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">AVPlayer</span>                  *mediaPlayer;          <span class="hljs-comment">///&lt; æ’­æ”¾å™¨</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">AVPlayerItem</span>              *meidaPlayerItem;      <span class="hljs-comment">///&lt; æ’­æ”¾å™¨çš„CurrentItem</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">NSMutableArray</span>&lt;<span class="hljs-built_in">NSString</span>*&gt; *dataUrlArray;         <span class="hljs-comment">///&lt; æ­£åœ¨æ’­æ”¾çš„åˆ—è¡¨æ•°æ®</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readonly</span>) MediaPlayType              playType;             <span class="hljs-comment">///&lt; å½“å‰æ’­æ”¾ç±»å‹</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readonly</span>) MediaPlayStatus            playStatus;           <span class="hljs-comment">///&lt; å½“å‰æ’­æ”¾çŠ¶æ€</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">NSInteger</span>                  currentIndex;         <span class="hljs-comment">///&lt; å½“å‰æ’­æ”¾çš„ç´¢å¼•</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">BOOL</span>                       isPlaying;            <span class="hljs-comment">///&lt; æ˜¯å¦åœ¨æ’­æ”¾</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">CGFloat</span>                    curentPlayTimeValue;  <span class="hljs-comment">///&lt; å½“å‰æ’­æ”¾æ—¶é—´å€¼</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">NSString</span>                    *curentPlayTime;       <span class="hljs-comment">///&lt; å½“å‰æ’­æ”¾æ—¶é—´</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">CGFloat</span>                    endPlayTimeValue;     <span class="hljs-comment">///&lt; å½“å‰æ’­æ”¾æ—¶é—´å€¼</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>, <span class="hljs-keyword">readonly</span>) <span class="hljs-built_in">NSString</span>                    *endPlayTime;          <span class="hljs-comment">///&lt; å½“å‰æ’­æ”¾æ—¶é—´</span><br>+ (<span class="hljs-keyword">instancetype</span>)defaultManager;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> åˆ—è¡¨æ’­æ”¾ âš ï¸&lt;é»˜è®¤ä¸è‡ªåŠ¨æ’­æ”¾&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param urls æ–‡ä»¶è·¯å¾„æ•°ç»„</span><br><span class="hljs-comment"> @param delegate å›è°ƒä»£ç†</span><br><span class="hljs-comment"> @return MediaPlyerManager</span><br><span class="hljs-comment"> */</span><br>- (MediaPlyerManager *)playerWithUrls:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)urls actionWithDelegate:(<span class="hljs-keyword">id</span>&lt;MediaPlyerManagerDelegate&gt;)delegate;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> å•ä¸ªéŸ³è§†é¢‘æ’­æ”¾ âš ï¸&lt;é»˜è®¤ä¸è‡ªåŠ¨æ’­æ”¾&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param url æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-comment"> @param delegate å›è°ƒä»£ç†</span><br><span class="hljs-comment"> @return MediaPlyerManager</span><br><span class="hljs-comment"> */</span><br>- (MediaPlyerManager *)playerWithUrl:(<span class="hljs-built_in">NSString</span> *)url actionWithDelegate:(<span class="hljs-keyword">id</span>&lt;MediaPlyerManagerDelegate&gt;)delegate;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    å¼€å§‹æ’­æ”¾</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)play;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    æš‚åœæ’­æ”¾</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)pause;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    åœæ­¢æ’­æ”¾</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)stop;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    ä¸‹ä¸€æ›²</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)next;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    ä¸Šä¸€æ›²</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)previous;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> æŒ‡å®šè¿›åº¦å¼€å§‹æ’­æ”¾</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param progress è¿›åº¦ç™¾åˆ†æ¯”</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)setupPlayerSeekToProgress:(<span class="hljs-built_in">CGFloat</span>)progress;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> åˆ¶å®šæ’­æ”¾ç±»å‹</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param type ç±»å‹</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)setupMediaPlayerType:(MediaPlayType)type;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> æŒ‡å®šæ’­æ”¾çš„index</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param index ç´¢å¼•</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)setupPlayerIndex:(<span class="hljs-built_in">NSInteger</span>)index;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> æ·»åŠ æ•°æ®</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param files æ–‡ä»¶æ•°ç»„</span><br><span class="hljs-comment"> @param index ç´¢å¼•</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)insertMediaFile:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)files atIndex:(<span class="hljs-built_in">NSInteger</span>)index;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">    ç§»é™¤å…¨éƒ¨æ•°æ®</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)removeAllFiles;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> ç§»é™¤ç´¢å¼•ä¸­çš„å•ä¸ªæ•°æ®</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param index ç´¢å¼•</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)removeObjectAtIndex:(<span class="hljs-built_in">NSInteger</span>)index;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> è®¾ç½®é”å±æ ·å¼</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param coverImage ä¸“è¾‘å›¾ç‰‡</span><br><span class="hljs-comment"> @param size æ˜¾ç¤ºå¤§å°</span><br><span class="hljs-comment"> @param title æ ‡é¢˜</span><br><span class="hljs-comment"> @param author ä¸“è¾‘ä½œè€…</span><br><span class="hljs-comment"> @param album ä¸“è¾‘åç§°</span><br><span class="hljs-comment"> @param currentTime å½“å‰æ’­æ”¾æ—¶é—´</span><br><span class="hljs-comment"> @param duration æ’­æ”¾æ€»æ—¶é•¿</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)setupLockScreenPlayInfo:(<span class="hljs-built_in">UIImage</span> *)coverImage<br>                      imageSize:(<span class="hljs-built_in">CGSize</span>)size<br>                          title:(<span class="hljs-built_in">NSString</span> *)title<br>                         ahthor:(<span class="hljs-built_in">NSString</span> *)author<br>                         album:(<span class="hljs-built_in">NSString</span> *)album<br>                currentPlayTime:(<span class="hljs-built_in">CGFloat</span>)currentTime<br>                       duration:(<span class="hljs-built_in">CGFloat</span>)duration;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br></code></pre></td></tr></table></figure><h3 id="ä»£ç å®ç°æ–‡ä»¶"><a href="#ä»£ç å®ç°æ–‡ä»¶" class="headerlink" title="ä»£ç å®ç°æ–‡ä»¶"></a>ä»£ç å®ç°æ–‡ä»¶</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;MediaPlyerManager.h&quot;</span></span><br><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;MediaPlayer/MediaPlayer.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">MediaPlyerManager</span> ()</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>, <span class="hljs-keyword">readwrite</span>) <span class="hljs-built_in">NSMutableArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *dataUrlArray;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>, <span class="hljs-keyword">readwrite</span>) <span class="hljs-built_in">AVPlayer</span>                  *mediaPlayer;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readwrite</span>) <span class="hljs-built_in">BOOL</span>                      isPlaying;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>, <span class="hljs-keyword">readwrite</span>) <span class="hljs-built_in">AVPlayerItem</span>              *meidaPlayerItem;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readwrite</span>) MediaPlayType             playeType;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readwrite</span>) <span class="hljs-built_in">NSInteger</span>                 currentIndex;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readwrite</span>) MediaPlayStatus           playStatus;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readwrite</span>) <span class="hljs-built_in">CGFloat</span>                   curentPlayTimeValue;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>, <span class="hljs-keyword">readwrite</span>  ) <span class="hljs-built_in">NSString</span>                  *curentPlayTime;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>, <span class="hljs-keyword">readwrite</span>) <span class="hljs-built_in">CGFloat</span>                   endPlayTimeValue;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>, <span class="hljs-keyword">readwrite</span>  ) <span class="hljs-built_in">NSString</span>                  *endPlayTime;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">weak</span>             ) <span class="hljs-keyword">id</span> &lt;MediaPlyerManagerDelegate&gt; delegate;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">MediaPlyerManager</span></span><br><br>+ (<span class="hljs-keyword">instancetype</span>)defaultManager &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_once_t</span> onceToken;<br>    <span class="hljs-keyword">static</span> MediaPlyerManager *manger;<br>    <span class="hljs-built_in">dispatch_once</span>(&amp;onceToken, ^&#123;<br>        manger = [[MediaPlyerManager alloc] init];<br>    &#125;);<br>    <span class="hljs-keyword">return</span> manger;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - åˆå§‹åŒ–</span><br><br>- (MediaPlyerManager *)playerWithUrl:(<span class="hljs-built_in">NSString</span> *)url actionWithDelegate:(<span class="hljs-keyword">id</span>&lt;MediaPlyerManagerDelegate&gt;)delegate &#123;<br>    [<span class="hljs-keyword">self</span> playerWithUrls:@[url] actionWithDelegate:delegate];<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br>- (MediaPlyerManager *)playerWithUrls:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)urls actionWithDelegate:(<span class="hljs-keyword">id</span>&lt;MediaPlyerManagerDelegate&gt;)delegate &#123;<br>    <span class="hljs-keyword">self</span>.delegate         = delegate;<br>    <span class="hljs-keyword">self</span>.currentIndex     = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">self</span>.dataUrlArray     = [<span class="hljs-built_in">NSMutableArray</span> array];<br>    <span class="hljs-built_in">NSMutableArray</span> *array = [<span class="hljs-built_in">NSMutableArray</span> arrayWithCapacity:urls.count];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">NSString</span> *urlStr <span class="hljs-keyword">in</span> urls) &#123;<br>        [array addObject:[<span class="hljs-keyword">self</span> createPlayerItemWithUrl:urlStr]];<br>        [<span class="hljs-keyword">self</span>.dataUrlArray addObject:urlStr];<br>    &#125;<br>    <span class="hljs-keyword">self</span>.playeType = MediaPlayTypeCycle;<br>    <span class="hljs-keyword">self</span>.mediaPlayer = [[<span class="hljs-built_in">AVPlayer</span> alloc] initWithPlayerItem:array.firstObject];<br>    <span class="hljs-keyword">self</span>.meidaPlayerItem = <span class="hljs-keyword">self</span>.mediaPlayer.currentItem;<br>    [<span class="hljs-keyword">self</span> getCurrentIndex:<span class="hljs-keyword">self</span>.currentIndex];<br>    [<span class="hljs-keyword">self</span> addObserver];<br>    <br>    __<span class="hljs-keyword">weak</span> <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakself = <span class="hljs-keyword">self</span>;<br>    [<span class="hljs-keyword">self</span>.mediaPlayer addPeriodicTimeObserverForInterval:<span class="hljs-built_in">CMTimeMake</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>) queue:<span class="hljs-literal">NULL</span> usingBlock:^(<span class="hljs-built_in">CMTime</span> time) &#123;<br>        <span class="hljs-built_in">NSString</span> *currentString = [weakself getStringFromCMTime:time];<br>        weakself.curentPlayTime = currentString;<br>        weakself.curentPlayTimeValue = (<span class="hljs-built_in">CGFloat</span>)time.value/time.timescale;        <br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - è·å–å½“å‰æ’­æ”¾æ—¶é—´</span><br>        <span class="hljs-keyword">if</span> (weakself.delegate &amp;&amp; [weakself.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(MediaPlayer:currentPlayTime:currentPlayTimeValue:)]) &#123;<br>            [weakself.delegate MediaPlayer:weakself currentPlayTime:currentString currentPlayTimeValue:(<span class="hljs-built_in">CGFloat</span>)time.value/time.timescale];<br>        &#125;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - å®æ—¶è·å–æ’­æ”¾ä¿¡æ¯</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(MediaPlayer:currentProgressValue:totalValue:currentIndex:)]) &#123;<br>            [weakself.delegate MediaPlayer:weakself currentProgressValue:weakself.curentPlayTimeValue totalValue:weakself.endPlayTimeValue currentIndex:weakself.currentIndex];<br>        &#125;<br>    &#125;];<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æ’­æ”¾ç»“æŸ</span><br><br>- (<span class="hljs-keyword">void</span>)playFinish:(<span class="hljs-built_in">NSNotification</span> *)notification &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(MediaPlayerCurrentMediaPlayFinish:)]) &#123;<br>        [<span class="hljs-keyword">self</span>.delegate MediaPlayerCurrentMediaPlayFinish:<span class="hljs-keyword">self</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.playeType == MediaPlayTypeSingle) &#123;<br>        [<span class="hljs-keyword">self</span>.mediaPlayer seekToTime:kCMTimeZero];<br>        [<span class="hljs-keyword">self</span> play];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.currentIndex &lt; <span class="hljs-keyword">self</span>.dataUrlArray.count - <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">self</span>.currentIndex += <span class="hljs-number">1</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">self</span>.currentIndex = <span class="hljs-number">0</span>;<br>        &#125;<br>        [<span class="hljs-keyword">self</span>.mediaPlayer replaceCurrentItemWithPlayerItem:[<span class="hljs-keyword">self</span> createPlayerItemWithUrl:<span class="hljs-keyword">self</span>.dataUrlArray[<span class="hljs-keyword">self</span>.currentIndex]]];<br>        <span class="hljs-keyword">self</span>.meidaPlayerItem = <span class="hljs-keyword">self</span>.mediaPlayer.currentItem;<br>        [<span class="hljs-keyword">self</span> getCurrentIndex:<span class="hljs-keyword">self</span>.currentIndex];<br>        [<span class="hljs-keyword">self</span> play];<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - KVO</span><br><br>- (<span class="hljs-keyword">void</span>)observeValueForKeyPath:(<span class="hljs-built_in">NSString</span> *)keyPath<br>                      ofObject:(<span class="hljs-keyword">id</span>)object<br>                        change:(<span class="hljs-built_in">NSDictionary</span>&lt;<span class="hljs-built_in">NSKeyValueChangeKey</span>,<span class="hljs-keyword">id</span>&gt; *)change<br>                       context:(<span class="hljs-keyword">void</span> *)context &#123;<br>    <br>    <span class="hljs-built_in">AVPlayerItem</span> *playerItem = object;<br>    <span class="hljs-keyword">if</span> ([keyPath isEqualToString:<span class="hljs-string">@&quot;status&quot;</span>]) &#123;<br>        MediaLoadStatus status = [change[<span class="hljs-string">@&quot;new&quot;</span>] integerValue];<br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - è·å–åª’ä½“åŠ è½½çŠ¶æ€</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(MediaPlayer:playerItemStatus:)]) &#123;<br>            [<span class="hljs-keyword">self</span>.delegate MediaPlayer:<span class="hljs-keyword">self</span> playerItemStatus:status];<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([keyPath isEqualToString:<span class="hljs-string">@&quot;loadedTimeRanges&quot;</span>]) &#123;<br>        <span class="hljs-built_in">NSArray</span> * timeRanges         = playerItem.loadedTimeRanges;<br>        <span class="hljs-built_in">CMTimeRange</span> timeRange        = [timeRanges.firstObject <span class="hljs-built_in">CMTimeRangeValue</span>];<br>        <span class="hljs-built_in">NSTimeInterval</span> totalLoadTime = <span class="hljs-built_in">CMTimeGetSeconds</span>(timeRange.start) \<br>                                                + <span class="hljs-built_in">CMTimeGetSeconds</span>(timeRange.duration);<br>        <span class="hljs-built_in">NSTimeInterval</span> duration      = <span class="hljs-built_in">CMTimeGetSeconds</span>(playerItem.duration);<br>        <span class="hljs-built_in">NSTimeInterval</span> scale         = totalLoadTime/duration;<br>        <br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - è·å–åª’ä½“æ€»æ—¶é—´</span><br>        <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">CGFloat</span>)duration/scale &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">self</span>.endPlayTime = [<span class="hljs-keyword">self</span> getStringFromCMTime:playerItem.duration];<br>            <span class="hljs-keyword">self</span>.endPlayTimeValue = (<span class="hljs-built_in">CGFloat</span>)duration/scale;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(MediaPlayer:mediaEndTime:mediaEndTimeValue:)]) &#123;<br>                [<span class="hljs-keyword">self</span>.delegate MediaPlayer:<span class="hljs-keyword">self</span> mediaEndTime:[<span class="hljs-keyword">self</span> getStringFromCMTime:playerItem.duration] mediaEndTimeValue:(<span class="hljs-built_in">CGFloat</span>)duration/scale];<br>            &#125;<br>        &#125;<br>        <br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - ç¼“å†²ç™¾åˆ†æ¯”</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(MediaPlayer:netBufferValue:)]) &#123;<br>            [<span class="hljs-keyword">self</span>.delegate MediaPlayer:<span class="hljs-keyword">self</span> netBufferValue:scale];<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([keyPath isEqualToString:<span class="hljs-string">@&quot;playbackBufferEmpty&quot;</span>]) &#123;<br>        <br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - ç¼“å†²ä¸è¶³å¤Ÿæ’­æ”¾</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(MediaPlayer:bufferHasEnough:)]) &#123;<br>            [<span class="hljs-keyword">self</span>.delegate MediaPlayer:<span class="hljs-keyword">self</span> bufferHasEnough:<span class="hljs-literal">false</span>];<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([keyPath isEqualToString:<span class="hljs-string">@&quot;playbackLikelyToKeepUp&quot;</span>]) &#123;<br>        <br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - ç¼“å†²è¶³å¤Ÿæ’­æ”¾</span><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(MediaPlayer:bufferHasEnough:)]) &#123;<br>            [<span class="hljs-keyword">self</span>.delegate MediaPlayer:<span class="hljs-keyword">self</span> bufferHasEnough:<span class="hljs-literal">true</span>];<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - å¼€å§‹æ’­æ”¾</span><br><br>- (<span class="hljs-keyword">void</span>)play &#123;<br>    [<span class="hljs-keyword">self</span>.mediaPlayer play];<br>    [<span class="hljs-keyword">self</span> getPlayStatus:MediaPlayStatusPlaying];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æš‚åœæ’­æ”¾</span><br><br>- (<span class="hljs-keyword">void</span>)pause &#123;<br>    [<span class="hljs-keyword">self</span>.mediaPlayer pause];<br>    [<span class="hljs-keyword">self</span> getPlayStatus:MediaPlayStatusPause];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - åœæ­¢æ’­æ”¾</span><br><br>- (<span class="hljs-keyword">void</span>)stop &#123;<br>    [<span class="hljs-keyword">self</span>.mediaPlayer replaceCurrentItemWithPlayerItem:<span class="hljs-literal">nil</span>];<br>    [<span class="hljs-keyword">self</span> getPlayStatus:MediaPlayStatusStop];<br>    [<span class="hljs-keyword">self</span> removeObserver];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - ä¸‹ä¸€ä¸ª</span><br><br>- (<span class="hljs-keyword">void</span>)next &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.playeType == MediaPlayTypeRandom) &#123;<br>        <span class="hljs-keyword">self</span>.currentIndex = (<span class="hljs-built_in">NSInteger</span>)arc4random_uniform((int32_t)(<span class="hljs-keyword">self</span>.dataUrlArray.count - <span class="hljs-number">1</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.currentIndex == <span class="hljs-keyword">self</span>.dataUrlArray.count - <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">self</span>.currentIndex = <span class="hljs-number">0</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">self</span>.currentIndex += <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br>    [<span class="hljs-keyword">self</span>.mediaPlayer replaceCurrentItemWithPlayerItem:[<span class="hljs-keyword">self</span> createPlayerItemWithUrl:<span class="hljs-keyword">self</span>.dataUrlArray[<span class="hljs-keyword">self</span>.currentIndex]]];<br>    <span class="hljs-keyword">self</span>.meidaPlayerItem = <span class="hljs-keyword">self</span>.mediaPlayer.currentItem;<br>    [<span class="hljs-keyword">self</span> getCurrentIndex:<span class="hljs-keyword">self</span>.currentIndex];<br>    [<span class="hljs-keyword">self</span> addObserver];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - ä¸Šä¸€ä¸ª</span><br><br>- (<span class="hljs-keyword">void</span>)previous &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.playeType == MediaPlayTypeRandom) &#123;<br>        <span class="hljs-keyword">self</span>.currentIndex = (<span class="hljs-built_in">NSInteger</span>)arc4random_uniform((int32_t)(<span class="hljs-keyword">self</span>.dataUrlArray.count - <span class="hljs-number">1</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.currentIndex == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">self</span>.currentIndex = <span class="hljs-keyword">self</span>.dataUrlArray.count - <span class="hljs-number">1</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">self</span>.currentIndex -= <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br>    [<span class="hljs-keyword">self</span>.mediaPlayer replaceCurrentItemWithPlayerItem:[<span class="hljs-keyword">self</span> createPlayerItemWithUrl:<span class="hljs-keyword">self</span>.dataUrlArray[<span class="hljs-keyword">self</span>.currentIndex]]];<br>    <span class="hljs-keyword">self</span>.meidaPlayerItem = <span class="hljs-keyword">self</span>.mediaPlayer.currentItem;<br>    [<span class="hljs-keyword">self</span> getCurrentIndex:<span class="hljs-keyword">self</span>.currentIndex];<br>    [<span class="hljs-keyword">self</span> addObserver];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æ’­æ”¾çŠ¶æ€</span><br><br>- (<span class="hljs-keyword">void</span>)getPlayStatus:(MediaPlayStatus)status &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(MediaPlayer:playeStatus:)]) &#123;<br>        [<span class="hljs-keyword">self</span>.delegate MediaPlayer:<span class="hljs-keyword">self</span> playeStatus:status];<br>    &#125;<br>    <span class="hljs-keyword">self</span>.playStatus = status;<br><br>    <span class="hljs-keyword">if</span> (status == MediaPlayStatusPlaying) &#123;<br>        <span class="hljs-keyword">self</span>.isPlaying = <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">self</span>.isPlaying = <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æ ¹æ®indexè¿›è¡Œå›è°ƒ</span><br><br>- (<span class="hljs-keyword">void</span>)getCurrentIndex:(<span class="hljs-built_in">NSInteger</span>)index &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(MediaPlayer:currentUrl:currentIndex:)]) &#123;<br>        [<span class="hljs-keyword">self</span>.delegate MediaPlayer:<span class="hljs-keyword">self</span> currentUrl:<span class="hljs-keyword">self</span>.dataUrlArray[index] currentIndex:index];<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - è®¾ç½®æ’­æ”¾è¿›åº¦ç™¾åˆ†æ¯”</span><br><br>- (<span class="hljs-keyword">void</span>)setupPlayerSeekToProgress:(<span class="hljs-built_in">CGFloat</span>)progress &#123;<br>    <span class="hljs-keyword">float</span> timeValue = progress * <span class="hljs-built_in">CMTimeGetSeconds</span>(<span class="hljs-keyword">self</span>.mediaPlayer.currentItem.duration);<br>    [<span class="hljs-keyword">self</span>.mediaPlayer seekToTime:<span class="hljs-built_in">CMTimeMake</span>(timeValue, <span class="hljs-number">1</span>)];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - è®¾ç½®æ’­æ”¾å½¢å¼</span><br><br>- (<span class="hljs-keyword">void</span>)setupMediaPlayerType:(MediaPlayType)type &#123;<br>    <span class="hljs-keyword">self</span>.playeType = type;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æ’­æ”¾æŒ‡å®šindexçš„åª’ä½“</span><br><br>- (<span class="hljs-keyword">void</span>)setupPlayerIndex:(<span class="hljs-built_in">NSInteger</span>)index &#123;<br>    <span class="hljs-keyword">if</span> (index &gt; (<span class="hljs-keyword">self</span>.dataUrlArray.count - <span class="hljs-number">1</span>)) &#123;<br>        <span class="hljs-keyword">@throw</span> [<span class="hljs-built_in">NSException</span> exceptionWithName:<span class="hljs-string">@&quot;è¶Šç•Œé”™è¯¯&quot;</span> reason:<span class="hljs-string">@&quot;index ä¸èƒ½è¶…å‡ºURLæ•°ç»„çš„é•¿åº¦&quot;</span> userInfo:<span class="hljs-literal">nil</span>];<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">self</span>.currentIndex = index;<br>    [<span class="hljs-keyword">self</span>.mediaPlayer replaceCurrentItemWithPlayerItem:[<span class="hljs-keyword">self</span> createPlayerItemWithUrl:<span class="hljs-keyword">self</span>.dataUrlArray[<span class="hljs-keyword">self</span>.currentIndex]]];<br>    <span class="hljs-keyword">self</span>.meidaPlayerItem = <span class="hljs-keyword">self</span>.mediaPlayer.currentItem;<br>    [<span class="hljs-keyword">self</span> getCurrentIndex:<span class="hljs-keyword">self</span>.currentIndex];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æ’å…¥æ•°æ®</span><br><br>- (<span class="hljs-keyword">void</span>)insertMediaFile:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)files atIndex:(<span class="hljs-built_in">NSInteger</span>)index &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">NSString</span> *urlStr <span class="hljs-keyword">in</span> files) &#123;<br>        <span class="hljs-built_in">NSInteger</span> i = [files indexOfObject:urlStr];<br>        [<span class="hljs-keyword">self</span>.dataUrlArray insertObject:urlStr atIndex:index + i];<br>    &#125;<br>    <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-keyword">self</span>.currentIndex) &#123;<br>        <span class="hljs-keyword">self</span>.currentIndex += <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - åˆ é™¤æ•°æ®</span><br><br>- (<span class="hljs-keyword">void</span>)removeAllFiles &#123;<br>    [<span class="hljs-keyword">self</span> stop];<br>    [<span class="hljs-keyword">self</span>.dataUrlArray removeAllObjects];<br>    <span class="hljs-keyword">self</span>.dataUrlArray = [<span class="hljs-built_in">NSMutableArray</span> array];<br>    <span class="hljs-keyword">self</span>.currentIndex = <span class="hljs-number">0</span>;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)removeObjectAtIndex:(<span class="hljs-built_in">NSInteger</span>)index &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.dataUrlArray.count == <span class="hljs-number">1</span>) &#123;<br>        [<span class="hljs-keyword">self</span> removeAllFiles];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        [<span class="hljs-keyword">self</span>.dataUrlArray removeObjectAtIndex:index];<br>        <span class="hljs-keyword">if</span> (index == <span class="hljs-keyword">self</span>.currentIndex) &#123;<br>            <span class="hljs-keyword">if</span> (index == <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">self</span>.currentIndex = <span class="hljs-number">0</span>;<br>                [<span class="hljs-keyword">self</span> next];<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">self</span>.currentIndex -= <span class="hljs-number">1</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.currentIndex &gt; index) &#123;<br>                <span class="hljs-keyword">self</span>.currentIndex -= <span class="hljs-number">1</span>;<br>            &#125; <br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Utils</span><br><br>- (<span class="hljs-built_in">NSString</span> *)getStringFromCMTime:(<span class="hljs-built_in">CMTime</span>)time &#123;<br>    <span class="hljs-keyword">float</span> currentTimeValue       = (<span class="hljs-built_in">CGFloat</span>)time.value/time.timescale;<br>    <span class="hljs-built_in">NSDate</span> * currentDate         = [<span class="hljs-built_in">NSDate</span> dateWithTimeIntervalSince1970:currentTimeValue];<br>    <span class="hljs-built_in">NSCalendar</span> *calendar         = [[<span class="hljs-built_in">NSCalendar</span> alloc] initWithCalendarIdentifier:<span class="hljs-built_in">NSCalendarIdentifierGregorian</span>];<br>    <span class="hljs-built_in">NSInteger</span> unitFlags          = <span class="hljs-built_in">NSCalendarUnitHour</span> | <span class="hljs-built_in">NSCalendarUnitMinute</span> | <span class="hljs-built_in">NSCalendarUnitSecond</span>;<br>    <span class="hljs-built_in">NSDateComponents</span> *components = [calendar components:unitFlags fromDate:currentDate];<br>    <span class="hljs-keyword">if</span> (currentTimeValue &gt;= <span class="hljs-number">3600</span> ) &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%02ld:%02ld:%02ld&quot;</span>, (<span class="hljs-keyword">long</span>)components.hour, (<span class="hljs-keyword">long</span>)components.minute, (<span class="hljs-keyword">long</span>)components.second];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;%02ld:%02ld&quot;</span>, (<span class="hljs-keyword">long</span>)components.minute, (<span class="hljs-keyword">long</span>)components.second];<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)addObserver &#123;<br>    <span class="hljs-comment">// ç›‘æ§çŠ¶æ€å±æ€§</span><br>    [<span class="hljs-keyword">self</span>.meidaPlayerItem addObserver:<span class="hljs-keyword">self</span><br>                           forKeyPath:<span class="hljs-string">@&quot;status&quot;</span><br>                              options:(<span class="hljs-built_in">NSKeyValueObservingOptionOld</span>|<span class="hljs-built_in">NSKeyValueObservingOptionNew</span>)<br>                              context:<span class="hljs-literal">nil</span>];<br>    <br>    <span class="hljs-comment">// ç›‘æ§ç¼“å†²åŠ è½½æƒ…å†µå±æ€§</span><br>    [<span class="hljs-keyword">self</span>.meidaPlayerItem addObserver:<span class="hljs-keyword">self</span><br>                           forKeyPath:<span class="hljs-string">@&quot;loadedTimeRanges&quot;</span><br>                              options:(<span class="hljs-built_in">NSKeyValueObservingOptionOld</span>|<span class="hljs-built_in">NSKeyValueObservingOptionNew</span>)<br>                              context:<span class="hljs-literal">nil</span>];<br>    <br>    <span class="hljs-comment">// ç›‘å¬ç¼“å†²ä¸è¶³å¤Ÿæ’­æ”¾</span><br>    [<span class="hljs-keyword">self</span>.meidaPlayerItem addObserver:<span class="hljs-keyword">self</span><br>                           forKeyPath:<span class="hljs-string">@&quot;playbackBufferEmpty&quot;</span><br>                              options:<span class="hljs-built_in">NSKeyValueObservingOptionNew</span><br>                              context:<span class="hljs-literal">nil</span>];<br>    <br>    <span class="hljs-comment">// ç›‘å¬ç¼“å†²è¶³å¤Ÿæ’­æ”¾</span><br>    [<span class="hljs-keyword">self</span>.meidaPlayerItem addObserver:<span class="hljs-keyword">self</span><br>                           forKeyPath:<span class="hljs-string">@&quot;playbackLikelyToKeepUp&quot;</span><br>                              options:<span class="hljs-built_in">NSKeyValueObservingOptionNew</span><br>                              context:<span class="hljs-literal">nil</span>];<br>    <br>    <span class="hljs-comment">// è·å–æ˜¯å¦æ’­æ”¾ç»“æŸ</span><br>    [[<span class="hljs-built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="hljs-keyword">self</span><br>                                             selector:<span class="hljs-keyword">@selector</span>(playFinish:)<br>                                                 name:<span class="hljs-built_in">AVPlayerItemDidPlayToEndTimeNotification</span><br>                                               object:<span class="hljs-keyword">self</span>.meidaPlayerItem];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)removeObserver &#123;<br>    [[<span class="hljs-built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="hljs-keyword">self</span>];<br>    <span class="hljs-keyword">@try</span> &#123;<br>        [<span class="hljs-keyword">self</span>.meidaPlayerItem removeObserver:<span class="hljs-keyword">self</span> forKeyPath:<span class="hljs-string">@&quot;loadedTimeRanges&quot;</span>];<br>        [<span class="hljs-keyword">self</span>.meidaPlayerItem removeObserver:<span class="hljs-keyword">self</span> forKeyPath:<span class="hljs-string">@&quot;playbackBufferEmpty&quot;</span>];<br>        [<span class="hljs-keyword">self</span>.meidaPlayerItem removeObserver:<span class="hljs-keyword">self</span> forKeyPath:<span class="hljs-string">@&quot;playbackLikelyToKeepUp&quot;</span>];<br>        [<span class="hljs-keyword">self</span>.meidaPlayerItem removeObserver:<span class="hljs-keyword">self</span> forKeyPath:<span class="hljs-string">@&quot;status&quot;</span>];<br>    &#125;<br>    <span class="hljs-keyword">@catch</span>(<span class="hljs-built_in">NSException</span> *exception) &#123;<br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, exception);<br>    &#125; <br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - è®¾ç½®é”å±æ ·å¼</span><br><br>- (<span class="hljs-keyword">void</span>)setupLockScreenPlayInfo:(<span class="hljs-built_in">UIImage</span> *)coverImage<br>                      imageSize:(<span class="hljs-built_in">CGSize</span>)size<br>                          title:(<span class="hljs-built_in">NSString</span> *)title<br>                         ahthor:(<span class="hljs-built_in">NSString</span> *)author<br>                          album:(<span class="hljs-built_in">NSString</span> *)album<br>                currentPlayTime:(<span class="hljs-built_in">CGFloat</span>)currentTime<br>                       duration:(<span class="hljs-built_in">CGFloat</span>)duration &#123;<br>    <br>    Class playingInfoCenter = <span class="hljs-built_in">NSClassFromString</span>(<span class="hljs-string">@&quot;MPNowPlayingInfoCenter&quot;</span>);<br>    <span class="hljs-keyword">if</span> (playingInfoCenter) &#123;<br>        <span class="hljs-built_in">NSMutableDictionary</span> *songInfo = [[<span class="hljs-built_in">NSMutableDictionary</span> alloc] init];<br>        <span class="hljs-built_in">MPMediaItemArtwork</span> *albumArt = [[<span class="hljs-built_in">MPMediaItemArtwork</span> alloc] initWithBoundsSize:size requestHandler:^<span class="hljs-built_in">UIImage</span> * _Nonnull(<span class="hljs-built_in">CGSize</span> size) &#123;<br>            <span class="hljs-keyword">return</span> coverImage;<br>        &#125;];<br>        [songInfo setObject:title forKey:<span class="hljs-built_in">MPMediaItemPropertyTitle</span>];<br>        [songInfo setObject:author forKey:<span class="hljs-built_in">MPMediaItemPropertyArtist</span>];<br>        [songInfo setObject:album forKey:<span class="hljs-built_in">MPMediaItemPropertyAlbumTitle</span>];<br>        [songInfo setObject:albumArt forKey:<span class="hljs-built_in">MPMediaItemPropertyArtwork</span>];<br>        [songInfo setObject:[<span class="hljs-built_in">NSNumber</span> numberWithDouble:currentTime] forKey:<span class="hljs-built_in">MPNowPlayingInfoPropertyElapsedPlaybackTime</span>];<br>        [songInfo setObject:[<span class="hljs-built_in">NSNumber</span> numberWithDouble:duration] forKey:<span class="hljs-built_in">MPMediaItemPropertyPlaybackDuration</span>];<br>        [[<span class="hljs-built_in">MPNowPlayingInfoCenter</span> defaultCenter] setNowPlayingInfo:songInfo];<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-built_in">AVPlayerItem</span> *)createPlayerItemWithUrl:(<span class="hljs-built_in">NSString</span> *)url &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">AVPlayerItem</span> playerItemWithURL:[<span class="hljs-built_in">NSURL</span> URLWithString:url]];<br>&#125;<br><br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><h3 id="æé—®"><a href="#æé—®" class="headerlink" title="æé—®"></a>æé—®</h3><p>æœ¬æ¥ç›¸åŒä½¿ç”¨AVQueuePlayeræ¥è¿›è¡Œåˆ—è¡¨æ’­æ”¾çš„ï¼Œä½†æ˜¯å½“åšå•æ›²å¾ªç¯çš„æ—¶å€™é‡åˆ°é—®é¢˜ï¼šé€šè¿‡é€šçŸ¥ç›‘å¬æ’­æ”¾å®Œæˆï¼Œåœ¨é€šçŸ¥çš„æ–¹æ³•é‡Œè¿›è¡Œå…·ä½“æ“ä½œï¼Œä½†æ˜¯è®¾ç½®æ— æ•ˆï¼Œç›´æ¥æ’­æ”¾çš„è¿˜æ˜¯ä¸‹ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœæœ‰äººçŸ¥é“å¦‚ä½•è§£å†³ï¼Œå¸®å¿™å›å¤ä¸€ä¸‹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶ï¼šè‡ªå®šä¹‰Alterå¼¹çª—</title>
    <link href="/2019/11/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%87%AA%E5%AE%9A%E4%B9%89Alter%E5%BC%B9%E7%AA%97/"/>
    <url>/2019/11/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E8%87%AA%E5%AE%9A%E4%B9%89Alter%E5%BC%B9%E7%AA%97/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-b779b2b4e3c10261.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼å›¾"></p><p>æ¨¡ä»¿å¾®ä¿¡åº•éƒ¨å¼¹çª—æ ·å¼ã€‚</p><h3 id="æ¥å£æ–‡ä»¶"><a href="#æ¥å£æ–‡ä»¶" class="headerlink" title="æ¥å£æ–‡ä»¶"></a>æ¥å£æ–‡ä»¶</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDAlterSheetModel</span> : <span class="hljs-title">NSObject</span></span><br><span class="hljs-comment">/// ä»…æ˜¾ç¤ºä¸»æ ‡é¢˜ é»‘è‰² ï¼Œ16å·å­—ä½“</span><br><span class="hljs-comment">/// @param title æ ‡é¢˜å†…å®¹</span><br>+ (WDAlterSheetModel *)setupWithTitle:(<span class="hljs-built_in">NSString</span> *)title;<br><br><span class="hljs-comment">/// ä¸»æ ‡é¢˜ï¼ˆé»‘è‰² ï¼Œ16å·å­—ä½“ï¼‰å’Œå‰¯æ ‡é¢˜ï¼ˆç°è‰² ï¼Œ10å·å­—ä½“ï¼‰</span><br><span class="hljs-comment">/// @param title ä¸»æ ‡é¢˜å†…å®¹</span><br><span class="hljs-comment">/// @param subTitle å‰¯æ ‡é¢˜å†…å®¹</span><br>+ (WDAlterSheetModel *)setupWithTitle:(<span class="hljs-built_in">NSString</span> *)title<br>                             subTitle:(<span class="hljs-built_in">NSString</span> *)subTitle;<br><br><br><span class="hljs-comment">/// ä»…æ˜¾ç¤ºä¸»æ ‡é¢˜ 16å·å­—ä½“</span><br><span class="hljs-comment">/// @param title æ ‡é¢˜å†…å®¹</span><br><span class="hljs-comment">/// @param titleColor é¢œè‰²é…ç½®</span><br>+ (WDAlterSheetModel *)setupWithTitle:(<span class="hljs-built_in">NSString</span> *)title<br>                           titleColor:(<span class="hljs-built_in">UIColor</span> *)titleColor;<br><br><br><span class="hljs-comment">/// ä»…æ˜¾ç¤ºä¸»æ ‡é¢˜</span><br><span class="hljs-comment">/// @param title ä¸»æ ‡é¢˜å†…å®¹</span><br><span class="hljs-comment">/// @param titleColor é¢œè‰²é…ç½®</span><br><span class="hljs-comment">/// @param titleFount å­—ä½“é…ç½®</span><br>+ (WDAlterSheetModel *)setupWithTitle:(<span class="hljs-built_in">NSString</span> *)title<br>                           titleColor:(<span class="hljs-built_in">UIColor</span> *)titleColor<br>                            titleFont:(<span class="hljs-built_in">UIFont</span> *)titleFount;<br><br><br><span class="hljs-comment">/// ä¸»æ ‡é¢˜å’Œå‰¯æ ‡é¢˜</span><br><span class="hljs-comment">/// @param title ä¸»æ ‡é¢˜å†…å®¹</span><br><span class="hljs-comment">/// @param titleColor ä¸»æ ‡é¢˜é¢œè‰²é…ç½®</span><br><span class="hljs-comment">/// @param titleFont ä¸»æ ‡é¢˜å­—ä½“é…ç½®</span><br><span class="hljs-comment">/// @param subTitle å‰¯æ ‡é¢˜å†…å®¹</span><br><span class="hljs-comment">/// @param subTitleColor å‰¯æ ‡é¢˜å­—ä½“é…ç½®</span><br><span class="hljs-comment">/// @param subTitleFont å‰¯æ ‡é¢˜å­—ä½“é…ç½®</span><br>+ (WDAlterSheetModel *)setupWithTitle:(<span class="hljs-built_in">NSString</span> *)title<br>                           titleColor:(<span class="hljs-built_in">UIColor</span> *)titleColor<br>                            titleFont:(<span class="hljs-built_in">UIFont</span> *)titleFont<br>                             subTitle:(<span class="hljs-built_in">NSString</span> *)subTitle<br>                        subTitleColor:(<span class="hljs-built_in">UIColor</span> *)subTitleColor<br>                         subTitleFont:(<span class="hljs-built_in">UIFont</span> *)subTitleFont;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-comment">// ç‚¹å‡»å›è°ƒï¼ˆå–æ¶ˆæŒ‰é’®é™¤å¤–ï¼‰</span><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">void</span> (^DidSelectedBlock)(<span class="hljs-built_in">NSUInteger</span> index);<br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDAlterSheetView</span> : <span class="hljs-title">UIControl</span></span><br><br><span class="hljs-comment">/// ä»…æ˜¾ç¤ºæŒ‰é’® é»˜è®¤æ ·å¼</span><br><span class="hljs-comment">/// @param items æŒ‰é’®æ–‡å­—æ•°ç»„</span><br>+ (<span class="hljs-keyword">void</span>)showAlterWithTitleItems:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)items<br>                 didSelectBlock:(DidSelectedBlock)selectBlock;<br><br><span class="hljs-comment">/// ä»…æ˜¾ç¤ºæŒ‰é’® è‡ªå®šä¹‰æ ·å¼æŒ‰é’®</span><br><span class="hljs-comment">/// @param items æŒ‰é’®æ ·å¼æ¨¡å‹æ•°ç»„</span><br>+ (<span class="hljs-keyword">void</span>)showAlterWithTitleAttItems:(<span class="hljs-built_in">NSArray</span>&lt;WDAlterSheetModel *&gt; *)items<br>                    didSelectBlock:(DidSelectedBlock)selectBlock;<br><br><br><span class="hljs-comment">/// æ˜¾ç¤ºæŒ‰é’®ï¼ˆé»˜è®¤æ ·å¼ï¼‰ + å–æ¶ˆæŒ‰é’®</span><br><span class="hljs-comment">/// @param items æŒ‰é’®æ–‡å­—æ•°ç»„</span><br><span class="hljs-comment">/// @param cancelText å–æ¶ˆæŒ‰é’®æ–‡å­—</span><br><span class="hljs-comment">/// @param cancelColor å–æ¶ˆæŒ‰é’®é¢œè‰²</span><br>+ (<span class="hljs-keyword">void</span>)showAlterWithTitleItems:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)items<br>                     cancelText:(<span class="hljs-built_in">NSString</span> *)cancelText<br>                    cancelColor:(<span class="hljs-built_in">UIColor</span> * _Nullable)cancelColor <span class="hljs-comment">// é»˜è®¤é¢œè‰²çº¢è‰²</span><br>                 didSelectBlock:(DidSelectedBlock)selectBlock;<br><br><span class="hljs-comment">/// æ˜¾ç¤ºæŒ‰é’®ï¼ˆè‡ªå®šä¹‰æ ·å¼ï¼‰ + å–æ¶ˆæŒ‰é’®</span><br><span class="hljs-comment">/// @param items æŒ‰é’®æ ·å¼æ¨¡å‹æ•°ç»„</span><br><span class="hljs-comment">/// @param cancelText å–æ¶ˆæŒ‰é’®æ–‡å­—</span><br><span class="hljs-comment">/// @param cancelColor å–æ¶ˆæŒ‰é’®é¢œè‰²</span><br>+ (<span class="hljs-keyword">void</span>)showAlterWithTitleAttItems:(<span class="hljs-built_in">NSArray</span>&lt;WDAlterSheetModel *&gt; *)items<br>                        cancelText:(<span class="hljs-built_in">NSString</span> *)cancelText<br>                       cancelColor:(<span class="hljs-built_in">UIColor</span> * _Nullable)cancelColor <span class="hljs-comment">// é»˜è®¤é¢œè‰²çº¢è‰²</span><br>                    didSelectBlock:(DidSelectedBlock)selectBlock;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br></code></pre></td></tr></table></figure><h3 id="å®ç°æ–‡ä»¶"><a href="#å®ç°æ–‡ä»¶" class="headerlink" title="å®ç°æ–‡ä»¶"></a>å®ç°æ–‡ä»¶</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;WDAlterSheetView.h&quot;</span></span><br><span class="hljs-comment">// æŒ‰é’®é«˜åº¦</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">CGFloat</span> KButtonHeight = <span class="hljs-number">55</span>;<br><span class="hljs-comment">// å–æ¶ˆæŒ‰é’®ä¸å…¶ä»–é—´è·</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">CGFloat</span> KSpace = <span class="hljs-number">8</span>;<br><span class="hljs-comment">// åœ†è§’</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">CGFloat</span> KCornersSpace = <span class="hljs-number">10</span>;<br><br><span class="hljs-comment">// å±å¹•é«˜åº¦</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">CGFloat</span> kScreenHeight() &#123;<br>    <span class="hljs-keyword">return</span> [[<span class="hljs-built_in">UIScreen</span> mainScreen] bounds].size.height;<br>&#125;<br><br><span class="hljs-comment">// å±å¹•å®½åº¦</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">CGFloat</span> kScreenWidth() &#123;<br>    <span class="hljs-keyword">return</span> [[<span class="hljs-built_in">UIScreen</span> mainScreen] bounds].size.width;<br>&#125;<br><br><span class="hljs-comment">// æ˜¯å¦æ˜¯åˆ˜æµ·å±</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">BOOL</span> kDevice_iPhoneX() &#123;<br>    <span class="hljs-built_in">BOOL</span> isPhoneX = <span class="hljs-literal">NO</span>;<br>    <span class="hljs-keyword">if</span> (@available(iOS <span class="hljs-number">11.0</span>, *)) &#123;<br>        isPhoneX = [[<span class="hljs-built_in">UIApplication</span> sharedApplication] delegate].window.safeAreaInsets.bottom &gt; <span class="hljs-number">0.0</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> isPhoneX;<br>&#125;<br><br><span class="hljs-comment">// ä¸»æ ‡é¢˜é¢œè‰²</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">UIColor</span> * kTitleColor() &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">UIColor</span> colorWithRed:<span class="hljs-number">0.1</span> green:<span class="hljs-number">0.1</span> blue:<span class="hljs-number">0.1</span> alpha:<span class="hljs-number">1</span>];<br>&#125;<br><br><span class="hljs-comment">// å‰¯æ ‡é¢˜é¢œè‰²</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">UIColor</span> * kSubTitleColor() &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">UIColor</span> colorWithRed:<span class="hljs-number">0.90</span> green:<span class="hljs-number">0.90</span> blue:<span class="hljs-number">0.90</span> alpha:<span class="hljs-number">1</span>];<br>&#125;<br><br><span class="hljs-comment">// é—´éš™é¢œè‰²</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">UIColor</span> * kSpaceColor() &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">UIColor</span> colorWithRed:<span class="hljs-number">0.95</span> green:<span class="hljs-number">0.95</span> blue:<span class="hljs-number">0.95</span> alpha:<span class="hljs-number">1</span>];<br>&#125;<br><br><span class="hljs-comment">// åˆ†å‰²çº¿é¢œè‰²</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">UIColor</span> * kSpaceLineColor() &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">UIColor</span> colorWithRed:<span class="hljs-number">0.90</span> green:<span class="hljs-number">0.90</span> blue:<span class="hljs-number">0.90</span> alpha:<span class="hljs-number">1</span>];<br>&#125;<br><br><span class="hljs-comment">// ä¸»æ ‡é¢˜å­—ä½“</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">UIFont</span> * kTitleFont() &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">UIFont</span> systemFontOfSize:<span class="hljs-number">16</span>];<br>&#125;<br><br><span class="hljs-comment">// å‰¯æ ‡é¢˜å­—ä½“</span><br><span class="hljs-keyword">static</span> <span class="hljs-built_in">UIFont</span> * kSubTitleFont() &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">UIFont</span> systemFontOfSize:<span class="hljs-number">12</span>];<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDAlterSheetModel</span> ()</span><br><span class="hljs-comment">// æ–‡å­—</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) <span class="hljs-built_in">NSString</span> *title;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) <span class="hljs-built_in">NSString</span> *subTitle;<br><span class="hljs-comment">// é¢œè‰²</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIColor</span> *titleColor;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIColor</span> *subTitleColor;<br><span class="hljs-comment">// å­—ä½“</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIFont</span> *titleFont;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIFont</span> *subTitleFont;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">WDAlterSheetModel</span></span><br><br>+ (WDAlterSheetModel *)setupWithTitle:(<span class="hljs-built_in">NSString</span> *)title &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> setupWithTitle:title titleColor:kTitleColor()];<br>&#125;<br><br>+ (WDAlterSheetModel *)setupWithTitle:(<span class="hljs-built_in">NSString</span> *)title<br>                             subTitle:(<span class="hljs-built_in">NSString</span> *)subTitle &#123;<br>    <br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> setupWithTitle:title<br>                    titleColor:kTitleColor()<br>                    titleFont:kTitleFont()<br>                       subTitle:subTitle<br>                  subTitleColor:kSubTitleColor()<br>                  subTitleFont:kSubTitleFont()];<br>&#125;<br><br>+ (WDAlterSheetModel *)setupWithTitle:(<span class="hljs-built_in">NSString</span> *)title<br>                           titleColor:(<span class="hljs-built_in">UIColor</span> *)titleColor &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> setupWithTitle:title titleColor:titleColor titleFont:kTitleFont()];<br>&#125;<br><br>+ (WDAlterSheetModel *)setupWithTitle:(<span class="hljs-built_in">NSString</span> *)title<br>                           titleColor:(<span class="hljs-built_in">UIColor</span> *)titleColor<br>                            titleFont:(<span class="hljs-built_in">UIFont</span> *)titleFont &#123;<br>    <br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> setupWithTitle:title<br>                     titleColor:titleColor<br>                      titleFont:titleFont<br>                       subTitle:<span class="hljs-string">@&quot;&quot;</span><br>                  subTitleColor:kSubTitleColor()<br>                   subTitleFont:kSubTitleFont()];<br>&#125;<br><br><br>+ (WDAlterSheetModel *)setupWithTitle:(<span class="hljs-built_in">NSString</span> *)title<br>                           titleColor:(<span class="hljs-built_in">UIColor</span> *)titleColor<br>                            titleFont:(<span class="hljs-built_in">UIFont</span> *)titleFont<br>                             subTitle:(<span class="hljs-built_in">NSString</span> *)subTitle<br>                        subTitleColor:(<span class="hljs-built_in">UIColor</span> *)subTitleColor<br>                         subTitleFont:(<span class="hljs-built_in">UIFont</span> *)subTitleFont &#123;<br>    WDAlterSheetModel *model = [[WDAlterSheetModel alloc] init];<br>    model.title = title;<br>    model.titleColor = titleColor;<br>    model.titleFont = titleFont;<br>    model.subTitle = subTitle;<br>    model.subTitleColor = subTitleColor;<br>    model.subTitleFont = subTitleFont;<br>    <span class="hljs-keyword">return</span> model;<br>&#125;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDAlterSheetControl</span> : <span class="hljs-title">UIControl</span></span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UILabel</span> *titleLabel;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UILabel</span> *subTitleLabel;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSLayoutConstraint</span> *&gt; *totalLayoutConstraints;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIView</span> *bottomLineView;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">WDAlterSheetControl</span></span><br>- (<span class="hljs-keyword">instancetype</span>)init &#123;<br>    <span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> init];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) &#123;<br>        <span class="hljs-keyword">self</span>.backgroundColor = [<span class="hljs-built_in">UIColor</span> whiteColor];<br>        <br>        _titleLabel = [[<span class="hljs-built_in">UILabel</span> alloc] init];<br>        _titleLabel.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal">NO</span>;<br>        _titleLabel.textAlignment = <span class="hljs-built_in">NSTextAlignmentCenter</span>;<br>        [<span class="hljs-keyword">self</span> addSubview:_titleLabel];<br>        <br>        _subTitleLabel = [[<span class="hljs-built_in">UILabel</span> alloc] init];<br>        _subTitleLabel.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal">NO</span>;<br>        _subTitleLabel.textAlignment = <span class="hljs-built_in">NSTextAlignmentCenter</span>;<br>        [<span class="hljs-keyword">self</span> addSubview:_subTitleLabel];<br>        <br>        _bottomLineView = [[<span class="hljs-built_in">UIView</span> alloc] init];<br>        _bottomLineView.backgroundColor = kSpaceLineColor();<br>        [<span class="hljs-keyword">self</span> addSubview:_bottomLineView];<br>    <br>        <span class="hljs-keyword">self</span>.totalLayoutConstraints = @[<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeBottom</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">-2</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_subTitleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_subTitleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeTop</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">2</span>],<br>        ];<br>        [<span class="hljs-keyword">self</span> addConstraints:<span class="hljs-keyword">self</span>.totalLayoutConstraints];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)layoutSubviews &#123;<br>    [<span class="hljs-keyword">super</span> layoutSubviews];<br>    <br>    _bottomLineView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">CGRectGetHeight</span>(<span class="hljs-keyword">self</span>.frame) - <span class="hljs-number">0.5</span>, <span class="hljs-built_in">CGRectGetWidth</span>(<span class="hljs-keyword">self</span>.frame), <span class="hljs-number">0.5</span>);<br>    <br>    <span class="hljs-keyword">if</span> (_subTitleLabel.text.length == <span class="hljs-number">0</span>) &#123;<br>        [<span class="hljs-keyword">self</span> removeConstraints:<span class="hljs-keyword">self</span>.totalLayoutConstraints];<br>        [<span class="hljs-keyword">self</span> addConstraints:@[<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_subTitleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_subTitleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>        ]];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDAlterSheetLastControl</span> : <span class="hljs-title">UIControl</span></span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UILabel</span> *titleLabel;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UILabel</span> *subTitleLabel;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSLayoutConstraint</span> *&gt; *totalLayoutConstraints;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIView</span> *bottomView;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">WDAlterSheetLastControl</span></span><br><br>- (<span class="hljs-keyword">instancetype</span>)init &#123;<br>    <span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> init];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) &#123;<br>        <br>        <span class="hljs-keyword">self</span>.backgroundColor = [<span class="hljs-built_in">UIColor</span> whiteColor];<br>        <br>        _titleLabel = [[<span class="hljs-built_in">UILabel</span> alloc] init];<br>        _titleLabel.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal">NO</span>;<br>        _titleLabel.textAlignment = <span class="hljs-built_in">NSTextAlignmentCenter</span>;<br>        [<span class="hljs-keyword">self</span> addSubview:_titleLabel];<br>        <br>        _subTitleLabel = [[<span class="hljs-built_in">UILabel</span> alloc] init];<br>        _subTitleLabel.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal">NO</span>;<br>        _subTitleLabel.textAlignment = <span class="hljs-built_in">NSTextAlignmentCenter</span>;<br>        [<span class="hljs-keyword">self</span> addSubview:_subTitleLabel];<br>        <br>        _bottomView = [[<span class="hljs-built_in">UIView</span> alloc] init];<br>        _bottomView.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal">NO</span>;<br>        _bottomView.backgroundColor = [<span class="hljs-built_in">UIColor</span> clearColor];<br>        [<span class="hljs-keyword">self</span> addSubview:_bottomView];<br>        <br>        <span class="hljs-keyword">self</span>.totalLayoutConstraints = @[<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeBottom</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">-2</span> - (kDevice_iPhoneX() ? <span class="hljs-number">34</span> : <span class="hljs-number">0</span>)],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_subTitleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_subTitleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeTop</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">2</span> - (kDevice_iPhoneX() ? <span class="hljs-number">34</span> : <span class="hljs-number">0</span>)],<br>        ];<br>        <br>        <span class="hljs-built_in">NSMutableArray</span> *array = [<span class="hljs-built_in">NSMutableArray</span> array];<br>        [array addObjectsFromArray:@[<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_bottomView attribute:<span class="hljs-built_in">NSLayoutAttributeBottom</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeBottom</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_bottomView attribute:<span class="hljs-built_in">NSLayoutAttributeHeight</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-literal">nil</span> attribute:<span class="hljs-built_in">NSLayoutAttributeHeight</span> multiplier:<span class="hljs-number">1</span> constant:kDevice_iPhoneX() ? <span class="hljs-number">34</span> : <span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_bottomView attribute:<span class="hljs-built_in">NSLayoutAttributeLeading</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeLeading</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_bottomView attribute:<span class="hljs-built_in">NSLayoutAttributeTrailing</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeTrailing</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>]<br>        ]];<br>        [array addObjectsFromArray:<span class="hljs-keyword">self</span>.totalLayoutConstraints];<br>        [<span class="hljs-keyword">self</span> addConstraints:array];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)layoutSubviews &#123;<br>    [<span class="hljs-keyword">super</span> layoutSubviews];<br>    <br>    <span class="hljs-keyword">if</span> (_subTitleLabel.text.length == <span class="hljs-number">0</span>) &#123;<br>        [<span class="hljs-keyword">self</span> removeConstraints:<span class="hljs-keyword">self</span>.totalLayoutConstraints];<br>        [<span class="hljs-keyword">self</span> addConstraints:@[<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_titleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:- (kDevice_iPhoneX() ? <span class="hljs-number">34</span> : <span class="hljs-number">0</span>) / <span class="hljs-number">2</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_subTitleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterX</span> multiplier:<span class="hljs-number">1</span> constant:<span class="hljs-number">0</span>],<br>            [<span class="hljs-built_in">NSLayoutConstraint</span> constraintWithItem:_subTitleLabel attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> relatedBy:<span class="hljs-built_in">NSLayoutRelationEqual</span> toItem:<span class="hljs-keyword">self</span> attribute:<span class="hljs-built_in">NSLayoutAttributeCenterY</span> multiplier:<span class="hljs-number">1</span> constant:- (kDevice_iPhoneX() ? <span class="hljs-number">34</span> : <span class="hljs-number">0</span>) / <span class="hljs-number">2</span>],<br>        ]];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">@end</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDAlterSheetView</span> ()</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIView</span> *backView;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> totalHeight;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">copy</span>) DidSelectedBlock selectedBlock;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">WDAlterSheetView</span></span><br><br>+ (<span class="hljs-keyword">instancetype</span>)shared &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_once_t</span> onceToken;<br>    <span class="hljs-keyword">static</span> WDAlterSheetView *view = <span class="hljs-literal">nil</span>;<br>    <span class="hljs-built_in">dispatch_once</span>(&amp;onceToken, ^&#123;<br>        view = [[WDAlterSheetView alloc] init];<br>        view.frame = [[<span class="hljs-built_in">UIScreen</span> mainScreen] bounds];<br>    &#125;);<br>    <span class="hljs-keyword">return</span> view;<br>&#125;<br><br>- (<span class="hljs-keyword">instancetype</span>)init &#123;<br>    <span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> init];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) &#123;<br>        [<span class="hljs-keyword">self</span> addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(hidenView) forControlEvents: <span class="hljs-built_in">UIControlEventTouchUpInside</span>];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showAlterWithTitleItems:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)items<br>                 didSelectBlock:(DidSelectedBlock)selectBlock &#123;<br>    [<span class="hljs-keyword">self</span> showAlterWithTitleItems:items cancelText:<span class="hljs-string">@&quot;&quot;</span> cancelColor:<span class="hljs-literal">nil</span> didSelectBlock:selectBlock];<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showAlterWithTitleItems:(<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)items<br>                     cancelText:(<span class="hljs-built_in">NSString</span> *)cancelText<br>                    cancelColor:(<span class="hljs-built_in">UIColor</span> *)cancelColor<br>                 didSelectBlock:(DidSelectedBlock)selectBlock &#123;<br>    <br>    <span class="hljs-built_in">NSMutableArray</span>&lt;WDAlterSheetModel *&gt; *array = [<span class="hljs-built_in">NSMutableArray</span> arrayWithCapacity:items.count];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">NSString</span> *title <span class="hljs-keyword">in</span> items) &#123;<br>        WDAlterSheetModel *model = [WDAlterSheetModel setupWithTitle:title];<br>        [array addObject:model];<br>    &#125;<br>    [<span class="hljs-keyword">self</span> showAlterWithTitleAttItems:array cancelText:cancelText cancelColor:cancelColor didSelectBlock:selectBlock];<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showAlterWithTitleAttItems:(<span class="hljs-built_in">NSArray</span>&lt;WDAlterSheetModel *&gt; *)items<br>                    didSelectBlock:(DidSelectedBlock)selectBlock &#123;<br>    [<span class="hljs-keyword">self</span> showAlterWithTitleAttItems:items cancelText:<span class="hljs-string">@&quot;&quot;</span> cancelColor:<span class="hljs-literal">nil</span> didSelectBlock:selectBlock];<br>&#125;<br><br>+ (<span class="hljs-keyword">void</span>)showAlterWithTitleAttItems:(<span class="hljs-built_in">NSArray</span>&lt;WDAlterSheetModel *&gt; *)items<br>                        cancelText:(<span class="hljs-built_in">NSString</span> *)cancelText<br>                       cancelColor:(<span class="hljs-built_in">UIColor</span> *)cancelColor<br>                    didSelectBlock:(DidSelectedBlock)selectBlock &#123;<br><br>    <span class="hljs-built_in">NSAssert</span>(items.count &gt; <span class="hljs-number">0</span>, <span class="hljs-string">@&quot;Thead Reason ===&gt; [WDAlterSheetView Â· itmes`count not be null]&quot;</span>);<br>       <br>    WDAlterSheetView *view = [WDAlterSheetView shared];<br>    view.selectedBlock = selectBlock;<br>    [view addSubViews];<br>    <br>    <span class="hljs-built_in">CGFloat</span> cornersSpace = KCornersSpace;<br>    <span class="hljs-keyword">if</span> (items.firstObject.subTitle.length == <span class="hljs-number">0</span>) &#123;<br>        cornersSpace = <span class="hljs-number">0</span>;<br>    &#125;<br>    <br>    <span class="hljs-built_in">NSMutableArray</span> *array = [<span class="hljs-built_in">NSMutableArray</span> arrayWithArray:items];<br>    <span class="hljs-keyword">if</span> (cancelText.length != <span class="hljs-number">0</span>) &#123;<br>        WDAlterSheetModel *cancelModel = [WDAlterSheetModel setupWithTitle:cancelText titleColor:cancelColor];<br>        <span class="hljs-keyword">if</span> (cancelColor == <span class="hljs-literal">nil</span>) &#123;<br>            cancelModel = [WDAlterSheetModel setupWithTitle:cancelText titleColor:[<span class="hljs-built_in">UIColor</span> redColor]];<br>        &#125;<br>        [array addObject:cancelModel];<br>    &#125;<br>    <br>    [array enumerateObjectsUsingBlock:^(WDAlterSheetModel * _Nonnull obj, <span class="hljs-built_in">NSUInteger</span> idx, <span class="hljs-built_in">BOOL</span> * _Nonnull stop) &#123;<br>        <span class="hljs-keyword">if</span> (idx == array.count - <span class="hljs-number">1</span>) &#123;<br>            WDAlterSheetLastControl *button = [view createLastButtonWithModel:obj tag:idx];<br>            <span class="hljs-keyword">if</span> (cancelText.length == <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">if</span> (kDevice_iPhoneX()) &#123;<br>                    button.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, KButtonHeight * (items.count - <span class="hljs-number">1</span>) + cornersSpace, kScreenWidth(), KButtonHeight + <span class="hljs-number">34</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    button.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, KButtonHeight * (items.count - <span class="hljs-number">1</span>) + cornersSpace, kScreenWidth(), KButtonHeight);<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">if</span> (kDevice_iPhoneX()) &#123;<br>                    button.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, KButtonHeight * items.count + KSpace + cornersSpace, kScreenWidth(), KButtonHeight + <span class="hljs-number">34</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    button.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, KButtonHeight * items.count + KSpace + cornersSpace, kScreenWidth(), KButtonHeight);<br>                &#125;<br>            &#125;<br>            [view.backView addSubview:button];<br><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            WDAlterSheetControl *button = [view createButtonWithModel:obj tag:idx];<br>            <span class="hljs-keyword">if</span> (idx == <span class="hljs-number">0</span>) &#123;<br>                button.bottomLineView.hidden = idx == items.count - <span class="hljs-number">1</span>;<br>                button.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, kScreenWidth(), KButtonHeight + cornersSpace);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                button.bottomLineView.hidden = idx == items.count - <span class="hljs-number">2</span>;<br>                button.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, cornersSpace + KButtonHeight * idx, kScreenWidth(), KButtonHeight);<br>            &#125;<br>            [view.backView addSubview:button];<br>        &#125;<br>    &#125;];<br><br>    <br>    [view showView];<br>    <br>    <span class="hljs-built_in">CGFloat</span> totoalHeight = KButtonHeight * items.count;<br>    <br>    <span class="hljs-keyword">if</span> (cancelText.length != <span class="hljs-number">0</span>) &#123;<br>        totoalHeight += KSpace + KButtonHeight;<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (kDevice_iPhoneX()) &#123;<br>        totoalHeight += <span class="hljs-number">34</span>;<br>    &#125;<br>    <br>    view.backView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, kScreenHeight(), kScreenWidth(), totoalHeight);<br><br>    [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.35</span> animations:^&#123;<br>        view.backgroundColor = [<span class="hljs-built_in">UIColor</span> colorWithWhite:<span class="hljs-number">0</span> alpha:<span class="hljs-number">0.35</span>];<br>        view.backView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, kScreenHeight() - totoalHeight, kScreenWidth(), totoalHeight);<br>    &#125;];<br>    [<span class="hljs-keyword">self</span> setupRoundedCornersWithView:view.backView];<br><br>    view.totalHeight = totoalHeight;<br>&#125;<br><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Private</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark Operation Methods</span><br>- (<span class="hljs-built_in">UIView</span> *)kWindowView &#123;<br>    <span class="hljs-keyword">if</span> ([<span class="hljs-keyword">self</span> viewController].view != <span class="hljs-literal">nil</span>) &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span> viewController].view;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([<span class="hljs-built_in">UIApplication</span> sharedApplication].delegate.window != <span class="hljs-literal">nil</span>) &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">UIApplication</span> sharedApplication].delegate.window;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">UIApplication</span> sharedApplication].keyWindow;<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)hidenView &#123;<br>    [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.35</span> animations:^&#123;<br>        <span class="hljs-keyword">self</span>.backView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, kScreenHeight(), kScreenWidth(), <span class="hljs-keyword">self</span>.totalHeight);<br>        <span class="hljs-keyword">self</span>.backgroundColor = [<span class="hljs-built_in">UIColor</span> colorWithWhite:<span class="hljs-number">0</span> alpha:<span class="hljs-number">0</span>];<br>    &#125; completion:^(<span class="hljs-built_in">BOOL</span> finished) &#123;<br>        [<span class="hljs-keyword">self</span> removeSubViews];<br>        [<span class="hljs-keyword">self</span> removeFromSuperview];<br>    &#125;];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)showView &#123;<br>    <span class="hljs-keyword">self</span>.backgroundColor = [<span class="hljs-built_in">UIColor</span> colorWithWhite:<span class="hljs-number">0</span> alpha:<span class="hljs-number">0</span>];<br>    [[<span class="hljs-keyword">self</span> kWindowView] addSubview:<span class="hljs-keyword">self</span>];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)addSubViews &#123;<br>    _backView = [[<span class="hljs-built_in">UIView</span> alloc] init];<br>    _backView.backgroundColor = kSpaceColor();<br>    [<span class="hljs-keyword">self</span> addSubview:_backView];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)removeSubViews &#123;<br>    [_backView removeFromSuperview];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark Target Action Method</span><br>- (<span class="hljs-keyword">void</span>)buttonDidClickTargetAction:(<span class="hljs-built_in">UIControl</span> *)sender &#123;<br>    sender.backgroundColor = [<span class="hljs-built_in">UIColor</span> whiteColor];<br><br>    [<span class="hljs-keyword">self</span> hidenView];<br>    <span class="hljs-keyword">if</span> (sender.tag != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.selectedBlock) &#123;<br>            <span class="hljs-keyword">self</span>.selectedBlock(sender.tag - <span class="hljs-number">1</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)buttonTouchUpOutSideTargetAction:(<span class="hljs-built_in">UIControl</span> *)sender &#123;<br>    sender.backgroundColor = [<span class="hljs-built_in">UIColor</span> colorWithRed:<span class="hljs-number">0.93</span> green:<span class="hljs-number">0.93</span> blue:<span class="hljs-number">0.93</span> alpha:<span class="hljs-number">1</span>];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark Common UI Create Methods</span><br>- (<span class="hljs-built_in">UIButton</span> *)creatButton:(<span class="hljs-built_in">NSString</span> *)title tag:(<span class="hljs-built_in">NSUInteger</span>)tag &#123;<br>    <span class="hljs-built_in">UIButton</span> *button = [[<span class="hljs-built_in">UIButton</span> alloc] init];<br>    button.tag = tag;<br>    [button setTitle:title forState:<span class="hljs-built_in">UIControlStateNormal</span>];<br>    button.titleLabel.font = kTitleFont();<br>    button.backgroundColor = [<span class="hljs-built_in">UIColor</span> whiteColor];<br>    [button addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(buttonDidClickTargetAction:) forControlEvents:<span class="hljs-built_in">UIControlEventTouchUpInside</span>];<br>    <span class="hljs-keyword">return</span> button;<br>&#125;<br><br>- (WDAlterSheetControl *)createButtonWithModel:(WDAlterSheetModel *)model tag:(<span class="hljs-built_in">NSUInteger</span>)tag &#123;<br>    WDAlterSheetControl *v = [[WDAlterSheetControl alloc] init];<br>    v.titleLabel.text = model.title;<br>    v.titleLabel.textColor = model.titleColor;<br>    v.titleLabel.font = model.titleFont;<br>    v.subTitleLabel.text = model.subTitle;<br>    v.subTitleLabel.textColor = model.subTitleColor;<br>    v.subTitleLabel.font = model.subTitleFont;<br>    v.tag = tag;<br>    [v addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(buttonTouchUpOutSideTargetAction:) forControlEvents:<span class="hljs-built_in">UIControlEventTouchDown</span>];<br>    [v addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(buttonDidClickTargetAction:) forControlEvents:<span class="hljs-built_in">UIControlEventTouchUpInside</span>];<br>    <span class="hljs-keyword">return</span> v;<br>&#125;<br><br>- (WDAlterSheetLastControl *)createLastButtonWithModel:(WDAlterSheetModel *)model tag:(<span class="hljs-built_in">NSUInteger</span>)tag &#123;<br>    WDAlterSheetLastControl *v = [[WDAlterSheetLastControl alloc] init];<br>    v.titleLabel.text = model.title;<br>    v.titleLabel.textColor = model.titleColor;<br>    v.titleLabel.font = model.titleFont;<br>    v.subTitleLabel.text = model.subTitle;<br>    v.subTitleLabel.textColor = model.subTitleColor;<br>    v.subTitleLabel.font = model.subTitleFont;<br>    v.tag = tag;<br>    [v addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(buttonTouchUpOutSideTargetAction:) forControlEvents:<span class="hljs-built_in">UIControlEventTouchDown</span>];<br>    [v addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(buttonDidClickTargetAction:) forControlEvents:<span class="hljs-built_in">UIControlEventTouchUpInside</span>];<br>    <span class="hljs-keyword">return</span> v;<br>&#125;<br><br>- (<span class="hljs-built_in">UIViewController</span> *)viewController &#123;<br>    <span class="hljs-built_in">UIResponder</span> *next = [<span class="hljs-keyword">self</span> nextResponder];<br>    <span class="hljs-keyword">do</span> &#123;<br>        <span class="hljs-keyword">if</span> ([next isKindOfClass:[<span class="hljs-built_in">UIViewController</span> <span class="hljs-keyword">class</span>]]) &#123;<br>            <span class="hljs-keyword">return</span> (<span class="hljs-built_in">UIViewController</span> *)next;<br>        &#125;<br>        next = [next nextResponder];<br>    &#125; <span class="hljs-keyword">while</span> (next != <span class="hljs-literal">nil</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Tool Method</span><br>+ (<span class="hljs-keyword">void</span>)setupRoundedCornersWithView:(<span class="hljs-built_in">UIView</span> *)view &#123;<br>    <br>    <span class="hljs-built_in">CAShapeLayer</span> *mask = [<span class="hljs-built_in">CAShapeLayer</span> layer];<br>    <span class="hljs-built_in">UIBezierPath</span> * path = [<span class="hljs-built_in">UIBezierPath</span> bezierPathWithRoundedRect:view.bounds<br>                                                byRoundingCorners:(<span class="hljs-built_in">UIRectCornerTopLeft</span> | <span class="hljs-built_in">UIRectCornerTopRight</span>)<br>                                                      cornerRadii:<span class="hljs-built_in">CGSizeMake</span>(<span class="hljs-number">15</span>, <span class="hljs-number">15</span>)];<br>    mask.path = path.CGPath;<br>    mask.frame = view.bounds;<br>    <br>    <span class="hljs-built_in">CAShapeLayer</span> *borderLayer = [<span class="hljs-built_in">CAShapeLayer</span> layer];<br>    borderLayer.path = path.CGPath;<br>    borderLayer.fillColor = [<span class="hljs-built_in">UIColor</span> clearColor].CGColor;<br>    borderLayer.strokeColor = [<span class="hljs-built_in">UIColor</span> clearColor].CGColor;<br>    borderLayer.lineWidth = <span class="hljs-number">0</span>;<br>    borderLayer.frame = view.bounds;<br>    view.layer.mask = mask;<br>    [view.layer addSublayer:borderLayer];<br>&#125;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨å®ä¾‹"><a href="#ä½¿ç”¨å®ä¾‹" class="headerlink" title="ä½¿ç”¨å®ä¾‹"></a>ä½¿ç”¨å®ä¾‹</h3><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">WDAlterSheetModel *m1 = [WDAlterSheetModel setupWithTitle:<span class="hljs-string">@&quot;æ‹æ‘„&quot;</span> titleColor:<span class="hljs-built_in">UIColor</span>.blackColor titleFont:[<span class="hljs-built_in">UIFont</span> systemFontOfSize:<span class="hljs-number">16</span>] subTitle:<span class="hljs-string">@&quot;ç…§ç‰‡æˆ–è§†é¢‘&quot;</span> subTitleColor:<span class="hljs-built_in">UIColor</span>.lightGrayColor subTitleFont:[<span class="hljs-built_in">UIFont</span> systemFontOfSize:<span class="hljs-number">11</span>]];<br>WDAlterSheetModel *m2 = [WDAlterSheetModel setupWithTitle:<span class="hljs-string">@&quot;ä»æ‰‹æœºç›¸å†Œé€‰æ‹©&quot;</span> titleColor:<span class="hljs-built_in">UIColor</span>.blackColor];<br>[WDAlterSheetView showAlterWithTitleAttItems:@[m1, m2] cancelText:<span class="hljs-string">@&quot;å–æ¶ˆ&quot;</span> cancelColor:[<span class="hljs-built_in">UIColor</span> redColor] didSelectBlock:^(<span class="hljs-built_in">NSUInteger</span> index) &#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;ç‚¹å‡»äº†ï¼š%lu&quot;</span>, index);<br>&#125;];<br></code></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹å›¾"><a href="#ç¤ºä¾‹å›¾" class="headerlink" title="ç¤ºä¾‹å›¾"></a>ç¤ºä¾‹å›¾</h3><p><img src="https://upload-images.jianshu.io/upload_images/3334769-afd04fff32d300b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.7 inch"></p><p><img src="https://upload-images.jianshu.io/upload_images/3334769-d6bab3410bbf2317.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ˜æµ·å±"></p><p><img src="https://upload-images.jianshu.io/upload_images/3334769-dc10a58e38728cb5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="åˆ˜æµ·å±"></p>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶-ä¸€ä¸ªç®€æ˜“çš„Combobox</title>
    <link href="/2019/10/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%9A%84Combobox/"/>
    <url>/2019/10/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%B8%80%E4%B8%AA%E7%AE%80%E6%98%93%E7%9A%84Combobox/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-72958ace35bcee4e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨å›¾"></p><p>ä»£ç ç®€å•æ˜“æ‡‚ï¼Œå±äºè‡ªå·±ç»ƒæ‰‹çš„ä»£ç ï¼Œè¿˜åœ¨å­¦ä¹ ï¼Œå†™çš„ä¸å¥½ï¼Œå¸Œæœ›å‹¿å–·<br>1ã€å¤´æ–‡ä»¶</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">NS_ENUM</span>(<span class="hljs-built_in">NSInteger</span>, WDComboBoxControlDirection) &#123;<br>    WDComboBoxControlDirectionTop,<br>    WDComboBoxControlDirectionLeading,<br>    WDComboBoxControlDirectionTrailing,<br>    WDComboBoxControlDirectionBottom,<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">@protocol</span> <span class="hljs-title">WDComboBoxControlDataSource</span> &lt;<span class="hljs-title">NSObject</span>&gt;</span><br><span class="hljs-keyword">@optional</span><br><span class="hljs-comment">/** &lt; æ•°æ®æ•°ç»„ &gt; */</span><br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *&gt; *)dataSourceOfColunm;<br><span class="hljs-keyword">@required</span><br><span class="hljs-comment">/** &lt; æ ‡é¢˜æ•°ç»„ &gt; */</span><br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)titleOfSection;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@protocol</span> <span class="hljs-title">WDComboBoxControlDelegate</span> &lt;<span class="hljs-title">NSObject</span>&gt;</span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> ç‚¹å‡»äº‹ä»¶</span><br><span class="hljs-comment"> </span><br><span class="hljs-comment"> @param indexPath indexPath description</span><br><span class="hljs-comment"> @param title title description</span><br><span class="hljs-comment"> @param sourceView sourceView description</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)selectedAtIndexPath:(<span class="hljs-built_in">NSIndexPath</span> *)indexPath resultTitle:(<span class="hljs-built_in">NSString</span> *)title fromSourceView:(<span class="hljs-built_in">UIView</span> *)sourceView;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDComboBoxControl</span> : <span class="hljs-title">UIView</span></span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">weak</span>) <span class="hljs-keyword">id</span> &lt;WDComboBoxControlDataSource&gt; dataSource;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">weak</span>) <span class="hljs-keyword">id</span> &lt;WDComboBoxControlDelegate&gt; delegate;<br><span class="hljs-comment">/** &lt; èƒŒæ™¯æŒ‰é’®ï¼Œå¯ä»¥å®šä¹‰éœ€è¦çš„å±æ€§ &gt; */</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIButton</span> *backgroundButton;<br><span class="hljs-comment">/** &lt; å†…å®¹TableViewï¼Œä¹Ÿå¯ä»¥å®šä¹‰ä¸€äº›å±æ€§ &gt; */</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UITableView</span> *tableView;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> åˆå§‹åŒ–æ–¹æ³•</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param height æ˜¾ç¤ºå†…å®¹é«˜åº¦</span><br><span class="hljs-comment"> @param view å‚è€ƒView</span><br><span class="hljs-comment"> @return return value description</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">instancetype</span>)initViewWithMaxHeight:(<span class="hljs-built_in">CGFloat</span>)height fromView:(<span class="hljs-built_in">UIView</span> *)view showDirection:(WDComboBoxControlDirection)direction;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> æ˜¾ç¤ºé¡µé¢</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)showInView;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br></code></pre></td></tr></table></figure><p>2ã€å®ç°æ–‡ä»¶</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;WDComboBoxControl.h&quot;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">WDComboBoxControl</span> () &lt;<span class="hljs-title">UITableViewDelegate</span>, <span class="hljs-title">UITableViewDataSource</span>&gt;</span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> viewHeight;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *&gt; * dataArray;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; * titleArray;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIView</span> *sourceView;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) WDComboBoxControlDirection direction;<br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">WDComboBoxControl</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== åˆå§‹åŒ–é¡µé¢ ===============</span><br>- (<span class="hljs-keyword">instancetype</span>)initViewWithMaxHeight:(<span class="hljs-built_in">CGFloat</span>)height fromView:(<span class="hljs-built_in">UIView</span> *)view showDirection:(WDComboBoxControlDirection)direction &#123;<br>    <span class="hljs-keyword">self</span> = [<span class="hljs-keyword">super</span> init];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>) &#123;<br>        _viewHeight = height;<br>        _sourceView = view;<br>        _direction = direction;<br>        [<span class="hljs-keyword">self</span> setupSubViewsPropertys];<br>        [<span class="hljs-keyword">self</span> setupSubViewsConstraints];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== æ˜¾ç¤ºé¡µé¢ ===============</span><br>- (<span class="hljs-keyword">void</span>)showInView &#123;<br>    <span class="hljs-keyword">self</span>.frame = <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds;<br>    [<span class="hljs-built_in">UIApplication</span>.sharedApplication.delegate.window addSubview:<span class="hljs-keyword">self</span>];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== è®©é¡µé¢æ¶ˆå¤± ===============</span><br>- (<span class="hljs-keyword">void</span>)dismisssView &#123;<br>    [<span class="hljs-keyword">self</span> removeFromSuperview];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== è·å–æ•°æ®æº ===============</span><br>- (<span class="hljs-keyword">void</span>)setDataSource:(<span class="hljs-keyword">id</span>&lt;WDComboBoxControlDataSource&gt;)dataSource &#123;<br>    _dataSource = dataSource;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.dataSource &amp;&amp; [<span class="hljs-keyword">self</span>.dataSource respondsToSelector:<span class="hljs-keyword">@selector</span>(dataSourceOfColunm)]) &#123;<br>        <span class="hljs-keyword">self</span>.dataArray = [<span class="hljs-keyword">self</span>.dataSource dataSourceOfColunm];<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.dataArray &amp;&amp; [<span class="hljs-keyword">self</span>.dataSource respondsToSelector:<span class="hljs-keyword">@selector</span>(titleOfSection)]) &#123;<br>        <span class="hljs-keyword">self</span>.titleArray =  [<span class="hljs-keyword">self</span>.dataSource titleOfSection];<br>    &#125;<br>    <br>    [<span class="hljs-keyword">self</span>.tableView reloadData];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== Add controls, set properties ===============</span><br>- (<span class="hljs-keyword">void</span>)setupSubViewsPropertys &#123;<br>    <span class="hljs-keyword">self</span>.backgroundButton = [[<span class="hljs-built_in">UIButton</span> alloc] init];<br>    <span class="hljs-keyword">self</span>.backgroundButton.backgroundColor = <span class="hljs-built_in">UIColor</span>.clearColor;<br>    [<span class="hljs-keyword">self</span>.backgroundButton addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(dismisssView) forControlEvents:<span class="hljs-built_in">UIControlEventTouchUpInside</span>];<br>    [<span class="hljs-keyword">self</span> addSubview:<span class="hljs-keyword">self</span>.backgroundButton];<br>    <br>    <span class="hljs-keyword">self</span>.tableView = [[<span class="hljs-built_in">UITableView</span> alloc] init];<br>    <span class="hljs-keyword">self</span>.tableView.delegate = <span class="hljs-keyword">self</span>;<br>    <span class="hljs-keyword">self</span>.tableView.dataSource = <span class="hljs-keyword">self</span>;<br>    <span class="hljs-keyword">self</span>.tableView.tableFooterView = [[<span class="hljs-built_in">UIView</span> alloc] init];<br>    <span class="hljs-keyword">self</span>.tableView.layer.borderColor = <span class="hljs-built_in">UIColor</span>.lightGrayColor.CGColor;<br>    <span class="hljs-keyword">self</span>.tableView.layer.borderWidth = <span class="hljs-number">0.5</span>;<br>    <span class="hljs-keyword">self</span>.tableView.estimatedRowHeight = <span class="hljs-number">45</span>;<br>    <span class="hljs-keyword">self</span>.tableView.layer.cornerRadius = <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">self</span>.tableView.rowHeight = <span class="hljs-built_in">UITableViewAutomaticDimension</span>;<br>    [<span class="hljs-keyword">self</span> addSubview:<span class="hljs-keyword">self</span>.tableView];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== Setting control layout constraints ===============</span><br>- (<span class="hljs-keyword">void</span>)setupSubViewsConstraints &#123;<br>    <span class="hljs-keyword">self</span>.backgroundButton.frame = <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds;<br>    <br>    <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">self</span>.direction) &#123;<br>        <span class="hljs-keyword">case</span> WDComboBoxControlDirectionBottom:&#123;<br>            <span class="hljs-keyword">self</span>.tableView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-built_in">CGRectGetMinX</span>(<span class="hljs-keyword">self</span>.sourceView.frame),<br>                                              <span class="hljs-built_in">CGRectGetMaxY</span>(<span class="hljs-keyword">self</span>.sourceView.frame),<br>                                              <span class="hljs-keyword">self</span>.sourceView.frame.size.width,<br>                                              <span class="hljs-keyword">self</span>.viewHeight);<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> WDComboBoxControlDirectionTop:&#123;<br>            <span class="hljs-keyword">self</span>.tableView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-built_in">CGRectGetMinX</span>(<span class="hljs-keyword">self</span>.sourceView.frame),<br>                                              <span class="hljs-built_in">CGRectGetMaxY</span>(<span class="hljs-keyword">self</span>.sourceView.frame) - <span class="hljs-keyword">self</span>.viewHeight - <span class="hljs-keyword">self</span>.sourceView.frame.size.height,<br>                                              <span class="hljs-keyword">self</span>.sourceView.frame.size.width,<br>                                              <span class="hljs-keyword">self</span>.viewHeight);<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> WDComboBoxControlDirectionLeading:&#123;<br>            <span class="hljs-keyword">self</span>.tableView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-built_in">CGRectGetMinX</span>(<span class="hljs-keyword">self</span>.sourceView.frame) - <span class="hljs-keyword">self</span>.sourceView.frame.size.width,<br>                                              <span class="hljs-built_in">CGRectGetMinY</span>(<span class="hljs-keyword">self</span>.sourceView.frame),<br>                                              <span class="hljs-keyword">self</span>.sourceView.frame.size.width,<br>                                              <span class="hljs-keyword">self</span>.viewHeight);<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> WDComboBoxControlDirectionTrailing:&#123;<br>            <span class="hljs-keyword">self</span>.tableView.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-built_in">CGRectGetMinX</span>(<span class="hljs-keyword">self</span>.sourceView.frame) + <span class="hljs-keyword">self</span>.sourceView.frame.size.width,<br>                                              <span class="hljs-built_in">CGRectGetMinY</span>(<span class="hljs-keyword">self</span>.sourceView.frame),<br>                                              <span class="hljs-keyword">self</span>.sourceView.frame.size.width,<br>                                              <span class="hljs-keyword">self</span>.viewHeight);<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>    &#125;    <br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== UITableViewDelegate, UITableViewDataSource ===============</span><br>- (<span class="hljs-built_in">NSString</span> *)tableView:(<span class="hljs-built_in">UITableView</span> *)tableView titleForHeaderInSection:(<span class="hljs-built_in">NSInteger</span>)section &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.titleArray[section];<br>&#125;<br><br>- (<span class="hljs-built_in">NSInteger</span>)numberOfSectionsInTableView:(<span class="hljs-built_in">UITableView</span> *)tableView &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.dataArray.count;<br>&#125;<br><br>- (<span class="hljs-built_in">NSInteger</span>)tableView:(<span class="hljs-built_in">UITableView</span> *)tableView numberOfRowsInSection:(<span class="hljs-built_in">NSInteger</span>)section &#123;<br>    <span class="hljs-keyword">return</span> [<span class="hljs-keyword">self</span>.dataArray[section] count];<br>&#125;<br><br>- (<span class="hljs-built_in">UITableViewCell</span> *)tableView:(<span class="hljs-built_in">UITableView</span> *)tableView cellForRowAtIndexPath:(<span class="hljs-built_in">NSIndexPath</span> *)indexPath &#123;<br>    <br>    <span class="hljs-built_in">UITableViewCell</span> *cell = [tableView dequeueReusableCellWithIdentifier:<span class="hljs-string">@&quot;cell&quot;</span>];<br>    <span class="hljs-keyword">if</span> (!cell) &#123;<br>        cell = [[<span class="hljs-built_in">UITableViewCell</span> alloc] initWithStyle:<span class="hljs-built_in">UITableViewCellStyleDefault</span> reuseIdentifier:<span class="hljs-string">@&quot;cell&quot;</span>];<br>    &#125;<br>    cell.textLabel.text = <span class="hljs-keyword">self</span>.dataArray[indexPath.section][indexPath.row];<br>    cell.textLabel.numberOfLines = <span class="hljs-number">0</span>;<br>    <br>    <span class="hljs-keyword">return</span> cell;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)tableView:(<span class="hljs-built_in">UITableView</span> *)tableView didSelectRowAtIndexPath:(<span class="hljs-built_in">NSIndexPath</span> *)indexPath &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(selectedAtIndexPath:resultTitle: fromSourceView:)]) &#123;<br>        [<span class="hljs-keyword">self</span>.delegate selectedAtIndexPath:indexPath resultTitle:<span class="hljs-keyword">self</span>.dataArray[indexPath.section][indexPath.row] fromSourceView:<span class="hljs-keyword">self</span>.sourceView];<br>        [<span class="hljs-keyword">self</span> dismisssView];<br>    &#125;<br>&#125;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><p>3ã€ä½¿ç”¨æ–¹æ³•</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">// 1ã€å¯¼å…¥å¤´æ–‡ä»¶</span><br><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;WDComboBoxControl.h&quot;</span></span><br><span class="hljs-comment">// 2ã€éµå¾ªä»£ç†å’Œæ•°æ®æº</span><br>&lt;WDComboBoxControlDataSource, WDComboBoxControlDelegate&gt;<br><span class="hljs-comment">// 3ã€å®ç°æ–¹æ³•</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== WDComBoxControlDataSource ===============</span><br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)titleOfSection;<br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *&gt; *)dataSourceOfColunm;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== WDComBoxControlDelegate ===============</span><br>- (<span class="hljs-keyword">void</span>)selectedAtIndexPath:(<span class="hljs-built_in">NSIndexPath</span> *)indexPath resultTitle:(<span class="hljs-built_in">NSString</span> *)title fromSourceView:(<span class="hljs-built_in">UIView</span> *)sourceView;<br><br><br><span class="hljs-comment">// ä¸‹é¢æ˜¯å®ä¾‹ï¼š</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIButton</span> *button;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIButton</span> *button2;<br>- (<span class="hljs-keyword">void</span>)viewDidLoad &#123;<br>    [<span class="hljs-keyword">super</span> viewDidLoad];<br>    <span class="hljs-comment">// Do any additional setup after loading the view.</span><br>    <br>    <span class="hljs-built_in">UIButton</span> *button = [[<span class="hljs-built_in">UIButton</span> alloc] init];<br>    [button setTitleColor:<span class="hljs-built_in">UIColor</span>.blackColor forState:<span class="hljs-built_in">UIControlStateNormal</span>];<br>    [button addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(buttonShow:) forControlEvents:<span class="hljs-built_in">UIControlEventTouchUpInside</span>];<br>    [<span class="hljs-keyword">self</span>.view addSubview:button];<br>    button.layer.borderColor = <span class="hljs-built_in">UIColor</span>.lightGrayColor.CGColor;<br>    button.layer.borderWidth = <span class="hljs-number">0.5</span>;<br>    [button setTitle:<span class="hljs-string">@&quot;æŒ‰é’®&quot;</span> forState:<span class="hljs-built_in">UIControlStateNormal</span>];<br>    [button mas_makeConstraints:^(MASConstraintMaker *make) &#123;<br>        make.centerX.mas_equalTo(<span class="hljs-keyword">self</span>.view);<br>        make.top.mas_equalTo(<span class="hljs-keyword">self</span>.wdNavigationBar.mas_bottom);<br>        make.width.mas_equalTo(<span class="hljs-number">300</span>);<br><br>    &#125;];<br>    <span class="hljs-keyword">self</span>.button = button;<br>    <br>    <br>    <span class="hljs-built_in">UIButton</span> *button2 = [[<span class="hljs-built_in">UIButton</span> alloc] init];<br>    [button2 setTitleColor:<span class="hljs-built_in">UIColor</span>.blackColor forState:<span class="hljs-built_in">UIControlStateNormal</span>];<br>    [button2 addTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(buttonShow:) forControlEvents:<span class="hljs-built_in">UIControlEventTouchUpInside</span>];<br>    [<span class="hljs-keyword">self</span>.view addSubview:button2];<br>    button2.layer.borderColor = <span class="hljs-built_in">UIColor</span>.lightGrayColor.CGColor;<br>    button2.layer.borderWidth = <span class="hljs-number">0.5</span>;<br>    [button2 setTitle:<span class="hljs-string">@&quot;æŒ‰é’®2&quot;</span> forState:<span class="hljs-built_in">UIControlStateNormal</span>];<br>    button2.bounds = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">300</span>, <span class="hljs-number">50</span>);<br>    button2.center = <span class="hljs-keyword">self</span>.view.center;<br>    <span class="hljs-keyword">self</span>.button2 = button2;<br>&#125;<br>- (<span class="hljs-keyword">void</span>)buttonShow:(<span class="hljs-built_in">UIButton</span> *)sender &#123;<br>    WDComboBoxControl *view = [[WDComboBoxControl alloc] initViewWithMaxHeight:<span class="hljs-number">400</span> fromView:sender showDirection:WDComboBoxControlDirectionBottom];<br>    view.dataSource = <span class="hljs-keyword">self</span>;<br>    view.delegate = <span class="hljs-keyword">self</span>;<br>    view.backgroundButton.backgroundColor = [<span class="hljs-built_in">UIColor</span> colorWithWhite:<span class="hljs-number">0</span> alpha:<span class="hljs-number">0.3</span>];<br>    [view showInView];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== WDComBoxControlDataSource ===============</span><br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *)titleOfSection &#123;<br>    <span class="hljs-keyword">return</span> @[<span class="hljs-string">@&quot;å®‰å¾½çœ&quot;</span>, <span class="hljs-string">@&quot;æµ™æ±Ÿçœ&quot;</span>, <span class="hljs-string">@&quot;æ±Ÿè‹çœ&quot;</span>, <span class="hljs-string">@&quot;å®‰å¾½çœ&quot;</span>, <span class="hljs-string">@&quot;æµ™æ±Ÿçœ&quot;</span>, <span class="hljs-string">@&quot;æ±Ÿè‹çœ&quot;</span>];<br>&#125;<br><br>- (<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSArray</span>&lt;<span class="hljs-built_in">NSString</span> *&gt; *&gt; *)dataSourceOfColunm &#123;<br>    <span class="hljs-keyword">return</span> @[@[<span class="hljs-string">@&quot;åˆè‚¥&quot;</span>, <span class="hljs-string">@&quot;èŠœæ¹–&quot;</span>, <span class="hljs-string">@&quot;å®‰åº†&quot;</span>],<br>             @[<span class="hljs-string">@&quot;å—äº¬&quot;</span>, <span class="hljs-string">@&quot;è‹å·&quot;</span>, <span class="hljs-string">@&quot;æ— é”¡&quot;</span>],<br>             @[<span class="hljs-string">@&quot;æ­å·&quot;</span>, <span class="hljs-string">@&quot;å®æ³¢&quot;</span>, <span class="hljs-string">@&quot;æ¸©å·&quot;</span>],<br>             @[<span class="hljs-string">@&quot;åˆè‚¥&quot;</span>, <span class="hljs-string">@&quot;èŠœæ¹–&quot;</span>, <span class="hljs-string">@&quot;å®‰åº†&quot;</span>],<br>             @[<span class="hljs-string">@&quot;å—äº¬&quot;</span>, <span class="hljs-string">@&quot;è‹å·&quot;</span>, <span class="hljs-string">@&quot;æ— é”¡&quot;</span>],<br>             @[<span class="hljs-string">@&quot;æ­å·&quot;</span>, <span class="hljs-string">@&quot;å®æ³¢&quot;</span>, <span class="hljs-string">@&quot;æ¸©å·&quot;</span>]];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark =============== WDComBoxControlDelegate ===============</span><br>- (<span class="hljs-keyword">void</span>)selectedAtIndexPath:(<span class="hljs-built_in">NSIndexPath</span> *)indexPath resultTitle:(<span class="hljs-built_in">NSString</span> *)title fromSourceView:(<span class="hljs-built_in">UIView</span> *)sourceView &#123;<br>    <span class="hljs-built_in">UIButton</span> *sender = (<span class="hljs-built_in">UIButton</span> *)sourceView;<br>    [sender setTitle:title forState:<span class="hljs-built_in">UIControlStateNormal</span>];<br>&#125;<br></code></pre></td></tr></table></figure><p>4ã€æ•ˆæœå›¾</p><p><img src="https://upload-images.jianshu.io/upload_images/3334769-a1266d179a4f81d9.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾"></p><p>5ã€Demoåœ°å€ï¼ˆä»£ç éƒ½åœ¨è¿™é‡Œäº†ï¼Œå°±ä¸å¼„ä¸ªDemoäº†ï¼Œè¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰çš„åœ°æ–¹è¿˜æœ‰å¾ˆå¤šï¼ŒTableViewå’ŒèƒŒæ™¯çš„Buttonéƒ½å¯ä»¥ï¼Œéšå¿ƒæ‰€æ¬²å§ï¼ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶å›¾ç‰‡æµè§ˆå™¨</title>
    <link href="/2019/09/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%9B%BE%E7%89%87%E6%B5%8F%E8%A7%88%E5%99%A8/"/>
    <url>/2019/09/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%9B%BE%E7%89%87%E6%B5%8F%E8%A7%88%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-32704538aebd1e35.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"><br>ä¸€ç›´æƒ³å†™ä¸€ä¸ªè‡ªå·±çš„å›¾ç‰‡æµè§ˆå™¨ï¼Œä½†æ˜¯è‡ªå·±èƒ½åŠ›åˆä¸æ˜¯å¾ˆå¤Ÿï¼Œæ‰€ä»¥ä¸€ç›´æ‹–è¿™ï¼Œæœ€è¿‘è¶è‡ªå·±æ—¶é—´å……è£•ï¼Œè‡ªå·±ç ”ç©¶äº†ä¸€ä¸‹è¿™æ–¹é¢çš„çŸ¥è¯†ã€‚æ„Ÿè§‰æœ‰ä»¥ä¸‹å‡ ä¸ªéš¾ç‚¹ï¼š</p><ol><li>æ˜¾ç¤ºå’Œæ¶ˆå¤±çš„è½¬åœºåŠ¨ç”»</li><li>æ‰‹åŠ¿æ‹–æ‹½</li><li> å›¾ç‰‡åŠ è½½</li></ol><h2 id="åŠ è½½æ–¹å¼å’Œè½¬åœºåŠ¨ç”»"><a href="#åŠ è½½æ–¹å¼å’Œè½¬åœºåŠ¨ç”»" class="headerlink" title="åŠ è½½æ–¹å¼å’Œè½¬åœºåŠ¨ç”»"></a>åŠ è½½æ–¹å¼å’Œè½¬åœºåŠ¨ç”»</h2><ul><li>é€šè¿‡<code>Controller</code>åŠ è½½ï¼šéœ€è¦ä½¿ç”¨<code>ViewController</code>å®ç°<code>UIViewControllerAnimatedTransitioning</code>å®ç°è½¬åœºæ•ˆæœ</li><li>é€šè¿‡<code>View</code>åŠ è½½ï¼šä½¿ç”¨<code>UIView</code>åŠ¨ç”»è¯•ä¸‹è½¬åœºæ•ˆæœ</li></ul><p>è½¬åœºåŠ¨ç”»å¿…è¦å…ƒç´ </p><ol><li>æ˜¾ç¤ºæ—¶éœ€è¦<code>fromView</code>çš„<code>frame</code></li><li>æ¶ˆå¤±æ—¶éœ€è¦<code>toView</code>çš„<code>frame</code><h4 id="æ˜¾ç¤º"><a href="#æ˜¾ç¤º" class="headerlink" title="æ˜¾ç¤º"></a>æ˜¾ç¤º</h4>é€šè¿‡ä¿®æ”¹å½“å‰éœ€è¦æ˜¾ç¤ºå›¾ç‰‡çš„<code>CollectionViewCell</code>ä¸­<code>ImageView</code>çš„<code>frame</code>ï¼ŒåŒæ—¶ä¿®æ”¹å½“æœŸ<code>View</code>çš„èƒŒæ™¯é¢œè‰²é€æ˜åº¦<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">WDImageCollectionViewCell *cell = (WDImageCollectionViewCell *)[<span class="hljs-keyword">self</span>.collectionView cellForItemAtIndexPath:[<span class="hljs-built_in">NSIndexPath</span> indexPathForRow:<span class="hljs-keyword">self</span>.tappedIndex inSection:<span class="hljs-number">0</span>]];<br><span class="hljs-built_in">CGRect</span> fromFrame                = [<span class="hljs-keyword">self</span>.originView convertRect:<span class="hljs-keyword">self</span>.originView.bounds toView:cell.contentView];<br>cell.imageView.frame            = fromFrame;<br>[<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.5</span> animations:^&#123;<br>    <span class="hljs-keyword">self</span>.backgroundColor = [[<span class="hljs-built_in">UIColor</span> alloc] initWithWhite:<span class="hljs-number">0</span> alpha:<span class="hljs-number">1</span>];<br>    cell.imageView.frame = cell.contentView.bounds;<br>&#125;];<br></code></pre></td></tr></table></figure><h4 id="æ¶ˆå¤±"><a href="#æ¶ˆå¤±" class="headerlink" title="æ¶ˆå¤±"></a>æ¶ˆå¤±</h4>åŸç†ä¸æ˜¾ç¤ºç›¸åŒ<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-built_in">CGRect</span> toRect = [<span class="hljs-keyword">self</span>.originView convertRect:<span class="hljs-keyword">self</span>.originView.bounds toView:<span class="hljs-keyword">self</span>.window];<br>[<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.5</span> animations:^&#123;<br>    cell.imageView.clipsToBounds = <span class="hljs-literal">YES</span>;<br>    cell.imageView.frame         = toRect;<br>    <span class="hljs-keyword">self</span>.backgroundColor         = [[<span class="hljs-built_in">UIColor</span> alloc] initWithWhite:<span class="hljs-number">0</span> alpha:<span class="hljs-number">0</span>];<br>&#125; completion:^(<span class="hljs-built_in">BOOL</span> finished) &#123;<br>    [<span class="hljs-keyword">self</span> removeFromSuperview];<br>&#125;];<br></code></pre></td></tr></table></figure><h2 id="æ‹–æ‹½çš„æ‰‹åŠ¿"><a href="#æ‹–æ‹½çš„æ‰‹åŠ¿" class="headerlink" title="æ‹–æ‹½çš„æ‰‹åŠ¿"></a>æ‹–æ‹½çš„æ‰‹åŠ¿</h2>å°†æ‰‹åŠ¿æ·»åŠ åœ¨<code>CollectionViewCell</code>ä¸­<code>ScrollView</code>ä¸Šï¼Œå¹¶éµå¾ª<code>UIGestureRecognizerDelegate</code>åè®®ï¼Œä¸ç„¶ä¼š<code>CollectionView</code>æ— æ³•è¿›è¡Œæ»šåŠ¨æ“ä½œã€‚</li><li>å£°æ˜ä¸€ä¸ªå…¨å±€å±æ€§<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">CGPoint firstTouchPoint<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure></li><li>å®ç°ä»£ç†<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - UIGestureRecognizer Delegate Method</span><br>- (<span class="hljs-built_in">BOOL</span>)gestureRecognizer:(<span class="hljs-built_in">UIGestureRecognizer</span> *)gestureRecognizer shouldReceiveTouch:(<span class="hljs-built_in">UITouch</span> *)touch &#123;<br>    firstTouchPoint = [touch locationInView:<span class="hljs-keyword">self</span>.window];<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;<br>&#125;<br><br>- (<span class="hljs-built_in">BOOL</span>)gestureRecognizerShouldBegin:(<span class="hljs-built_in">UIGestureRecognizer</span> *)gestureRecognizer &#123;<br>    <span class="hljs-built_in">CGPoint</span> touchPoint = [gestureRecognizer locationInView:<span class="hljs-keyword">self</span>.window];<br>    <span class="hljs-built_in">CGFloat</span> dirTop = firstTouchPoint.y - touchPoint.y;<br>    <span class="hljs-keyword">if</span> (dirTop &gt; <span class="hljs-number">-10</span> &amp;&amp; dirTop &lt; <span class="hljs-number">10</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NO</span>;<br>    &#125;<br>    <span class="hljs-built_in">CGFloat</span> dirLift = firstTouchPoint.x - touchPoint.x;<br>    <span class="hljs-keyword">if</span> (dirLift &gt; <span class="hljs-number">-10</span> &amp;&amp; dirLift &lt; <span class="hljs-number">10</span> &amp;&amp; <span class="hljs-keyword">self</span>.scrollView.frame.size.height &gt; [[<span class="hljs-built_in">UIScreen</span> mainScreen] bounds].size.height) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NO</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">YES</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li>æ‹–åŠ¨æ‰‹åŠ¿æ“ä½œï¼ŒåŒæ„ä»£ç†ä¼ ç»™<code>View</code></li></ol><ul><li>åè®®æ–¹æ³•<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@class</span> WDImageCollectionViewCell;<br><span class="hljs-variable">@protocol</span> WDImageCollectionViewCellDelegate &lt;NSObject&gt;<br>- (void)<span class="hljs-attribute">collectionViewCell</span>:(WDImageCollectionViewCell *)cell <span class="hljs-attribute">singleTapActionWithImageUrl</span>:(NSString *)imageUrl;<br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">collectionViewCell</span>:(WDImageCollectionViewCell *)<span class="hljs-selector-tag">cell</span> <span class="hljs-selector-tag">panActionWithPercent</span>:(CGFloat)<span class="hljs-selector-tag">percent</span>;<br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">collectionViewCell</span>:(WDImageCollectionViewCell *)<span class="hljs-selector-tag">cell</span> <span class="hljs-selector-tag">dimssViewWithImageUrl</span>:(NSString *)<span class="hljs-selector-tag">imageUrl</span>;<br>@<span class="hljs-selector-tag">end</span><br></code></pre></td></tr></table></figure></li><li>æ‹–åŠ¨æ‰‹åŠ¿æ–¹æ³•<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - UIGestureRecognizer Target Event</span><br><span class="hljs-comment">/** æ»‘åŠ¨æ‰‹åŠ¿ */</span><br>- (<span class="hljs-keyword">void</span>)didRecognizedPanGuesture:(<span class="hljs-built_in">UIPanGestureRecognizer</span> *)pan &#123;<br>    <span class="hljs-built_in">CGPoint</span> point = [pan translationInView:<span class="hljs-keyword">self</span>.window];<br>    <span class="hljs-built_in">CGFloat</span> scale = <span class="hljs-number">1.0</span> - ABS(point.y) / [[<span class="hljs-built_in">UIScreen</span> mainScreen] bounds].size.height;<br>    <span class="hljs-keyword">switch</span> (pan.state) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-built_in">UIGestureRecognizerStateBegan</span>: &#123;&#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-built_in">UIGestureRecognizerStateChanged</span>:<br>        &#123;<br>            scale = MAX(scale, <span class="hljs-number">0</span>);<br>            <span class="hljs-built_in">CGFloat</span> s = MAX(scale, <span class="hljs-number">0.5</span>);<br>            <span class="hljs-built_in">CGAffineTransform</span> translation = <span class="hljs-built_in">CGAffineTransformMakeTranslation</span>(point.x / s, point.y / s);<br>            <span class="hljs-built_in">CGAffineTransform</span> translationScale = <span class="hljs-built_in">CGAffineTransformMakeScale</span>(s, s);<br>            <span class="hljs-keyword">self</span>.imageView.transform = <span class="hljs-built_in">CGAffineTransformConcat</span>(translation, translationScale);<br>            <span class="hljs-comment">// ä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(collectionViewCell:panActionWithPercent:)]) &#123;<br>                [<span class="hljs-keyword">self</span>.delegate collectionViewCell:<span class="hljs-keyword">self</span> panActionWithPercent:scale];<br>            &#125;<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span>  <span class="hljs-built_in">UIGestureRecognizerStateCancelled</span> | <span class="hljs-built_in">UIGestureRecognizerStateFailed</span>:<br>        &#123;<br>            <span class="hljs-keyword">self</span>.imageView.transform = <span class="hljs-built_in">CGAffineTransformIdentity</span>;<br>            <span class="hljs-comment">// å›å¤åˆå§‹æ ·å¼ï¼Œä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(collectionViewCell:panActionWithPercent:)]) &#123;<br>                [<span class="hljs-keyword">self</span>.delegate collectionViewCell:<span class="hljs-keyword">self</span> panActionWithPercent:<span class="hljs-number">1</span>];<br>            &#125;<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-built_in">UIGestureRecognizerStateEnded</span>:<br>        &#123;<br>            [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.5</span> animations:^&#123;<br>                <span class="hljs-built_in">CGAffineTransform</span> transform1 = <span class="hljs-built_in">CGAffineTransformMakeTranslation</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">self</span>.imageView.transform = <span class="hljs-built_in">CGAffineTransformScale</span>(transform1, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);<br>            &#125;];<br>            <br>            <span class="hljs-comment">// å›å¤åˆå§‹æ ·å¼ï¼Œä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦</span><br>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(collectionViewCell:panActionWithPercent:)]) &#123;<br>                [<span class="hljs-keyword">self</span>.delegate collectionViewCell:<span class="hljs-keyword">self</span> panActionWithPercent:scale];<br>            &#125;<br>            <span class="hljs-keyword">if</span> (scale &lt; <span class="hljs-number">0.7</span>) &#123;<br>                <span class="hljs-comment">// æ‹–åŠ¨ç»“æŸï¼Œè®©é¡µé¢æ¶ˆå¤±</span><br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(collectionViewCell:dimssViewWithImageUrl:)]) &#123;<br>                    [<span class="hljs-keyword">self</span>.delegate collectionViewCell:<span class="hljs-keyword">self</span> dimssViewWithImageUrl:<span class="hljs-keyword">self</span>.imageUrl];<br>                &#125;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-comment">// å›å¤åˆå§‹æ ·å¼ï¼Œä¼ å‡ºtranslationScaleï¼Œä¿®æ”¹èƒŒæ™¯é¢œè‰²é€æ˜åº¦</span><br>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.delegate &amp;&amp; [<span class="hljs-keyword">self</span>.delegate respondsToSelector:<span class="hljs-keyword">@selector</span>(collectionViewCell:panActionWithPercent:)]) &#123;<br>                    [<span class="hljs-keyword">self</span>.delegate collectionViewCell:<span class="hljs-keyword">self</span> panActionWithPercent:<span class="hljs-number">1</span>];<br>                &#125;<br>            &#125;<br>        &#125;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å›¾ç‰‡åŠ è½½"><a href="#å›¾ç‰‡åŠ è½½" class="headerlink" title="å›¾ç‰‡åŠ è½½"></a>å›¾ç‰‡åŠ è½½</h2>ä½¿ç”¨<code>SDWebImage</code>è·å–å›¾ç‰‡ï¼Œé€šè¿‡<code>FLAnimatedImageView</code>åŠ è½½<code>gif</code>å›¾<h2 id="Githubåœ°å€"><a href="#Githubåœ°å€" class="headerlink" title="Githubåœ°å€"></a>Githubåœ°å€</h2><a href="https://github.com/wudan-ios/WDImageBrowser.git">é¡¹ç›®åœ°å€</a><h2 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h2><img src="https://upload-images.jianshu.io/upload_images/3334769-daf79ce9d51e3359.gif?imageMogr2/auto-orient/strip"></li></ul>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>Objective-C</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶ï¼šæé†’æ¡</title>
    <link href="/2019/08/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E6%8F%90%E9%86%92%E6%9D%A1/"/>
    <url>/2019/08/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E6%8F%90%E9%86%92%E6%9D%A1/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-ccc89345e72081d5.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><p>ç®€å•çš„æé†’æ¡ï¼Œä»£ç æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨å®¹æ˜“ï¼Œä»£ç ä¸­ç›®å‰æä¾›äº†ä¸‰ç§æ˜¾ç¤ºçš„é¢œè‰²ï¼Œé»˜è®¤æ˜¾ç¤ºæ–‡æœ¬å†…å®¹ä¸ºä¸€è¡Œæ–‡å­—ï¼Œé»˜è®¤é«˜åº¦ä¸º20ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚è‡ªå®šä¹‰æ ·å¼ã€‚ä»£ç åŒæ—¶æ”¯æŒObjective-Cå’ŒSwiftï¼Œä½¿ç”¨æ–¹å¼æœ‰ç‚¹ç‚¹å·®åˆ«ï¼Œè¯¦æƒ…çœ‹ä»£ç ã€‚</p><h4 id="æ¥å£æ–‡ä»¶"><a href="#æ¥å£æ–‡ä»¶" class="headerlink" title="æ¥å£æ–‡ä»¶"></a>æ¥å£æ–‡ä»¶</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">NS_ENUM</span>(<span class="hljs-built_in">NSInteger</span>, RemindBarStyle) &#123;<br>    RemindBarStyleInfo, <span class="hljs-comment">// æé†’ â‡ï¸</span><br>    RemindBarStyleWarn, <span class="hljs-comment">// è­¦å‘Š âš ï¸</span><br>    RemindBarStyleError <span class="hljs-comment">// é”™è¯¯ âŒ</span><br>&#125;;<br><br><span class="hljs-keyword">typedef</span> <span class="hljs-built_in">NS_ENUM</span>(<span class="hljs-built_in">NSInteger</span>, RemindBarPosition) &#123;<br>    RemindBarPositionStatusBar,     <span class="hljs-comment">// çŠ¶æ€æ ä¸‹é¢</span><br>    RemindBarPositionNavigationBar, <span class="hljs-comment">// å¯¼èˆªæ ä¸‹é¢</span><br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">LZRemindBar</span> : <span class="hljs-title">UIView</span></span><br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> é…ç½®æ˜¾ç¤ºæ ·å¼</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param style æ ·å¼</span><br><span class="hljs-comment"> @param position ä½ç½®</span><br><span class="hljs-comment"> @param text å†…å®¹</span><br><span class="hljs-comment"> @return return value description</span><br><span class="hljs-comment"> */</span><br>+ (LZRemindBar *)configurationWithStyle:(RemindBarStyle)style showPosition:(RemindBarPosition)position contentText:(<span class="hljs-built_in">NSString</span> *)text;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> æ˜¾ç¤º å¹¶è®¾ç½®æ˜¾ç¤ºæ—¶é—´</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param interval æ˜¾ç¤ºæ—¶é—´</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)showBarAfterTimeInterval:(<span class="hljs-built_in">NSTimeInterval</span>)interval;<br><br><span class="hljs-keyword">@end</span><br><span class="hljs-built_in">NS_ASSUME_NONNULL_END</span><br></code></pre></td></tr></table></figure><h4 id="å®ç°æ–‡ä»¶"><a href="#å®ç°æ–‡ä»¶" class="headerlink" title="å®ç°æ–‡ä»¶"></a>å®ç°æ–‡ä»¶</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;LZRemindBar.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> bar_IsPhoneX  UIApplication.sharedApplication.statusBarFrame.size.height != 20</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> bar_topInterval  bar_IsPhoneX ? UIApplication.sharedApplication.statusBarFrame.size.height : 0</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">LZRemindBar</span> ()</span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UILabel</span>           *contentLabel; <span class="hljs-comment">//*! æ–‡å­—Label</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) RemindBarPosition position;      <span class="hljs-comment">//*! æ˜¾ç¤ºä½ç½®</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">BOOL</span>              isShowing;     <span class="hljs-comment">//*! æ˜¯å¦æ­£åœ¨æ˜¾ç¤º</span><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">LZRemindBar</span></span><br><br>+ (<span class="hljs-keyword">instancetype</span>)remind &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_once_t</span> onceToken;<br>    <span class="hljs-keyword">static</span> LZRemindBar *remind;<br>    <span class="hljs-built_in">dispatch_once</span>(&amp;onceToken, ^&#123;<br>        remind = [[LZRemindBar alloc] init];<br>    &#125;);<br>    <span class="hljs-keyword">return</span> remind;<br>&#125;<br><br>+ (LZRemindBar *)configurationWithStyle:(RemindBarStyle)style showPosition:(RemindBarPosition)position contentText:(<span class="hljs-built_in">NSString</span> *)text &#123;<br>    <br>    <span class="hljs-keyword">if</span> ([LZRemindBar remind].isShowing) &#123;<br>        <span class="hljs-keyword">return</span> [LZRemindBar remind];<br>    &#125;<br>    <br>    [LZRemindBar remind].contentLabel = (&#123;<br>        <span class="hljs-built_in">UILabel</span> *label = [[<span class="hljs-built_in">UILabel</span> alloc] init];<br>        label.backgroundColor = <span class="hljs-built_in">UIColor</span>.clearColor;<br>        label.numberOfLines = <span class="hljs-number">1</span>;<br>        label.textAlignment = <span class="hljs-built_in">NSTextAlignmentCenter</span>;<br>        label.font = [<span class="hljs-built_in">UIFont</span> systemFontOfSize:<span class="hljs-number">13</span>];<br>        label.textColor = <span class="hljs-built_in">UIColor</span>.whiteColor;<br>        [[LZRemindBar remind] addSubview:label];<br>        label.translatesAutoresizingMaskIntoConstraints = <span class="hljs-literal">false</span>;<br>        [[label.leadingAnchor constraintEqualToAnchor:[LZRemindBar remind].leadingAnchor] setActive:<span class="hljs-literal">true</span>];<br>        [[label.trailingAnchor constraintEqualToAnchor:[LZRemindBar remind].trailingAnchor] setActive:<span class="hljs-literal">true</span>];<br>        [[label.topAnchor constraintEqualToAnchor:[LZRemindBar remind].topAnchor] setActive:<span class="hljs-literal">true</span>];<br>        [[label.bottomAnchor constraintEqualToAnchor:[LZRemindBar remind].bottomAnchor] setActive:<span class="hljs-literal">true</span>];<br>        label.text = text;<br>        label;<br>    &#125;);<br>    <br>    [LZRemindBar remind].isShowing = <span class="hljs-literal">true</span>;<br>    [LZRemindBar remind].position  = position;<br>    <br>    <span class="hljs-keyword">switch</span> (style) &#123;<br>        <span class="hljs-keyword">case</span> RemindBarStyleInfo:<br>            [LZRemindBar remind].backgroundColor = [<span class="hljs-built_in">UIColor</span> colorWithRed:<span class="hljs-number">0</span> green:<span class="hljs-number">166.0</span>/<span class="hljs-number">255</span> blue:<span class="hljs-number">124.0</span>/<span class="hljs-number">255</span> alpha:<span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> RemindBarStyleWarn:<br>            [LZRemindBar remind].backgroundColor = <span class="hljs-built_in">UIColor</span>.orangeColor;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> RemindBarStyleError:<br>            [LZRemindBar remind].backgroundColor = <span class="hljs-built_in">UIColor</span>.redColor;<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (position == RemindBarPositionStatusBar) &#123;<br>        [[LZRemindBar remind] setupShowStatusBarBottomWithStutus:<span class="hljs-literal">true</span>];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        [[LZRemindBar remind] setupShowNavigationBarBottomWithStutus:<span class="hljs-literal">true</span>];<br>    &#125;<br>    <br>    <span class="hljs-keyword">return</span> [LZRemindBar remind];<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)setupShowStatusBarBottomWithStutus:(<span class="hljs-built_in">BOOL</span>)show &#123;<br>    <span class="hljs-keyword">if</span> (show) &#123;<br>        <span class="hljs-built_in">UIApplication</span>.sharedApplication.delegate.window.windowLevel = bar_IsPhoneX ? <span class="hljs-built_in">UIWindowLevelNormal</span> : <span class="hljs-built_in">UIWindowLevelAlert</span>;<br>        <span class="hljs-keyword">self</span>.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, bar_topInterval, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, <span class="hljs-number">0</span>);<br>        [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.5</span> animations:^&#123;<br>            <span class="hljs-keyword">self</span>.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, bar_topInterval, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, <span class="hljs-number">20</span>);<br>        &#125;];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.5</span> animations:^&#123;<br>            <span class="hljs-keyword">self</span>.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, bar_topInterval, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, <span class="hljs-number">0</span>);<br>        &#125; completion:^(<span class="hljs-built_in">BOOL</span> finished) &#123;<br>            <span class="hljs-built_in">UIApplication</span>.sharedApplication.delegate.window.windowLevel = <span class="hljs-built_in">UIWindowLevelNormal</span>;<br>            [<span class="hljs-keyword">self</span> dismissBar];<br>        &#125;];<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)setupShowNavigationBarBottomWithStutus:(<span class="hljs-built_in">BOOL</span>)show &#123;<br>    <span class="hljs-keyword">if</span> (show) &#123;<br>        <span class="hljs-keyword">self</span>.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">UIApplication</span>.sharedApplication.statusBarFrame.size.height + <span class="hljs-number">44</span>, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, <span class="hljs-number">0</span>);<br>        [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.5</span> animations:^&#123;<br>            <span class="hljs-keyword">self</span>.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">UIApplication</span>.sharedApplication.statusBarFrame.size.height + <span class="hljs-number">44</span>, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, <span class="hljs-number">20</span>);<br>        &#125;];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.5</span> animations:^&#123;<br>            <span class="hljs-keyword">self</span>.frame = <span class="hljs-built_in">CGRectMake</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">UIApplication</span>.sharedApplication.statusBarFrame.size.height + <span class="hljs-number">44</span>, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, <span class="hljs-number">0</span>);<br>        &#125; completion:^(<span class="hljs-built_in">BOOL</span> finished) &#123;<br>            [<span class="hljs-keyword">self</span> dismissBar];<br>        &#125;];<br>    &#125;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)showBarAfterTimeInterval:(<span class="hljs-built_in">NSTimeInterval</span>)interval &#123;<br>    [<span class="hljs-built_in">UIApplication</span>.sharedApplication.delegate.window addSubview:<span class="hljs-keyword">self</span>];<br>    <br>    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(interval * <span class="hljs-built_in">NSEC_PER_SEC</span>)), dispatch_get_main_queue(), ^&#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.position == RemindBarPositionStatusBar) &#123;<br>            [<span class="hljs-keyword">self</span> setupShowStatusBarBottomWithStutus:<span class="hljs-literal">false</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            [<span class="hljs-keyword">self</span> setupShowNavigationBarBottomWithStutus:<span class="hljs-literal">false</span>];<br>        &#125;<br>    &#125;);<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)dismissBar &#123;<br>    <span class="hljs-keyword">self</span>.isShowing = <span class="hljs-literal">false</span>;<br>    [<span class="hljs-keyword">self</span>.contentLabel removeFromSuperview];<br>    [<span class="hljs-keyword">self</span> removeFromSuperview];<br>&#125;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><h4 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-comment">//  å‚æ•°RemindBarStyleï¼š æ˜¾ç¤ºæ ·å¼</span><br><span class="hljs-comment">//  å‚æ•°RemindBarPosition: æ˜¾ç¤ºä½ç½® </span><br><span class="hljs-comment">//  å‚æ•°contentText: æ˜¾ç¤ºæ–‡å­—å†…å®¹ </span><br><span class="hljs-comment">//  intervalï¼šæ˜¾ç¤ºæ—¶é—´</span><br><br><span class="hljs-comment">// Objc</span><br><span class="hljs-selector-attr">[[LZRemindBar configurationWithStyle:RemindBarStyleInfo showPosition:RemindBarPositionStatusBar contentText:@<span class="hljs-string">&quot;è¿™æ˜¯ä¸€ä¸ªæç¤º&quot;</span>]</span> <span class="hljs-selector-tag">showBarAfterTimeInterval</span>:<span class="hljs-selector-tag">1</span><span class="hljs-selector-class">.2</span>];<br><span class="hljs-comment">// Swift</span><br><span class="hljs-selector-tag">LZRemindBar</span><span class="hljs-selector-class">.configuration</span>(<span class="hljs-attribute">with</span>: .info, <span class="hljs-attribute">show</span>: .statusBar, <span class="hljs-attribute">contentText</span>: <span class="hljs-string">&quot;æç¤ºæ–‡å­—&quot;</span>)<span class="hljs-selector-class">.show</span>(<span class="hljs-attribute">afterTimeInterval</span>: <span class="hljs-number">1.2</span>)<br></code></pre></td></tr></table></figure><h4 id="æ•ˆæœå›¾"><a href="#æ•ˆæœå›¾" class="headerlink" title="æ•ˆæœå›¾"></a>æ•ˆæœå›¾</h4><p><img src="https://upload-images.jianshu.io/upload_images/3334769-0b94020c5e06325c.gif?imageMogr2/auto-orient/strip"></p>]]></content>
    
    
    <categories>
      
      <category>Objective-C</category>
      
      <category>iOS</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶-åˆ†æ®µé€‰æ‹©å™¨-Swift</title>
    <link href="/2019/07/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%BC%80%E5%B1%8F%E5%B9%BF%E5%91%8A/"/>
    <url>/2019/07/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%BC%80%E5%B1%8F%E5%B9%BF%E5%91%8A/</url>
    
    <content type="html"><![CDATA[<p>date: 2019-06-01 10:00:00</p><p>tags: </p><ul><li>  è‡ªå®šä¹‰æ§ä»¶<br>categories:</li><li>iOS</li><li>Swift</li><li>è‡ªå®šä¹‰æ§ä»¶</li></ul><hr><p><img src="https://upload-images.jianshu.io/upload_images/3334769-b2036ea2521c628c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ä¸“ç”¨æ•´ç†å›¾"></p><p>å¾ˆä¹…æ²¡æœ‰å»å†™åšå®¢äº†ï¼Œæœ€è¿‘ç”±äºå…¬å¸éœ€æ±‚å˜åŒ–ï¼Œéœ€è¦åšä¸€ä¸ªæ–°çš„å¼€å±å¹¿å‘Šçš„é¡µé¢ï¼Œæ‰€ä»¥æˆ‘å°±ç®€å•çš„å»ç ”ç©¶äº†ä¸€ä¸‹ã€‚å…¶ä¸­æ˜¾ç¤ºåˆ†ä¸ºè§†é¢‘å’Œå›¾ç‰‡ï¼Œå…¶ä¸­å›¾ç‰‡ç›¸æ¯”è€Œè¨€å®ç°èµ·æ¥å°±ç®€å•çš„å¤šäº†ã€‚</p><h3 id="å›¾ç‰‡åŠ è½½"><a href="#å›¾ç‰‡åŠ è½½" class="headerlink" title="å›¾ç‰‡åŠ è½½"></a>å›¾ç‰‡åŠ è½½</h3><p>å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„åŠ è½½å’Œç¼“å­˜ï¼Œä¾‹å¦‚ï¼š<code>SDWebImage</code>æˆ–è€…<code>Kingfisher</code>ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç³»ç»Ÿçš„<code>URLSession</code>ä¸‹è½½åˆ°æœ¬åœ°å†è¿›è¡Œè¯»å–åŠ è½½ã€‚</p><h3 id="è§†é¢‘åŠ è½½"><a href="#è§†é¢‘åŠ è½½" class="headerlink" title="è§†é¢‘åŠ è½½"></a>è§†é¢‘åŠ è½½</h3><p>æˆ‘è¿™è¾¹åˆ©ç”¨çš„å°±<code>URLSession </code>çš„<code>downloadTask</code>è¿›è¡Œä¸‹è½½åˆ°æœ¬åœ°å†è¿›è¡Œæ’­æ”¾çš„ã€‚</p><h3 id="è§†é¢‘ä¸‹è½½çš„ä»£ç "><a href="#è§†é¢‘ä¸‹è½½çš„ä»£ç " class="headerlink" title="è§†é¢‘ä¸‹è½½çš„ä»£ç "></a>è§†é¢‘ä¸‹è½½çš„ä»£ç </h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">import UIKit<br><br><span class="hljs-comment">/// ä¿å­˜URLåœ°å€è¿›è¡ŒåŒ¹é…</span><br>fileprivate <span class="hljs-keyword">let</span> kURL_DOWNLOAD_PATH = <span class="hljs-string">&quot;WDDownloadUrlPath&quot;</span><br><span class="hljs-comment">/// ä¿å­˜è·¯å¾„</span><br>fileprivate <span class="hljs-keyword">let</span> kDOCUMENTS_PATH = <span class="hljs-constructor">NSHomeDirectory()</span> + <span class="hljs-string">&quot;/Documents/Advertisement.mp4&quot;</span><br><br>fileprivate <span class="hljs-keyword">class</span> UserDefaultsTools &#123;<br>    <span class="hljs-comment">// è®¾ç½®åœ°å€</span><br>    static func wd<span class="hljs-constructor">_set(<span class="hljs-params">value</span>: String)</span> &#123;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UserDefaults</span>.</span></span>standard.set<span class="hljs-constructor">Value(<span class="hljs-params">value</span>, <span class="hljs-params">forKey</span>: <span class="hljs-params">kURL_DOWNLOAD_PATH</span>)</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// è¯»å–åœ°å€</span><br>    static func wd<span class="hljs-constructor">_get()</span> -&gt; String &#123;<br>        return <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UserDefaults</span>.</span></span>standard.<span class="hljs-keyword">object</span>(forKey: kURL_DOWNLOAD_PATH) <span class="hljs-keyword">as</span>? String ?? <span class="hljs-string">&quot;&quot;</span><br>    &#125;<br>&#125;<br><br>fileprivate <span class="hljs-keyword">class</span> FileManagerTools &#123;<br>    <span class="hljs-comment">// æ˜¯å¦å­˜åœ¨æ–‡ä»¶</span><br>    static func is<span class="hljs-constructor">ExistFile(<span class="hljs-params">atPath</span>: String)</span> -&gt; Bool &#123;<br>        return <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileManager</span>.</span></span>default.file<span class="hljs-constructor">Exists(<span class="hljs-params">atPath</span>: <span class="hljs-params">atPath</span>)</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// ç§»åŠ¨æ–‡ä»¶</span><br>    static func move<span class="hljs-constructor">File(<span class="hljs-params">fromPath</span>: String, <span class="hljs-params">toPath</span>: String)</span> &#123;<br>        <span class="hljs-keyword">try</span>! <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileManager</span>.</span></span>default.move<span class="hljs-constructor">Item(<span class="hljs-params">atPath</span>: <span class="hljs-params">fromPath</span>, <span class="hljs-params">toPath</span>: <span class="hljs-params">toPath</span>)</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// åˆ é™¤æ–‡ä»¶</span><br>    static func delete<span class="hljs-constructor">File(<span class="hljs-params">atPath</span>: String)</span> &#123;<br>        <span class="hljs-keyword">try</span>! <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileManager</span>.</span></span>default.remove<span class="hljs-constructor">Item(<span class="hljs-params">atPath</span>: <span class="hljs-params">atPath</span>)</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// æ–‡ä»¶å¤§å°</span><br>    static func file<span class="hljs-constructor">Size(<span class="hljs-params">atPath</span>: String)</span> -&gt; Float &#123;<br>        <span class="hljs-keyword">if</span> self.is<span class="hljs-constructor">ExistFile(<span class="hljs-params">atPath</span>: <span class="hljs-params">kDOCUMENTS_PATH</span>)</span> &#123;<br>            <span class="hljs-keyword">let</span> attributes = <span class="hljs-keyword">try</span>! <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileManager</span>.</span></span>default.attributes<span class="hljs-constructor">OfItem(<span class="hljs-params">atPath</span>: <span class="hljs-params">atPath</span>)</span><br>            <span class="hljs-keyword">let</span> size = attributes<span class="hljs-literal">[F<span class="hljs-identifier">ileAttributeKey</span>.<span class="hljs-identifier">size</span>]</span> <span class="hljs-keyword">as</span>! Int<br>            return <span class="hljs-constructor">Float(<span class="hljs-params">size</span>)</span><br>        &#125;<br>        return <span class="hljs-number">0</span><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> WDLaunchADDownloader: NSObject &#123;<br>    <span class="hljs-comment">/// ä¸‹è½½è§†é¢‘çš„è·¯å¾„</span><br>    <span class="hljs-keyword">private</span> var downloadUrlPath: String = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-comment">/// ä¸‹è½½çš„Session</span><br>    <span class="hljs-keyword">private</span> var session: URLSession!<br>    <span class="hljs-comment">/// ä¸‹è½½çš„ä»»åŠ¡</span><br>    <span class="hljs-keyword">private</span> var downloadTask: URLSessionDownloadTask!<br>    <span class="hljs-comment">/// è®°å½•æ˜¯å¦åœ¨ä¸‹è½½</span><br>    <span class="hljs-keyword">private</span> var downloading: Bool = <span class="hljs-literal">false</span><br>    <span class="hljs-comment">/// è®°å½•å·²ä¸‹è½½çš„æ•°æ®</span><br>    <span class="hljs-keyword">private</span> var downloadData: Data?<br><br>    <span class="hljs-comment">/* ä¸‹è½½è§†é¢‘ */</span><br>    static func download<span class="hljs-constructor">Video(<span class="hljs-params">path</span>: String)</span> -&gt; String &#123;<br>        <span class="hljs-keyword">let</span> downloader = <span class="hljs-constructor">WDLaunchADDownloader()</span><br>        return downloader.setup<span class="hljs-constructor">Download(<span class="hljs-params">with</span>: <span class="hljs-params">path</span>)</span><br>    &#125;<br>    <br>    <span class="hljs-keyword">private</span> func setup<span class="hljs-constructor">Download(<span class="hljs-params">with</span> <span class="hljs-params">path</span>: String)</span> -&gt; String &#123;<br>        downloadUrlPath = path <span class="hljs-comment">// è·å–è§†é¢‘æ’­æ”¾ç½‘ç»œè·¯å¾„</span><br><br>        <span class="hljs-keyword">let</span> configuration = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">URLSessionConfiguration</span>.</span></span>default<br>        configuration.isDiscretionary = <span class="hljs-literal">true</span><br>        session = <span class="hljs-constructor">URLSession(<span class="hljs-params">configuration</span>: <span class="hljs-params">configuration</span>, <span class="hljs-params">delegate</span>: <span class="hljs-params">self</span>, <span class="hljs-params">delegateQueue</span>: <span class="hljs-params">nil</span>)</span><br>        <br>        <span class="hljs-keyword">let</span> request = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">URLRequest</span>.</span></span>init(url: <span class="hljs-constructor">URL(<span class="hljs-params">string</span>: <span class="hljs-params">path</span>)</span>!)<br>        downloadTask = session.download<span class="hljs-constructor">Task(<span class="hljs-params">with</span>: <span class="hljs-params">request</span>)</span><br>        <br>        <span class="hljs-comment">// ç½‘å€ä¸åŒï¼Œåˆ é™¤åŸæœ¬çš„ï¼Œä¸‹è½½æœ€æ–°çš„</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UserDefaultsTools</span>.</span></span>wd<span class="hljs-constructor">_get()</span> != path &#123;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UserDefaultsTools</span>.</span></span>wd<span class="hljs-constructor">_set(<span class="hljs-params">value</span>: <span class="hljs-string">&quot;&quot;</span>)</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileManagerTools</span>.</span></span>is<span class="hljs-constructor">ExistFile(<span class="hljs-params">atPath</span>: <span class="hljs-params">kDOCUMENTS_PATH</span>)</span> &#123;<br>                <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileManagerTools</span>.</span></span>delete<span class="hljs-constructor">File(<span class="hljs-params">atPath</span>: <span class="hljs-params">kDOCUMENTS_PATH</span>)</span><br>            &#125;<br>            <span class="hljs-comment">// å¼€å§‹ä¸‹è½½</span><br>            start<span class="hljs-constructor">Download()</span><br>        &#125;<br>        <br>        <span class="hljs-comment">// å¦‚æœå·²å­˜åœ¨æ–‡ä»¶ å°±åŠ è½½è§†é¢‘ å¦åˆ™åŠ è½½å›¾ç‰‡</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileManagerTools</span>.</span></span>is<span class="hljs-constructor">ExistFile(<span class="hljs-params">atPath</span>: <span class="hljs-params">kDOCUMENTS_PATH</span>)</span> &#123;<br>            return kDOCUMENTS_PATH<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            return <span class="hljs-string">&quot;&quot;</span><br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// MARK: - å¼€å§‹ä¸‹è½½</span><br>    <span class="hljs-keyword">private</span> func start<span class="hljs-constructor">Download()</span> &#123;<br>        downloading = <span class="hljs-literal">true</span><br>        downloadTask.resume<span class="hljs-literal">()</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// MARK: - æš‚åœä¸‹è½½</span><br>    <span class="hljs-keyword">private</span> func pause<span class="hljs-constructor">Download()</span> &#123;<br>        downloadTask.cancel &#123; <span class="hljs-literal">[<span class="hljs-identifier">weak</span> <span class="hljs-identifier">self</span>]</span> (resumeData) <span class="hljs-keyword">in</span><br>            self?.downloadData = resumeData<br>        &#125;<br>        downloading = <span class="hljs-literal">false</span><br>    &#125;<br>&#125;<br><br>extension WDLaunchADDownloader: URLSessionDownloadDelegate &#123;<br>    <span class="hljs-comment">// ä¸‹è½½ä»£ç†æ–¹æ³•ï¼Œä¸‹è½½ç»“æŸ</span><br>    func url<span class="hljs-constructor">Session(<span class="hljs-params">_</span> <span class="hljs-params">session</span>: URLSession, <span class="hljs-params">downloadTask</span>: URLSessionDownloadTask, <span class="hljs-params">didFinishDownloadingTo</span> <span class="hljs-params">location</span>: URL)</span> &#123;<br>        <span class="hljs-keyword">let</span> locationPath = location.path<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileManagerTools</span>.</span></span>move<span class="hljs-constructor">File(<span class="hljs-params">fromPath</span>: <span class="hljs-params">locationPath</span>, <span class="hljs-params">toPath</span>: <span class="hljs-params">kDOCUMENTS_PATH</span>)</span><br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UserDefaultsTools</span>.</span></span>wd<span class="hljs-constructor">_set(<span class="hljs-params">value</span>: <span class="hljs-params">downloadUrlPath</span>)</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// ä¸‹è½½ä»£ç†æ–¹æ³•ï¼Œç›‘å¬ä¸‹è½½è¿›åº¦</span><br>    func url<span class="hljs-constructor">Session(<span class="hljs-params">_</span> <span class="hljs-params">session</span>: URLSession, <span class="hljs-params">downloadTask</span>: URLSessionDownloadTask, <span class="hljs-params">didWriteData</span> <span class="hljs-params">bytesWritten</span>: Int64, <span class="hljs-params">totalBytesWritten</span>: Int64, <span class="hljs-params">totalBytesExpectedToWrite</span>: Int64)</span> &#123;<br>        <span class="hljs-keyword">if</span> <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FileManagerTools</span>.</span></span>file<span class="hljs-constructor">Size(<span class="hljs-params">atPath</span>: <span class="hljs-params">kDOCUMENTS_PATH</span>)</span> &gt;= <span class="hljs-constructor">Float(<span class="hljs-params">totalBytesExpectedToWrite</span>)</span> &#123;<br>            pause<span class="hljs-constructor">Download()</span><br>            return<br>        &#125;<br>        print(<span class="hljs-constructor">String(<span class="hljs-params">format</span>: <span class="hljs-string">&quot;ğŸ‰ Advertising Video Download Progress: %0.2f&quot;</span>, Float(<span class="hljs-params">totalBytesWritten</span>)</span><span class="hljs-operator"> / </span><span class="hljs-constructor">Float(<span class="hljs-params">totalBytesExpectedToWrite</span>)</span>))<br>    &#125;<br>    <br>    <span class="hljs-comment">// å¦‚æœä¸‹è½½å¤±è´¥äº†</span><br>    func url<span class="hljs-constructor">Session(<span class="hljs-params">_</span> <span class="hljs-params">session</span>: URLSession, <span class="hljs-params">task</span>: URLSessionTask, <span class="hljs-params">didCompleteWithError</span> <span class="hljs-params">error</span>: Error?)</span> &#123;<br>        <span class="hljs-keyword">if</span> error != nil &#123;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">UserDefaultsTools</span>.</span></span>wd<span class="hljs-constructor">_set(<span class="hljs-params">value</span>: <span class="hljs-string">&quot;&quot;</span>)</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è§†é¢‘æ’­æ”¾ä»£ç "><a href="#è§†é¢‘æ’­æ”¾ä»£ç " class="headerlink" title="è§†é¢‘æ’­æ”¾ä»£ç "></a>è§†é¢‘æ’­æ”¾ä»£ç </h3><p>å…¶ä¸­è·å–åˆ°åŠ è½½çš„ç§ç±»(å›¾ç‰‡ã€è§†é¢‘)ï¼Œé¡µé¢è¿›è¡Œç›¸åº”çš„å¸ƒå±€</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> UIKit<br><span class="hljs-keyword">import</span> AVFoundation<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WDLaunchADPlayerManager</span>: <span class="hljs-title">NSObject</span> </span>&#123;<br>    <br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">let</span> share <span class="hljs-operator">=</span> <span class="hljs-type">WDLaunchADPlayerManager</span>()<br>    <br>    <span class="hljs-keyword">var</span> playerItem: <span class="hljs-type">AVPlayerItem</span>!<br>    <span class="hljs-keyword">var</span> player: <span class="hljs-type">AVPlayer</span>!<br>    <span class="hljs-keyword">var</span> playerLayer: <span class="hljs-type">CALayer</span>!<br>    <br>    <span class="hljs-comment">// å¼€å§‹æ’­æ”¾ &lt;æ’­æ”¾ä¸‹è½½å¥½å†æœ¬åœ°æ–‡ä»¶å¤¹é‡Œé¢çš„è§†é¢‘æ–‡ä»¶&gt;</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">playItem</span>(<span class="hljs-params">with</span> <span class="hljs-params">url</span>: <span class="hljs-type">String</span>)</span> &#123;<br>        playerItem <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerItem</span>(url: <span class="hljs-type">URL</span>(fileURLWithPath: url))<br>        player <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayer</span>(playerItem: playerItem)<br>        playerLayer <span class="hljs-operator">=</span> <span class="hljs-type">AVPlayerLayer</span>(player: player)<br>        player.usesExternalPlaybackWhileExternalScreenIsActive <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        player.play()<br>        player.volume <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-comment">// é™éŸ³æ’­æ”¾</span><br>    &#125;<br>    <br>    <span class="hljs-comment">// åœæ­¢æ’­æ”¾</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">stopPlay</span>()</span> &#123;<br>        player.pause()<br>        player <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é¡µé¢æ˜¾ç¤º"><a href="#é¡µé¢æ˜¾ç¤º" class="headerlink" title="é¡µé¢æ˜¾ç¤º"></a>é¡µé¢æ˜¾ç¤º</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">import UIKit<br>import SDWebImage<br><br><span class="hljs-keyword">class</span> WDLaunchADController: UIViewController &#123;<br>    <br>    <span class="hljs-comment">/// æ’­æ”¾å™¨çš„layerå±‚</span><br>    <span class="hljs-keyword">private</span> var playerLayer: CALayer = <span class="hljs-constructor">CALayer()</span><br>    <br>    <span class="hljs-comment">/// å›¾ç‰‡åŠ è½½</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> imageView: UIImageView = &#123;<br>        <span class="hljs-keyword">let</span> imageV = <span class="hljs-constructor">UIImageView()</span><br>        imageV.contentMode = .scaleAspectFill<br>        imageV.clipsToBounds = <span class="hljs-literal">true</span><br>        return imageV<br>    &#125;<span class="hljs-literal">()</span><br>    <br>    deinit &#123;<br>        print(<span class="hljs-string">&quot;==[\(type(of: self))] deinit==&quot;</span>)<br>    &#125;<br>    <br>    override func view<span class="hljs-constructor">DidLoad()</span> &#123;<br>        super.view<span class="hljs-constructor">DidLoad()</span><br>        view.backgroundColor = .white<br>    &#125;<br>    <br>    <span class="hljs-comment">// é…ç½®é¡µé¢æ ·å¼</span><br>    func setup(<span class="hljs-keyword">with</span> adType: WDLaunchADType, url: String, bottomLogoView: UIView? = <span class="hljs-constructor">UIView()</span>, bottomLogoViewHeight: CGFloat = <span class="hljs-number">180</span>) &#123;<br>        <span class="hljs-keyword">if</span> adType<span class="hljs-operator"> == </span>.image &#123;<br>            imageView.isUserInteractionEnabled = <span class="hljs-literal">true</span><br>            view.add<span class="hljs-constructor">Subview(<span class="hljs-params">imageView</span>)</span><br>            imageView.sd<span class="hljs-constructor">_setImage(<span class="hljs-params">with</span>: URL(<span class="hljs-params">string</span>: <span class="hljs-params">url</span>)</span>, completed: nil)<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">WDLaunchADPlayerManager</span>.</span></span>share.play<span class="hljs-constructor">Item(<span class="hljs-params">with</span>: <span class="hljs-params">url</span>)</span><br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> layer = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">WDLaunchADPlayerManager</span>.</span></span>share.playerLayer &#123;<br>                self.view.layer.add<span class="hljs-constructor">Sublayer(<span class="hljs-params">layer</span>)</span><br>                playerLayer = layer<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> logoView = bottomLogoView &#123;<br>            view.add<span class="hljs-constructor">Subview(<span class="hljs-params">logoView</span>)</span><br>            logoView.frame = <span class="hljs-constructor">CGRect(<span class="hljs-params">x</span>: 0, <span class="hljs-params">y</span>: <span class="hljs-params">view</span>.<span class="hljs-params">frame</span>.<span class="hljs-params">height</span> - <span class="hljs-params">bottomLogoViewHeight</span>, <span class="hljs-params">width</span>: <span class="hljs-params">view</span>.<span class="hljs-params">frame</span>.<span class="hljs-params">width</span>, <span class="hljs-params">height</span>: <span class="hljs-params">bottomLogoViewHeight</span>)</span><br>            <span class="hljs-keyword">if</span> adType<span class="hljs-operator"> == </span>.image &#123;<br>                imageView.frame = <span class="hljs-constructor">CGRect(<span class="hljs-params">x</span>: 0, <span class="hljs-params">y</span>: 0, <span class="hljs-params">width</span>: <span class="hljs-params">view</span>.<span class="hljs-params">frame</span>.<span class="hljs-params">width</span>, <span class="hljs-params">height</span>: <span class="hljs-params">view</span>.<span class="hljs-params">frame</span>.<span class="hljs-params">height</span> - <span class="hljs-params">bottomLogoViewHeight</span>)</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                playerLayer.frame = <span class="hljs-constructor">CGRect(<span class="hljs-params">x</span>: 0, <span class="hljs-params">y</span>: 0, <span class="hljs-params">width</span>: <span class="hljs-params">view</span>.<span class="hljs-params">frame</span>.<span class="hljs-params">width</span>, <span class="hljs-params">height</span>: <span class="hljs-params">view</span>.<span class="hljs-params">frame</span>.<span class="hljs-params">height</span>)</span><br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> adType<span class="hljs-operator"> == </span>.image &#123;<br>                imageView.frame = view.bounds<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                playerLayer.frame = view.bounds<br>            &#125;<br>        &#125;<br>    &#125;<br>        <br>    override var shouldAutorotate: Bool &#123;<br>        return <span class="hljs-literal">false</span><br>    &#125;<br>    <br>    override var prefersHomeIndicatorAutoHidden: Bool &#123;<br>        return <span class="hljs-literal">false</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åŠ è½½æ§åˆ¶ä»£ç "><a href="#åŠ è½½æ§åˆ¶ä»£ç " class="headerlink" title="åŠ è½½æ§åˆ¶ä»£ç "></a>åŠ è½½æ§åˆ¶ä»£ç </h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">import</span> UIKit<br><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">WDLaunchADType</span> </span>&#123;<br>    <span class="hljs-keyword">case</span> image<br>    <span class="hljs-keyword">case</span> video<br>&#125;<br><br><span class="hljs-comment">/// æ˜¯å¦æ˜¯åˆ˜æµ·å±ç³»åˆ—</span><br><span class="hljs-keyword">var</span> kIS_IPHONEX: <span class="hljs-type">Bool</span> &#123;<br>    <span class="hljs-keyword">var</span> iPhoneX <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-type">UIDevice</span>.current.userInterfaceIdiom <span class="hljs-operator">!=</span> .phone &#123;<br>        <span class="hljs-keyword">return</span> iPhoneX<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">#available</span>(<span class="hljs-keyword">iOS</span> <span class="hljs-number">11.0</span>, <span class="hljs-operator">*</span>) &#123;<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> mainWindow <span class="hljs-operator">=</span> <span class="hljs-type">UIApplication</span>.shared.delegate<span class="hljs-operator">?</span>.window &#123;<br>            <span class="hljs-keyword">if</span> (mainWindow<span class="hljs-operator">?</span>.safeAreaInsets.bottom)<span class="hljs-operator">!</span> <span class="hljs-operator">&gt;</span> <span class="hljs-type">CGFloat</span>(<span class="hljs-number">0.0</span>) &#123;<br>                iPhoneX <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> iPhoneX<br>&#125;<br><br><span class="hljs-comment">/// çŠ¶æ€æ é«˜åº¦</span><br><span class="hljs-keyword">var</span> kSTATUS_HEIGHT: <span class="hljs-type">CGFloat</span> &#123;<br>    <span class="hljs-keyword">return</span> kIS_IPHONEX <span class="hljs-operator">?</span> <span class="hljs-type">UIApplication</span>.shared.statusBarFrame.height : <span class="hljs-number">22</span><br>&#125;<br><br><span class="hljs-comment">// MARK: - Main</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WDLaunchAD</span>: <span class="hljs-title">NSObject</span> </span>&#123;<br>    <span class="hljs-comment">// MARK: Public</span><br>    <span class="hljs-comment">/// é™æ€æ–¹æ³•</span><br>    <span class="hljs-comment">///</span><br>    <span class="hljs-comment">/// - Parameters:</span><br>    <span class="hljs-comment">///   - adType: å¹¿å‘Šç±»å‹ `å›¾ç‰‡` `è§†é¢‘&lt;æ— å£°éŸ³&gt;`</span><br>    <span class="hljs-comment">///   - url: å¹¿å‘Šåœ°å€</span><br>    <span class="hljs-comment">///   - durition: æ˜¾ç¤ºæ—¶é—´</span><br>    <span class="hljs-comment">///   - bottomView: åº•éƒ¨è§†å›¾</span><br>    <span class="hljs-comment">///   - buttomViewHeight: åº•éƒ¨è§†å›¾é«˜åº¦</span><br>    <span class="hljs-comment">///   - clickBlock: å¹¿å‘Šç‚¹å‡»äº‹ä»¶å›è°ƒ</span><br>    <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setup</span>(<span class="hljs-params">with</span> <span class="hljs-params">adType</span>: <span class="hljs-type">WDLaunchADType</span> <span class="hljs-operator">=</span> .image,</span><br><span class="hljs-function">                      <span class="hljs-params">url</span>: <span class="hljs-type">String</span>, <span class="hljs-params">durition</span>: <span class="hljs-type">Int</span>,</span><br><span class="hljs-function">                      <span class="hljs-params">bottomView</span>: <span class="hljs-type">UIView</span>? <span class="hljs-operator">=</span> <span class="hljs-type">UIView</span>(),</span><br><span class="hljs-function">                      <span class="hljs-params">buttomViewHeight</span>: <span class="hljs-type">CGFloat</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>,</span><br><span class="hljs-function">                      <span class="hljs-params">clickBlock</span>: <span class="hljs-keyword">@escaping</span> (() -&gt; <span class="hljs-type">Void</span>))</span> &#123;<br>        <br>        <span class="hljs-keyword">let</span> manager <span class="hljs-operator">=</span> <span class="hljs-type">WDLaunchAD</span>()<br>        manager.show(with: adType, url: url, durition: durition, bottomView: bottomView, buttomViewHeight: buttomViewHeight ,clickBlock: clickBlock)<br>    &#125;<br>    <br>    <span class="hljs-comment">// MARK: Private</span><br>    <span class="hljs-comment">/// é¡µé¢æ˜¾ç¤ºçš„windowæ ¹æ§åˆ¶å™¨ï¼Œé™¤äº†å€’è®¡æ—¶æŒ‰é’®ï¼Œå…¶ä»–å…ƒç´ åœ¨æ§åˆ¶å™¨ä¸­é…ç½®</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> wdLaunchADViewController <span class="hljs-operator">=</span> <span class="hljs-type">WDLaunchADController</span>()<br>    <span class="hljs-comment">/// æ˜¾ç¤ºçš„æ—¶é—´</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> timerInterval: <span class="hljs-type">Int</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br>    <span class="hljs-comment">/// å®šæ—¶å™¨</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> timer: <span class="hljs-type">Timer</span>?<br>    <span class="hljs-comment">/// ç‚¹å‡»äº‹ä»¶å›è°ƒ</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> clickBlockHandle: (() -&gt; <span class="hljs-type">Void</span>)<span class="hljs-operator">?</span><br>    <span class="hljs-comment">/// é¡µé¢æ˜¾ç¤ºçš„window</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> window: <span class="hljs-type">UIWindow</span> <span class="hljs-operator">=</span> &#123;<br>        <span class="hljs-keyword">let</span> window <span class="hljs-operator">=</span> <span class="hljs-type">UIWindow</span>.<span class="hljs-keyword">init</span>(frame: <span class="hljs-type">UIScreen</span>.main.bounds)<br>        window.rootViewController<span class="hljs-operator">?</span>.view.backgroundColor <span class="hljs-operator">=</span> .black<br>        window.rootViewController<span class="hljs-operator">?</span>.view.isUserInteractionEnabled <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>        window.windowLevel <span class="hljs-operator">=</span> <span class="hljs-type">UIWindow</span>.<span class="hljs-type">Level</span>.statusBar <span class="hljs-operator">+</span> <span class="hljs-number">1</span><br>        window.isHidden <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>        window.alpha <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> window<br>    &#125;()<br>    <span class="hljs-comment">/// å€’è®¡æ—¶æŒ‰é’®</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> timeButton: <span class="hljs-type">UIButton</span> <span class="hljs-operator">=</span> &#123;<br>        <span class="hljs-keyword">let</span> button <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>(type: .custom)<br>        button.backgroundColor <span class="hljs-operator">=</span> <span class="hljs-type">UIColor</span>(white: <span class="hljs-number">0</span>, alpha: <span class="hljs-number">0.5</span>)<br>        button.setTitleColor(.white, for: .normal)<br>        button.titleLabel<span class="hljs-operator">?</span>.font <span class="hljs-operator">=</span> <span class="hljs-type">UIFont</span>.systemFont(ofSize: <span class="hljs-number">15</span>)<br>        <span class="hljs-keyword">return</span> button<br>    &#125;()<br>&#125;<br><br><span class="hljs-comment">// MARK: - é¡µé¢åˆå§‹åŒ–ä¸é”€æ¯</span><br><span class="hljs-keyword">fileprivate</span> <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">WDLaunchAD</span> </span>&#123;<br>    <span class="hljs-comment">// æ§åˆ¶å™¨åˆå§‹åŒ–é¡µé¢</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">show</span>(<span class="hljs-params">with</span> <span class="hljs-params">adType</span>: <span class="hljs-type">WDLaunchADType</span>, <span class="hljs-params">url</span>: <span class="hljs-type">String</span>, <span class="hljs-params">durition</span>: <span class="hljs-type">Int</span>, <span class="hljs-params">bottomView</span>: <span class="hljs-type">UIView</span>?, <span class="hljs-params">buttomViewHeight</span>: <span class="hljs-type">CGFloat</span>, <span class="hljs-params">clickBlock</span>: <span class="hljs-keyword">@escaping</span> (() -&gt; <span class="hljs-type">Void</span>))</span> &#123;<br>        clickBlockHandle <span class="hljs-operator">=</span> clickBlock<br>        timerInterval <span class="hljs-operator">=</span> durition<br>        window.rootViewController <span class="hljs-operator">=</span> wdLaunchADViewController<br>        wdLaunchADViewController.view.addGestureRecognizer(<span class="hljs-type">UITapGestureRecognizer</span>.<span class="hljs-keyword">init</span>(target: <span class="hljs-keyword">self</span>, action: #selector(adGuestureTargetAction)))<br>        wdLaunchADViewController.setup(with: adType, url: url, bottomLogoView: bottomView, bottomLogoViewHeight: buttomViewHeight)<br>        addTimeButton()<br>        <br>        <span class="hljs-comment">// å¼€å§‹å€’è®¡æ—¶</span><br>        <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() <span class="hljs-operator">+</span> <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">self</span>.timer <span class="hljs-operator">=</span> <span class="hljs-type">Timer</span>.scheduledTimer(timeInterval: <span class="hljs-number">1</span>, target: <span class="hljs-keyword">self</span>, selector: #selector(<span class="hljs-keyword">self</span>.timerDown(timer:)), userInfo: <span class="hljs-literal">nil</span>, repeats: <span class="hljs-literal">true</span>)<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> timer <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span>.timer &#123;<br>                timer.fire()<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// ç§»é™¤å®šæ—¶å™¨ä¸è§†å›¾</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">removeWindow</span>()</span> &#123;<br>        <span class="hljs-comment">// åœæ­¢æ’­æ”¾è§†é¢‘</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-type">WDLaunchADPlayerManager</span>.share.player <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span>  &#123;<br>            <span class="hljs-type">WDLaunchADPlayerManager</span>.share.stopPlay()<br>        &#125;<br>        <br>        <span class="hljs-comment">// åœæ­¢å€’è®¡æ—¶å¹¶ç§»é™¤</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> timer <span class="hljs-operator">=</span> timer &#123;<br>            timer.invalidate()<br>        &#125;<br>        timer <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span><br>        <br>        <span class="hljs-comment">// ç§»é™¤å½“å‰è§†å›¾</span><br>        <span class="hljs-type">UIView</span>.transition(with: window, duration: <span class="hljs-number">0.8</span>, options: <span class="hljs-type">UIView</span>.<span class="hljs-type">AnimationOptions</span>.curveEaseOut, animations: &#123;<br>            <span class="hljs-keyword">self</span>.window.alpha <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        &#125;) &#123; (finished) <span class="hljs-keyword">in</span><br>            <span class="hljs-keyword">self</span>.window.rootViewController <span class="hljs-operator">=</span> <span class="hljs-literal">nil</span><br>            <span class="hljs-keyword">self</span>.window.removeFromSuperview()<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// MARK: - é¡µé¢æ§ä»¶é…ç½®</span><br><span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">WDLaunchAD</span> </span>&#123;<br>    <span class="hljs-comment">// é…ç½®æ—¶é—´æŒ‰é’®</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addTimeButton</span>()</span> &#123;<br>        timeButton.setTitle(<span class="hljs-string">&quot;   è·³è¿‡ <span class="hljs-subst">\(timerInterval)</span>   &quot;</span>, for: .normal)<br>        timeButton.addTarget(<span class="hljs-keyword">self</span>, action: #selector(buttonTargetAction(sender:)), for: .touchUpInside)<br>        window.addSubview(timeButton)<br>        timeButton.translatesAutoresizingMaskIntoConstraints <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>        window.addConstraints([<br>            <span class="hljs-type">NSLayoutConstraint</span>(item: timeButton, attribute: .trailing, relatedBy: .equal, toItem: window, attribute: .trailing, multiplier: <span class="hljs-number">1</span>, constant: <span class="hljs-operator">-</span><span class="hljs-number">15</span>),<br>            <span class="hljs-type">NSLayoutConstraint</span>(item: timeButton, attribute: .top, relatedBy: .equal, toItem: window, attribute: .top, multiplier: <span class="hljs-number">1</span>, constant: kSTATUS_HEIGHT),<br>        ])<br>        timeButton.layoutIfNeeded()<br>        timeButton.layer.cornerRadius <span class="hljs-operator">=</span> timeButton.frame.height <span class="hljs-operator">/</span> <span class="hljs-number">2.0</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// MARK: - å€’è®¡æ—¶ä¸å€’è®¡æ—¶ç‚¹å‡»äº‹ä»¶</span><br><span class="hljs-keyword">@objc</span> <span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">WDLaunchAD</span> </span>&#123;<br>    <span class="hljs-comment">// å€’è®¡æ—¶</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">timerDown</span>(<span class="hljs-params">timer</span>: <span class="hljs-type">Timer</span>)</span> &#123;<br>        timerInterval <span class="hljs-operator">-=</span> <span class="hljs-number">1</span><br>        timeButton.setTitle(<span class="hljs-string">&quot;   è·³è¿‡ <span class="hljs-subst">\(timerInterval)</span>   &quot;</span>, for: .normal)<br>        <span class="hljs-keyword">if</span> timerInterval <span class="hljs-operator">==</span> <span class="hljs-number">0</span> &#123;<br>            removeWindow()<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// å¹¿å‘Šé¡µç§»é™¤</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">buttonTargetAction</span>(<span class="hljs-params">sender</span>: <span class="hljs-type">UIButton</span>)</span> &#123;<br>        removeWindow()<br>    &#125;<br>    <br>    <span class="hljs-comment">// ç‚¹å‡»æ‰‹åŠ¿</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">adGuestureTargetAction</span>()</span> &#123;<br>        <span class="hljs-keyword">if</span> clickBlockHandle <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span> &#123;<br>            clickBlockHandle<span class="hljs-operator">!</span>()<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åŠ è½½æ–¹å¼"><a href="#åŠ è½½æ–¹å¼" class="headerlink" title="åŠ è½½æ–¹å¼"></a>åŠ è½½æ–¹å¼</h3><p>åœ¨<code>AppDelgate</code>ä¸­çš„<code>didFinishLaunchingWithOptions</code>æ–¹æ³•ä¸­è°ƒç”¨æ–¹æ³•ã€‚<br>æˆ‘è¿™ä¸ºäº†é€‚åº”å˜åŒ–çš„éœ€è¦ï¼Œæä¾›äº†ç›¸å¯¹è‡ªç”±çš„æ˜¾ç¤ºæ–¹å¼</p><p>åº•éƒ¨çš„logoè§†å›¾æ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œä¼ å…¥å¯¹åº”æ˜¾ç¤ºçš„é«˜åº¦å³å¯ã€‚</p><p>å›¾ç‰‡åœ°å€</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs perl">let imagePath = <span class="hljs-string">&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1567682065374&amp;di=4c2a4d2008a4e951b34b3d130db19d12&amp;imgtype=0&amp;src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201704%2F14%2F20170414155109_Cmz24.jpeg&quot;</span><br></code></pre></td></tr></table></figure><ul><li><p>ä»…æ˜¾ç¤ºå›¾ç‰‡</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">WDLaunchAD</span><span class="hljs-selector-class">.setup</span>(<span class="hljs-attribute">with</span>: .image, <span class="hljs-attribute">url</span>: imagePath, <span class="hljs-attribute">durition</span>: <span class="hljs-number">5</span>, <span class="hljs-attribute">bottomView</span>: WDLaunchADBottomLogoView(), <span class="hljs-attribute">buttomViewHeight</span>: <span class="hljs-number">180</span>) &#123;<br>    <span class="hljs-selector-tag">print</span>(<span class="hljs-string">&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/3334769-d6fbb2567bb19116.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/375" alt="ä»…æ˜¾ç¤ºå›¾ç‰‡"></p></li><li><p>æ˜¾ç¤ºå›¾ç‰‡ä¸åº•éƒ¨logoè§†å›¾<br>åº•éƒ¨è§†å›¾ä»£ç </p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">// MARK: - åº•éƒ¨logoè§†å›¾</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WDLaunchADBottomLogoView</span>: <span class="hljs-title">UIView</span> </span>&#123;<br>    <span class="hljs-comment">// logo</span><br>    <span class="hljs-keyword">let</span> logoImageView: <span class="hljs-type">UIImageView</span> <span class="hljs-operator">=</span> &#123;<br>        <span class="hljs-keyword">let</span> imageV <span class="hljs-operator">=</span> <span class="hljs-type">UIImageView</span>()<br>        imageV.image <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(named: <span class="hljs-string">&quot;nav-logo-4c7bbafe27adc892f3046e6978459bac&quot;</span>)<span class="hljs-operator">?</span>.withRenderingMode(.alwaysTemplate)<br>        imageV.tintColor <span class="hljs-operator">=</span> .red<br>        <span class="hljs-keyword">return</span> imageV<br>    &#125;()<br>    <br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">init</span>(<span class="hljs-params">frame</span>: <span class="hljs-type">CGRect</span>)</span> &#123;<br>        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>(frame: frame)<br>        setupSubviews()<br>        setupSubviewsLayouts()<br>    &#125;<br>    <br>    <span class="hljs-keyword">required</span> <span class="hljs-function"><span class="hljs-keyword">init?</span>(<span class="hljs-params">coder</span> <span class="hljs-params">aDecoder</span>: <span class="hljs-type">NSCoder</span>)</span> &#123;<br>        <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">&quot;init(coder:) has not been implemented&quot;</span>)<br>    &#125;<br>&#125;<br><br><br><span class="hljs-comment">// MARK: åº•éƒ¨logoè§†å›¾é¡µé¢é…ç½®ä¸å¸ƒå±€</span><br><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">WDLaunchADBottomLogoView</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setupSubviews</span>()</span> &#123;<br>        backgroundColor <span class="hljs-operator">=</span> .white<br>        addSubview(logoImageView)<br>        logoImageView.translatesAutoresizingMaskIntoConstraints <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">setupSubviewsLayouts</span>()</span> &#123;<br>        addConstraints([<br>            <span class="hljs-type">NSLayoutConstraint</span>(item: logoImageView, attribute: .centerX, relatedBy: .equal, toItem: <span class="hljs-keyword">self</span>, attribute: .centerX, multiplier: <span class="hljs-number">1</span>, constant: <span class="hljs-number">0</span>),<br>            <span class="hljs-type">NSLayoutConstraint</span>(item: logoImageView, attribute: .centerY, relatedBy: .equal, toItem: <span class="hljs-keyword">self</span>, attribute: .centerY, multiplier: <span class="hljs-number">1</span>, constant: <span class="hljs-number">0</span>)<br>        ])<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŠ è½½ä»£ç </p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">WDLaunchAD</span><span class="hljs-selector-class">.setup</span>(<span class="hljs-attribute">with</span>: .image, <span class="hljs-attribute">url</span>: imagePath, <span class="hljs-attribute">durition</span>: <span class="hljs-number">5</span>, <span class="hljs-attribute">bottomView</span>: WDLaunchADBottomLogoView(), <span class="hljs-attribute">buttomViewHeight</span>: <span class="hljs-number">180</span>) &#123;<br>    <span class="hljs-selector-tag">print</span>(<span class="hljs-string">&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/3334769-50c5290afad2df1f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/375" alt="å›¾ç‰‡+åº•éƒ¨logoè§†å›¾"></p></li><li><p>åŠ è½½è§†é¢‘<br>é¦–å…ˆéœ€è¦ç°åœ¨æœ‰ç½‘çš„ç¯å¢ƒç¼“å­˜åˆ°æœ¬åœ°ï¼Œæˆ‘è¿™è¾¹çš„æ€æƒ³æ˜¯ï¼Œé¦–æ¬¡è¿›å…¥Appé»˜è®¤åŠ è½½å›¾ç‰‡ï¼Œç„¶åä¸‹è½½å¹¿å‘Šçš„è§†é¢‘åˆ°æœ¬åœ°ã€‚å†æ¬¡è¿›å…¥çš„æ—¶å€™ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯ç¼“å­˜çš„è§†é¢‘ï¼Œæ˜¯åˆ™è¿›è¡Œæ’­æ”¾ã€‚æ˜¯å¦åŠ è½½çš„<code>URL</code>ä¸ç¼“å­˜çš„ä¸åŒï¼Œåˆ™ä¾æ—§åŠ è½½å›¾ç‰‡ï¼Œå¹¶ä¸‹è½½æœ€æ–°<code>URL</code>ä¸‹çš„è§†é¢‘ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-keyword">let</span> path = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">WDLaunchADDownloader</span>.</span></span>download<span class="hljs-constructor">Video(<span class="hljs-params">path</span>: <span class="hljs-string">&quot;http://wvideo.spriteapp.cn/video/2018/0514/eede6198571f11e8b5ca842b2b4c75ab_wpd.mp4&quot;</span>)</span><br>    <span class="hljs-keyword">if</span> path.count &gt; <span class="hljs-number">0</span> &#123;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">WDLaunchAD</span>.</span></span>setup(<span class="hljs-keyword">with</span>: .video, url: path, durition: <span class="hljs-number">5</span>, bottomView: <span class="hljs-constructor">WDLaunchADBottomLogoView()</span>, buttomViewHeight: <span class="hljs-number">180</span>) &#123;<br>            print(<span class="hljs-string">&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;</span>)<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">WDLaunchAD</span>.</span></span>setup(<span class="hljs-keyword">with</span>: .image, url: imagePath, durition: <span class="hljs-number">5</span>, bottomView: <span class="hljs-constructor">WDLaunchADBottomLogoView()</span>, buttomViewHeight: <span class="hljs-number">180</span>) &#123;<br>            print(<span class="hljs-string">&quot;âœ¨ ç‚¹å‡»äº†å¹¿å‘Š&quot;</span>)<br>        &#125;<br> &#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ•ˆæœå›¾ï¼Œæ²¡æœ‰æ‰¾åˆ°åˆé€‚å¤§å°çš„è§†é¢‘å°±å‡‘åˆç€ç”¨äº†ã€‚</p></blockquote></li></ul><p><img src="https://upload-images.jianshu.io/upload_images/3334769-fad275cc7fe23ab3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/375" alt="è§†é¢‘æ’­æ”¾"></p><blockquote><p>è¯´æ˜:</p><ol><li>é¡µé¢æ¶ˆå¤±çš„åŠ¨ç”»ï¼Œæ²¡æœ‰åšè¿‡å¤šçš„å¤„ç†</li><li>è§†é¢‘æ²¡æœ‰åšå¾ªç¯æ’­æ”¾</li></ol></blockquote>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>Swift</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶-åˆ†æ®µé€‰æ‹©å™¨-Swift</title>
    <link href="/2019/06/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%88%86%E6%AE%B5%E9%80%89%E6%8B%A9%E5%99%A8-Swift/"/>
    <url>/2019/06/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E5%88%86%E6%AE%B5%E9%80%89%E6%8B%A9%E5%99%A8-Swift/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-3932cbca22e906ac.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"><br>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç </p><h5 id="1ã€æ•°æ®æºæ–¹æ³•"><a href="#1ã€æ•°æ®æºæ–¹æ³•" class="headerlink" title="1ã€æ•°æ®æºæ–¹æ³•"></a>1ã€æ•°æ®æºæ–¹æ³•</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">// MARK: ============ SegmentSelectorManagerDataSource ============</span><br><span class="hljs-keyword">@objc</span> <span class="hljs-class"><span class="hljs-keyword">protocol</span>  <span class="hljs-title">SegmentSelectorManagerDataSource</span>:<span class="hljs-title">NSObjectProtocol</span> </span>&#123;<br>    <br>    <span class="hljs-comment">/// ä¸»è¦é…ç½® -&gt; å¿…é¡»è¦å®ç°</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">nameOfSliderItems</span>(<span class="hljs-params">segemntControl</span>:<span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt;<br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">childViewControllers</span>(<span class="hljs-params">segemntControl</span>:<span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">Array</span>&lt;<span class="hljs-type">UIViewController</span>&gt;<br>    <br>    <span class="hljs-comment">/// å­—ä½“é¢œè‰²é…ç½® -&gt; æœ‰é»˜è®¤</span><br>    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">optional</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">colorOfSlider</span>(<span class="hljs-params">segemntControl</span>:<span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">UIColor</span><br>    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">optional</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">colorOfTopView</span>(<span class="hljs-params">segemntControl</span>:<span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">UIColor</span><br>    <br>    <span class="hljs-comment">/// èƒŒæ™¯é¢œè‰²é…ç½® -&gt; æœ‰é»˜è®¤</span><br>    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">optional</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">colorOfSliderItemsTitle</span>(<span class="hljs-params">segemntControl</span>:<span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">UIColor</span><br>    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">optional</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">colorOfHighlightedSliderItemsTitle</span>(<span class="hljs-params">segemntControl</span>:<span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">UIColor</span><br>    <br>    <span class="hljs-comment">/// é«˜åº¦é…ç½® -&gt; æœ‰é»˜è®¤</span><br>    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">optional</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">heightOfTopView</span>(<span class="hljs-params">segemntControl</span>:<span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">CGFloat</span><br>    <span class="hljs-keyword">@objc</span> <span class="hljs-keyword">optional</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">heightOfSlider</span>(<span class="hljs-params">segemntControl</span>:<span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">CGFloat</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="2ã€ä»£ç†æ–¹æ³•"><a href="#2ã€ä»£ç†æ–¹æ³•" class="headerlink" title="2ã€ä»£ç†æ–¹æ³•"></a>2ã€ä»£ç†æ–¹æ³•</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">// MARK: ============ SegmentSelectorManagerDelegate ============</span><br><span class="hljs-class"><span class="hljs-keyword">protocol</span> <span class="hljs-title">SegmentSelectorManagerDelegate</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">slideView</span>(<span class="hljs-params">sliderView</span>:<span class="hljs-type">SegmentSelectorManager</span>, <span class="hljs-params">didSelectItemAtIndex</span>:<span class="hljs-type">Int</span>)</span> -&gt; <span class="hljs-type">Void</span><br>&#125;<br></code></pre></td></tr></table></figure><h5 id="3ã€é¡µé¢å®ç°"><a href="#3ã€é¡µé¢å®ç°" class="headerlink" title="3ã€é¡µé¢å®ç°"></a>3ã€é¡µé¢å®ç°</h5><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">init</span>(<span class="hljs-params">frame</span>: <span class="hljs-type">CGRect</span>)</span> &#123;<br>        <span class="hljs-keyword">super</span>.<span class="hljs-keyword">init</span>(frame: frame)<br>    &#125;<br>    <br>    <span class="hljs-keyword">required</span> <span class="hljs-function"><span class="hljs-keyword">init?</span>(<span class="hljs-params">coder</span> <span class="hljs-params">aDecoder</span>: <span class="hljs-type">NSCoder</span>)</span> &#123;<br>        <span class="hljs-built_in">fatalError</span>(<span class="hljs-string">&quot;init(coder:) has not been implemented&quot;</span>)<br>    &#125;<br>    <br>    <span class="hljs-comment">/// æ•°æ®æº</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">weak</span> <span class="hljs-keyword">var</span> dataSource:<span class="hljs-type">SegmentSelectorManagerDataSource</span>? &#123;<br>        <span class="hljs-keyword">didSet</span> &#123;<br>            <span class="hljs-comment">// åç§°æ•°ç»„</span><br>            namesOfSlideItems <span class="hljs-operator">=</span> dataSource<span class="hljs-operator">?</span>.nameOfSliderItems(segemntControl: <span class="hljs-keyword">self</span>)<br>            <span class="hljs-comment">// æ§åˆ¶å™¨æ•°ç»„</span><br>            childControllersArray <span class="hljs-operator">=</span> dataSource<span class="hljs-operator">?</span>.childViewControllers(segemntControl: <span class="hljs-keyword">self</span>)<br>            <br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> ds <span class="hljs-operator">=</span> dataSource &#123;<br><br>                <span class="hljs-keyword">if</span> (ds.responds(to: #selector(ds.colorOfHighlightedSliderItemsTitle(segemntControl:)))) &#123;<br>                    <span class="hljs-comment">//æŒ‰é’®å­—ä½“é¢œè‰²é»˜è®¤</span><br>                    colorOfSlideItemsTitle <span class="hljs-operator">=</span> ds.colorOfSliderItemsTitle<span class="hljs-operator">!</span>(segemntControl: <span class="hljs-keyword">self</span>)<br>                &#125;<br>            <br>                <span class="hljs-keyword">if</span> (ds.responds(to: #selector(ds.colorOfHighlightedSliderItemsTitle(segemntControl:)))) &#123;<br>                    <span class="hljs-comment">// æŒ‰é’®å­—ä½“é¢œè‰²é€‰ä¸­</span><br>                    colorOfHighlightedSlideItemsTitle <span class="hljs-operator">=</span> ds.colorOfHighlightedSliderItemsTitle<span class="hljs-operator">!</span>(segemntControl: <span class="hljs-keyword">self</span>)<br>                &#125;<br>                <br>                <span class="hljs-keyword">if</span> (ds.responds(to: #selector(ds.colorOfSlider(segemntControl:)))) &#123;<br>                    <span class="hljs-comment">// æŒ‡ç¤ºå™¨é¢œè‰²</span><br>                    colorOfSlider <span class="hljs-operator">=</span> ds.colorOfSlider<span class="hljs-operator">!</span>(segemntControl: <span class="hljs-keyword">self</span>)<br>                &#125;<br>                <br>                <span class="hljs-keyword">if</span> ds.responds(to: #selector(ds.heightOfTopView(segemntControl:))) &#123;<br>                    <span class="hljs-comment">// é¡¶éƒ¨è§†å›¾é«˜åº¦</span><br>                    heightOfTopView <span class="hljs-operator">=</span> (ds.heightOfTopView<span class="hljs-operator">!</span>(segemntControl: <span class="hljs-keyword">self</span>))<br>                &#125;<br>                <br>                <span class="hljs-keyword">if</span> ds.responds(to: #selector(ds.heightOfTopView(segemntControl:))) &#123;<br>                    <span class="hljs-comment">// æŒ‡ç¤ºå™¨é«˜åº¦</span><br>                    heightOfSlider <span class="hljs-operator">=</span> (ds.heightOfSlider<span class="hljs-operator">!</span>(segemntControl: <span class="hljs-keyword">self</span>))<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// ä»£ç†</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">var</span> delegate:<span class="hljs-type">SegmentSelectorManagerDelegate</span>?<br>    <br>    <span class="hljs-keyword">var</span> namesOfSlideItems: <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt;? <span class="hljs-operator">=</span> []                           <span class="hljs-comment">// åç§°æ•°ç»„</span><br>    <span class="hljs-keyword">var</span> colorOfSlider: <span class="hljs-type">UIColor</span>? <span class="hljs-operator">=</span>  <span class="hljs-type">UIColor</span>.orange                        <span class="hljs-comment">// æŒ‡ç¤ºå™¨é¢œè‰²</span><br>    <span class="hljs-keyword">var</span> colorOfSlideView: <span class="hljs-type">UIColor</span>? <span class="hljs-operator">=</span> <span class="hljs-type">UIColor</span>.white                       <span class="hljs-comment">// é¡¶éƒ¨è§†å›¾é¢œè‰²</span><br>    <span class="hljs-keyword">var</span> colorOfSlideItemsTitle: <span class="hljs-type">UIColor</span>? <span class="hljs-operator">=</span> <span class="hljs-type">UIColor</span>.gray                  <span class="hljs-comment">// é»˜è®¤å­—ä½“é¢œè‰²</span><br>    <span class="hljs-keyword">var</span> colorOfHighlightedSlideItemsTitle: <span class="hljs-type">UIColor</span>? <span class="hljs-operator">=</span> <span class="hljs-type">UIColor</span>.orange     <span class="hljs-comment">// é€‰ä¸­å­—ä½“é¢œè‰²</span><br>    <span class="hljs-keyword">var</span> heightOfTopView:<span class="hljs-type">CGFloat</span> <span class="hljs-operator">=</span> <span class="hljs-number">45</span>                                     <span class="hljs-comment">// é¡¶éƒ¨è§†å›¾é«˜åº¦</span><br>    <span class="hljs-keyword">var</span> heightOfSlider:<span class="hljs-type">CGFloat</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>                                       <span class="hljs-comment">// æŒ‡ç¤ºå™¨é«˜åº¦</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-type">SliderThanSliderView_WidthRatio</span>:<span class="hljs-type">CGFloat</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>                      <span class="hljs-comment">// æŒ‰é’®å’ŒæŒ‡ç¤ºå™¨å®½åº¦æ¯”</span><br>    <span class="hljs-keyword">var</span> buttonsArray:<span class="hljs-type">Array</span>&lt;<span class="hljs-type">UIButton</span>&gt;? <span class="hljs-operator">=</span> []                               <span class="hljs-comment">// æ‰€æœ‰æŒ‰é’®çš„æ•°ç»„</span><br>    <span class="hljs-keyword">var</span> childControllersArray:<span class="hljs-type">Array</span>&lt;<span class="hljs-type">UIViewController</span>&gt;? <span class="hljs-operator">=</span> []              <span class="hljs-comment">// æ§åˆ¶å™¨æ•°ç»„</span><br>    <br>    <span class="hljs-keyword">let</span> <span class="hljs-type">SCREEN_WIDTH</span> <span class="hljs-operator">=</span> <span class="hljs-type">UIScreen</span>.main.bounds.size.width<br>    <span class="hljs-keyword">let</span> <span class="hljs-type">SCREEN_HEIGHT</span> <span class="hljs-operator">=</span> <span class="hljs-type">UIScreen</span>.main.bounds.height<br>    <br>    <span class="hljs-comment">/// é¡¶éƒ¨View</span><br>    <span class="hljs-keyword">lazy</span> <span class="hljs-keyword">var</span> slideBar:<span class="hljs-type">UIView</span> <span class="hljs-operator">=</span> &#123;<br>        <span class="hljs-keyword">let</span> view <span class="hljs-operator">=</span> <span class="hljs-type">UIView</span>.<span class="hljs-keyword">init</span>()<br>        view.backgroundColor <span class="hljs-operator">=</span> colorOfSlideView<br>        addSubview(view)<br>        view.translatesAutoresizingMaskIntoConstraints <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>        view.leadingAnchor.constraint(equalTo: leadingAnchor).isActive <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        view.trailingAnchor.constraint(equalTo: trailingAnchor).isActive <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        view.topAnchor.constraint(equalTo: topAnchor).isActive <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        view.heightAnchor.constraint(equalToConstant: <span class="hljs-keyword">self</span>.heightOfTopView).isActive <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        <span class="hljs-keyword">return</span> view<br>    &#125;()<br>    <br>    <span class="hljs-comment">// åº•éƒ¨æŒ‡ç¤ºå™¨</span><br>    <span class="hljs-keyword">var</span> slider:<span class="hljs-type">UIView</span>?<br>    <br>    <span class="hljs-comment">/// æ§åˆ¶å™¨ScrollView</span><br>    <span class="hljs-keyword">lazy</span> <span class="hljs-keyword">var</span> contentScrollView:<span class="hljs-type">UIScrollView</span> <span class="hljs-operator">=</span> &#123;<br>        <span class="hljs-keyword">let</span> sc <span class="hljs-operator">=</span> <span class="hljs-type">UIScrollView</span>.<span class="hljs-keyword">init</span>()<br>        sc.isDirectionalLockEnabled <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        sc.backgroundColor <span class="hljs-operator">=</span> <span class="hljs-type">UIColor</span>.white<br>        sc.isPagingEnabled <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        sc.showsHorizontalScrollIndicator <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>        sc.delegate <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span><br>        sc.bounces <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>        addSubview(sc)<br>        sc.translatesAutoresizingMaskIntoConstraints <span class="hljs-operator">=</span> <span class="hljs-literal">false</span><br>        sc.leadingAnchor.constraint(equalTo: leadingAnchor).isActive <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        sc.trailingAnchor.constraint(equalTo: trailingAnchor).isActive <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        sc.topAnchor.constraint(equalTo: <span class="hljs-keyword">self</span>.slideBar.bottomAnchor).isActive <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        sc.bottomAnchor.constraint(equalTo: bottomAnchor).isActive <span class="hljs-operator">=</span> <span class="hljs-literal">true</span><br>        <span class="hljs-keyword">return</span> sc<br>    &#125;()<br></code></pre></td></tr></table></figure><p>#####4ã€ç»˜åˆ¶é¡µé¢UI</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><code class="hljs swift">    <span class="hljs-comment">// è·å–å½“å‰é¡µé¢çš„æ§åˆ¶å™¨</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">viewController</span>()</span>-&gt;<span class="hljs-type">UIViewController</span>? &#123;<br>        <span class="hljs-keyword">var</span> nextResponder: <span class="hljs-type">UIResponder</span>? <span class="hljs-operator">=</span> <span class="hljs-keyword">self</span><br>        <span class="hljs-keyword">repeat</span> &#123;<br>            nextResponder <span class="hljs-operator">=</span> nextResponder<span class="hljs-operator">?</span>.next<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> viewController <span class="hljs-operator">=</span> nextResponder <span class="hljs-keyword">as?</span> <span class="hljs-type">UIViewController</span> &#123;<br>                <span class="hljs-keyword">return</span> viewController<br>            &#125;<br>        &#125; <span class="hljs-keyword">while</span> nextResponder <span class="hljs-operator">!=</span> <span class="hljs-literal">nil</span><br>        <br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>    &#125;<br><br><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">layoutSubviews</span>()</span> &#123;<br>        <span class="hljs-keyword">super</span>.layoutSubviews()<br>        addSlider()<br>        addButton()<br>        addContentScrollView()<br>    &#125;<br><span class="hljs-comment">/// æ·»åŠ æŒ‰é’®åˆ°é¡¶éƒ¨è§†å›¾</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addButton</span>()</span> &#123;<br>        <br>        <span class="hljs-keyword">let</span> numberOfItems:<span class="hljs-type">Int</span> <span class="hljs-operator">=</span> (namesOfSlideItems<span class="hljs-operator">?</span>.count)<span class="hljs-operator">!</span><br>        <span class="hljs-keyword">let</span> slideItemWidth <span class="hljs-operator">=</span> <span class="hljs-type">SCREEN_WIDTH</span> <span class="hljs-operator">/</span> <span class="hljs-type">CGFloat</span>(numberOfItems)<br>        <span class="hljs-keyword">let</span> sliderWidth <span class="hljs-operator">=</span> slideItemWidth <span class="hljs-operator">*</span> <span class="hljs-type">SliderThanSliderView_WidthRatio</span><br>        <span class="hljs-keyword">let</span> position_x <span class="hljs-operator">=</span> (slideItemWidth <span class="hljs-operator">-</span> sliderWidth) <span class="hljs-operator">/</span> <span class="hljs-number">2.0</span><br>        <br>        <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span><span class="hljs-operator">..&lt;</span>numberOfItems &#123;<br>            <span class="hljs-keyword">let</span> b <span class="hljs-operator">=</span> <span class="hljs-type">UIButton</span>.<span class="hljs-keyword">init</span>(type: .custom)<br>            b.tag <span class="hljs-operator">=</span> index<br>            b.setTitle(namesOfSlideItems<span class="hljs-operator">!</span>[index], for: .normal)<br>            b.setTitleColor(colorOfSlideItemsTitle, for: .normal)<br>            b.titleLabel<span class="hljs-operator">?</span>.textAlignment <span class="hljs-operator">=</span> .center<br>            b.addTarget(<span class="hljs-keyword">self</span>, action: #selector(buttonTouched(button:)), for: .touchUpInside)<br>            buttonsArray<span class="hljs-operator">?</span>.append(b)<br>            b.frame <span class="hljs-operator">=</span> <span class="hljs-type">CGRect</span>(x: position_x <span class="hljs-operator">+</span> slideItemWidth <span class="hljs-operator">*</span> <span class="hljs-type">CGFloat</span>(index),<br>                             y: <span class="hljs-number">5</span>,<br>                             width: sliderWidth,<br>                             height: heightOfTopView<span class="hljs-operator">-</span><span class="hljs-number">5</span>)<br>            slideBar.addSubview(b)<br>            <br>            <span class="hljs-keyword">if</span> index <span class="hljs-operator">==</span> <span class="hljs-number">0</span> &#123;<br>                b.setTitleColor(colorOfHighlightedSlideItemsTitle<span class="hljs-operator">!</span>, for: .normal)<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// æ·»åŠ åº•éƒ¨æŒ‡ç¤ºå™¨åˆ°é¡¶éƒ¨è§†å›¾</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addSlider</span>()</span> &#123;<br>        <span class="hljs-keyword">let</span> slideItemWidth <span class="hljs-operator">=</span>  <span class="hljs-type">SCREEN_WIDTH</span> <span class="hljs-operator">/</span> <span class="hljs-type">CGFloat</span>((namesOfSlideItems<span class="hljs-operator">?</span>.count)<span class="hljs-operator">!</span>)<br>        <span class="hljs-keyword">let</span> sliderWidth <span class="hljs-operator">=</span> slideItemWidth <span class="hljs-operator">*</span> <span class="hljs-type">SliderThanSliderView_WidthRatio</span><br>        <span class="hljs-keyword">let</span> position_x <span class="hljs-operator">=</span> (slideItemWidth <span class="hljs-operator">-</span> sliderWidth) <span class="hljs-operator">/</span> <span class="hljs-number">2.0</span><br>        slideBar.addSubview(sliderView(frame: <span class="hljs-type">CGRect</span>(x: position_x,<br>                                                     y: heightOfTopView <span class="hljs-operator">-</span> heightOfSlider,<br>                                                     width: sliderWidth,<br>                                                     height: heightOfSlider)))<br>        slideBar.backgroundColor <span class="hljs-operator">=</span> colorOfSlideView<br>        slider<span class="hljs-operator">?</span>.backgroundColor <span class="hljs-operator">=</span> colorOfSlider<br>    &#125;<br>    <br>     <span class="hljs-comment">// æ·»åŠ ScrollView</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">addContentScrollView</span>()</span> &#123;<br>        contentScrollView.contentSize <span class="hljs-operator">=</span> <span class="hljs-type">CGSize</span>(width: <span class="hljs-type">SCREEN_WIDTH</span> <span class="hljs-operator">*</span> <span class="hljs-type">CGFloat</span>((namesOfSlideItems<span class="hljs-operator">?</span>.count)<span class="hljs-operator">!</span>), height: <span class="hljs-number">0</span>)<br><br>        <span class="hljs-keyword">for</span> (index) <span class="hljs-keyword">in</span> (childControllersArray<span class="hljs-operator">?</span>.enumerated())<span class="hljs-operator">!</span> &#123;<br>            index.element.view.frame <span class="hljs-operator">=</span> <span class="hljs-type">CGRect</span>(x: <span class="hljs-type">CGFloat</span>(index.offset) <span class="hljs-operator">*</span> <span class="hljs-type">SCREEN_WIDTH</span>,<br>                                              y: <span class="hljs-number">0</span>,<br>                                              width: contentScrollView.frame.width,<br>                                              height: contentScrollView.frame.height)<br>            contentScrollView.addSubview(index.element.view)<br>            viewController()<span class="hljs-operator">?</span>.addChild(index.element)<br>            index.element.didMove(toParent: viewController())<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-comment">// vcæ»šåŠ¨åŠ¨ç”»</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">animateSlider</span>(<span class="hljs-params">tag</span>:<span class="hljs-type">Int</span>)</span> -&gt; <span class="hljs-type">Void</span> &#123;<br>        contentScrollView.setContentOffset(<span class="hljs-type">CGPoint</span>(x: <span class="hljs-type">SCREEN_WIDTH</span> <span class="hljs-operator">*</span> <span class="hljs-type">CGFloat</span>(tag), y: <span class="hljs-number">0</span>), animated: <span class="hljs-literal">true</span>)<br>    &#125;<br>    <br>    <span class="hljs-comment">// æŒ‡ç¤ºå™¨æ»šåŠ¨åŠ¨ç”»</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">animateSliderToPosition</span>(<span class="hljs-params">offset</span>:<span class="hljs-type">CGPoint</span>)</span> -&gt; <span class="hljs-type">Void</span> &#123;<br>        <br>        <span class="hljs-keyword">let</span> slideItemWidth <span class="hljs-operator">=</span>  <span class="hljs-type">SCREEN_WIDTH</span> <span class="hljs-operator">/</span> <span class="hljs-type">CGFloat</span>((namesOfSlideItems<span class="hljs-operator">?</span>.count)<span class="hljs-operator">!</span>)<br>        <span class="hljs-keyword">let</span> sliderWidth <span class="hljs-operator">=</span>  slideItemWidth <span class="hljs-operator">*</span> <span class="hljs-type">SliderThanSliderView_WidthRatio</span><br>        <span class="hljs-keyword">let</span> position_x <span class="hljs-operator">=</span>  (slideItemWidth <span class="hljs-operator">-</span> sliderWidth) <span class="hljs-operator">/</span> <span class="hljs-number">2.0</span><br>        <br>        <span class="hljs-keyword">let</span> newFrame <span class="hljs-operator">=</span> <span class="hljs-type">CGRect</span>(x: (offset.x <span class="hljs-operator">/</span> <span class="hljs-type">SCREEN_WIDTH</span>) <span class="hljs-operator">*</span> slideItemWidth <span class="hljs-operator">+</span> position_x,<br>                              y: (slider<span class="hljs-operator">?</span>.frame.origin.y)<span class="hljs-operator">!</span>,<br>                              width: (slider<span class="hljs-operator">?</span>.frame.width)<span class="hljs-operator">!</span>,<br>                              height: (slider<span class="hljs-operator">?</span>.frame.height)<span class="hljs-operator">!</span>)<br>        slider<span class="hljs-operator">?</span>.frame <span class="hljs-operator">=</span> newFrame<br>        <br>        <span class="hljs-keyword">for</span> (index) <span class="hljs-keyword">in</span> (buttonsArray<span class="hljs-operator">?</span>.enumerated())<span class="hljs-operator">!</span> &#123;<br>            index.element.setTitleColor(colorOfSlideItemsTitle, for: .normal)<br>        &#125;<br>        <br>        <span class="hljs-keyword">var</span> buttonTag <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br>        <span class="hljs-keyword">let</span> ratio <span class="hljs-operator">=</span> offset.x <span class="hljs-operator">/</span> <span class="hljs-type">SCREEN_WIDTH</span><br>        <span class="hljs-keyword">let</span> tempRation <span class="hljs-operator">=</span> <span class="hljs-type">Int</span>(ratio)<br>        <br>        <span class="hljs-keyword">let</span> decimal:<span class="hljs-type">CGFloat</span> <span class="hljs-operator">=</span> ratio <span class="hljs-operator">-</span> <span class="hljs-type">CGFloat</span>(tempRation)<br><br>        <span class="hljs-keyword">if</span> decimal <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0.5</span> &#123;<br>            buttonTag <span class="hljs-operator">=</span> <span class="hljs-type">Int</span>(ratio) <span class="hljs-operator">+</span> <span class="hljs-number">1</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            buttonTag <span class="hljs-operator">=</span> <span class="hljs-type">Int</span>(ratio)<br>        &#125;<br>        <br>        buttonsArray<span class="hljs-operator">!</span>[buttonTag].setTitleColor(colorOfHighlightedSlideItemsTitle, for: .normal)<br>    &#125;<br>    <br>    <span class="hljs-comment">/// æ ¹æ®frameåˆå§‹åŒ–æŒ‡ç¤ºå™¨</span><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sliderView</span>(<span class="hljs-params">frame</span>:<span class="hljs-type">CGRect</span>)</span> -&gt; <span class="hljs-type">UIView</span> &#123;<br>        slider <span class="hljs-operator">=</span> <span class="hljs-type">UIView</span>.<span class="hljs-keyword">init</span>(frame: frame)<br>        <span class="hljs-keyword">return</span> slider<span class="hljs-operator">!</span><br>    &#125;<br>   <br>    <span class="hljs-comment">/// ç‚¹å‡»äº‹ä»¶</span><br>    <span class="hljs-keyword">@objc</span> <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">buttonTouched</span>(<span class="hljs-params">button</span>:<span class="hljs-type">UIButton</span>)</span> &#123;<br>        delegate<span class="hljs-operator">?</span>.slideView(sliderView: <span class="hljs-keyword">self</span>, didSelectItemAtIndex: button.tag)<br>        animateSlider(tag: tag)<br>        contentScrollView.setContentOffset(<span class="hljs-type">CGPoint</span>(x: <span class="hljs-type">SCREEN_WIDTH</span> <span class="hljs-operator">*</span> <span class="hljs-type">CGFloat</span>(button.tag), y: <span class="hljs-number">0</span>), animated: <span class="hljs-literal">true</span>)<br>    &#125;<br></code></pre></td></tr></table></figure><h5 id="5ã€ä½¿ç”¨Extensionå®ç°UIScrollViewDidScrollDelegate"><a href="#5ã€ä½¿ç”¨Extensionå®ç°UIScrollViewDidScrollDelegate" class="headerlink" title="5ã€ä½¿ç”¨Extensionå®ç°UIScrollViewDidScrollDelegate"></a>5ã€ä½¿ç”¨Extensionå®ç°UIScrollViewDidScrollDelegate</h5><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">// MARK: ============ UIScrollViewDidScrollDelegate ============</span><br>extension SegmentSelectorManager:UIScrollViewDelegate &#123;<br>    func scroll<span class="hljs-constructor">ViewDidScroll(<span class="hljs-params">_</span> <span class="hljs-params">scrollView</span>: UIScrollView)</span> &#123;<br>        animate<span class="hljs-constructor">SliderToPosition(<span class="hljs-params">offset</span>: <span class="hljs-params">scrollView</span>.<span class="hljs-params">contentOffset</span>)</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="6ã€ä½¿ç”¨æ–¹æ³•-å®ä¾‹ä»£ç "><a href="#6ã€ä½¿ç”¨æ–¹æ³•-å®ä¾‹ä»£ç " class="headerlink" title="6ã€ä½¿ç”¨æ–¹æ³•(å®ä¾‹ä»£ç )"></a>6ã€ä½¿ç”¨æ–¹æ³•(å®ä¾‹ä»£ç )</h5><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs roboconf">override func setupSubViewsProperties() &#123;<br>        <span class="hljs-attribute">segmentView = SegmentSelectorManager.init(frame</span>: CGRect<span class="hljs-variable">.zero</span>)<br>        segmentView?<span class="hljs-variable">.delegate</span> = self<br>        segmentView?<span class="hljs-variable">.dataSource</span> = self<br>        view<span class="hljs-variable">.addSubview</span>(segmentView!)<br>    &#125;<br>    <br>    override func setupSubViewsConstrains() &#123;<br>        if let seg = segmentView &#123;<br>            seg<span class="hljs-variable">.translatesAutoresizingMaskIntoConstraints</span> = false<br>            seg<span class="hljs-variable">.leadingAnchor</span><span class="hljs-variable">.constraint</span>(equalTo: view<span class="hljs-variable">.leadingAnchor</span>)<span class="hljs-variable">.isActive</span> = true<br>            seg<span class="hljs-variable">.trailingAnchor</span><span class="hljs-variable">.constraint</span>(equalTo: view<span class="hljs-variable">.trailingAnchor</span>)<span class="hljs-variable">.isActive</span> = true<br>            seg<span class="hljs-variable">.bottomAnchor</span><span class="hljs-variable">.constraint</span>(equalTo: view<span class="hljs-variable">.bottomAnchor</span>, constant: -kTabBarHeight)<span class="hljs-variable">.isActive</span> = true<br>            seg<span class="hljs-variable">.topAnchor</span><span class="hljs-variable">.constraint</span>(equalTo: wd_navgationBar_normal<span class="hljs-variable">.bottomAnchor</span>)<span class="hljs-variable">.isActive</span> = true<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><hr><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">HotPlayController</span>: <span class="hljs-title">SegmentSelectorManagerDataSource</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">nameOfSliderItems</span>(<span class="hljs-params">segemntControl</span>: <span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">Array</span>&lt;<span class="hljs-type">String</span>&gt; &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-string">&quot;æ­£åœ¨çƒ­æ˜ &quot;</span>, <span class="hljs-string">&quot;å³å°†ä¸Šæ˜ &quot;</span>]<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">childViewControllers</span>(<span class="hljs-params">segemntControl</span>: <span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">Array</span>&lt;<span class="hljs-type">UIViewController</span>&gt; &#123;<br>        <span class="hljs-keyword">return</span> [<span class="hljs-type">HotPlayingController</span>(), <span class="hljs-type">HotWillPlayViewController</span>()]<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">heightOfTopView</span>(<span class="hljs-params">segemntControl</span>: <span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">CGFloat</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">45</span><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">heightOfSlider</span>(<span class="hljs-params">segemntControl</span>: <span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">CGFloat</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">3</span><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">colorOfSlider</span>(<span class="hljs-params">segemntControl</span> <span class="hljs-params">slider</span>: <span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">UIColor</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-type">UIColor</span>.wd_init(r: <span class="hljs-number">73</span>, g: <span class="hljs-number">73</span>, b: <span class="hljs-number">73</span>)<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">colorOfTopView</span>(<span class="hljs-params">segemntControl</span>: <span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">UIColor</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-type">UIColor</span>.white<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">colorOfSliderItemsTitle</span>(<span class="hljs-params">segemntControl</span>: <span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">UIColor</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-type">UIColor</span>.gray<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">colorOfHighlightedSliderItemsTitle</span>(<span class="hljs-params">segemntControl</span>: <span class="hljs-type">SegmentSelectorManager</span>)</span> -&gt; <span class="hljs-type">UIColor</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-type">UIColor</span>.wd_init(r: <span class="hljs-number">73</span>, g: <span class="hljs-number">73</span>, b: <span class="hljs-number">73</span>)<br>    &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">HotPlayController</span>: <span class="hljs-title">SegmentSelectorManagerDelegate</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">slideView</span>(<span class="hljs-params">sliderView</span>: <span class="hljs-type">SegmentSelectorManager</span>, <span class="hljs-params">didSelectItemAtIndex</span>: <span class="hljs-type">Int</span>)</span> &#123;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="7ã€æ•ˆæœå›¾"><a href="#7ã€æ•ˆæœå›¾" class="headerlink" title="7ã€æ•ˆæœå›¾"></a>7ã€æ•ˆæœå›¾</h5><p><img src="https://upload-images.jianshu.io/upload_images/3334769-115a441c7def0de0.gif?imageMogr2/auto-orient/strip" alt="æ•ˆæœå›¾.gif"></p>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>Swift</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSè‡ªå®šä¹‰æ§ä»¶-ä»¿QQä¾§è¾¹èœå•</title>
    <link href="/2019/05/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%BB%BFQQ%E4%BE%A7%E8%BE%B9%E8%8F%9C%E5%8D%95/"/>
    <url>/2019/05/01/iOS%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%A7%E4%BB%B6-%E4%BB%BFQQ%E4%BE%A7%E8%BE%B9%E8%8F%9C%E5%8D%95/</url>
    
    <content type="html"><![CDATA[<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span><br><br><span class="hljs-built_in">NS_ASSUME_NONNULL_BEGIN</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">LZSliderContainerViewController</span> : <span class="hljs-title">UIViewController</span></span><br><span class="hljs-comment">// æ˜¯å¦å…è®¸ä¾§æ»‘æ‰‹åŠ¿</span><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">BOOL</span> allowOpenSliderView;<br><br><span class="hljs-comment">// å•ä¾‹</span><br>+ (<span class="hljs-keyword">instancetype</span>)mamager;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> åˆå§‹åŒ–æ–¹æ³•</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> @param mainController ä¸»é¡µé¢æ§åˆ¶å™¨</span><br><span class="hljs-comment"> @param sliderController èœå•é¡µé¢æ§åˆ¶å™¨</span><br><span class="hljs-comment"> @param space ç©ºéš™</span><br><span class="hljs-comment"> @return UIViewController</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-built_in">UIViewController</span> *)lz_setupMainController:(<span class="hljs-built_in">UIViewController</span> *)mainController sliderController:(<span class="hljs-built_in">UIViewController</span> *)sliderController space:(<span class="hljs-built_in">CGFloat</span>)space;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> æ‰“å¼€ä¾§è¾¹èœå•</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)lz_openSlderView;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> å…³é—­ä¾§è¾¹èœå•</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)lz_closeSliderView;<br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;LZSliderContainerViewController.h&quot;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">UIView</span> (<span class="hljs-title">Frame</span>)</span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>) <span class="hljs-built_in">CGFloat</span> left;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>) <span class="hljs-built_in">CGFloat</span> right;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">UIView</span> (<span class="hljs-title">Frame</span>)</span><br><br>- (<span class="hljs-built_in">CGFloat</span>)left &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.frame.origin.x;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)setLeft:(<span class="hljs-built_in">CGFloat</span>)x &#123;<br>    <span class="hljs-built_in">CGRect</span> frame = <span class="hljs-keyword">self</span>.frame;<br>    frame.origin.x = x;<br>    <span class="hljs-keyword">self</span>.frame = frame;<br>&#125;<br><br>- (<span class="hljs-built_in">CGFloat</span>)right &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>.frame.origin.x + <span class="hljs-keyword">self</span>.frame.size.width;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)setRight:(<span class="hljs-built_in">CGFloat</span>)right &#123;<br>    <span class="hljs-built_in">CGRect</span> frame = <span class="hljs-keyword">self</span>.frame;<br>    frame.origin.x = right - frame.size.width;<br>    <span class="hljs-keyword">self</span>.frame = frame;<br>&#125;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">LZSliderContainerViewController</span> ()</span><br><br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIViewController</span> *mainController;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIViewController</span> *sliderController;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> spece;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">assign</span>) <span class="hljs-built_in">CGFloat</span> panStartX;<br><span class="hljs-keyword">@property</span> (<span class="hljs-keyword">nonatomic</span>, <span class="hljs-keyword">strong</span>) <span class="hljs-built_in">UIView</span> *coverView;<br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">LZSliderContainerViewController</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - å•ä¾‹æ–¹æ³•</span><br>+ (<span class="hljs-keyword">instancetype</span>)mamager &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-built_in">dispatch_once_t</span> onceToken;<br>    <span class="hljs-keyword">static</span> LZSliderContainerViewController *vc;<br>    <span class="hljs-built_in">dispatch_once</span>(&amp;onceToken, ^&#123;<br>        vc = [[LZSliderContainerViewController alloc] init];<br>    &#125;);<br>    <span class="hljs-keyword">return</span> vc;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - åˆå§‹åŒ–æ–¹æ³•</span><br>- (<span class="hljs-built_in">UIViewController</span> *)lz_setupMainController:(<span class="hljs-built_in">UIViewController</span> *)mainController sliderController:(<span class="hljs-built_in">UIViewController</span> *)sliderController space:(<span class="hljs-built_in">CGFloat</span>)space &#123;<br>    [<span class="hljs-keyword">self</span> lz_addChildControllerWithMainController:mainController sliderController:sliderController];<br>    [<span class="hljs-keyword">self</span> lz_setupCoverView];<br>    _spece = space;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - é…ç½®é®ç½©å±‚</span><br>- (<span class="hljs-keyword">void</span>)lz_setupCoverView &#123;<br>    <span class="hljs-keyword">self</span>.coverView = [[<span class="hljs-built_in">UIView</span> alloc] init];<br>    <span class="hljs-keyword">self</span>.coverView.frame = <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds;<br>    <span class="hljs-keyword">self</span>.coverView.backgroundColor = [[<span class="hljs-built_in">UIColor</span> blackColor] colorWithAlphaComponent:<span class="hljs-number">0</span>];<br>    <span class="hljs-keyword">self</span>.coverView.hidden = <span class="hljs-literal">true</span>;<br>    [<span class="hljs-keyword">self</span>.coverView addGestureRecognizer:[[<span class="hljs-built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(lz_closeSliderView)]];<br>    [<span class="hljs-keyword">self</span>.view addSubview:<span class="hljs-keyword">self</span>.coverView];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æ·»åŠ VC</span><br>- (<span class="hljs-keyword">void</span>)lz_addChildControllerWithMainController:(<span class="hljs-built_in">UIViewController</span> *)mainController sliderController:(<span class="hljs-built_in">UIViewController</span> *)sliderController &#123;<br>    [<span class="hljs-keyword">self</span> addChildViewController:mainController];<br>    [mainController didMoveToParentViewController:<span class="hljs-keyword">self</span>];<br>    mainController.view.frame = <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds;<br>    [<span class="hljs-keyword">self</span>.view addSubview:mainController.view];<br>    <br>    [<span class="hljs-keyword">self</span> addChildViewController:sliderController];<br>    [sliderController didMoveToParentViewController:<span class="hljs-keyword">self</span>];<br>    sliderController.view.frame = <span class="hljs-built_in">CGRectMake</span>(-<span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, <span class="hljs-number">0</span>, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width, <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.height);<br>    [<span class="hljs-keyword">self</span>.view addSubview:sliderController.view];<br>    <br>    <span class="hljs-keyword">self</span>.mainController = mainController;<br>    <span class="hljs-keyword">self</span>.sliderController = sliderController;<br>    <br>    [<span class="hljs-keyword">self</span> lz_setupGusture];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æ·»åŠ å¹³ç§»æ‰‹åŠ¿</span><br>- (<span class="hljs-keyword">void</span>)lz_setupGusture &#123;<br>    <span class="hljs-built_in">UIPanGestureRecognizer</span> *panGusture = [[<span class="hljs-built_in">UIPanGestureRecognizer</span> alloc] initWithTarget:<span class="hljs-keyword">self</span> action:<span class="hljs-keyword">@selector</span>(lz_panGestureRecognizer:)];<br>    [<span class="hljs-keyword">self</span>.view addGestureRecognizer:panGusture];<br>&#125;<br><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - UIPanGestureRecognizer Action</span><br>- (<span class="hljs-keyword">void</span>)lz_panGestureRecognizer:(<span class="hljs-built_in">UIPanGestureRecognizer</span> *)sender &#123;<br>    <span class="hljs-built_in">UIView</span> *rootView = <span class="hljs-keyword">self</span>.mainController.view;<br>    <span class="hljs-built_in">UIView</span> *menuView = <span class="hljs-keyword">self</span>.sliderController.view;<br>    <br>    <span class="hljs-keyword">if</span> (sender.state == <span class="hljs-built_in">UIGestureRecognizerStateBegan</span>) &#123;<br>        <span class="hljs-built_in">CGFloat</span> startPointX = [sender translationInView:<span class="hljs-keyword">self</span>.view].x;<br>        <span class="hljs-keyword">self</span>.panStartX = startPointX;<br>        <span class="hljs-keyword">self</span>.coverView.hidden = <span class="hljs-literal">false</span>;<br>    &#125;<br>    <br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.panStartX &gt;= <span class="hljs-number">40</span> &amp;&amp; rootView.frame.origin.x == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-built_in">CGFloat</span> translationX = [sender translationInView:rootView].x;<br>    <span class="hljs-built_in">CGFloat</span> rootViewX = rootView.frame.origin.x;<br>    <br>    rootViewX = [<span class="hljs-keyword">self</span> lz_minmumWithValueA:(rootViewX + translationX) valueB:(<span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width - <span class="hljs-keyword">self</span>.spece)];<br>    rootViewX = [<span class="hljs-keyword">self</span> lz_maxmumWithValueA:rootViewX valueB:<span class="hljs-number">0</span>];<br>    <br>    rootView.left = rootViewX;<br>    menuView.right = rootView.left;<br>    <span class="hljs-keyword">self</span>.coverView.frame = rootView.frame;<br>    <br>    <span class="hljs-built_in">CGFloat</span> aphal = <span class="hljs-number">0.5</span> * rootView.frame.origin.x / (<span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width - <span class="hljs-keyword">self</span>.spece);<br>    <span class="hljs-keyword">self</span>.coverView.backgroundColor = [[<span class="hljs-built_in">UIColor</span> blackColor] colorWithAlphaComponent:aphal];<br>    <br>    [sender setTranslation:<span class="hljs-built_in">CGPointZero</span> inView:rootView];<br>    <br>    <span class="hljs-keyword">if</span> (sender.state == <span class="hljs-built_in">UIGestureRecognizerStateEnded</span> || sender.state == <span class="hljs-built_in">UIGestureRecognizerStateCancelled</span>) &#123;<br>        <span class="hljs-keyword">if</span> (rootViewX &gt;= (<span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width - <span class="hljs-keyword">self</span>.spece)/<span class="hljs-number">2</span>) &#123;<br>            [<span class="hljs-keyword">self</span> lz_openSlderView];<br>        &#125; <span class="hljs-keyword">else</span>&#123;<br>            [<span class="hljs-keyword">self</span> lz_closeSliderView];<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æ‰“å¼€ä¾§è¾¹èœå•</span><br>- (<span class="hljs-keyword">void</span>)lz_openSlderView &#123;<br>    [<span class="hljs-keyword">self</span> lz_setupGusture];<br>    <br>    <span class="hljs-built_in">UIView</span> *rootView = <span class="hljs-keyword">self</span>.mainController.view;<br>    <span class="hljs-built_in">UIView</span> *menuView = <span class="hljs-keyword">self</span>.sliderController.view;<br>    <br>    <span class="hljs-keyword">self</span>.coverView.hidden = <span class="hljs-literal">false</span>;<br>    <br>    [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.4</span> animations:^&#123;<br>        rootView.left = <span class="hljs-built_in">UIScreen</span>.mainScreen.bounds.size.width - <span class="hljs-keyword">self</span>.spece;<br>        menuView.right = rootView.left;<br>        <span class="hljs-keyword">self</span>.coverView.frame = rootView.frame;<br>        <span class="hljs-keyword">self</span>.coverView.backgroundColor = [[<span class="hljs-built_in">UIColor</span> blackColor] colorWithAlphaComponent:<span class="hljs-number">0.5</span>];<br>    &#125;];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - å…³é—­ä¾§è¾¹èœå•</span><br>- (<span class="hljs-keyword">void</span>)lz_closeSliderView &#123;<br>    <span class="hljs-built_in">UIView</span> *rootView = <span class="hljs-keyword">self</span>.mainController.view;<br>    <span class="hljs-built_in">UIView</span> *menuView = <span class="hljs-keyword">self</span>.sliderController.view;<br>    <br>    [<span class="hljs-built_in">UIView</span> animateWithDuration:<span class="hljs-number">0.4</span> animations:^&#123;<br>        <span class="hljs-keyword">self</span>.coverView.backgroundColor = [[<span class="hljs-built_in">UIColor</span> blackColor] colorWithAlphaComponent:<span class="hljs-number">0</span>];<br>        rootView.left = <span class="hljs-number">0</span>;<br>        menuView.right = rootView.left;<br>        <span class="hljs-keyword">self</span>.coverView.frame = rootView.frame;<br>    &#125; completion:^(<span class="hljs-built_in">BOOL</span> finished) &#123;<br>        <span class="hljs-keyword">if</span> (finished) &#123;<br>            <span class="hljs-keyword">self</span>.coverView.hidden = <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;];<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æ¯”è¾ƒå¤§å°å–æœ€å°å€¼</span><br>- (<span class="hljs-built_in">CGFloat</span>)lz_minmumWithValueA:(<span class="hljs-built_in">CGFloat</span>)a valueB:(<span class="hljs-built_in">CGFloat</span>)b &#123;<br>    <span class="hljs-keyword">return</span> a &gt; b ? b : a;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - æ¯”è¾ƒå¤§å°å–æœ€å¤§å€¼</span><br>- (<span class="hljs-built_in">CGFloat</span>)lz_maxmumWithValueA:(<span class="hljs-built_in">CGFloat</span>)a valueB:(<span class="hljs-built_in">CGFloat</span>)b &#123;<br>    <span class="hljs-keyword">return</span> a &gt; b ? a : b;<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> mark - Setter</span><br>- (<span class="hljs-keyword">void</span>)setAllowOpenSliderView:(<span class="hljs-built_in">BOOL</span>)allowOpenSliderView &#123;<br>    _allowOpenSliderView = allowOpenSliderView;<br>    <span class="hljs-keyword">if</span> (allowOpenSliderView) &#123;<br>        [<span class="hljs-keyword">self</span> lz_setupGusture];<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">UIGestureRecognizer</span> *pan <span class="hljs-keyword">in</span> <span class="hljs-keyword">self</span>.view.gestureRecognizers) &#123;<br>            [<span class="hljs-keyword">self</span>.view removeGestureRecognizer:pan];<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-keyword">@end</span><br><br></code></pre></td></tr></table></figure><p>AppDelegateä¸­è®¾ç½®ä¸ºæ ¹æ§åˆ¶å™¨</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">self.window.rootViewController</span> = [[LZSliderContainerViewController mamager] lz_setupMainController:tab sliderController:sldier space:<span class="hljs-number">200</span>]<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>// å•ç‹¬æ‰“å¼€æˆ–å…³é—­</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-comment">// æ‰“å¼€é¡µé¢</span><br><span class="hljs-string">[[LZSliderContainerViewController mamager]</span> lz_openSlderView];<br><span class="hljs-comment">// å…³é—­é¡µé¢</span><br><span class="hljs-string">[[LZSliderContainerViewController mamager]</span> lz_closeSliderView];<br></code></pre></td></tr></table></figure><p>é»˜è®¤æ‰€æœ‰é¡µé¢éƒ½æ˜¯æ‰“å¼€çš„ï¼Œå¦‚æœéœ€è¦å…³é—­</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">- (<span class="hljs-keyword">void</span>)viewWillAppear:(<span class="hljs-built_in">BOOL</span>)animated&#123;<br>    [<span class="hljs-keyword">super</span> viewWillAppear:animated];<br>    [LZSliderContainerViewController mamager].allowOpenSliderView = <span class="hljs-literal">NO</span>;<br>&#125;<br><br>- (<span class="hljs-keyword">void</span>)viewDidDisappear:(<span class="hljs-built_in">BOOL</span>)animated &#123;<br>    [<span class="hljs-keyword">super</span> viewDidDisappear:animated];<br>    [LZSliderContainerViewController mamager].allowOpenSliderView = <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ•ˆæœå›¾<br><br><img src="http://i2.bvimg.com/667578/85fad1a82178134d.gif" alt="image"></p>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>Objective-C</category>
      
      <category>è‡ªå®šä¹‰æ§ä»¶</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è‡ªå®šä¹‰æ§ä»¶</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSå¤šçº¿ç¨‹-9ç§é”</title>
    <link href="/2019/04/01/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-9%E7%A7%8D%E9%94%81.md/"/>
    <url>/2019/04/01/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-9%E7%A7%8D%E9%94%81.md/</url>
    
    <content type="html"><![CDATA[<h2 id="1ã€dispatch-semaphore-è‡ªæ—‹é”"><a href="#1ã€dispatch-semaphore-è‡ªæ—‹é”" class="headerlink" title="1ã€dispatch_semaphore è‡ªæ—‹é”"></a>1ã€dispatch_semaphore è‡ªæ—‹é”</h2><h2 id="2ã€-synchronized-äº’æ–¥é”"><a href="#2ã€-synchronized-äº’æ–¥é”" class="headerlink" title="2ã€@synchronized äº’æ–¥é”"></a>2ã€@synchronized äº’æ–¥é”</h2><h2 id="3ã€NSLock-çº¿ç¨‹é”"><a href="#3ã€NSLock-çº¿ç¨‹é”" class="headerlink" title="3ã€NSLock çº¿ç¨‹é”"></a>3ã€NSLock çº¿ç¨‹é”</h2><h2 id="4ã€NSRecursiveLock-é€’å½’é”"><a href="#4ã€NSRecursiveLock-é€’å½’é”" class="headerlink" title="4ã€NSRecursiveLock é€’å½’é”"></a>4ã€NSRecursiveLock é€’å½’é”</h2><h2 id="5ã€NSConditionLock-æ¡ä»¶é”"><a href="#5ã€NSConditionLock-æ¡ä»¶é”" class="headerlink" title="5ã€NSConditionLock æ¡ä»¶é”"></a>5ã€NSConditionLock æ¡ä»¶é”</h2><h2 id="6ã€NSCondition-æ–­è¨€"><a href="#6ã€NSCondition-æ–­è¨€" class="headerlink" title="6ã€NSCondition æ–­è¨€"></a>6ã€NSCondition æ–­è¨€</h2><h2 id="7ã€OSSpinLock-è‡ªæ—‹é”"><a href="#7ã€OSSpinLock-è‡ªæ—‹é”" class="headerlink" title="7ã€OSSpinLock è‡ªæ—‹é”"></a>7ã€OSSpinLock è‡ªæ—‹é”</h2><h2 id="8ã€pthread-mutex-äº’æ–¥é”"><a href="#8ã€pthread-mutex-äº’æ–¥é”" class="headerlink" title="8ã€pthread_mutex äº’æ–¥é”"></a>8ã€pthread_mutex äº’æ–¥é”</h2><h2 id="9ã€pthread-mutex-recursive-äº’æ–¥é”"><a href="#9ã€pthread-mutex-recursive-äº’æ–¥é”" class="headerlink" title="9ã€pthread_mutex(recursive) äº’æ–¥é”"></a>9ã€pthread_mutex(recursive) äº’æ–¥é”</h2>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>å¤šçº¿ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSå¤šçº¿ç¨‹-GCD</title>
    <link href="/2019/03/01/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-GCD/"/>
    <url>/2019/03/01/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-GCD/</url>
    
    <content type="html"><![CDATA[<h1 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h1><h2 id="ä»»åŠ¡"><a href="#ä»»åŠ¡" class="headerlink" title="ä»»åŠ¡"></a>ä»»åŠ¡</h2><p>å°±æ˜¯æ‰§è¡Œæ“ä½œçš„æ„æ€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä½ åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„é‚£æ®µä»£ç ã€‚åœ¨ GCD ä¸­æ˜¯æ”¾åœ¨ block ä¸­çš„ã€‚æ‰§è¡Œä»»åŠ¡æœ‰ä¸¤ç§æ–¹å¼ï¼šåŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰å’Œå¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰ã€‚<br>ä¸¤è€…çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼šæ˜¯å¦ç­‰å¾…é˜Ÿåˆ—çš„ä»»åŠ¡æ‰§è¡Œç»“æŸï¼Œä»¥åŠæ˜¯å¦å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚</p><h3 id="åŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰"><a href="#åŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰" class="headerlink" title="åŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰"></a>åŒæ­¥æ‰§è¡Œï¼ˆsyncï¼‰</h3><p>åŒæ­¥æ·»åŠ ä»»åŠ¡åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ï¼Œåœ¨æ·»åŠ çš„ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹å‰ï¼Œä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°é˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡å®Œæˆä¹‹åå†ç»§ç»­æ‰§è¡Œã€‚<br><br>åªèƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä¸å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚</p><h3 id="å¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰"><a href="#å¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰" class="headerlink" title="å¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰"></a>å¼‚æ­¥æ‰§è¡Œï¼ˆasyncï¼‰</h3><p>å¼‚æ­¥æ·»åŠ ä»»åŠ¡åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ï¼Œå®ƒä¸ä¼šåšä»»ä½•ç­‰å¾…ï¼Œå¯ä»¥ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚<br><br>å¯ä»¥åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œå…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚</p><h2 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h2><p>æ‰§è¡Œä»»åŠ¡çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œå³ç”¨æ¥å­˜æ”¾ä»»åŠ¡çš„é˜Ÿåˆ—ã€‚é˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿æ€§è¡¨ï¼Œé‡‡ç”¨ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ï¼Œå³æ–°ä»»åŠ¡æ€»æ˜¯è¢«æ’å…¥åˆ°é˜Ÿåˆ—çš„æœ«å°¾ï¼Œè€Œè¯»å–ä»»åŠ¡çš„æ—¶å€™æ€»æ˜¯ä»é˜Ÿåˆ—çš„å¤´éƒ¨å¼€å§‹è¯»å–ã€‚æ¯è¯»å–ä¸€ä¸ªä»»åŠ¡ï¼Œåˆ™ä»é˜Ÿåˆ—ä¸­é‡Šæ”¾ä¸€ä¸ªä»»åŠ¡ã€‚<br><br><br>åœ¨ GCD ä¸­æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼šä¸²è¡Œé˜Ÿåˆ—å’Œå¹¶å‘é˜Ÿåˆ—ã€‚ä¸¤è€…éƒ½ç¬¦åˆ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ã€‚ä¸¤è€…çš„ä¸»è¦åŒºåˆ«æ˜¯ï¼šæ‰§è¡Œé¡ºåºä¸åŒï¼Œä»¥åŠå¼€å¯çº¿ç¨‹æ•°ä¸åŒã€‚</p><h3 id="ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial-Dispatch-Queueï¼‰"><a href="#ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial-Dispatch-Queueï¼‰" class="headerlink" title="ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial Dispatch Queueï¼‰"></a>ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerial Dispatch Queueï¼‰</h3><p>æ¯æ¬¡åªæœ‰ä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œã€‚è®©ä»»åŠ¡ä¸€ä¸ªæ¥ç€ä¸€ä¸ªåœ°æ‰§è¡Œã€‚ï¼ˆåªå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼‰</p><h3 id="å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent-Dispatch-Queueï¼‰"><a href="#å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent-Dispatch-Queueï¼‰" class="headerlink" title="å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent Dispatch Queueï¼‰"></a>å¹¶å‘é˜Ÿåˆ—ï¼ˆConcurrent Dispatch Queueï¼‰</h3><p>å¯ä»¥è®©å¤šä¸ªä»»åŠ¡å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œã€‚ï¼ˆå¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼‰</p><blockquote><p>æ³¨æ„ï¼šå¹¶å‘é˜Ÿåˆ— çš„å¹¶å‘åŠŸèƒ½åªæœ‰åœ¨å¼‚æ­¥ï¼ˆdispatch_asyncï¼‰å‡½æ•°ä¸‹æ‰æœ‰æ•ˆ</p></blockquote><h2 id="dispatch-queue-t"><a href="#dispatch-queue-t" class="headerlink" title="dispatch_queue_t"></a>dispatch_queue_t</h2><table><thead><tr><th>ä»»åŠ¡</th><th>é˜Ÿåˆ—</th></tr></thead><tbody><tr><td>åŒæ­¥</td><td>ä¸²è¡Œ</td></tr><tr><td>å¼‚æ­¥</td><td>å¹¶å‘</td></tr></tbody></table><h4 id="ç»„åˆç»“æœ"><a href="#ç»„åˆç»“æœ" class="headerlink" title="ç»„åˆç»“æœ"></a>ç»„åˆç»“æœ</h4><table><thead><tr><th>ç»„åˆ</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>åŒæ­¥æ‰§è¡Œ + å¹¶å‘é˜Ÿåˆ—</td><td>åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œä¸ä¼šå¼€å¯æ–°çº¿ç¨‹ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</td></tr><tr><td>å¼‚æ­¥æ‰§è¡Œ + å¹¶å‘é˜Ÿåˆ—</td><td>å¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œä»»åŠ¡äº¤æ›¿ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œ</td></tr><tr><td>åŒæ­¥æ‰§è¡Œ + ä¸²è¡Œé˜Ÿåˆ—</td><td>ä¸ä¼šå¼€å¯æ–°çº¿ç¨‹ï¼Œåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚ä»»åŠ¡æ˜¯ä¸²è¡Œçš„ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</td></tr><tr><td>å¼‚æ­¥æ‰§è¡Œ + ä¸²è¡Œé˜Ÿåˆ—</td><td>ä¼šå¼€å¯æ–°çº¿ç¨‹ï¼Œä½†æ˜¯å› ä¸ºä»»åŠ¡æ˜¯ä¸²è¡Œçš„ï¼Œæ‰§è¡Œå®Œä¸€ä¸ªä»»åŠ¡ï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</td></tr><tr><td>åŒæ­¥æ‰§è¡Œ + ä¸»é˜Ÿåˆ—</td><td>åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ä¼šå‡ºç°æ­»é”ï¼Œè€Œåœ¨å…¶ä»–çº¿ç¨‹ä¸­åˆ™ä¸ä¼š</td></tr><tr><td>å¼‚æ­¥æ‰§è¡Œ + ä¸»é˜Ÿåˆ—</td><td>äº’ç›¸ç­‰å¾…å¡ä½ä¸å¯è¡Œ</td></tr></tbody></table><h3 id="åˆ›å»º"><a href="#åˆ›å»º" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h3><h4 id="ä¸²è¡Œé˜Ÿåˆ—"><a href="#ä¸²è¡Œé˜Ÿåˆ—" class="headerlink" title="ä¸²è¡Œé˜Ÿåˆ—"></a>ä¸²è¡Œé˜Ÿåˆ—</h4><p>å¸¸ç”¨å®å®šä¹‰</p><table><thead><tr><th>åç§°</th><th>å€¼</th></tr></thead><tbody><tr><td>DISPATCH_QUEUE_SERIAL</td><td>NULL</td></tr><tr><td>DISPATCH_QUEUE_SERIAL_INACTIVE</td><td>dispatch_queue_attr_make_initially_inactive(DISPATCH_QUEUE_SERIAL)</td></tr><tr><td>DISPATCH_QUEUE_SERIAL_WITH_AUTORELEASE_POOL</td><td>dispatch_queue_attr_make_with_autorelease_frequency(DISPATCH_QUEUE_SERIAL, DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM)</td></tr><tr><td></td><td></td></tr></tbody></table><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">dispatch_queue_create</span>(<span class="hljs-string">&quot;æ ‡è¯†&quot;</span>, DISPATCH_QUEUE_SERIAL);<br></code></pre></td></tr></table></figure><h4 id="å¹¶å‘é˜Ÿåˆ—"><a href="#å¹¶å‘é˜Ÿåˆ—" class="headerlink" title="å¹¶å‘é˜Ÿåˆ—"></a>å¹¶å‘é˜Ÿåˆ—</h4><p>å¸¸ç”¨å®å®šä¹‰</p><table><thead><tr><th>åç§°</th><th>å€¼</th></tr></thead><tbody><tr><td>DISPATCH_QUEUE_CONCURRENT</td><td>NULL</td></tr><tr><td>DISPATCH_QUEUE_CONCURRENT_INACTIVE</td><td>dispatch_queue_attr_make_initially_inactive(DISPATCH_QUEUE_CONCURRENT)</td></tr><tr><td>DISPATCH_QUEUE_CONCURRENT_WITH_AUTORELEASE_POOL</td><td>dispatch_queue_attr_make_with_autorelease_frequency(DISPATCH_QUEUE_SERIAL,DISPATCH_AUTORELEASE_FREQUENCY_WORK_ITEM)</td></tr></tbody></table><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">dispatch_queue_t</span> queue = <span class="hljs-built_in">dispatch_queue_create</span>(<span class="hljs-string">&quot;æ ‡è¯†&quot;</span>, DISPATCH_QUEUE_CONCURRENT);<br><br></code></pre></td></tr></table></figure><h4 id="è·å–ä¸»çº¿ç¨‹"><a href="#è·å–ä¸»çº¿ç¨‹" class="headerlink" title="è·å–ä¸»çº¿ç¨‹"></a>è·å–ä¸»çº¿ç¨‹</h4><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf">dispatch_get_main_queue()<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h4 id="è·å–ç³»ç»Ÿé»˜è®¤çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—"><a href="#è·å–ç³»ç»Ÿé»˜è®¤çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—" class="headerlink" title="è·å–ç³»ç»Ÿé»˜è®¤çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—"></a>è·å–ç³»ç»Ÿé»˜è®¤çš„å…¨å±€å¹¶å‘é˜Ÿåˆ—</h4><h4 id="iOS-8-0"><a href="#iOS-8-0" class="headerlink" title="iOS 8.0"></a>iOS 8.0</h4><table><thead><tr><th>åç§°</th><th>æ„ä¹‰</th></tr></thead><tbody><tr><td>QOS_CLASS_USER_INTERACTIVE</td><td>ç”¨æˆ·äº¤äº’(å¸Œæœ›å°½å¿«å®Œæˆï¼Œç”¨æˆ·å¯¹ç»“æœå¾ˆæœŸæœ›ï¼Œä¸è¦æ”¾å¤ªè€—æ—¶æ“ä½œ)</td></tr><tr><td>QOS_CLASS_USER_INITIATED</td><td>ç”¨æˆ·æœŸæœ›(ä¸è¦æ”¾å¤ªè€—æ—¶æ“ä½œ)</td></tr><tr><td>QOS_CLASS_DEFAULT</td><td>é»˜è®¤(ä¸æ˜¯ç»™ç¨‹åºå‘˜ä½¿ç”¨çš„ï¼Œç”¨æ¥é‡ç½®å¯¹åˆ—ä½¿ç”¨çš„)</td></tr><tr><td>QOS_CLASS_UTILITY</td><td>å®ç”¨å·¥å…·(è€—æ—¶æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹)</td></tr><tr><td>QOS_CLASS_BACKGROUND</td><td>åå°</td></tr><tr><td>QOS_CLASS_UNSPECIFIED</td><td>æœªæŒ‡å®š</td></tr></tbody></table><h4 id="iOS-8-0ä¹‹å‰"><a href="#iOS-8-0ä¹‹å‰" class="headerlink" title="iOS 8.0ä¹‹å‰"></a>iOS 8.0ä¹‹å‰</h4><table><thead><tr><th>åç§°</th><th>æ„ä¹‰</th></tr></thead><tbody><tr><td>DISPATCH_QUEUE_PRIORITY_HIGH</td><td>é«˜ä¼˜å…ˆçº§</td></tr><tr><td>DISPATCH_QUEUE_PRIORITY_DEFAULT</td><td>é»˜è®¤ä¼˜å…ˆçº§</td></tr><tr><td>DISPATCH_QUEUE_PRIORITY_LOW</td><td>ä½ä¼˜å…ˆçº§</td></tr><tr><td>DISPATCH_QUEUE_PRIORITY_BACKGROUND</td><td>åå°ä¼˜å…ˆçº§</td></tr></tbody></table><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">dispatch_get_global_queue</span>(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><h4 id="å¼‚æ­¥æ‰§è¡Œ"><a href="#å¼‚æ­¥æ‰§è¡Œ" class="headerlink" title="å¼‚æ­¥æ‰§è¡Œ"></a>å¼‚æ­¥æ‰§è¡Œ</h4><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">int</span> context = <span class="hljs-number">10</span>;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  é˜Ÿåˆ—å¼‚æ­¥æ‰§è¡Œ</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">  <span class="hljs-doctag">@param</span> queue é˜Ÿåˆ—</span><br><span class="hljs-comment">  <span class="hljs-doctag">@param</span> context è¦ä¼ é€’ç»™å‡½æ•°çš„åº”ç”¨ç¨‹åºå®šä¹‰çš„ä¸Šä¸‹æ–‡å‚æ•°ã€‚</span><br><span class="hljs-comment">  <span class="hljs-doctag">@param</span> asyncMethod cæ“ä½œæ–¹æ³•</span><br><span class="hljs-comment">  <span class="hljs-doctag">@return</span> dispatch_queue_t</span><br><span class="hljs-comment">*/</span><br>dispatch_async_f(queue, &amp;context, asyncMethod);<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">asyncMethod</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;<br><br>dispatch_sync(queue, ^&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="åŒæ­¥æ‰§è¡Œ"><a href="#åŒæ­¥æ‰§è¡Œ" class="headerlink" title="åŒæ­¥æ‰§è¡Œ"></a>åŒæ­¥æ‰§è¡Œ</h4><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">int</span> context = <span class="hljs-number">10</span>;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment">  é˜Ÿåˆ—åŒæ­¥æ‰§è¡Œ</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">  <span class="hljs-doctag">@param</span> queue é˜Ÿåˆ—</span><br><span class="hljs-comment">  <span class="hljs-doctag">@param</span> context è¦ä¼ é€’ç»™å‡½æ•°çš„åº”ç”¨ç¨‹åºå®šä¹‰çš„ä¸Šä¸‹æ–‡å‚æ•°ã€‚</span><br><span class="hljs-comment">  <span class="hljs-doctag">@param</span> syncMethod cæ“ä½œæ–¹æ³•</span><br><span class="hljs-comment">  <span class="hljs-doctag">@return</span> dispatch_queue_t</span><br><span class="hljs-comment"> */</span><br>dispatch_sync_f(queue, &amp;context, syncMethod);<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">syncMethod</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;<br><br>dispatch_sync(queue, ^&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="å»¶è¿Ÿæ“ä½œ"><a href="#å»¶è¿Ÿæ“ä½œ" class="headerlink" title="å»¶è¿Ÿæ“ä½œ"></a>å»¶è¿Ÿæ“ä½œ</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">int</span> context = <span class="hljs-number">10</span>;<br><span class="hljs-built_in">dispatch_after_f</span>(<span class="hljs-built_in">dispatch_time</span>(DISPATCH_TIME_NOW, (<span class="hljs-keyword">int64_t</span>)(<span class="hljs-number">1.2</span> * NSEC_PER_SEC)), queue, &amp;context, afterMethod);<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">afterMethod</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;<br><br><span class="hljs-keyword">dispatch_queue_t</span> queue = <span class="hljs-built_in">dispatch_get_main_queue</span>();<br> <span class="hljs-built_in">dispatch_after</span>(<span class="hljs-built_in">dispatch_time</span>(DISPATCH_TIME_NOW, (<span class="hljs-keyword">int64_t</span>)(<span class="hljs-number">1.2</span> * NSEC_PER_SEC)), queue, ^&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="å¿«é€Ÿè¿­ä»£"><a href="#å¿«é€Ÿè¿­ä»£" class="headerlink" title="å¿«é€Ÿè¿­ä»£"></a>å¿«é€Ÿè¿­ä»£</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-built_in">int</span> context = <span class="hljs-number">1</span>;<br><span class="hljs-comment">// æ‰§è¡Œ10æ¬¡applyMethodå‡½æ•°</span><br>dispatch<span class="hljs-constructor">_apply_f(10, <span class="hljs-params">queue</span>, &amp;<span class="hljs-params">context</span>, <span class="hljs-params">applyMethod</span>)</span>;<br>void apply<span class="hljs-constructor">Method()</span> &#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;<br><br>dispatch<span class="hljs-constructor">_apply(10, <span class="hljs-params">queue</span>, ^(<span class="hljs-params">size_t</span> <span class="hljs-params">index</span>)</span> &#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="æ‰§è¡Œä¸€æ¬¡"><a href="#æ‰§è¡Œä¸€æ¬¡" class="headerlink" title="æ‰§è¡Œä¸€æ¬¡"></a>æ‰§è¡Œä¸€æ¬¡</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-built_in">dispatch_once_f</span>(&amp;onceToken, &amp;context, onceMethod);<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">onceMethod</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">dispatch_once_t</span> onceToken;<br><span class="hljs-built_in">dispatch_once</span>(&amp;onceToken, ^&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="æ …æ æ–¹æ³•"><a href="#æ …æ æ–¹æ³•" class="headerlink" title="æ …æ æ–¹æ³•"></a>æ …æ æ–¹æ³•</h4><p>å°†é˜Ÿåˆ—æ‰§è¡Œçš„æ“ä½œç»„ç»™åˆ†å‰²èµ·æ¥ã€‚</p><ul><li>dispatch_barrier_async<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">int</span> context = <span class="hljs-number">10</span>;<br><span class="hljs-built_in">dispatch_barrier_async_f</span>(queue, &amp;context, barrierAsync);<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">barrierAsync</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;<br><br><span class="hljs-built_in">dispatch_barrier_async</span>(queue, ^&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;);<br></code></pre></td></tr></table></figure></li><li>dispatch_barrier_sync<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">int</span> context = <span class="hljs-number">10</span>;<br><span class="hljs-built_in">dispatch_barrier_sync_f</span>(queue, &amp;context, barrierAsync);<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">barrierSync</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;<br><br><span class="hljs-built_in">dispatch_barrier_sync</span>(queue, ^&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;);<br></code></pre></td></tr></table></figure>dispatch_barrier_syncå’Œdispatch_barrier_asyncçš„å…±åŒç‚¹ï¼š <blockquote><ul><li>1ã€éƒ½ä¼šç­‰å¾…åœ¨å®ƒå‰é¢æ’å…¥é˜Ÿåˆ—çš„ä»»åŠ¡å…ˆæ‰§è¡Œå®Œ </li><li>2ã€éƒ½ä¼šç­‰å¾…ä»–ä»¬è‡ªå·±çš„ä»»åŠ¡æ‰§è¡Œå®Œå†æ‰§è¡Œåé¢çš„ä»»åŠ¡</li></ul></blockquote></li></ul><p>dispatch_barrier_syncå’Œdispatch_barrier_asyncçš„ä¸å…±åŒç‚¹ï¼š </p><blockquote><ul><li>åœ¨å°†ä»»åŠ¡æ’å…¥åˆ°queueçš„æ—¶å€™ï¼Œdispatch_barrier_syncéœ€è¦ç­‰å¾…è‡ªå·±çš„ä»»åŠ¡ç»“æŸä¹‹åæ‰ä¼šç»§ç»­ç¨‹åºï¼Œç„¶åæ’å…¥è¢«å†™åœ¨å®ƒåé¢çš„ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œåé¢çš„ä»»åŠ¡<br>è€Œdispatch_barrier_asyncå°†è‡ªå·±çš„ä»»åŠ¡æ’å…¥åˆ°queueä¹‹åï¼Œä¸ä¼šç­‰å¾…è‡ªå·±çš„ä»»åŠ¡ç»“æŸï¼Œå®ƒä¼šç»§ç»­æŠŠåé¢çš„ä»»åŠ¡æ’å…¥åˆ°queueã€‚</li><li>æ‰€ä»¥ï¼Œdispatch_barrier_asyncçš„ä¸ç­‰å¾…ï¼ˆå¼‚æ­¥ï¼‰ç‰¹æ€§ä½“ç°åœ¨å°†ä»»åŠ¡æ’å…¥é˜Ÿåˆ—çš„è¿‡ç¨‹ï¼Œå®ƒçš„ç­‰å¾…ç‰¹æ€§ä½“ç°åœ¨ä»»åŠ¡çœŸæ­£æ‰§è¡Œçš„è¿‡ç¨‹ã€‚</li></ul></blockquote><h2 id="dispatch-semaphore"><a href="#dispatch-semaphore" class="headerlink" title="dispatch_semaphore"></a>dispatch_semaphore</h2><p>GCD ä¸­çš„ä¿¡å·é‡æ˜¯æŒ‡ Dispatch Semaphoreï¼Œæ˜¯æŒæœ‰è®¡æ•°çš„ä¿¡å·ã€‚ç±»ä¼¼äºè¿‡é«˜é€Ÿè·¯æ”¶è´¹ç«™çš„æ æ†ã€‚å¯ä»¥é€šè¿‡æ—¶ï¼Œæ‰“å¼€æ æ†ï¼Œä¸å¯ä»¥é€šè¿‡æ—¶ï¼Œå…³é—­æ æ†ã€‚åœ¨ Dispatch Semaphore ä¸­ï¼Œä½¿ç”¨è®¡æ•°æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œè®¡æ•°ä¸º0æ—¶ç­‰å¾…ï¼Œä¸å¯é€šè¿‡ã€‚è®¡æ•°ä¸º1æˆ–å¤§äº1æ—¶ï¼Œè®¡æ•°å‡1ä¸”ä¸ç­‰å¾…ï¼Œå¯é€šè¿‡ã€‚<br><br></p><h5 id="Dispatch-Semaphore-æä¾›äº†ä¸‰ä¸ªå‡½æ•°ã€‚"><a href="#Dispatch-Semaphore-æä¾›äº†ä¸‰ä¸ªå‡½æ•°ã€‚" class="headerlink" title="Dispatch Semaphore æä¾›äº†ä¸‰ä¸ªå‡½æ•°ã€‚"></a>Dispatch Semaphore æä¾›äº†ä¸‰ä¸ªå‡½æ•°ã€‚</h5><ul><li>dispatch_semaphore_createï¼šåˆ›å»ºä¸€ä¸ªSemaphoreå¹¶åˆå§‹åŒ–ä¿¡å·çš„æ€»é‡</li><li>dispatch_semaphore_signalï¼šå‘é€ä¸€ä¸ªä¿¡å·ï¼Œè®©ä¿¡å·æ€»é‡åŠ 1</li><li>dispatch_semaphore_waitï¼šå¯ä»¥ä½¿æ€»ä¿¡å·é‡å‡1ï¼Œå½“ä¿¡å·æ€»é‡ä¸º0æ—¶å°±ä¼šä¸€ç›´ç­‰å¾…ï¼ˆé˜»å¡æ‰€åœ¨çº¿ç¨‹ï¼‰ï¼Œå¦åˆ™å°±å¯ä»¥æ­£å¸¸æ‰§è¡Œã€‚</li></ul><blockquote><p>æ³¨æ„ï¼šä¿¡å·é‡çš„ä½¿ç”¨å‰ææ˜¯ï¼šæƒ³æ¸…æ¥šä½ éœ€è¦å¤„ç†å“ªä¸ªçº¿ç¨‹ç­‰å¾…ï¼ˆé˜»å¡ï¼‰ï¼Œåˆè¦å“ªä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œç„¶åä½¿ç”¨ä¿¡å·é‡ã€‚</p></blockquote><h5 id="Dispatch-Semaphore-åœ¨å®é™…å¼€å‘ä¸­ä¸»è¦ç”¨äºï¼š"><a href="#Dispatch-Semaphore-åœ¨å®é™…å¼€å‘ä¸­ä¸»è¦ç”¨äºï¼š" class="headerlink" title="Dispatch Semaphore åœ¨å®é™…å¼€å‘ä¸­ä¸»è¦ç”¨äºï¼š"></a>Dispatch Semaphore åœ¨å®é™…å¼€å‘ä¸­ä¸»è¦ç”¨äºï¼š</h5><ul><li>ä¿æŒçº¿ç¨‹åŒæ­¥ï¼Œå°†å¼‚æ­¥æ‰§è¡Œä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥æ‰§è¡Œä»»åŠ¡</li><li>ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä¸ºçº¿ç¨‹åŠ é”</li></ul><h3 id="Dispatch-Semaphore-çº¿ç¨‹åŒæ­¥"><a href="#Dispatch-Semaphore-çº¿ç¨‹åŒæ­¥" class="headerlink" title="Dispatch Semaphore çº¿ç¨‹åŒæ­¥"></a>Dispatch Semaphore çº¿ç¨‹åŒæ­¥</h3><p>æˆ‘ä»¬åœ¨å¼€å‘ä¸­ï¼Œä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼šå¼‚æ­¥æ‰§è¡Œè€—æ—¶ä»»åŠ¡ï¼Œå¹¶ä½¿ç”¨å¼‚æ­¥æ‰§è¡Œçš„ç»“æœè¿›è¡Œä¸€äº›é¢å¤–çš„æ“ä½œã€‚æ¢å¥è¯è¯´ï¼Œç›¸å½“äºï¼Œå°†å°†å¼‚æ­¥æ‰§è¡Œä»»åŠ¡è½¬æ¢ä¸ºåŒæ­¥æ‰§è¡Œä»»åŠ¡ã€‚æ¯”å¦‚è¯´ï¼šAFNetworking ä¸­ AFURLSessionManager.m é‡Œé¢çš„ tasksForKeyPath: æ–¹æ³•ã€‚é€šè¿‡å¼•å…¥ä¿¡å·é‡çš„æ–¹å¼ï¼Œç­‰å¾…å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ç»“æœï¼Œè·å–åˆ° tasksï¼Œç„¶åå†è¿”å›è¯¥ tasksã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">- (<span class="hljs-built_in">NSArray</span> *)tasksForKeyPath:(<span class="hljs-built_in">NSString</span> *)keyPath &#123;<br>    __block <span class="hljs-built_in">NSArray</span> *tasks = <span class="hljs-literal">nil</span>;<br>    dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class="hljs-number">0</span>);<br>    [<span class="hljs-keyword">self</span>.session getTasksWithCompletionHandler:^(<span class="hljs-built_in">NSArray</span> *dataTasks, <span class="hljs-built_in">NSArray</span> *uploadTasks, <span class="hljs-built_in">NSArray</span> *downloadTasks) &#123;<br>        <span class="hljs-keyword">if</span> ([keyPath isEqualToString:<span class="hljs-built_in">NSStringFromSelector</span>(<span class="hljs-keyword">@selector</span>(dataTasks))]) &#123;<br>            tasks = dataTasks;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([keyPath isEqualToString:<span class="hljs-built_in">NSStringFromSelector</span>(<span class="hljs-keyword">@selector</span>(uploadTasks))]) &#123;<br>            tasks = uploadTasks;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([keyPath isEqualToString:<span class="hljs-built_in">NSStringFromSelector</span>(<span class="hljs-keyword">@selector</span>(downloadTasks))]) &#123;<br>            tasks = downloadTasks;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ([keyPath isEqualToString:<span class="hljs-built_in">NSStringFromSelector</span>(<span class="hljs-keyword">@selector</span>(tasks))]) &#123;<br>            tasks = [@[dataTasks, uploadTasks, downloadTasks] valueForKeyPath:<span class="hljs-string">@&quot;@unionOfArrays.self&quot;</span>];<br>        &#125;<br><br>        dispatch_semaphore_signal(semaphore);<br>    &#125;];<br><br>    dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);<br><br>    <span class="hljs-keyword">return</span> tasks;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Dispatch-Semaphore-çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹åŒæ­¥ï¼ˆä¸ºçº¿ç¨‹åŠ é”ï¼‰"><a href="#Dispatch-Semaphore-çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹åŒæ­¥ï¼ˆä¸ºçº¿ç¨‹åŠ é”ï¼‰" class="headerlink" title="Dispatch Semaphore çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹åŒæ­¥ï¼ˆä¸ºçº¿ç¨‹åŠ é”ï¼‰"></a>Dispatch Semaphore çº¿ç¨‹å®‰å…¨å’Œçº¿ç¨‹åŒæ­¥ï¼ˆä¸ºçº¿ç¨‹åŠ é”ï¼‰</h3><ul><li><p>çº¿ç¨‹å®‰å…¨ï¼šå¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<br><br>è‹¥æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹å…¨å±€å˜é‡ã€é™æ€å˜é‡åªæœ‰è¯»æ“ä½œï¼Œè€Œæ— å†™æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªå…¨å±€å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå†™æ“ä½œï¼ˆæ›´æ”¹å˜é‡ï¼‰ï¼Œä¸€èˆ¬éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œå¦åˆ™çš„è¯å°±å¯èƒ½å½±å“çº¿ç¨‹å®‰å…¨ã€‚</p></li><li><p>çº¿ç¨‹åŒæ­¥ï¼šå¯ç†è§£ä¸ºçº¿ç¨‹ A å’Œ çº¿ç¨‹ B ä¸€å—é…åˆï¼ŒA æ‰§è¡Œåˆ°ä¸€å®šç¨‹åº¦æ—¶è¦ä¾é çº¿ç¨‹ B çš„æŸä¸ªç»“æœï¼Œäºæ˜¯åœä¸‹æ¥ï¼Œç¤ºæ„ B è¿è¡Œï¼›B ä¾è¨€æ‰§è¡Œï¼Œå†å°†ç»“æœç»™ Aï¼›A å†ç»§ç»­æ“ä½œã€‚</p></li><li><p>ä¸¾ä¸ªç®€å•ä¾‹å­å°±æ˜¯ï¼šä¸¤ä¸ªäººåœ¨ä¸€èµ·èŠå¤©ã€‚ä¸¤ä¸ªäººä¸èƒ½åŒæ—¶è¯´è¯ï¼Œé¿å…å¬ä¸æ¸…(æ“ä½œå†²çª)ã€‚ç­‰ä¸€ä¸ªäººè¯´å®Œ(ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ“ä½œ)ï¼Œå¦ä¸€ä¸ªå†è¯´(å¦ä¸€ä¸ªçº¿ç¨‹å†å¼€å§‹æ“ä½œ)ã€‚<br>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿç«è½¦ç¥¨å”®å–çš„æ–¹å¼ï¼Œå®ç° NSThread çº¿ç¨‹å®‰å…¨å’Œè§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚<br>åœºæ™¯ï¼šæ€»å…±æœ‰50å¼ ç«è½¦ç¥¨ï¼Œæœ‰ä¸¤ä¸ªå”®å–ç«è½¦ç¥¨çš„çª—å£ï¼Œä¸€ä¸ªæ˜¯åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ã€‚ä¸¤ä¸ªçª—å£åŒæ—¶å”®å–ç«è½¦ç¥¨ï¼Œå–å®Œä¸ºæ­¢ã€‚</p><h4 id="éçº¿ç¨‹å®‰å…¨ï¼ˆä¸ä½¿ç”¨-semaphoreï¼‰"><a href="#éçº¿ç¨‹å®‰å…¨ï¼ˆä¸ä½¿ç”¨-semaphoreï¼‰" class="headerlink" title="éçº¿ç¨‹å®‰å…¨ï¼ˆä¸ä½¿ç”¨ semaphoreï¼‰"></a>éçº¿ç¨‹å®‰å…¨ï¼ˆä¸ä½¿ç”¨ semaphoreï¼‰</h4><p>å…ˆæ¥çœ‹çœ‹ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * éçº¿ç¨‹å®‰å…¨ï¼šä¸ä½¿ç”¨ semaphore</span><br><span class="hljs-comment"> * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(éçº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)initTicketStatusNotSave &#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;currentThread---%@&quot;</span>,[<span class="hljs-built_in">NSThread</span> currentThread]);  <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;semaphore---begin&quot;</span>);<br>    <br>    <span class="hljs-keyword">self</span>.ticketSurplusCount = <span class="hljs-number">50</span>;<br>    <br>    <span class="hljs-comment">// queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£</span><br>    <span class="hljs-built_in">dispatch_queue_t</span> queue1 = dispatch_queue_create(<span class="hljs-string">&quot;net.bujige.testQueue1&quot;</span>, DISPATCH_QUEUE_SERIAL);<br>    <span class="hljs-comment">// queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£</span><br>    <span class="hljs-built_in">dispatch_queue_t</span> queue2 = dispatch_queue_create(<span class="hljs-string">&quot;net.bujige.testQueue2&quot;</span>, DISPATCH_QUEUE_SERIAL);<br>    <br>    __<span class="hljs-keyword">weak</span> <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;<br>    <span class="hljs-built_in">dispatch_async</span>(queue1, ^&#123;<br>        [weakSelf saleTicketNotSafe];<br>    &#125;);<br>    <br>    <span class="hljs-built_in">dispatch_async</span>(queue2, ^&#123;<br>        [weakSelf saleTicketNotSafe];<br>    &#125;);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å”®å–ç«è½¦ç¥¨(éçº¿ç¨‹å®‰å…¨)</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)saleTicketNotSafe &#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.ticketSurplusCount &gt; <span class="hljs-number">0</span>) &#123;  <span class="hljs-comment">//å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–</span><br>            <span class="hljs-keyword">self</span>.ticketSurplusCount--;<br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;å‰©ä½™ç¥¨æ•°ï¼š%d çª—å£ï¼š%@&quot;</span>, <span class="hljs-keyword">self</span>.ticketSurplusCount, [<span class="hljs-built_in">NSThread</span> currentThread]]);<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">0.2</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">//å¦‚æœå·²å–å®Œï¼Œå…³é—­å”®ç¥¨çª—å£</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>è¾“å‡ºç»“æœï¼ˆéƒ¨åˆ†ï¼‰ï¼š<br>2018-02-23 22:25:35.789072+0800 YSC-GCD-demo[20712:5258914] currentThreadâ€”&lt;NSThread: 0x604000068880&gt;{number = 1, name = main}</p></blockquote></li></ul><blockquote><p>2018-02-23 22:25:35.789260+0800 YSC-GCD-demo[20712:5258914] semaphoreâ€”begin</p></blockquote><blockquote><p>2018-02-23 22:25:35.789641+0800 YSC-GCD-demo[20712:5259176] å‰©ä½™ç¥¨æ•°ï¼š48 çª—å£ï¼š&lt;NSThread: 0x60000027db80&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:25:35.789646+0800 YSC-GCD-demo[20712:5259175] å‰©ä½™ç¥¨æ•°ï¼š49 çª—å£ï¼š&lt;NSThread: 0x60000027e740&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:25:35.994113+0800 YSC-GCD-demo[20712:5259175] å‰©ä½™ç¥¨æ•°ï¼š47 çª—å£ï¼š&lt;NSThread: 0x60000027e740&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:25:35.994129+0800 YSC-GCD-demo[20712:5259176] å‰©ä½™ç¥¨æ•°ï¼š46 çª—å£ï¼š&lt;NSThread: 0x60000027db80&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:25:36.198993+0800 YSC-GCD-demo[20712:5259176] å‰©ä½™ç¥¨æ•°ï¼š45 çª—å£ï¼š&lt;NSThread: 0x60000027db80&gt;{number = 3, name = (null)}</p></blockquote><p>å¯ä»¥çœ‹åˆ°åœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œä¸ä½¿ç”¨ semaphore çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°ç¥¨æ•°æ˜¯é”™ä¹±çš„ï¼Œè¿™æ ·æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><h4 id="çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨-semaphore-åŠ é”ï¼‰"><a href="#çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨-semaphore-åŠ é”ï¼‰" class="headerlink" title="çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨ semaphore åŠ é”ï¼‰"></a>çº¿ç¨‹å®‰å…¨ï¼ˆä½¿ç”¨ semaphore åŠ é”ï¼‰</h4><p>è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ semaphore åŠ é”</span><br><span class="hljs-comment"> * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(çº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)initTicketStatusSave &#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;currentThread---%@&quot;</span>,[<span class="hljs-built_in">NSThread</span> currentThread]);  <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;semaphore---begin&quot;</span>);<br>    <br>    semaphoreLock = dispatch_semaphore_create(<span class="hljs-number">1</span>);<br>    <br>    <span class="hljs-keyword">self</span>.ticketSurplusCount = <span class="hljs-number">50</span>;<br>    <br>    <span class="hljs-comment">// queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£</span><br>    <span class="hljs-built_in">dispatch_queue_t</span> queue1 = dispatch_queue_create(<span class="hljs-string">&quot;net.bujige.testQueue1&quot;</span>, DISPATCH_QUEUE_SERIAL);<br>    <span class="hljs-comment">// queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£</span><br>    <span class="hljs-built_in">dispatch_queue_t</span> queue2 = dispatch_queue_create(<span class="hljs-string">&quot;net.bujige.testQueue2&quot;</span>, DISPATCH_QUEUE_SERIAL);<br>    <br>    __<span class="hljs-keyword">weak</span> <span class="hljs-keyword">typeof</span>(<span class="hljs-keyword">self</span>) weakSelf = <span class="hljs-keyword">self</span>;<br>    <span class="hljs-built_in">dispatch_async</span>(queue1, ^&#123;<br>        [weakSelf saleTicketSafe];<br>    &#125;);<br>    <br>    <span class="hljs-built_in">dispatch_async</span>(queue2, ^&#123;<br>        [weakSelf saleTicketSafe];<br>    &#125;);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å”®å–ç«è½¦ç¥¨(çº¿ç¨‹å®‰å…¨)</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)saleTicketSafe &#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">// ç›¸å½“äºåŠ é”</span><br>        dispatch_semaphore_wait(semaphoreLock, DISPATCH_TIME_FOREVER);<br>        <br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.ticketSurplusCount &gt; <span class="hljs-number">0</span>) &#123;  <span class="hljs-comment">//å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–</span><br>            <span class="hljs-keyword">self</span>.ticketSurplusCount--;<br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;å‰©ä½™ç¥¨æ•°ï¼š%d çª—å£ï¼š%@&quot;</span>, <span class="hljs-keyword">self</span>.ticketSurplusCount, [<span class="hljs-built_in">NSThread</span> currentThread]]);<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">0.2</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-comment">//å¦‚æœå·²å–å®Œï¼Œå…³é—­å”®ç¥¨çª—å£</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;</span>);<br>            <br>            <span class="hljs-comment">// ç›¸å½“äºè§£é”</span><br>            dispatch_semaphore_signal(semaphoreLock);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <br>        <span class="hljs-comment">// ç›¸å½“äºè§£é”</span><br>        dispatch_semaphore_signal(semaphoreLock);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>è¾“å‡ºç»“æœä¸ºï¼š<br>2018-02-23 22:32:19.814232+0800 YSC-GCD-demo[20862:5290531] currentThreadâ€”&lt;NSThread: 0x6000000783c0&gt;{number = 1, name = main}</p></blockquote><blockquote><p>2018-02-23 22:32:19.814412+0800 YSC-GCD-demo[20862:5290531] semaphoreâ€”begin</p></blockquote><blockquote><p>2018-02-23 22:32:19.814837+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š49 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:20.017745+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š48 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:20.222039+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š47 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>â€¦<br>2018-02-23 22:32:29.024817+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š4 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:29.230110+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š3 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:29.433615+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š2 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:29.637572+0800 YSC-GCD-demo[20862:5290687] å‰©ä½™ç¥¨æ•°ï¼š1 çª—å£ï¼š&lt;NSThread: 0x6040002709c0&gt;{number = 3, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:29.840234+0800 YSC-GCD-demo[20862:5290689] å‰©ä½™ç¥¨æ•°ï¼š0 çª—å£ï¼š&lt;NSThread: 0x60000046c640&gt;{number = 4, name = (null)}</p></blockquote><blockquote><p>2018-02-23 22:32:30.044960+0800 YSC-GCD-demo[20862:5290687] æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ</p></blockquote><blockquote><p>2018-02-23 22:32:30.045260+0800 YSC-GCD-demo[20862:5290689] æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ</p></blockquote><p>å¯ä»¥çœ‹å‡ºï¼Œåœ¨è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ dispatch_semaphore<br>æœºåˆ¶ä¹‹åï¼Œå¾—åˆ°çš„ç¥¨æ•°æ˜¯æ­£ç¡®çš„ï¼Œæ²¡æœ‰å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚æˆ‘ä»¬ä¹Ÿå°±è§£å†³äº†å¤šä¸ªçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚</p><h2 id="dispatch-group"><a href="#dispatch-group" class="headerlink" title="dispatch_group"></a>dispatch_group</h2><p>å¤šä¸ªä»»åŠ¡æ”¾åˆ°ä¸€ä¸ªç»„ä¸­ã€‚</p><h3 id="dispatch-group-t"><a href="#dispatch-group-t" class="headerlink" title="dispatch_group_t"></a>dispatch_group_t</h3><h4 id="åˆ›å»º-1"><a href="#åˆ›å»º-1" class="headerlink" title="åˆ›å»º"></a>åˆ›å»º</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">dispatch_group_t <span class="hljs-keyword">group</span> <span class="hljs-title">= dispatch_group_create</span>();<br></code></pre></td></tr></table></figure><h4 id="æ·»åŠ ä»»åŠ¡"><a href="#æ·»åŠ ä»»åŠ¡" class="headerlink" title="æ·»åŠ ä»»åŠ¡"></a>æ·»åŠ ä»»åŠ¡</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">dispatch_queue_t</span> queue = <span class="hljs-built_in">dispatch_queue_create</span>(<span class="hljs-string">&quot;name&quot;</span>, DISPATCH_QUEUE_SERIAL);<br><span class="hljs-keyword">int</span> context = <span class="hljs-number">10</span>;<br><span class="hljs-built_in">dispatch_group_async_f</span>(group, queue, &amp;context, groupMethod);<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">groupMethod</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;<br><br><span class="hljs-keyword">dispatch_queue_t</span> queue = <span class="hljs-built_in">dispatch_queue_create</span>(<span class="hljs-string">&quot;name&quot;</span>, DISPATCH_QUEUE_SERIAL);<br><span class="hljs-built_in">dispatch_group_async</span>(group, queue, ^&#123;<br>    <span class="hljs-comment">// TODO</span><br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="å…¶ä»–æ“ä½œ"><a href="#å…¶ä»–æ“ä½œ" class="headerlink" title="å…¶ä»–æ“ä½œ"></a>å…¶ä»–æ“ä½œ</h4><h5 id="1-è·å–ä»»åŠ¡ç»„ä»»åŠ¡å®Œæˆï¼Œè¿›è¡Œæ“ä½œ"><a href="#1-è·å–ä»»åŠ¡ç»„ä»»åŠ¡å®Œæˆï¼Œè¿›è¡Œæ“ä½œ" class="headerlink" title="1. è·å–ä»»åŠ¡ç»„ä»»åŠ¡å®Œæˆï¼Œè¿›è¡Œæ“ä½œ"></a>1. è·å–ä»»åŠ¡ç»„ä»»åŠ¡å®Œæˆï¼Œè¿›è¡Œæ“ä½œ</h5><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">//</span> æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œï¼Œé€šçŸ¥è°ƒåº¦ç»„ï¼Œåœ¨queueä¸Šå¼‚æ­¥æ‰§è¡Œblockï¼Œä¸ä¼šé˜»å¡å½“å‰ä»»åŠ¡<br>dispatch_group_notify_f(group, queue5, &amp;context, groupMethod);<br><br>void groupMethod() &#123;<br>    <span class="hljs-regexp">//</span> TODO<br>&#125;<br><br><span class="hljs-regexp">//</span> dispatch_group_notify_fçš„å°è£…    <br>dispatch_group_notify(group, queue, ^&#123;<br>    <span class="hljs-regexp">//</span> TODO<br>&#125;);<br></code></pre></td></tr></table></figure><h4 id="2-é€šçŸ¥groupï¼Œä¸‹é¢çš„ä»»åŠ¡é©¬ä¸Šè¦æ”¾åˆ°groupä¸­æ‰§è¡Œäº†ã€‚"><a href="#2-é€šçŸ¥groupï¼Œä¸‹é¢çš„ä»»åŠ¡é©¬ä¸Šè¦æ”¾åˆ°groupä¸­æ‰§è¡Œäº†ã€‚" class="headerlink" title="2. é€šçŸ¥groupï¼Œä¸‹é¢çš„ä»»åŠ¡é©¬ä¸Šè¦æ”¾åˆ°groupä¸­æ‰§è¡Œäº†ã€‚"></a>2. é€šçŸ¥groupï¼Œä¸‹é¢çš„ä»»åŠ¡é©¬ä¸Šè¦æ”¾åˆ°groupä¸­æ‰§è¡Œäº†ã€‚</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">dispatch<span class="hljs-constructor">_group_enter(<span class="hljs-params">group</span>)</span>;<br></code></pre></td></tr></table></figure><h4 id="3-é€šçŸ¥groupï¼Œä»»åŠ¡å®Œæˆäº†ï¼Œè¯¥ä»»åŠ¡è¦ä»groupä¸­ç§»é™¤äº†ã€‚"><a href="#3-é€šçŸ¥groupï¼Œä»»åŠ¡å®Œæˆäº†ï¼Œè¯¥ä»»åŠ¡è¦ä»groupä¸­ç§»é™¤äº†ã€‚" class="headerlink" title="3. é€šçŸ¥groupï¼Œä»»åŠ¡å®Œæˆäº†ï¼Œè¯¥ä»»åŠ¡è¦ä»groupä¸­ç§»é™¤äº†ã€‚"></a>3. é€šçŸ¥groupï¼Œä»»åŠ¡å®Œæˆäº†ï¼Œè¯¥ä»»åŠ¡è¦ä»groupä¸­ç§»é™¤äº†ã€‚</h4><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">dispatch<span class="hljs-constructor">_group_leave(<span class="hljs-params">group</span>)</span>;<br></code></pre></td></tr></table></figure><h4 id="4-è®¾ç½®è¶…æ—¶"><a href="#4-è®¾ç½®è¶…æ—¶" class="headerlink" title="4. è®¾ç½®è¶…æ—¶"></a>4. è®¾ç½®è¶…æ—¶</h4><p>å‡è®¾åˆ›å»ºdispatch_group_waité‡Œçš„dispatch_timeç­‰å¾…æ—¶é—´æ˜¯4ç§’,é‚£ä¹ˆgroupé‡Œçš„å†…å®¹åœ¨4så†…å®Œæˆçš„è¯,é‚£waitç›´æ¥ç»“æŸ,å¦‚æœgroupåœ¨4så†…æ²¡æœ‰æ‰§è¡Œå®Œ,é‚£ä¹ˆwaitä¹Ÿä¼šç»“æŸ,ç»“æŸä¹‹å,å‘¨æœ«çš„ä»»åŠ¡å°±ä¼šè¢«åŠ è¿›æ¥äº†ã€‚</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">long result = dispatch<span class="hljs-constructor">_group_wait(<span class="hljs-params">group</span>, <span class="hljs-params">dispatch_time</span>(DISPATCH_TIME_NOW, 4.0 <span class="hljs-operator">*</span> NSEC_PER_SEC)</span>);<br><span class="hljs-keyword">if</span> (result) &#123;<br>    <span class="hljs-constructor">NSLog(@<span class="hljs-string">&quot;è¶…è¿‡ç­‰å¾…æ—¶é—´äº†&quot;</span>)</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-constructor">NSLog(@<span class="hljs-string">&quot;æ—¶é—´æ²¡æœ‰è¶…è¿‡ç­‰å¾…æ—¶é—´&quot;</span>)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>å¤šçº¿ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSå¤šçº¿ç¨‹-NSOperation</title>
    <link href="/2019/02/01/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-NSOperation/"/>
    <url>/2019/02/01/iOS%E5%A4%9A%E7%BA%BF%E7%A8%8B-NSOperation/</url>
    
    <content type="html"><![CDATA[<h2 id="1-NSOperationã€NSOperationQueue-ç®€ä»‹"><a href="#1-NSOperationã€NSOperationQueue-ç®€ä»‹" class="headerlink" title="1.NSOperationã€NSOperationQueue ç®€ä»‹"></a>1.NSOperationã€NSOperationQueue ç®€ä»‹</h2><p>NSOperationã€NSOperationQueue æ˜¯è‹¹æœæä¾›ç»™æˆ‘ä»¬çš„ä¸€å¥—å¤šçº¿ç¨‹è§£å†³æ–¹æ¡ˆã€‚å®é™…ä¸Š NSOperationã€NSOperationQueue æ˜¯åŸºäº GCD æ›´é«˜ä¸€å±‚çš„å°è£…ï¼Œå®Œå…¨é¢å‘å¯¹è±¡ã€‚ä½†æ˜¯æ¯” GCD æ›´ç®€å•æ˜“ç”¨ã€ä»£ç å¯è¯»æ€§ä¹Ÿæ›´é«˜ã€‚</p><h5 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NSOperationã€NSOperationQueueï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-NSOperationã€NSOperationQueueï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ NSOperationã€NSOperationQueueï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ NSOperationã€NSOperationQueueï¼Ÿ</h5><ol><li>å¯æ·»åŠ å®Œæˆçš„ä»£ç å—ï¼Œåœ¨æ“ä½œå®Œæˆåæ‰§è¡Œã€‚</li><li>æ·»åŠ æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ–¹ä¾¿çš„æ§åˆ¶æ‰§è¡Œé¡ºåºã€‚</li><li>è®¾å®šæ“ä½œæ‰§è¡Œçš„ä¼˜å…ˆçº§ã€‚</li><li>å¯ä»¥å¾ˆæ–¹ä¾¿çš„å–æ¶ˆä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œã€‚</li><li>ä½¿ç”¨ KVO è§‚å¯Ÿå¯¹æ“ä½œæ‰§è¡ŒçŠ¶æ€çš„æ›´æ”¹ï¼šisExecuteingã€isFinishedã€isCancelledã€‚</li></ol><h2 id="2-NSOperationã€NSOperationQueue-æ“ä½œå’Œæ“ä½œé˜Ÿåˆ—"><a href="#2-NSOperationã€NSOperationQueue-æ“ä½œå’Œæ“ä½œé˜Ÿåˆ—" class="headerlink" title="2. NSOperationã€NSOperationQueue æ“ä½œå’Œæ“ä½œé˜Ÿåˆ—"></a>2. NSOperationã€NSOperationQueue æ“ä½œå’Œæ“ä½œé˜Ÿåˆ—</h2><p>æ—¢ç„¶æ˜¯åŸºäº GCD çš„æ›´é«˜ä¸€å±‚çš„å°è£…ã€‚é‚£ä¹ˆï¼ŒGCD ä¸­çš„ä¸€äº›æ¦‚å¿µåŒæ ·é€‚ç”¨äº NSOperationã€NSOperationQueueã€‚åœ¨ NSOperationã€NSOperationQueue ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ä»»åŠ¡ï¼ˆæ“ä½œï¼‰å’Œé˜Ÿåˆ—ï¼ˆæ“ä½œé˜Ÿåˆ—ï¼‰çš„æ¦‚å¿µã€‚</p><h4 id="æ“ä½œï¼ˆOperationï¼‰ï¼š"><a href="#æ“ä½œï¼ˆOperationï¼‰ï¼š" class="headerlink" title="æ“ä½œï¼ˆOperationï¼‰ï¼š"></a>æ“ä½œï¼ˆOperationï¼‰ï¼š</h4><ul><li>æ‰§è¡Œæ“ä½œçš„æ„æ€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä½ åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„é‚£æ®µä»£ç ã€‚</li><li>åœ¨ GCD ä¸­æ˜¯æ”¾åœ¨ block ä¸­çš„ã€‚åœ¨ NSOperation ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ NSOperation å­ç±» NSInvocationOperationã€NSBlockOperationï¼Œæˆ–è€…è‡ªå®šä¹‰å­ç±»æ¥å°è£…æ“ä½œã€‚<h4 id="æ“ä½œé˜Ÿåˆ—ï¼ˆOperation-Queuesï¼‰ï¼š"><a href="#æ“ä½œé˜Ÿåˆ—ï¼ˆOperation-Queuesï¼‰ï¼š" class="headerlink" title="æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰ï¼š"></a>æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰ï¼š</h4></li><li>è¿™é‡Œçš„é˜Ÿåˆ—æŒ‡æ“ä½œé˜Ÿåˆ—ï¼Œå³ç”¨æ¥å­˜æ”¾æ“ä½œçš„é˜Ÿåˆ—ã€‚ä¸åŒäº GCD ä¸­çš„è°ƒåº¦é˜Ÿåˆ— FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ã€‚NSOperationQueue å¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œé¦–å…ˆè¿›å…¥å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€å–å†³äºæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œçš„å¼€å§‹æ‰§è¡Œé¡ºåºï¼ˆéç»“æŸæ‰§è¡Œé¡ºåºï¼‰ç”±æ“ä½œä¹‹é—´ç›¸å¯¹çš„ä¼˜å…ˆçº§å†³å®šï¼ˆä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡è‡ªèº«çš„å±æ€§ï¼‰ã€‚</li><li>æ“ä½œé˜Ÿåˆ—é€šè¿‡è®¾ç½®æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼ˆmaxConcurrentOperationCountï¼‰æ¥æ§åˆ¶å¹¶å‘ã€ä¸²è¡Œã€‚</li><li>NSOperationQueue ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§ä¸åŒç±»å‹çš„é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—å’Œè‡ªå®šä¹‰é˜Ÿåˆ—ã€‚ä¸»é˜Ÿåˆ—è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¹‹ä¸Šï¼Œè€Œè‡ªå®šä¹‰é˜Ÿåˆ—åœ¨åå°æ‰§è¡Œã€‚</li></ul><h2 id="3-NSOperationã€NSOperationQueue-ä½¿ç”¨æ­¥éª¤"><a href="#3-NSOperationã€NSOperationQueue-ä½¿ç”¨æ­¥éª¤" class="headerlink" title="3. NSOperationã€NSOperationQueue ä½¿ç”¨æ­¥éª¤"></a>3. NSOperationã€NSOperationQueue ä½¿ç”¨æ­¥éª¤</h2><p>NSOperation éœ€è¦é…åˆ NSOperationQueue æ¥å®ç°å¤šçº¿ç¨‹ã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒNSOperation å•ç‹¬ä½¿ç”¨æ—¶ç³»ç»ŸåŒæ­¥æ‰§è¡Œæ“ä½œï¼Œé…åˆ NSOperationQueue æˆ‘ä»¬èƒ½æ›´å¥½çš„å®ç°å¼‚æ­¥æ‰§è¡Œã€‚<br>NSOperation å®ç°å¤šçº¿ç¨‹çš„ä½¿ç”¨æ­¥éª¤åˆ†ä¸ºä¸‰æ­¥ï¼š</p><p>åˆ›å»ºæ“ä½œï¼šå…ˆå°†éœ€è¦æ‰§è¡Œçš„æ“ä½œå°è£…åˆ°ä¸€ä¸ª NSOperation å¯¹è±¡ä¸­ã€‚<br>åˆ›å»ºé˜Ÿåˆ—ï¼šåˆ›å»º NSOperationQueue å¯¹è±¡ã€‚<br>å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼šå°† NSOperation å¯¹è±¡æ·»åŠ åˆ° NSOperationQueue å¯¹è±¡ä¸­ã€‚</p><p>ä¹‹åå‘¢ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°† NSOperationQueue ä¸­çš„ NSOperation å–å‡ºæ¥ï¼Œåœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œã€‚<br>ä¸‹é¢æˆ‘ä»¬æ¥å­¦ä¹ ä¸‹ NSOperation å’Œ NSOperationQueue çš„åŸºæœ¬ä½¿ç”¨ã€‚</p><h2 id="4-NSOperation-å’Œ-NSOperationQueue-åŸºæœ¬ä½¿ç”¨"><a href="#4-NSOperation-å’Œ-NSOperationQueue-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="4. NSOperation å’Œ NSOperationQueue åŸºæœ¬ä½¿ç”¨"></a>4. NSOperation å’Œ NSOperationQueue åŸºæœ¬ä½¿ç”¨</h2><h3 id="4-1-åˆ›å»ºæ“ä½œ"><a href="#4-1-åˆ›å»ºæ“ä½œ" class="headerlink" title="4.1 åˆ›å»ºæ“ä½œ"></a>4.1 åˆ›å»ºæ“ä½œ</h3><p>NSOperation æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç”¨æ¥å°è£…æ“ä½œã€‚æˆ‘ä»¬åªæœ‰ä½¿ç”¨å®ƒçš„å­ç±»æ¥å°è£…æ“ä½œã€‚æˆ‘ä»¬æœ‰ä¸‰ç§æ–¹å¼æ¥å°è£…æ“ä½œã€‚</p><p>ä½¿ç”¨å­ç±» NSInvocationOperation<br>ä½¿ç”¨å­ç±» NSBlockOperation<br>è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé€šè¿‡å®ç°å†…éƒ¨ç›¸åº”çš„æ–¹æ³•æ¥å°è£…æ“ä½œã€‚</p><p>åœ¨ä¸ä½¿ç”¨ NSOperationQueueï¼Œå•ç‹¬ä½¿ç”¨ NSOperation çš„æƒ…å†µä¸‹ç³»ç»ŸåŒæ­¥æ‰§è¡Œæ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬å­¦ä¹ ä»¥ä¸‹æ“ä½œçš„ä¸‰ç§åˆ›å»ºæ–¹å¼ã€‚</p><h4 id="4-1-1-ä½¿ç”¨å­ç±»-NSInvocationOperation"><a href="#4-1-1-ä½¿ç”¨å­ç±»-NSInvocationOperation" class="headerlink" title="4.1.1 ä½¿ç”¨å­ç±» NSInvocationOperation"></a>4.1.1 ä½¿ç”¨å­ç±» NSInvocationOperation</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä½¿ç”¨å­ç±» NSInvocationOperation</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)useInvocationOperation &#123;<br><br>    <span class="hljs-comment">// 1.åˆ›å»º NSInvocationOperation å¯¹è±¡</span><br>    <span class="hljs-built_in">NSInvocationOperation</span> *op = [[<span class="hljs-built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="hljs-keyword">self</span> selector:<span class="hljs-keyword">@selector</span>(task1) object:<span class="hljs-literal">nil</span>];<br><br>    <span class="hljs-comment">// 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span><br>    [op start];<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä»»åŠ¡1</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)task1 &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>        [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>        <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;1---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-8adc1a81b44170e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><ul><li>å¯ä»¥çœ‹åˆ°ï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨ä½¿ç”¨å­ç±» NSInvocationOperation æ‰§è¡Œä¸€ä¸ªæ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ“ä½œæ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚<br>å¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™æ‰“å°ç»“æœä¸ºå…¶ä»–çº¿ç¨‹ã€‚<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">// åœ¨å…¶ä»–çº¿ç¨‹ä½¿ç”¨å­ç±» NSInvocationOperation</span><br>[<span class="hljs-built_in">NSThread</span> detachNewThreadSelector:<span class="hljs-keyword">@selector</span>(useInvocationOperation) toTarget:<span class="hljs-keyword">self</span> withObject:<span class="hljs-literal">nil</span>];<br></code></pre></td></tr></table></figure>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-3a5b4d58d70a9129.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></li><li>å¯ä»¥çœ‹åˆ°ï¼šåœ¨å…¶ä»–çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨å­ç±» NSInvocationOperationï¼Œæ“ä½œæ˜¯åœ¨å½“å‰è°ƒç”¨çš„å…¶ä»–çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚</li></ul><p>ä¸‹è¾¹å†æ¥çœ‹çœ‹ NSBlockOperationã€‚</p><h4 id="4-1-2-ä½¿ç”¨å­ç±»-NSBlockOperation"><a href="#4-1-2-ä½¿ç”¨å­ç±»-NSBlockOperation" class="headerlink" title="4.1.2 ä½¿ç”¨å­ç±» NSBlockOperation"></a>4.1.2 ä½¿ç”¨å­ç±» NSBlockOperation</h4><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä½¿ç”¨å­ç±» NSBlockOperation</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)useBlockOperation &#123;<br><br>    <span class="hljs-comment">// 1.åˆ›å»º NSBlockOperation å¯¹è±¡</span><br>    <span class="hljs-built_in">NSBlockOperation</span> *op = [<span class="hljs-built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;1---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br><br>    <span class="hljs-comment">// 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span><br>    [op start];<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-bfec9a19f48614b0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><ul><li>å¯ä»¥çœ‹åˆ°ï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨ NSBlockOperation æ‰§è¡Œä¸€ä¸ªæ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ“ä½œæ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚</li></ul><blockquote><p>æ³¨æ„ï¼šå’Œä¸Šè¾¹ NSInvocationOperation ä½¿ç”¨ä¸€æ ·ã€‚å› ä¸ºä»£ç æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨çš„ï¼Œæ‰€ä»¥æ‰“å°ç»“æœä¸ºä¸»çº¿ç¨‹ã€‚å¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™æ‰“å°ç»“æœä¸ºå…¶ä»–çº¿ç¨‹ã€‚</p></blockquote><p>ä½†æ˜¯ï¼ŒNSBlockOperation è¿˜æä¾›äº†ä¸€ä¸ªæ–¹æ³• addExecutionBlock:ï¼Œé€šè¿‡ addExecutionBlock: å°±å¯ä»¥ä¸º NSBlockOperation æ·»åŠ é¢å¤–çš„æ“ä½œã€‚è¿™äº›æ“ä½œï¼ˆåŒ…æ‹¬ blockOperationWithBlock ä¸­çš„æ“ä½œï¼‰å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­åŒæ—¶ï¼ˆå¹¶å‘ï¼‰æ‰§è¡Œã€‚åªæœ‰å½“æ‰€æœ‰ç›¸å…³çš„æ“ä½œå·²ç»å®Œæˆæ‰§è¡Œæ—¶ï¼Œæ‰è§†ä¸ºå®Œæˆã€‚<br><br><br><br><br>å¦‚æœæ·»åŠ çš„æ“ä½œå¤šçš„è¯ï¼ŒblockOperationWithBlock: ä¸­çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶ä»–çº¿ç¨‹ï¼ˆéå½“å‰çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œï¼Œè¿™æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œå¹¶ä¸æ˜¯è¯´æ·»åŠ åˆ° blockOperationWithBlock: ä¸­çš„æ“ä½œä¸€å®šä¼šåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ï¼ˆå¯ä»¥ä½¿ç”¨ addExecutionBlock: å¤šæ·»åŠ å‡ ä¸ªæ“ä½œè¯•è¯•ï¼‰ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä½¿ç”¨å­ç±» NSBlockOperation</span><br><span class="hljs-comment"> * è°ƒç”¨æ–¹æ³• AddExecutionBlock:</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)useBlockOperationAddExecutionBlock &#123;<br><br>    <span class="hljs-comment">// 1.åˆ›å»º NSBlockOperation å¯¹è±¡</span><br>    <span class="hljs-built_in">NSBlockOperation</span> *op = [<span class="hljs-built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;1---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br><br>    <span class="hljs-comment">// 2.æ·»åŠ é¢å¤–çš„æ“ä½œ</span><br>    [op addExecutionBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;2---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [op addExecutionBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;3---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [op addExecutionBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;4---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [op addExecutionBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;5---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [op addExecutionBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;6---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [op addExecutionBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;7---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [op addExecutionBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;8---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br><br>    <span class="hljs-comment">// 3.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span><br>    [op start];<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-86c1302fa13acc83.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><ul><li>å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨å­ç±» NSBlockOperationï¼Œå¹¶è°ƒç”¨æ–¹æ³• AddExecutionBlock: çš„æƒ…å†µä¸‹ï¼ŒblockOperationWithBlock:æ–¹æ³•ä¸­çš„æ“ä½œ å’Œ addExecutionBlock: ä¸­çš„æ“ä½œæ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¼‚æ­¥æ‰§è¡Œçš„ã€‚è€Œä¸”ï¼Œè¿™æ¬¡æ‰§è¡Œç»“æœä¸­ blockOperationWithBlock:æ–¹æ³•ä¸­çš„æ“ä½œä¹Ÿä¸æ˜¯åœ¨å½“å‰çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œçš„ã€‚ä»è€Œå°è¯äº†blockOperationWithBlock: ä¸­çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶ä»–çº¿ç¨‹ï¼ˆéå½“å‰çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œã€‚</li></ul><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ª NSBlockOperation å¯¹è±¡å°è£…äº†å¤šä¸ªæ“ä½œã€‚NSBlockOperation æ˜¯å¦å¼€å¯æ–°çº¿ç¨‹ï¼Œå–å†³äºæ“ä½œçš„ä¸ªæ•°ã€‚å¦‚æœæ·»åŠ çš„æ“ä½œçš„ä¸ªæ•°å¤šï¼Œå°±ä¼šè‡ªåŠ¨å¼€å¯æ–°çº¿ç¨‹ã€‚å½“ç„¶å¼€å¯çš„çº¿ç¨‹æ•°æ˜¯ç”±ç³»ç»Ÿæ¥å†³å®šçš„ã€‚</p><h4 id="4-1-3-ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª-NSOperation-çš„å­ç±»"><a href="#4-1-3-ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª-NSOperation-çš„å­ç±»" class="headerlink" title="4.1.3 ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»"></a>4.1.3 ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»</h4><p>å¦‚æœä½¿ç”¨å­ç±» NSInvocationOperationã€NSBlockOperation ä¸èƒ½æ»¡è¶³æ—¥å¸¸éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ã€‚å¯ä»¥é€šè¿‡é‡å†™ main æˆ–è€… start æ–¹æ³• æ¥å®šä¹‰è‡ªå·±çš„ NSOperation å¯¹è±¡ã€‚é‡å†™mainæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç®¡ç†æ“ä½œçš„çŠ¶æ€å±æ€§ isExecuting å’Œ isFinishedã€‚å½“ main æ‰§è¡Œå®Œè¿”å›çš„æ—¶å€™ï¼Œè¿™ä¸ªæ“ä½œå°±ç»“æŸäº†ã€‚</p><p>å…ˆå®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé‡å†™mainæ–¹æ³•ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">// YSCOperation.h æ–‡ä»¶</span><br><span class="hljs-meta">#import <span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@interface</span> <span class="hljs-title">YSCOperation</span> : <span class="hljs-title">NSOperation</span></span><br><br><span class="hljs-keyword">@end</span><br><br><span class="hljs-comment">// YSCOperation.m æ–‡ä»¶</span><br><span class="hljs-meta">#import <span class="hljs-meta-string">&quot;YSCOperation.h&quot;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">@implementation</span> <span class="hljs-title">YSCOperation</span></span><br><br>- (<span class="hljs-keyword">void</span>)main &#123;<br>    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">self</span>.isCancelled) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>];<br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;1---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">@end</span><br></code></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨çš„æ—¶å€™å¯¼å…¥å¤´æ–‡ä»¶YSCOperation.hã€‚</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)useCustomOperation &#123;<br>    <span class="hljs-comment">// 1.åˆ›å»º YSCOperation å¯¹è±¡</span><br>    YSCOperation *op = [[YSCOperation alloc] <span class="hljs-keyword">init</span>];<br>    <span class="hljs-comment">// 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span><br>    [<span class="hljs-meta">op start</span>];<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-3ed047566df45382.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><ul><li>å¯ä»¥çœ‹å‡ºï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹å•ç‹¬ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»çš„æƒ…å†µä¸‹ï¼Œæ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚</li></ul><p>ä¸‹è¾¹æˆ‘ä»¬æ¥è®²è®² NSOperationQueue çš„åˆ›å»ºã€‚</p><h3 id="4-2-åˆ›å»ºé˜Ÿåˆ—"><a href="#4-2-åˆ›å»ºé˜Ÿåˆ—" class="headerlink" title="4.2 åˆ›å»ºé˜Ÿåˆ—"></a>4.2 åˆ›å»ºé˜Ÿåˆ—</h3><p>NSOperationQueue ä¸€å…±æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—ã€è‡ªå®šä¹‰é˜Ÿåˆ—ã€‚å…¶ä¸­è‡ªå®šä¹‰é˜Ÿåˆ—åŒæ—¶åŒ…å«äº†ä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ã€‚ä¸‹è¾¹æ˜¯ä¸»é˜Ÿåˆ—ã€è‡ªå®šä¹‰é˜Ÿåˆ—çš„åŸºæœ¬åˆ›å»ºæ–¹æ³•å’Œç‰¹ç‚¹ã€‚</p><h4 id="ä¸»é˜Ÿåˆ—"><a href="#ä¸»é˜Ÿåˆ—" class="headerlink" title="ä¸»é˜Ÿåˆ—"></a>ä¸»é˜Ÿåˆ—</h4><ul><li>å‡¡æ˜¯æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œéƒ½ä¼šæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆæ³¨ï¼šä¸åŒ…æ‹¬æ“ä½œä½¿ç”¨addExecutionBlock:æ·»åŠ çš„é¢å¤–æ“ä½œï¼Œé¢å¤–æ“ä½œå¯èƒ½åœ¨å…¶ä»–çº¿ç¨‹æ‰§è¡Œï¼Œæ„Ÿè°¢æŒ‡æ­£ï¼‰ã€‚<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"> <span class="hljs-comment">// ä¸»é˜Ÿåˆ—è·å–æ–¹æ³•</span><br><span class="hljs-built_in">NSOperationQueue</span> *queue = [<span class="hljs-built_in">NSOperationQueue</span> mainQueue];<br></code></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰"><a href="#è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰" class="headerlink" title="è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰"></a>è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰</h4></li><li>æ·»åŠ åˆ°è¿™ç§é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œå°±ä¼šè‡ªåŠ¨æ”¾åˆ°å­çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</li><li>åŒæ—¶åŒ…å«äº†ï¼šä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ã€‚<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">// è‡ªå®šä¹‰é˜Ÿåˆ—åˆ›å»ºæ–¹æ³•</span><br><span class="hljs-type">NSOperationQueue</span> <span class="hljs-operator">*</span>queue <span class="hljs-operator">=</span> [[<span class="hljs-type">NSOperationQueue</span> alloc] <span class="hljs-keyword">init</span>];<br></code></pre></td></tr></table></figure><h3 id="4-3-å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­"><a href="#4-3-å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­" class="headerlink" title="4.3 å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­"></a>4.3 å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­</h3>ä¸Šè¾¹æˆ‘ä»¬è¯´åˆ° NSOperation éœ€è¦é…åˆ NSOperationQueue æ¥å®ç°å¤šçº¿ç¨‹ã€‚</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°†åˆ›å»ºå¥½çš„æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å»ã€‚æ€»å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p>1.- (void)addOperation:(NSOperation *)op;</p><ul><li>éœ€è¦å…ˆåˆ›å»ºæ“ä½œï¼Œå†å°†åˆ›å»ºå¥½çš„æ“ä½œåŠ å…¥åˆ°åˆ›å»ºå¥½çš„é˜Ÿåˆ—ä¸­å»ã€‚<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä½¿ç”¨ addOperation: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—ä¸­</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)addOperationToQueue &#123;<br><br>    <span class="hljs-comment">// 1.åˆ›å»ºé˜Ÿåˆ—</span><br>    <span class="hljs-built_in">NSOperationQueue</span> *queue = [[<span class="hljs-built_in">NSOperationQueue</span> alloc] init];<br><br>    <span class="hljs-comment">// 2.åˆ›å»ºæ“ä½œ</span><br>    <span class="hljs-comment">// ä½¿ç”¨ NSInvocationOperation åˆ›å»ºæ“ä½œ1</span><br>    <span class="hljs-built_in">NSInvocationOperation</span> *op1 = [[<span class="hljs-built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="hljs-keyword">self</span> selector:<span class="hljs-keyword">@selector</span>(task1) object:<span class="hljs-literal">nil</span>];<br><br>    <span class="hljs-comment">// ä½¿ç”¨ NSInvocationOperation åˆ›å»ºæ“ä½œ2</span><br>    <span class="hljs-built_in">NSInvocationOperation</span> *op2 = [[<span class="hljs-built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="hljs-keyword">self</span> selector:<span class="hljs-keyword">@selector</span>(task2) object:<span class="hljs-literal">nil</span>];<br><br>    <span class="hljs-comment">// ä½¿ç”¨ NSBlockOperation åˆ›å»ºæ“ä½œ3</span><br>    <span class="hljs-built_in">NSBlockOperation</span> *op3 = [<span class="hljs-built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;3---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [op3 addExecutionBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;4---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br><br>    <span class="hljs-comment">// 3.ä½¿ç”¨ addOperation: æ·»åŠ æ‰€æœ‰æ“ä½œåˆ°é˜Ÿåˆ—ä¸­</span><br>    [queue addOperation:op1]; <span class="hljs-comment">// [op1 start]</span><br>    [queue addOperation:op2]; <span class="hljs-comment">// [op2 start]</span><br>    [queue addOperation:op3]; <span class="hljs-comment">// [op3 start]</span><br>&#125;<br></code></pre></td></tr></table></figure>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-f31a03ee66c365e5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></li><li>å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ NSOperation å­ç±»åˆ›å»ºæ“ä½œï¼Œå¹¶ä½¿ç”¨ addOperation: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—åèƒ½å¤Ÿå¼€å¯æ–°çº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ‰§è¡Œ.</li></ul><br>2.- (void)addOperationWithBlock:(void (^)(void))block;- æ— éœ€å…ˆåˆ›å»ºæ“ä½œï¼Œåœ¨ block ä¸­æ·»åŠ æ“ä½œï¼Œç›´æ¥å°†åŒ…å«æ“ä½œçš„ block åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä½¿ç”¨ addOperationWithBlock: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—ä¸­</span><br><span class="hljs-comment"> */</span><br><br>- (<span class="hljs-keyword">void</span>)addOperationWithBlockToQueue &#123;<br>    <span class="hljs-comment">// 1.åˆ›å»ºé˜Ÿåˆ—</span><br>    <span class="hljs-built_in">NSOperationQueue</span> *queue = [[<span class="hljs-built_in">NSOperationQueue</span> alloc] init];<br><br>    <span class="hljs-comment">// 2.ä½¿ç”¨ addOperationWithBlock: æ·»åŠ æ“ä½œåˆ°é˜Ÿåˆ—ä¸­</span><br>    [queue addOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;1---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [queue addOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;2---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [queue addOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;3---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-ac8c2cdaf40b4202.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000" alt="60920ddb4ccdca50074568b5ea54679f.jpg"></p><ul><li>å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ addOperationWithBlock: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—åèƒ½å¤Ÿå¼€å¯æ–°çº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚</li></ul><h2 id="5-NSOperationQueue-æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œ"><a href="#5-NSOperationQueue-æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œ" class="headerlink" title="5. NSOperationQueue æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œ"></a>5. NSOperationQueue æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œ</h2><p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒNSOperationQueue åˆ›å»ºçš„è‡ªå®šä¹‰é˜Ÿåˆ—åŒæ—¶å…·æœ‰ä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ï¼Œä¸Šè¾¹æˆ‘ä»¬æ¼”ç¤ºäº†å¹¶å‘åŠŸèƒ½ï¼Œé‚£ä¹ˆä»–çš„ä¸²è¡ŒåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p><p>è¿™é‡Œæœ‰ä¸ªå…³é”®å±æ€§ maxConcurrentOperationCountï¼Œå«åšæœ€å¤§å¹¶å‘æ“ä½œæ•°ã€‚ç”¨æ¥æ§åˆ¶ä¸€ä¸ªç‰¹å®šé˜Ÿåˆ—ä¸­å¯ä»¥æœ‰å¤šå°‘ä¸ªæ“ä½œåŒæ—¶å‚ä¸å¹¶å‘æ‰§è¡Œã€‚</p><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œ maxConcurrentOperationCount æ§åˆ¶çš„ä¸æ˜¯å¹¶å‘çº¿ç¨‹çš„æ•°é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ä¸­åŒæ—¶èƒ½å¹¶å‘æ‰§è¡Œçš„æœ€å¤§æ“ä½œæ•°ã€‚è€Œä¸”ä¸€ä¸ªæ“ä½œä¹Ÿå¹¶éåªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œã€‚</p></blockquote><h4 id="æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼šmaxConcurrentOperationCount"><a href="#æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼šmaxConcurrentOperationCount" class="headerlink" title="æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼šmaxConcurrentOperationCount"></a>æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼šmaxConcurrentOperationCount</h4><ul><li><p>maxConcurrentOperationCount é»˜è®¤æƒ…å†µä¸‹ä¸º-1ï¼Œè¡¨ç¤ºä¸è¿›è¡Œé™åˆ¶ï¼Œå¯è¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚</p></li><li><p>maxConcurrentOperationCount ä¸º1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºä¸²è¡Œé˜Ÿåˆ—ã€‚åªèƒ½ä¸²è¡Œæ‰§è¡Œã€‚</p></li><li><p>maxConcurrentOperationCount å¤§äº1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºå¹¶å‘é˜Ÿåˆ—ã€‚æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œå½“ç„¶è¿™ä¸ªå€¼ä¸åº”è¶…è¿‡ç³»ç»Ÿé™åˆ¶ï¼Œå³ä½¿è‡ªå·±è®¾ç½®ä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨è°ƒæ•´ä¸º min{è‡ªå·±è®¾å®šçš„å€¼ï¼Œç³»ç»Ÿè®¾å®šçš„é»˜è®¤æœ€å¤§å€¼}ã€‚</p></li></ul><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è®¾ç½® MaxConcurrentOperationCountï¼ˆæœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼‰</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)setMaxConcurrentOperationCount &#123;<br><br>    <span class="hljs-comment">// 1.åˆ›å»ºé˜Ÿåˆ—</span><br>    <span class="hljs-built_in">NSOperationQueue</span> *queue = [[<span class="hljs-built_in">NSOperationQueue</span> alloc] init];<br><br>    <span class="hljs-comment">// 2.è®¾ç½®æœ€å¤§å¹¶å‘æ“ä½œæ•°</span><br>    queue.maxConcurrentOperationCount = <span class="hljs-number">1</span>; <span class="hljs-comment">// ä¸²è¡Œé˜Ÿåˆ—</span><br><span class="hljs-comment">// queue.maxConcurrentOperationCount = 2; // å¹¶å‘é˜Ÿåˆ—</span><br><span class="hljs-comment">// queue.maxConcurrentOperationCount = 8; // å¹¶å‘é˜Ÿåˆ—</span><br><br>    <span class="hljs-comment">// 3.æ·»åŠ æ“ä½œ</span><br>    [queue addOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;1---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [queue addOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;2---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [queue addOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;3---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    [queue addOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;4---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º1 è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-79e0996ee294d434.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000"></p></li><li><p>æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º2 è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-c4f7ac2202fcb871.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000"></p></li><li><p>å¯ä»¥çœ‹å‡ºï¼šå½“æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º1æ—¶ï¼Œæ“ä½œæ˜¯æŒ‰é¡ºåºä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¹¶ä¸”ä¸€ä¸ªæ“ä½œå®Œæˆä¹‹åï¼Œä¸‹ä¸€ä¸ªæ“ä½œæ‰å¼€å§‹æ‰§è¡Œã€‚å½“æœ€å¤§æ“ä½œå¹¶å‘æ•°ä¸º2æ—¶ï¼Œæ“ä½œæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œä¸¤ä¸ªæ“ä½œã€‚è€Œå¼€å¯çº¿ç¨‹æ•°é‡æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œä¸éœ€è¦æˆ‘ä»¬æ¥ç®¡ç†ã€‚</p></li></ul><p>è¿™æ ·çœ‹æ¥ï¼Œæ˜¯ä¸æ˜¯æ¯” GCD è¿˜è¦ç®€å•äº†è®¸å¤šï¼Ÿ</p><h2 id="6-NSOperation-æ“ä½œä¾èµ–"><a href="#6-NSOperation-æ“ä½œä¾èµ–" class="headerlink" title="6. NSOperation æ“ä½œä¾èµ–"></a>6. NSOperation æ“ä½œä¾èµ–</h2><p>NSOperationã€NSOperationQueue æœ€å¸å¼•äººçš„åœ°æ–¹æ˜¯å®ƒèƒ½æ·»åŠ æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚é€šè¿‡æ“ä½œä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ§åˆ¶æ“ä½œä¹‹é—´çš„æ‰§è¡Œå…ˆåé¡ºåºã€‚NSOperation æä¾›äº†3ä¸ªæ¥å£ä¾›æˆ‘ä»¬ç®¡ç†å’ŒæŸ¥çœ‹ä¾èµ–ã€‚</p><blockquote><ul><li>(void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚</li></ul></blockquote><blockquote><ul><li>(void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚</li></ul></blockquote><blockquote><p>@property (readonly, copy) NSArray&lt;NSOperation *&gt; *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚</p></blockquote><p>å½“ç„¶ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„è¿˜æ˜¯æ·»åŠ ä¾èµ–æ“ä½œã€‚ç°åœ¨è€ƒè™‘è¿™æ ·çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¯´æœ‰ Aã€B ä¸¤ä¸ªæ“ä½œï¼Œå…¶ä¸­ A æ‰§è¡Œå®Œæ“ä½œï¼ŒB æ‰èƒ½æ‰§è¡Œæ“ä½œã€‚</p><p>å¦‚æœä½¿ç”¨ä¾èµ–æ¥å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦è®©æ“ä½œ B ä¾èµ–äºæ“ä½œ Aã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ“ä½œä¾èµ–</span><br><span class="hljs-comment"> * ä½¿ç”¨æ–¹æ³•ï¼šaddDependency:</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)addDependency &#123;<br><br>    <span class="hljs-comment">// 1.åˆ›å»ºé˜Ÿåˆ—</span><br>    <span class="hljs-built_in">NSOperationQueue</span> *queue = [[<span class="hljs-built_in">NSOperationQueue</span> alloc] init];<br><br>    <span class="hljs-comment">// 2.åˆ›å»ºæ“ä½œ</span><br>    <span class="hljs-built_in">NSBlockOperation</span> *op1 = [<span class="hljs-built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;1---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br>    <span class="hljs-built_in">NSBlockOperation</span> *op2 = [<span class="hljs-built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;2---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br>    &#125;];<br><br>    <span class="hljs-comment">// 3.æ·»åŠ ä¾èµ–</span><br>    [op2 addDependency:op1]; <span class="hljs-comment">// è®©op2 ä¾èµ–äº op1ï¼Œåˆ™å…ˆæ‰§è¡Œop1ï¼Œåœ¨æ‰§è¡Œop2</span><br><br>    <span class="hljs-comment">// 4.æ·»åŠ æ“ä½œåˆ°é˜Ÿåˆ—ä¸­</span><br>    [queue addOperation:op1];<br>    [queue addOperation:op2];<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-c0ce9c8c762ea71b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000"></p><ul><li>å¯ä»¥çœ‹åˆ°ï¼šé€šè¿‡æ·»åŠ æ“ä½œä¾èµ–ï¼Œæ— è®ºè¿è¡Œå‡ æ¬¡ï¼Œå…¶ç»“æœéƒ½æ˜¯ op1 å…ˆæ‰§è¡Œï¼Œop2 åæ‰§è¡Œã€‚</li></ul><h2 id="7-NSOperation-ä¼˜å…ˆçº§"><a href="#7-NSOperation-ä¼˜å…ˆçº§" class="headerlink" title="7. NSOperation ä¼˜å…ˆçº§"></a>7. NSOperation ä¼˜å…ˆçº§</h2><p>NSOperation æä¾›äº†queuePriorityï¼ˆä¼˜å…ˆçº§ï¼‰å±æ€§ï¼ŒqueuePriorityå±æ€§é€‚ç”¨äºåŒä¸€æ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œä¸é€‚ç”¨äºä¸åŒæ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„æ“ä½œå¯¹è±¡ä¼˜å…ˆçº§éƒ½æ˜¯NSOperationQueuePriorityNormalã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡setQueuePriority:æ–¹æ³•æ¥æ”¹å˜å½“å‰æ“ä½œåœ¨åŒä¸€é˜Ÿåˆ—ä¸­çš„æ‰§è¡Œä¼˜å…ˆçº§ã€‚</p><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs elm">// ä¼˜å…ˆçº§çš„å–å€¼<br>typedef <span class="hljs-type">NS_ENUM</span>(<span class="hljs-type">NSInteger</span>, <span class="hljs-type">NSOperationQueuePriority</span>) &#123;<br>    <span class="hljs-type">NSOperationQueuePriorityVeryLow</span> = -8L,<br>    <span class="hljs-type">NSOperationQueuePriorityLow</span> = -4L,<br>    <span class="hljs-type">NSOperationQueuePriorityNormal</span> = 0,<br>    <span class="hljs-type">NSOperationQueuePriorityHigh</span> = 4,<br>    <span class="hljs-type">NSOperationQueuePriorityVeryHigh</span> = 8<br>&#125;;<br></code></pre></td></tr></table></figure><p>ä¸Šè¾¹æˆ‘ä»¬è¯´è¿‡ï¼šå¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œé¦–å…ˆè¿›å…¥å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€å–å†³äºæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œçš„å¼€å§‹æ‰§è¡Œé¡ºåºï¼ˆéç»“æŸæ‰§è¡Œé¡ºåºï¼‰ç”±æ“ä½œä¹‹é—´ç›¸å¯¹çš„ä¼˜å…ˆçº§å†³å®šï¼ˆä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡è‡ªèº«çš„å±æ€§ï¼‰ã€‚</p><h5 id="é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ"></a>é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ</h5><ul><li>å½“ä¸€ä¸ªæ“ä½œçš„æ‰€æœ‰ä¾èµ–éƒ½å·²ç»å®Œæˆæ—¶ï¼Œæ“ä½œå¯¹è±¡é€šå¸¸ä¼šè¿›å…¥å‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…æ‰§è¡Œã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰4ä¸ªä¼˜å…ˆçº§éƒ½æ˜¯ NSOperationQueuePriorityNormalï¼ˆé»˜è®¤çº§åˆ«ï¼‰çš„æ“ä½œï¼šop1ï¼Œop2ï¼Œop3ï¼Œop4ã€‚å…¶ä¸­ op3 ä¾èµ–äº op2ï¼Œop2 ä¾èµ–äº op1ï¼Œå³ op3 -&gt; op2 -&gt; op1ã€‚ç°åœ¨å°†è¿™4ä¸ªæ“ä½œæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å¹¶å‘æ‰§è¡Œã€‚</p><ul><li>å› ä¸º op1 å’Œ op4 éƒ½æ²¡æœ‰éœ€è¦ä¾èµ–çš„æ“ä½œï¼Œæ‰€ä»¥åœ¨ op1ï¼Œop4 æ‰§è¡Œä¹‹å‰ï¼Œå°±æ˜¯å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€çš„æ“ä½œã€‚</li><li>è€Œ op3 å’Œ op2 éƒ½æœ‰ä¾èµ–çš„æ“ä½œï¼ˆop3 ä¾èµ–äº op2ï¼Œop2 ä¾èµ–äº op1ï¼‰ï¼Œæ‰€ä»¥ op3 å’Œ op2 éƒ½ä¸æ˜¯å‡†å¤‡å°±ç»ªçŠ¶æ€ä¸‹çš„æ“ä½œã€‚</li></ul><p>ç†è§£äº†è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç†è§£äº†queuePriority å±æ€§çš„ä½œç”¨å¯¹è±¡ã€‚</p><ul><li>queuePriority å±æ€§å†³å®šäº†è¿›å…¥å‡†å¤‡å°±ç»ªçŠ¶æ€ä¸‹çš„æ“ä½œä¹‹é—´çš„å¼€å§‹æ‰§è¡Œé¡ºåºã€‚å¹¶ä¸”ï¼Œä¼˜å…ˆçº§ä¸èƒ½å–ä»£ä¾èµ–å…³ç³»ã€‚</li><li>å¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­æ—¢åŒ…å«é«˜ä¼˜å…ˆçº§æ“ä½œï¼ŒåˆåŒ…å«ä½ä¼˜å…ˆçº§æ“ä½œï¼Œå¹¶ä¸”ä¸¤ä¸ªæ“ä½œéƒ½å·²ç»å‡†å¤‡å°±ç»ªï¼Œé‚£ä¹ˆé˜Ÿåˆ—å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§æ“ä½œã€‚æ¯”å¦‚ä¸Šä¾‹ä¸­ï¼Œå¦‚æœ op1 å’Œ op4 æ˜¯ä¸åŒä¼˜å…ˆçº§çš„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå…ˆæ‰§è¡Œä¼˜å…ˆçº§é«˜çš„æ“ä½œã€‚</li><li>å¦‚æœï¼Œä¸€ä¸ªé˜Ÿåˆ—ä¸­æ—¢åŒ…å«äº†å‡†å¤‡å°±ç»ªçŠ¶æ€çš„æ“ä½œï¼ŒåˆåŒ…å«äº†æœªå‡†å¤‡å°±ç»ªçš„æ“ä½œï¼Œæœªå‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§æ¯”å‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§é«˜ã€‚é‚£ä¹ˆï¼Œè™½ç„¶å‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§ä½ï¼Œä¹Ÿä¼šä¼˜å…ˆæ‰§è¡Œã€‚ä¼˜å…ˆçº§ä¸èƒ½å–ä»£ä¾èµ–å…³ç³»ã€‚å¦‚æœè¦æ§åˆ¶æ“ä½œé—´çš„å¯åŠ¨é¡ºåºï¼Œåˆ™å¿…é¡»ä½¿ç”¨ä¾èµ–å…³ç³»ã€‚</li></ul><h2 id="8-NSOperationã€NSOperationQueue-çº¿ç¨‹é—´çš„é€šä¿¡"><a href="#8-NSOperationã€NSOperationQueue-çº¿ç¨‹é—´çš„é€šä¿¡" class="headerlink" title="8. NSOperationã€NSOperationQueue çº¿ç¨‹é—´çš„é€šä¿¡"></a>8. NSOperationã€NSOperationQueue çº¿ç¨‹é—´çš„é€šä¿¡</h2><p>åœ¨ iOS å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¸»çº¿ç¨‹é‡Œè¾¹è¿›è¡Œ UI åˆ·æ–°ï¼Œä¾‹å¦‚ï¼šç‚¹å‡»ã€æ»šåŠ¨ã€æ‹–æ‹½ç­‰äº‹ä»¶ã€‚æˆ‘ä»¬é€šå¸¸æŠŠä¸€äº›è€—æ—¶çš„æ“ä½œæ”¾åœ¨å…¶ä»–çº¿ç¨‹ï¼Œæ¯”å¦‚è¯´å›¾ç‰‡ä¸‹è½½ã€æ–‡ä»¶ä¸Šä¼ ç­‰è€—æ—¶æ“ä½œã€‚è€Œå½“æˆ‘ä»¬æœ‰æ—¶å€™åœ¨å…¶ä»–çº¿ç¨‹å®Œæˆäº†è€—æ—¶æ“ä½œæ—¶ï¼Œéœ€è¦å›åˆ°ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç”¨åˆ°äº†çº¿ç¨‹ä¹‹é—´çš„é€šè®¯ã€‚</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * çº¿ç¨‹é—´é€šä¿¡</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)communication &#123;<br><br>    <span class="hljs-comment">// 1.åˆ›å»ºé˜Ÿåˆ—</span><br>    <span class="hljs-built_in">NSOperationQueue</span> *queue = [[<span class="hljs-built_in">NSOperationQueue</span> alloc]init];<br><br>    <span class="hljs-comment">// 2.æ·»åŠ æ“ä½œ</span><br>    [queue addOperationWithBlock:^&#123;<br>        <span class="hljs-comment">// å¼‚æ­¥è¿›è¡Œè€—æ—¶æ“ä½œ</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;1---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>        &#125;<br><br>        <span class="hljs-comment">// å›åˆ°ä¸»çº¿ç¨‹</span><br>        [[<span class="hljs-built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;<br>            <span class="hljs-comment">// è¿›è¡Œä¸€äº› UI åˆ·æ–°ç­‰æ“ä½œ</span><br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++) &#123;<br>                [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">2</span>]; <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>                <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;2---%@&quot;</span>, [<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br>            &#125;<br>        &#125;];<br>    &#125;];<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-c284bc79994a08dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000"></p><ul><li>å¯ä»¥çœ‹åˆ°ï¼šé€šè¿‡çº¿ç¨‹é—´çš„é€šä¿¡ï¼Œå…ˆåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œç­‰æ“ä½œæ‰§è¡Œå®Œäº†ä¹‹åå†å›åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œä¸»çº¿ç¨‹çš„ç›¸åº”æ“ä½œã€‚</li></ul><h2 id="9-NSOperationã€NSOperationQueue-çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨"><a href="#9-NSOperationã€NSOperationQueue-çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨" class="headerlink" title="9. NSOperationã€NSOperationQueue çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨"></a>9. NSOperationã€NSOperationQueue çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨</h2><h4 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h4><p>å¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<br>è‹¥æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹å…¨å±€å˜é‡ã€é™æ€å˜é‡åªæœ‰è¯»æ“ä½œï¼Œè€Œæ— å†™æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªå…¨å±€å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå†™æ“ä½œï¼ˆæ›´æ”¹å˜é‡ï¼‰ï¼Œä¸€èˆ¬éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œå¦åˆ™çš„è¯å°±å¯èƒ½å½±å“çº¿ç¨‹å®‰å…¨ã€‚</p><h4 id="çº¿ç¨‹åŒæ­¥"><a href="#çº¿ç¨‹åŒæ­¥" class="headerlink" title="çº¿ç¨‹åŒæ­¥"></a>çº¿ç¨‹åŒæ­¥</h4><p>å¯ç†è§£ä¸ºçº¿ç¨‹ A å’Œ çº¿ç¨‹ B ä¸€å—é…åˆï¼ŒA æ‰§è¡Œåˆ°ä¸€å®šç¨‹åº¦æ—¶è¦ä¾é çº¿ç¨‹ B çš„æŸä¸ªç»“æœï¼Œäºæ˜¯åœä¸‹æ¥ï¼Œç¤ºæ„ B è¿è¡Œï¼›B ä¾è¨€æ‰§è¡Œï¼Œå†å°†ç»“æœç»™ Aï¼›A å†ç»§ç»­æ“ä½œã€‚</p><p>ä¸¾ä¸ªç®€å•ä¾‹å­å°±æ˜¯ï¼šä¸¤ä¸ªäººåœ¨ä¸€èµ·èŠå¤©ã€‚ä¸¤ä¸ªäººä¸èƒ½åŒæ—¶è¯´è¯ï¼Œé¿å…å¬ä¸æ¸…(æ“ä½œå†²çª)ã€‚ç­‰ä¸€ä¸ªäººè¯´å®Œ(ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ“ä½œ)ï¼Œå¦ä¸€ä¸ªå†è¯´(å¦ä¸€ä¸ªçº¿ç¨‹å†å¼€å§‹æ“ä½œ)ã€‚<br>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿç«è½¦ç¥¨å”®å–çš„æ–¹å¼ï¼Œå®ç° NSOperation çº¿ç¨‹å®‰å…¨å’Œè§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚<br>åœºæ™¯ï¼šæ€»å…±æœ‰50å¼ ç«è½¦ç¥¨ï¼Œæœ‰ä¸¤ä¸ªå”®å–ç«è½¦ç¥¨çš„çª—å£ï¼Œä¸€ä¸ªæ˜¯åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ã€‚ä¸¤ä¸ªçª—å£åŒæ—¶å”®å–ç«è½¦ç¥¨ï¼Œå–å®Œä¸ºæ­¢ã€‚</p><h3 id="9-1-NSOperationã€NSOperationQueue-éçº¿ç¨‹å®‰å…¨"><a href="#9-1-NSOperationã€NSOperationQueue-éçº¿ç¨‹å®‰å…¨" class="headerlink" title="9.1 NSOperationã€NSOperationQueue éçº¿ç¨‹å®‰å…¨"></a>9.1 NSOperationã€NSOperationQueue éçº¿ç¨‹å®‰å…¨</h3><p>å…ˆæ¥çœ‹çœ‹ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * éçº¿ç¨‹å®‰å…¨ï¼šä¸ä½¿ç”¨ NSLock</span><br><span class="hljs-comment"> * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(éçº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)initTicketStatusNotSave &#123;<br>    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;currentThread---%@&quot;</span>,[<span class="hljs-built_in">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br><br>    <span class="hljs-keyword">self</span>.ticketSurplusCount = <span class="hljs-number">50</span>;<br><br>    <span class="hljs-comment">// 1.åˆ›å»º queue1,queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£</span><br>    <span class="hljs-built_in">NSOperationQueue</span> *queue1 = [[<span class="hljs-built_in">NSOperationQueue</span> alloc] init];<br>    queue1.maxConcurrentOperationCount = <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// 2.åˆ›å»º queue2,queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£</span><br>    <span class="hljs-built_in">NSOperationQueue</span> *queue2 = [[<span class="hljs-built_in">NSOperationQueue</span> alloc] init];<br>    queue2.maxConcurrentOperationCount = <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// 3.åˆ›å»ºå–ç¥¨æ“ä½œ op1</span><br>    <span class="hljs-built_in">NSBlockOperation</span> *op1 = [<span class="hljs-built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;<br>        [<span class="hljs-keyword">self</span> saleTicketNotSafe];<br>    &#125;];<br><br>    <span class="hljs-comment">// 4.åˆ›å»ºå–ç¥¨æ“ä½œ op2</span><br>    <span class="hljs-built_in">NSBlockOperation</span> *op2 = [<span class="hljs-built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;<br>        [<span class="hljs-keyword">self</span> saleTicketNotSafe];<br>    &#125;];<br><br>    <span class="hljs-comment">// 5.æ·»åŠ æ“ä½œï¼Œå¼€å§‹å–ç¥¨</span><br>    [queue1 addOperation:op1];<br>    [queue2 addOperation:op2];<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å”®å–ç«è½¦ç¥¨(éçº¿ç¨‹å®‰å…¨)</span><br><span class="hljs-comment"> */</span><br>- (<span class="hljs-keyword">void</span>)saleTicketNotSafe &#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.ticketSurplusCount &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–</span><br>            <span class="hljs-keyword">self</span>.ticketSurplusCount--;<br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;%@&quot;</span>, [<span class="hljs-built_in">NSString</span> stringWithFormat:<span class="hljs-string">@&quot;å‰©ä½™ç¥¨æ•°:%d çª—å£:%@&quot;</span>, <span class="hljs-keyword">self</span>.ticketSurplusCount, [<span class="hljs-built_in">NSThread</span> currentThread]]);<br>            [<span class="hljs-built_in">NSThread</span> sleepForTimeInterval:<span class="hljs-number">0.2</span>];<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/1877784-e4a2e86c0523d4c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000"></p><p>çœç•¥ä¸€éƒ¨åˆ†ç»“æœå›¾ã€‚ã€‚ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/1877784-4a354394f006929f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000"></p><blockquote><p>å¯ä»¥çœ‹åˆ°ï¼šåœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œä¸ä½¿ç”¨ NSLock æƒ…å†µä¸‹ï¼Œå¾—åˆ°ç¥¨æ•°æ˜¯é”™ä¹±çš„ï¼Œè¿™æ ·æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p></blockquote><h3 id="9-2-NSOperationã€NSOperationQueue-çº¿ç¨‹å®‰å…¨"><a href="#9-2-NSOperationã€NSOperationQueue-çº¿ç¨‹å®‰å…¨" class="headerlink" title="9.2 NSOperationã€NSOperationQueue çº¿ç¨‹å®‰å…¨"></a>9.2 NSOperationã€NSOperationQueue çº¿ç¨‹å®‰å…¨</h3><p>çº¿ç¨‹å®‰å…¨è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥ç»™çº¿ç¨‹åŠ é”ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ“ä½œçš„æ—¶å€™ï¼Œä¸å…è®¸å…¶ä»–çº¿ç¨‹è¿›è¡Œæ“ä½œã€‚iOS å®ç°çº¿ç¨‹åŠ é”æœ‰å¾ˆå¤šç§æ–¹å¼ã€‚@synchronizedã€ NSLockã€NSRecursiveLockã€NSConditionã€NSConditionLockã€pthread_mutexã€dispatch_semaphoreã€OSSpinLockã€atomic(property) set/geç­‰ç­‰å„ç§æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ NSLock å¯¹è±¡æ¥è§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚NSLock å¯¹è±¡å¯ä»¥é€šè¿‡è¿›å…¥é”æ—¶è°ƒç”¨ lock æ–¹æ³•ï¼Œè§£é”æ—¶è°ƒç”¨ unlock æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<br>è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs swift"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ NSLock åŠ é”</span><br><span class="hljs-comment"> * åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(çº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-operator">-</span> (void)initTicketStatusSave &#123;<br>    <span class="hljs-type">NSLog</span>(@<span class="hljs-string">&quot;currentThread---%@&quot;</span>,[<span class="hljs-type">NSThread</span> currentThread]); <span class="hljs-comment">// æ‰“å°å½“å‰çº¿ç¨‹</span><br><br>    <span class="hljs-keyword">self</span>.ticketSurplusCount <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;<br><br>    <span class="hljs-keyword">self</span>.lock <span class="hljs-operator">=</span> [[<span class="hljs-type">NSLock</span> alloc] <span class="hljs-keyword">init</span>];  <span class="hljs-comment">// åˆå§‹åŒ– NSLock å¯¹è±¡</span><br><br>    <span class="hljs-comment">// 1.åˆ›å»º queue1,queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£</span><br>    <span class="hljs-type">NSOperationQueue</span> <span class="hljs-operator">*</span>queue1 <span class="hljs-operator">=</span> [[<span class="hljs-type">NSOperationQueue</span> alloc] <span class="hljs-keyword">init</span>];<br>    queue1.maxConcurrentOperationCount <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// 2.åˆ›å»º queue2,queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£</span><br>    <span class="hljs-type">NSOperationQueue</span> <span class="hljs-operator">*</span>queue2 <span class="hljs-operator">=</span> [[<span class="hljs-type">NSOperationQueue</span> alloc] <span class="hljs-keyword">init</span>];<br>    queue2.maxConcurrentOperationCount <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-comment">// 3.åˆ›å»ºå–ç¥¨æ“ä½œ op1</span><br>    <span class="hljs-type">NSBlockOperation</span> <span class="hljs-operator">*</span>op1 <span class="hljs-operator">=</span> [<span class="hljs-type">NSBlockOperation</span> blockOperationWithBlock:<span class="hljs-operator">^</span>&#123;<br>        [<span class="hljs-keyword">self</span> saleTicketSafe];<br>    &#125;];<br><br>    <span class="hljs-comment">// 4.åˆ›å»ºå–ç¥¨æ“ä½œ op2</span><br>    <span class="hljs-type">NSBlockOperation</span> <span class="hljs-operator">*</span>op2 <span class="hljs-operator">=</span> [<span class="hljs-type">NSBlockOperation</span> blockOperationWithBlock:<span class="hljs-operator">^</span>&#123;<br>        [<span class="hljs-keyword">self</span> saleTicketSafe];<br>    &#125;];<br><br>    <span class="hljs-comment">// 5.æ·»åŠ æ“ä½œï¼Œå¼€å§‹å–ç¥¨</span><br>    [queue1 addOperation:op1];<br>    [queue2 addOperation:op2];<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å”®å–ç«è½¦ç¥¨(çº¿ç¨‹å®‰å…¨)</span><br><span class="hljs-comment"> */</span><br><span class="hljs-operator">-</span> (void)saleTicketSafe &#123;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br><br>        <span class="hljs-comment">// åŠ é”</span><br>        [<span class="hljs-keyword">self</span>.lock lock];<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.ticketSurplusCount <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">//å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–</span><br>            <span class="hljs-keyword">self</span>.ticketSurplusCount<span class="hljs-operator">--</span>;<br>            <span class="hljs-type">NSLog</span>(@<span class="hljs-string">&quot;%@&quot;</span>, [<span class="hljs-type">NSString</span> stringWithFormat:@<span class="hljs-string">&quot;å‰©ä½™ç¥¨æ•°:%d çª—å£:%@&quot;</span>, <span class="hljs-keyword">self</span>.ticketSurplusCount, [<span class="hljs-type">NSThread</span> currentThread]]);<br>            [<span class="hljs-type">NSThread</span> sleepForTimeInterval:<span class="hljs-number">0.2</span>];<br>        &#125;<br><br>        <span class="hljs-comment">// è§£é”</span><br>        [<span class="hljs-keyword">self</span>.lock unlock];<br><br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>.ticketSurplusCount <span class="hljs-operator">&lt;=</span> <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-type">NSLog</span>(@<span class="hljs-string">&quot;æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/1877784-7bffb9eade5887d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000"></p><p>çœç•¥ä¸€éƒ¨åˆ†ç»“æœå›¾ã€‚ã€‚ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/1877784-6698fdd0d10b0d14.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000"></p><blockquote><p>å¯ä»¥çœ‹å‡ºï¼šåœ¨è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨ NSLock åŠ é”ã€è§£é”æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°çš„ç¥¨æ•°æ˜¯æ­£ç¡®çš„ï¼Œæ²¡æœ‰å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚æˆ‘ä»¬ä¹Ÿå°±è§£å†³äº†å¤šä¸ªçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚</p></blockquote><h2 id="10-NSOperationã€NSOperationQueue-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³"><a href="#10-NSOperationã€NSOperationQueue-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³" class="headerlink" title="10. NSOperationã€NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³"></a>10. NSOperationã€NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³</h2><h3 id="10-1-NSOperation-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•"><a href="#10-1-NSOperation-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•" class="headerlink" title="10.1 NSOperation å¸¸ç”¨å±æ€§å’Œæ–¹æ³•"></a>10.1 NSOperation å¸¸ç”¨å±æ€§å’Œæ–¹æ³•</h3><p>1ã€å–æ¶ˆæ“ä½œæ–¹æ³•</p><ul><li>-(void)cancel; å¯å–æ¶ˆæ“ä½œï¼Œå®è´¨æ˜¯æ ‡è®° isCancelled çŠ¶æ€ã€‚</li></ul><p>2ã€åˆ¤æ–­æ“ä½œçŠ¶æ€æ–¹æ³•</p><ul><li><p>-(BOOL)isFinished; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»ç»“æŸã€‚</p></li><li><p>-(BOOL)isCancelled; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»æ ‡è®°ä¸ºå–æ¶ˆã€‚</p></li><li><p>-(BOOL)isExecuting; åˆ¤æ–­æ“ä½œæ˜¯å¦æ­£åœ¨åœ¨è¿è¡Œã€‚</p></li><li><p>-(BOOL)isReady; åˆ¤æ–­æ“ä½œæ˜¯å¦å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œè¿™ä¸ªå€¼å’Œæ“ä½œçš„ä¾èµ–å…³ç³»ç›¸å…³ã€‚</p></li></ul><p>3ã€æ“ä½œåŒæ­¥</p><ul><li><p>-(void)waitUntilFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¯¥æ“ä½œç»“æŸã€‚å¯ç”¨äºçº¿ç¨‹æ‰§è¡Œé¡ºåºçš„åŒæ­¥ã€‚</p></li><li><p>-(void)setCompletionBlock:(void (^)(void))block; completionBlock ä¼šåœ¨å½“å‰æ“ä½œæ‰§è¡Œå®Œæ¯•æ—¶æ‰§è¡Œ completionBlockã€‚</p></li><li><p>-(void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚</p></li><li><p>-(void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚</p></li><li><p>@property (readonly, copy) NSArray&lt;NSOperation *&gt; *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚</p></li></ul><h3 id="10-2-NSOperationQueue-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•"><a href="#10-2-NSOperationQueue-å¸¸ç”¨å±æ€§å’Œæ–¹æ³•" class="headerlink" title="10.2 NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•"></a>10.2 NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•</h3><p>1ã€å–æ¶ˆ/æš‚åœ/æ¢å¤æ“ä½œ</p><ul><li><p>-(void)cancelAllOperations; å¯ä»¥å–æ¶ˆé˜Ÿåˆ—çš„æ‰€æœ‰æ“ä½œã€‚</p></li><li><p>-(BOOL)isSuspended; åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å¤„äºæš‚åœçŠ¶æ€ã€‚ YES ä¸ºæš‚åœçŠ¶æ€ï¼ŒNO ä¸ºæ¢å¤çŠ¶æ€ã€‚</p></li><li><p>-(void)setSuspended:(BOOL)b; å¯è®¾ç½®æ“ä½œçš„æš‚åœå’Œæ¢å¤ï¼ŒYES ä»£è¡¨æš‚åœé˜Ÿåˆ—ï¼ŒNO ä»£è¡¨æ¢å¤é˜Ÿåˆ—ã€‚</p></li></ul><p>2ã€æ“ä½œåŒæ­¥</p><ul><li>-(void)waitUntilAllOperationsAreFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œå…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚</li></ul><p>3ã€æ·»åŠ /è·å–æ“ä½œ</p><ul><li><p>-(void)addOperationWithBlock:(void (^)(void))block; å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ª NSBlockOperation ç±»å‹æ“ä½œå¯¹è±¡ã€‚</p></li><li><p>-(void)addOperations:(NSArray *)ops waitUntilFinished:(BOOL)wait; å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ“ä½œæ•°ç»„ï¼Œwait æ ‡å¿—æ˜¯å¦é˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°æ‰€æœ‰æ“ä½œç»“æŸ</p></li><li><p>-(NSArray *)operations; å½“å‰åœ¨é˜Ÿåˆ—ä¸­çš„æ“ä½œæ•°ç»„ï¼ˆæŸä¸ªæ“ä½œæ‰§è¡Œç»“æŸåä¼šè‡ªåŠ¨ä»è¿™ä¸ªæ•°ç»„æ¸…é™¤ï¼‰ã€‚</p></li><li><p>-(NSUInteger)operationCount; å½“å‰é˜Ÿåˆ—ä¸­çš„æ“ä½œæ•°ã€‚</p></li></ul><p>4ã€è·å–é˜Ÿåˆ—</p><ul><li>+(id)currentQueue; è·å–å½“å‰é˜Ÿåˆ—ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯åœ¨ NSOperationQueue ä¸Šè¿è¡Œåˆ™è¿”å› nilã€‚</li><li>-(id)mainQueue; è·å–ä¸»é˜Ÿåˆ—ã€‚<blockquote><p>æ³¨æ„ï¼š</p><p>è¿™é‡Œçš„æš‚åœå’Œå–æ¶ˆï¼ˆåŒ…æ‹¬æ“ä½œçš„å–æ¶ˆå’Œé˜Ÿåˆ—çš„å–æ¶ˆï¼‰å¹¶ä¸ä»£è¡¨å¯ä»¥å°†å½“å‰çš„æ“ä½œç«‹å³å–æ¶ˆï¼Œè€Œæ˜¯å½“å½“å‰çš„æ“ä½œæ‰§è¡Œå®Œæ¯•ä¹‹åä¸å†æ‰§è¡Œæ–°çš„æ“ä½œã€‚<br>æš‚åœå’Œå–æ¶ˆçš„åŒºåˆ«å°±åœ¨äºï¼šæš‚åœæ“ä½œä¹‹åè¿˜å¯ä»¥æ¢å¤æ“ä½œï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›è€Œå–æ¶ˆæ“ä½œä¹‹åï¼Œæ‰€æœ‰çš„æ“ä½œå°±æ¸…ç©ºäº†ï¼Œæ— æ³•å†æ¥ç€æ‰§è¡Œå‰©ä¸‹çš„æ“ä½œã€‚</p></blockquote></li></ul>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>å¤šçº¿ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¤šçº¿ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOS åŠ¨ç”»-CAAniamtionçš„å±æ€§å’Œä½¿ç”¨</title>
    <link href="/2019/01/01/iOS%E5%8A%A8%E7%94%BB-CAAniamtion%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
    <url>/2019/01/01/iOS%E5%8A%A8%E7%94%BB-CAAniamtion%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<h2 id="CAAnimation"><a href="#CAAnimation" class="headerlink" title="CAAnimation"></a>CAAnimation</h2><p>CAAnimationæ˜¯æ‰€æœ‰åŠ¨ç”»å¯¹è±¡çš„çˆ¶ç±»ï¼Œè´Ÿè´£æ§åˆ¶åŠ¨ç”»çš„æŒç»­æ—¶é—´å’Œé€Ÿåº¦ï¼Œæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œåº”è¯¥ä½¿ç”¨å®ƒå…·ä½“çš„å­ç±»ã€‚</p><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><blockquote><ul><li><p>durationï¼šåŠ¨ç”»çš„æŒç»­æ—¶é—´</p></li><li><p>repeatCountï¼šåŠ¨ç”»çš„é‡å¤æ¬¡æ•°</p></li><li><p>repeatDurationï¼šåŠ¨ç”»çš„é‡å¤æ—¶é—´</p></li><li><p>removedOnCompletionï¼šé»˜è®¤ä¸ºYESï¼Œä»£è¡¨åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åå°±ä»å›¾å±‚ä¸Šç§»é™¤ï¼Œå›¾å½¢ä¼šæ¢å¤åˆ°åŠ¨ç”»æ‰§è¡Œå‰çš„çŠ¶æ€ã€‚å¦‚æœæƒ³è®©å›¾å±‚ä¿æŒæ˜¾ç¤ºåŠ¨ç”»æ‰§è¡Œåçš„çŠ¶æ€ï¼Œé‚£å°±è®¾ç½®ä¸ºNOï¼Œä¸è¿‡è¿˜è¦è®¾ç½®fillModeä¸ºkCAFillModeForwards</p></li><li><p>fillModeï¼šå†³å®šå½“å‰å¯¹è±¡åœ¨éactiveæ—¶é—´æ®µçš„è¡Œä¸ºã€‚æ¯”å¦‚åŠ¨ç”»å¼€å§‹ä¹‹å‰,åŠ¨ç”»ç»“æŸä¹‹å</p></li><li><p>beginTimeï¼šå¯ä»¥ç”¨æ¥è®¾ç½®åŠ¨ç”»å»¶è¿Ÿæ‰§è¡Œæ—¶é—´ï¼Œè‹¥æƒ³å»¶è¿Ÿ2sï¼Œå°±è®¾ç½®ä¸ºCACurrentMediaTime()+2ï¼ŒCACurrentMediaTime()ä¸ºå›¾å±‚çš„å½“å‰æ—¶é—´</p></li><li><p>timingFunctionï¼šé€Ÿåº¦æ§åˆ¶å‡½æ•°ï¼Œæ§åˆ¶åŠ¨ç”»è¿è¡Œçš„èŠ‚å¥</p></li><li><p>delegateï¼šåŠ¨ç”»ä»£ç†</p></li></ul></blockquote><h2 id="å­ç±»"><a href="#å­ç±»" class="headerlink" title="å­ç±»"></a>å­ç±»</h2><h3 id="1-CAPropertyAnimation"><a href="#1-CAPropertyAnimation" class="headerlink" title="1.CAPropertyAnimation"></a>1.CAPropertyAnimation</h3><p>æ˜¯CAAnimationçš„å­ç±»ï¼Œä¹Ÿæ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œè¦æƒ³åˆ›å»ºåŠ¨ç”»å¯¹è±¡ï¼Œåº”è¯¥ä½¿ç”¨å®ƒçš„ä¸¤ä¸ªå­ç±»ï¼šCABasicAnimationå’ŒCAKeyframeAnimationã€‚</p><blockquote><ul><li>keyPath é€šè¿‡æŒ‡å®šCALayerçš„ä¸€ä¸ªå±æ€§åç§°ä¸ºkeyPath(NSStringç±»å‹)ï¼Œå¹¶ä¸”å¯¹CALayerçš„è¿™ä¸ªå±æ€§çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œè¾¾åˆ°ç›¸åº”çš„åŠ¨ç”»æ•ˆæœã€‚æ¯”å¦‚ï¼ŒæŒ‡å®š@â€positionâ€ä¸ºkeyPathï¼Œå°±ä¿®æ”¹CALayerçš„positionå±æ€§çš„å€¼ï¼Œä»¥è¾¾åˆ°å¹³ç§»çš„åŠ¨ç”»æ•ˆæœã€‚</li></ul></blockquote><h3 id="2-CABasicAnimation"><a href="#2-CABasicAnimation" class="headerlink" title="2.CABasicAnimation"></a>2.CABasicAnimation</h3><blockquote><ul><li><p>fromValueï¼škeyPathç›¸åº”å±æ€§çš„åˆå§‹å€¼ã€‚</p></li><li><p>toValueï¼škeyPathç›¸åº”å±æ€§çš„ç»“æŸå€¼ã€‚</p></li><li><p>éšç€åŠ¨ç”»çš„è¿›è¡Œï¼Œåœ¨é•¿åº¦ä¸ºdurationçš„æŒç»­æ—¶é—´å†…ï¼ŒkeyPathç›¸åº”å±æ€§çš„å€¼ä»fromValueæ¸æ¸åœ°å˜ä¸ºtoValueã€‚</p></li><li><p>å¦‚æœfillMode=kCAFillModeForwardså’ŒremovedOnComletion=NOï¼Œé‚£ä¹ˆåœ¨åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åï¼Œå›¾å±‚ä¼šä¿æŒæ˜¾ç¤ºåŠ¨ç”»æ‰§è¡Œåçš„çŠ¶æ€ã€‚ä½†åœ¨å®è´¨ä¸Šï¼Œå›¾å±‚çš„å±æ€§å€¼è¿˜æ˜¯åŠ¨ç”»æ‰§è¡Œå‰çš„åˆå§‹å€¼ï¼Œå¹¶æ²¡æœ‰çœŸæ­£è¢«æ”¹å˜ã€‚æ¯”å¦‚ï¼ŒCALayerçš„positionåˆå§‹å€¼ä¸º(0,0)ï¼ŒCABasicAnimationçš„fromValueä¸º(10,10)ï¼ŒtoValueä¸º(100,100)ï¼Œè™½ç„¶åŠ¨ç”»æ‰§è¡Œå®Œæ¯•åå›¾å±‚ä¿æŒåœ¨(100,100)è¿™ä¸ªä½ç½®ï¼Œå®è´¨ä¸Šå›¾å±‚çš„positionè¿˜æ˜¯ä¸º(0,0)ã€‚</p></li></ul></blockquote><h3 id="3-CAKeyframeAnimation"><a href="#3-CAKeyframeAnimation" class="headerlink" title="3.CAKeyframeAnimation"></a>3.CAKeyframeAnimation</h3><p>CApropertyAnimationçš„å­ç±»ï¼Œè·ŸCABasicAnimationçš„åŒºåˆ«æ˜¯ï¼šCABasicAnimationåªèƒ½ä»ä¸€ä¸ªæ•°å€¼(fromValue)å˜åˆ°å¦ä¸€ä¸ªæ•°å€¼(toValue)ï¼Œè€ŒCAKeyframeAnimationä¼šä½¿ç”¨ä¸€ä¸ªNSArrayä¿å­˜è¿™äº›æ•°å€¼ã€‚</p><blockquote><ul><li><p>valuesï¼šå°±æ˜¯ä¸Šè¿°çš„NSArrayå¯¹è±¡ã€‚é‡Œé¢çš„å…ƒç´ ç§°ä¸ºâ€å…³é”®å¸§â€(keyframe)ã€‚åŠ¨ç”»å¯¹è±¡ä¼šåœ¨æŒ‡å®šçš„æ—¶é—´(duration)å†…ï¼Œä¾æ¬¡æ˜¾ç¤ºvaluesæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…³é”®å¸§ã€‚</p></li><li><p>pathï¼šå¯ä»¥è®¾ç½®ä¸€ä¸ªCGPathRef\CGMutablePathRef,è®©å±‚è·Ÿç€è·¯å¾„ç§»åŠ¨ã€‚pathåªå¯¹CALayerçš„anchorPointå’Œpositionèµ·ä½œç”¨ã€‚å¦‚æœä½ è®¾ç½®äº†pathï¼Œé‚£ä¹ˆvalueså°†è¢«å¿½ç•¥ã€‚</p></li><li><p>keyTimesï¼šå¯ä»¥ä¸ºå¯¹åº”çš„å…³é”®å¸§æŒ‡å®šå¯¹åº”çš„æ—¶é—´ç‚¹,å…¶å–å€¼èŒƒå›´ä¸º0åˆ°1.0,keyTimesä¸­çš„æ¯ä¸€ä¸ªæ—¶é—´å€¼éƒ½å¯¹åº”valuesä¸­çš„æ¯ä¸€å¸§.å½“keyTimesæ²¡æœ‰è®¾ç½®çš„æ—¶å€™,å„ä¸ªå…³é”®å¸§çš„æ—¶é—´æ˜¯å¹³åˆ†çš„ã€‚</p></li><li><p>CABasicAnimationå¯çœ‹åšæ˜¯æœ€å¤šåªæœ‰2ä¸ªå…³é”®å¸§çš„CAKeyframeAnimationã€‚</p></li></ul></blockquote><h3 id="4-CAAnimationGroup"><a href="#4-CAAnimationGroup" class="headerlink" title="4.CAAnimationGroup"></a>4.CAAnimationGroup</h3><p>CAAnimationçš„å­ç±»ï¼Œå¯ä»¥ä¿å­˜ä¸€ç»„åŠ¨ç”»å¯¹è±¡ï¼Œå°†CAAnimationGroupå¯¹è±¡åŠ å…¥å±‚åï¼Œç»„ä¸­æ‰€æœ‰åŠ¨ç”»å¯¹è±¡å¯ä»¥åŒæ—¶å¹¶å‘è¿è¡Œã€‚</p><blockquote><ul><li><p>animationsï¼šç”¨æ¥ä¿å­˜ä¸€ç»„åŠ¨ç”»å¯¹è±¡çš„NSArrayã€‚</p></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ç»„åŠ¨ç”»å¯¹è±¡æ˜¯åŒæ—¶è¿è¡Œçš„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®åŠ¨ç”»å¯¹è±¡çš„beginTimeå±æ€§æ¥æ›´æ”¹åŠ¨ç”»çš„å¼€å§‹æ—¶é—´ã€‚</p></li></ul></blockquote><h3 id="5-CATransition"><a href="#5-CATransition" class="headerlink" title="5.CATransition"></a>5.CATransition</h3><p>CAAnimationçš„å­ç±»ï¼Œç”¨äºåšè½¬åœºåŠ¨ç”»ï¼Œèƒ½å¤Ÿä¸ºå±‚æä¾›ç§»å‡ºå±å¹•å’Œç§»å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœã€‚iOSæ¯”Mac OS Xçš„è½¬åœºåŠ¨ç”»æ•ˆæœå°‘ä¸€ç‚¹ã€‚UINavigationControllerå°±æ˜¯é€šè¿‡CATransitionå®ç°äº†å°†æ§åˆ¶å™¨çš„è§†å›¾æ¨å…¥å±å¹•çš„åŠ¨ç”»æ•ˆæœã€‚</p><blockquote><ul><li><p>typeï¼šåŠ¨ç”»è¿‡æ¸¡ç±»å‹ã€‚</p></li><li><p>subtypeï¼šåŠ¨ç”»è¿‡æ¸¡æ–¹å‘ã€‚</p></li><li><p>startProgressï¼šåŠ¨ç”»èµ·ç‚¹(åœ¨æ•´ä½“åŠ¨ç”»çš„ç™¾åˆ†æ¯”)ã€‚</p></li><li><p>endProgressï¼šåŠ¨ç”»ç»ˆç‚¹(åœ¨æ•´ä½“åŠ¨ç”»çš„ç™¾åˆ†æ¯”)ã€‚</p></li></ul></blockquote>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>åŠ¨ç”»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŠ¨ç”»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSåŠ¨ç”»-CALayerçš„å±æ€§å’Œä½¿ç”¨(æœªå®Œç»“)</title>
    <link href="/2018/12/01/iOS%E5%8A%A8%E7%94%BB-CALayer%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8(%E6%9C%AA%E5%AE%8C%E7%BB%93)/"/>
    <url>/2018/12/01/iOS%E5%8A%A8%E7%94%BB-CALayer%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E4%BD%BF%E7%94%A8(%E6%9C%AA%E5%AE%8C%E7%BB%93)/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§"><a href="#ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§" class="headerlink" title="ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§"></a>ä¸€ã€CALayerçš„å¸¸ç”¨å±æ€§</h2><blockquote><ul><li><p>@propertyCGPoint position;<br>å›¾å±‚ä¸­å¿ƒç‚¹çš„ä½ç½®ï¼Œç±»ä¼¼ä¸UIViewçš„centerï¼›ç”¨æ¥è®¾ç½®CALayeråœ¨çˆ¶å±‚ä¸­çš„ä½ç½®ï¼›ä»¥çˆ¶å±‚çš„å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ˆ0ï¼Œ0ï¼‰</p></li><li><p>@property CGPoint anchorPoint;<br>ç§°ã€å®šä½ç‚¹ã€ã€ã€é”šç‚¹ã€ï¼Œè¯¥æè¿°æ˜¯ç›¸å¯¹äºxã€yä½ç½®æ¯”ä¾‹è€Œè¨€çš„é»˜è®¤åœ¨å›¾åƒä¸­å¿ƒç‚¹ï¼ˆ0.5ã€0.5ï¼‰çš„ä½ç½®ï¼›å†³å®šç€CALayerèº«ä¸Šçš„å“ªä¸ªç‚¹ä¼šå†positionå±æ€§æ‰€æŒ‡çš„ä½ç½®ï¼Œä»¥è‡ªå·±çš„å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ˆ0ï¼Œ0ï¼‰ï¼›å®ƒçš„xã€yå–å€¼èŒƒå›´éƒ½æ˜¯0~1</p></li><li><p>@property(nullable) CGColorRef backgroundColor<br>å›¾å±‚èƒŒæ™¯é¢œè‰²</p></li><li><p>@property(nullable) CGColorRef borderColor<br>å›¾å±‚è¾¹æ¡†é¢œè‰²</p></li><li><p>@property CGFloat borderWidth<br>å›¾å±‚è¾¹æ¡†å®½åº¦</p></li><li><p>@property CGRect bounds<br>å›¾å±‚å¤§å°</p></li><li><p>@property(nullable, strong) id contents<br>å›¾å±‚æ˜¾ç¤ºå†…å®¹ï¼Œä¾‹å¦‚å¯ä»¥å°†å›¾ç‰‡ä½œä¸ºå›¾å±‚å†…å®¹æ˜¾ç¤º</p></li><li><p>@property CGRect contentsRect<br>å›¾å±‚æ˜¾ç¤ºå†…å®¹çš„å¤§å°å’Œä½ç½®</p></li><li><p>@property CGFloat cornerRadius<br>åœ†è§’åŠå¾„</p></li><li><p>@property(getter=isDoubleSided) BOOL doubleSided<br>å›¾å±‚èƒŒæ™¯æ˜¯å¦æ˜¾ç¤ºï¼Œé»˜è®¤æ˜¯YES</p></li><li><p>@property CGRect frame<br>å›¾å±‚å¤§å°å’Œä½ç½®ï¼Œä¸æ”¯æŒéšå¼åŠ¨ç”»ï¼Œæ‰€ä»¥CALyaerä¸­å¾ˆå°‘ä½¿ç”¨frameï¼Œé€šå¸¸ä½¿ç”¨boundå’Œpositionä»£æ›¿</p></li><li><p>@property(getter=isHidden) BOOL hidden<br>æ˜¯å¦éšè—</p></li><li><p>@property(nullable, strong) CALayer *mask<br>å›¾å±‚è’™ç‰ˆ</p></li><li><p>@property BOOL masksToBounds<br>å­å›¾å±‚æ˜¯å¦å‰ªåˆ‡å›¾å±‚è¾¹ç•Œï¼Œé»˜è®¤æ˜¯NO</p></li><li><p>@property float opacit;<br>å›¾å±‚é€æ˜åº¦ï¼Œç±»ä¼¼ä¸UIViewçš„alpha</p></li><li><p>@property(nullable) CGColorRef shadowColor<br>é˜´å½±é¢œè‰²</p></li><li><p>@property CGSize shadowOffset<br>é˜´å½±åç§»é‡</p></li><li><p>@property float shadowOpacity<br>é˜´å½±é€æ˜åº¦ï¼Œæ³¨æ„é»˜è®¤ä¸º0ï¼Œå¦‚æœè®¾ç½®é˜´å½±å¿…é¡»è®¾ç½®æ­¤å±æ€§</p></li><li><p>@property(nullable) CGPathRef shadowPath<br>é˜´å½±å½¢çŠ¶</p></li><li><p>@property CGFloat shadowRadius<br>é˜´å½±æ¨¡ç³ŠåŠå¾„</p></li><li><p>@property(nullable, copy) NSArray</p></li></ul></blockquote><h2 id="äºŒã€CALayerä¸å¸¸ç”¨å±æ€§"><a href="#äºŒã€CALayerä¸å¸¸ç”¨å±æ€§" class="headerlink" title="äºŒã€CALayerä¸å¸¸ç”¨å±æ€§"></a>äºŒã€CALayerä¸å¸¸ç”¨å±æ€§</h2><blockquote><ul><li><p>@property CGFloat zPosition<br>å›¾å±‚ä¸­å¿ƒç‚¹åœ¨zè½´ä¸­çš„ä½ç½®</p></li><li><p>@property CGFloat anchorPointZ<br>å›¾å±‚åœ¨zè½´ä¸­çš„é”šç‚¹ï¼›</p></li><li><p>æ–¹æ³• - (CGAffineTransform)affineTransform</p></li><li><p>æ–¹æ³• - (void)setAffineTransform:(CGAffineTransform)m<br>ä»¥ä¸Šå±æ€§ä¸ºå›¾å±‚å½¢å˜ï¼›è¯¥å±æ€§å€¼æŒ‡å®šä¸€ä¸ªCGAffineTransformå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä»£è¡¨å¯¹CALayeræ‰§è¡ŒXã€Yä¸¤ä¸ªç»´åº¦ï¼ˆä¹Ÿå°±æ˜¯å¹³é¢ï¼‰ä¸Šçš„æ—‹è½¬ã€ç¼©æ”¾ã€ä½ç§»ã€æ–œåˆ‡ã€é•œåƒç­‰å˜æ¢çŸ©é˜µ</p></li><li><p>@property(nullable, readonly) CALayer *superlayer<br>å›¾å±‚çš„çˆ¶å›¾å±‚</p></li></ul></blockquote><h2 id="ä¸‰ã€CALayerå›¾å±‚æ“ä½œ"><a href="#ä¸‰ã€CALayerå›¾å±‚æ“ä½œ" class="headerlink" title="ä¸‰ã€CALayerå›¾å±‚æ“ä½œ"></a>ä¸‰ã€CALayerå›¾å±‚æ“ä½œ</h2><blockquote><ul><li><p>æ–¹æ³•  - (void)addSublayer:(CALayer *)layer<br>æ·»åŠ å­å›¾å±‚</p></li><li><p>æ–¹æ³•  - (void)removeFromSuperlayer<br>å°†è‡ªå·±ä»çˆ¶å›¾å±‚ä¸­ç§»é™¤</p></li><li><p>æ–¹æ³• - (void)insertSublayer:(CALayer *)layer atIndex:(unsigned)idx<br>åœ¨è‡ªå·±å­å›¾å±‚æ•°ç»„ä¸­çš„ç¬¬idxä½ç½®æ·»åŠ å›¾å±‚</p></li><li><p>æ–¹æ³•  - (void)insertSublayer:(CALayer )layer below:(nullable CALayer )sibling<br>å°†å›¾å±‚layeræ·»åŠ åœ¨å­å›¾å±‚siblingçš„ä¸‹é¢</p></li><li><p>æ–¹æ³• - (void)insertSublayer:(CALayer )layer above:(nullable CALayer )sibling<br>å°†å›¾å±‚layeræ·»åŠ åœ¨å­å›¾å±‚siblingçš„ä¸Šé¢</p></li><li><p>æ–¹æ³• - (void)replaceSublayer:(CALayer )layer with:(CALayer )layer2<br>å°†å›¾å±‚layeræ›¿æ¢layer2ï¼›</p></li></ul></blockquote><h2 id="å››ã€CALayeråŠ¨ç”»æ“ä½œ"><a href="#å››ã€CALayeråŠ¨ç”»æ“ä½œ" class="headerlink" title="å››ã€CALayeråŠ¨ç”»æ“ä½œ"></a>å››ã€CALayeråŠ¨ç”»æ“ä½œ</h2><blockquote><ul><li><p>æ–¹æ³•  - (void)addAnimation:(CAAnimation )anim forKey:(nullable NSString )key<br>å›¾å±‚æ·»åŠ æŸä¸€å±æ€§çš„åŠ¨ç”»</p></li><li><p>æ–¹æ³• - (nullable NSArray&lt; NSString &gt; )animationKeys<br>è·å–æ‰€æœ‰åŠ¨ç”»çš„å±æ€§</p></li><li><p>æ–¹æ³• - (nullable CAAnimation )animationForKey:(NSString )key<br>è·å–æŸä¸€å±æ€§çš„åŠ¨ç”»</p></li><li><p>æ–¹æ³• - (void)removeAnimationForKey:(NSString *)key<br>ç§»é™¤æŸä¸€å±æ€§åŠ¨ç”»</p></li><li><p>æ–¹æ³• - (void)removeAllAnimations<br>ç§»é™¤æ‰€æœ‰åŠ¨ç”»</p></li></ul></blockquote><h2 id="äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜"><a href="#äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜" class="headerlink" title="äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜"></a>äº”ã€CALayerå­ç±»å…¶ä»–è¯´æ˜</h2><table><thead><tr><th>å­ç±»åç§°</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>CAEmitterLayer</td><td>å‘å°„å™¨å±‚ï¼Œç”¨æ¥æ§åˆ¶ç²’å­æ•ˆæœ</td></tr><tr><td>CAGradientLayer</td><td>æ¢¯åº¦å±‚ï¼Œé¢œè‰²æ¸å˜</td></tr><tr><td>CAEAGLayer</td><td>ç”¨OpenGL ESç»˜åˆ¶çš„å±‚</td></tr><tr><td>CAReplicationLayer</td><td>ç”¨æ¥è‡ªåŠ¨å¤åˆ¶sublayer</td></tr><tr><td>CAShapeLayer</td><td>ç»˜åˆ¶ç«‹ä½“çš„è´å¡å°”æ›²çº¿</td></tr><tr><td>CAScrollLayer</td><td>ç”¨æ¥ç®¡ç†å¯æ»‘åŠ¨çš„åŒºåŸŸ</td></tr><tr><td>CATextLayer</td><td>å¯ä»¥ç»˜åˆ¶AttributeString</td></tr><tr><td>CATiledLayer</td><td>ç”¨æ¥ç®¡ç†ä¸€å‰¯å¯ä»¥è¢«åˆ†å‰²çš„å¤§å›¾</td></tr><tr><td>CATransformLayer</td><td>ç”¨æ¥æ¸²æŸ“3D layerçš„å±‚æ¬¡ç»“æ„</td></tr></tbody></table><h3 id="1-CAShapeLayer"><a href="#1-CAShapeLayer" class="headerlink" title="1. CAShapeLayer"></a>1. CAShapeLayer</h3><p>CAShapeLayerå±äºQuartzCoreæ¡†æ¶ï¼Œç»§æ‰¿è‡ªCALayerã€‚CAShapeLayeræ˜¯åœ¨åæ ‡ç³»å†…ç»˜åˆ¶è´å¡å°”æ›²çº¿çš„ï¼Œé€šè¿‡ç»˜åˆ¶è´å¡å°”æ›²çº¿ï¼Œè®¾ç½®shape(å½¢çŠ¶)çš„path(è·¯å¾„)ï¼Œä»è€Œç»˜åˆ¶å„ç§å„æ ·çš„å›¾å½¢ä»¥åŠä¸è§„åˆ™å›¾å½¢ã€‚å› æ­¤ï¼Œä½¿ç”¨CAShapeLayeréœ€è¦ä¸UIBezierPathä¸€èµ·ä½¿ç”¨ã€‚<br>UIBezierPathç±»å…è®¸ä½ åœ¨è‡ªå®šä¹‰çš„ View ä¸­ç»˜åˆ¶å’Œæ¸²æŸ“ç”±ç›´çº¿å’Œæ›²çº¿ç»„æˆçš„è·¯å¾„.ã€‚ä½ å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™ç›´æ¥ä¸ºä½ çš„UIBezierPathæŒ‡å®šä¸€ä¸ªå‡ ä½•å›¾å½¢ã€‚<br>é€šä¿—ç‚¹å°±æ˜¯UIBezierPathç”¨æ¥æŒ‡å®šç»˜åˆ¶å›¾å½¢è·¯å¾„ï¼Œè€ŒCAShapeLayerå°±æ˜¯æ ¹æ®è·¯å¾„æ¥ç»˜å›¾çš„ã€‚</p><h4 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><blockquote><ul><li><p>1ã€@property(nullable) CGPathRef path;  å‘ˆç°çš„å½¢çŠ¶çš„è·¯å¾„</p></li><li><p>2ã€@property(nullable) CGColorRef fillColor;å¡«å……è·¯å¾„çš„é¢œè‰²  </p></li><li><p>3ã€@property(copy) CAShapeLayerFillRule fillRule;   å½“åœ¨å¡«å……é¢œè‰²çš„æ—¶å€™åˆ™å°±éœ€è¦è¿™ç§å¡«å……è§„åˆ™ï¼Œå€¼æœ‰ä¸¤ç§ï¼Œéé›¶å’Œå¥‡å¶æ•°ï¼Œä½†é»˜è®¤æ˜¯éé›¶å€¼ã€‚</p></li><li><p>4ã€@property(nullable) CGColorRef strokeColor;è®¾ç½®æè¾¹è‰²ï¼Œé»˜è®¤æ— è‰²ã€‚</p></li><li><p>5ã€@property CGFloat strokeStart; ç»˜åˆ¶è¾¹çº¿è½®å»“è·¯å¾„çš„å­åŒºåŸŸã€‚è¯¥å€¼å¿…é¡»åœ¨[0,1]èŒƒå›´ï¼Œ0ä»£è¡¨è·¯å¾„çš„å¼€å§‹ï¼Œ1ä»£è¡¨è·¯å¾„çš„ç»“æŸã€‚ é»˜è®¤ä¸º0</p></li><li><p>6ã€@property CGFloat strokeEnd; é»˜è®¤ä¸º1</p></li><li><p>7ã€@property CGFloat lineWidth; çº¿çš„å®½åº¦ é»˜è®¤ä¸º1</p></li><li><p>8ã€@property CGFloat miterLimit;æœ€å¤§æ–œæ¥é•¿åº¦ã€‚æ–œæ¥é•¿åº¦æŒ‡çš„æ˜¯åœ¨ä¸¤æ¡çº¿äº¤æ±‡å¤„å’Œå¤–äº¤ä¹‹é—´çš„è·ç¦»ã€‚åªæœ‰lineJoinå±æ€§ä¸ºkCALineJoinMiteræ—¶miterLimitæ‰æœ‰æ•ˆã€‚è¾¹è§’çš„è§’åº¦è¶Šå°ï¼Œæ–œæ¥é•¿åº¦å°±ä¼šè¶Šå¤§ã€‚ä¸ºäº†é¿å…æ–œæ¥é•¿åº¦è¿‡é•¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨miterLimitå±æ€§ã€‚å¦‚æœæ–œæ¥é•¿åº¦è¶…è¿‡miterLimitçš„å€¼ï¼Œè¾¹è§’ä¼šä»¥lineJoinçš„â€œbevelâ€å³kCALineJoinBevelç±»å‹æ¥æ˜¾ç¤ºã€‚</p></li><li><p>9ã€@property(copy) CAShapeLayerLineCap lineCap; çº¿ç«¯ç‚¹ç±»å‹ï¼Œå€¼æœ‰ä¸‰ä¸ªç±»å‹ï¼Œåˆ†åˆ«ä¸ºkCALineCapButt ã€kCALineCapRound ã€kCALineCapSquareï¼Œé»˜è®¤å€¼ä¸ºButtï¼›</p></li><li><p>10ã€@property(copy) CAShapeLayerLineJoin lineJoin;lineJoinä¸ºçº¿è¿æ¥ç±»å‹ï¼Œå…¶å€¼ä¹Ÿæœ‰ä¸‰ä¸ªç±»å‹ï¼Œåˆ†åˆ«ä¸ºkCALineJoinMiterã€kCALineJoinRoundã€kCALineJoinBevelï¼Œé»˜è®¤å€¼æ˜¯Miterã€‚</p></li><li><p>11ã€@property CGFloat lineDashPhase;ä¸ºçº¿å‹æ¨¡ç‰ˆçš„èµ·å§‹ä½ç½®ï¼›lineDashPatternä¸ºçº¿æ€§æ¨¡ç‰ˆï¼Œè¿™æ˜¯ä¸€ä¸ªNSNumberçš„æ•°ç»„ï¼Œç´¢å¼•ä»1å¼€å§‹è®°ï¼Œå¥‡æ•°ä½æ•°å€¼è¡¨ç¤ºå®çº¿é•¿åº¦ï¼Œå¶æ•°ä½æ•°å€¼è¡¨ç¤ºç©ºç™½é•¿åº¦ã€‚<br>æ³¨ï¼šfillColorä¸strokeColoréƒ½æ˜¯åœ¨æœ‰UIBezierPathå‚æ•°é…ç½®çš„æƒ…å†µä¸‹æ‰èƒ½å‘ç”Ÿä½œç”¨</p></li><li><p>12ã€@property(nullable, copy) NSArray&lt;NSNumber *&gt; *lineDashPattern;</p></li></ul></blockquote><h3 id="2-CAReplicationLayer"><a href="#2-CAReplicationLayer" class="headerlink" title="2.CAReplicationLayer"></a>2.CAReplicationLayer</h3><h4 id="å±æ€§-1"><a href="#å±æ€§-1" class="headerlink" title="å±æ€§"></a>å±æ€§</h4><blockquote><ul><li><p>1ã€@property NSInteger instanceCount;  å¤åˆ¶subLayerä¸ªæ•°ï¼Œé»˜è®¤ä¸º1</p></li><li><p>2ã€@property BOOL preservesDepth; æ˜¯å¦å°†3Dä¾‹å­ç³»ç»Ÿå¹³é¢åŒ–åˆ°ä¸€ä¸ªå›¾å±‚ï¼ˆé»˜è®¤å€¼ï¼‰æˆ–è€…å¯ä»¥åœ¨3Dç©ºé—´ä¸­æ··åˆå…¶ä»–çš„å›¾å±‚</p></li><li><p>3ã€@property CFTimeInterval instanceDelay; è®¾ç½®å¤åˆ¶å­å±‚çš„å»¶è¿ŸåŠ¨ç”»æ—¶é•¿</p></li><li><p>4ã€@property CATransform3D instanceTransform; è®¾ç½®å¤åˆ¶å­å±‚çš„ç›¸å¯¹ä½ç½®</p></li><li><p>5ã€@property(nullable) CGColorRef instanceColor; å­å±‚é¢œè‰²ï¼Œä¼šå’ŒåŸç”Ÿå­å±‚èƒŒæ™¯è‰²å†²çªï¼Œå› æ­¤äºŒè€…é€‰å…¶ä¸€è®¾ç½®</p></li><li><p>6ã€@property float instanceRedOffset;<br>è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„çº¢è‰²åç§»é‡</p></li><li><p>7ã€@property float instanceRedOffset;<br>è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„ç»¿è‰²åç§»é‡</p></li><li><p>8ã€@property float instanceBlueOffset;è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„è“è‰²åç§»é‡</p></li><li><p>9ã€@property float instanceAlphaOffset;è®¾ç½®æ¯ä¸ªå¤åˆ¶å›¾å±‚ç›¸å¯¹ä¸Šä¸€ä¸ªå¤åˆ¶å›¾å±‚çš„é€æ˜åº¦åç§»é‡</p></li></ul></blockquote>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>åŠ¨ç”»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŠ¨ç”»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSåŠ¨ç”»-CATransitionåè½¬åŠ¨ç”»</title>
    <link href="/2018/12/01/iOS%E5%8A%A8%E7%94%BB-CATransition%E5%8F%8D%E8%BD%AC%E5%8A%A8%E7%94%BB/"/>
    <url>/2018/12/01/iOS%E5%8A%A8%E7%94%BB-CATransition%E5%8F%8D%E8%BD%AC%E5%8A%A8%E7%94%BB/</url>
    
    <content type="html"><![CDATA[<p>ç§»åŠ¨åŠ¨ç”»</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/* Common transition types. */</span><br><br>/**<br> *   kCATransitionFade    <span class="hljs-regexp">//</span> æ¸å˜<br> *   kCATransitionMoveIn  <span class="hljs-regexp">//</span> è¦†ç›–<br> *   kCATransitionPush    <span class="hljs-regexp">//</span> æ¨å‡º<br> *   kCATransitionReveal  <span class="hljs-regexp">//</span> æ­å¼€<br> */<br><br><span class="hljs-regexp">/* Common transition subtypes. */</span><br><br>/**<br> *   kCATransitionFromRight<br> *   kCATransitionFromLeft<br> *   kCATransitionFromTop<br> *   kCATransitionFromBottom<br> */<br><br>CATransition *transition = [CATransition animation];<br>transition.duration = <span class="hljs-number">0.25</span>;<br>transition.type = kCATransitionPush;<br>transition.subtype = kCATransitionFromRight;<br>[containerView.layer addAnimation:transition forKey:nil];<br>[containerView exchangeSubviewAtIndex:<span class="hljs-number">0</span> withSubviewAtIndex:<span class="hljs-number">1</span>];<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>åŠ¨ç”»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŠ¨ç”»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSåŠ¨ç”»-CATransitionå±æ€§åŠ¨ç”»</title>
    <link href="/2018/11/01/iOS%E5%8A%A8%E7%94%BB-CATransition%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB/"/>
    <url>/2018/11/01/iOS%E5%8A%A8%E7%94%BB-CATransition%E5%B1%9E%E6%80%A7%E5%8A%A8%E7%94%BB/</url>
    
    <content type="html"><![CDATA[<p>ç§æœ‰æ–¹æ³•</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/* Common transition types. */</span><br><br>/**<br> *   cube                  <span class="hljs-regexp">//</span> ç«‹æ–¹ä½“æ—‹è½¬<br> *   suckEffect            <span class="hljs-regexp">//</span> æ”¶ç¼©åŠ¨ç”»<br> *   oglFlip               <span class="hljs-regexp">//</span> ç¿»è½¬<br> *   pageCurl              <span class="hljs-regexp">//</span> é¡µé¢æ­å¼€<br> *   pageUnCurl            <span class="hljs-regexp">//</span> æ”¾ä¸‹é¡µé¢<br> *   cemeraIrisHollowOpen  <span class="hljs-regexp">//</span> é•œå¤´æ‰“å¼€<br> *   cameraIrisHollowClose <span class="hljs-regexp">//</span> é•œå¤´å…³é—­<br> */<br><br><span class="hljs-regexp">/* Common transition subtypes. */</span><br><br>/**<br> *   kCATransitionFromRight<br> *   kCATransitionFromLeft<br> *   kCATransitionFromTop<br> *   kCATransitionFromBottom<br> */<br><br>CATransition *transition = [CATransition animation];<br>transition.duration = <span class="hljs-number">3</span>;<br>transition.type = @<span class="hljs-string">&quot;oglFlip&quot;</span>;<br>transition.subtype = kCATransitionFromTop;<br>[containerView.layer addAnimation:transition forKey:nil];<br>[containerView exchangeSubviewAtIndex:<span class="hljs-number">0</span> withSubviewAtIndex:<span class="hljs-number">1</span>];<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>åŠ¨ç”»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŠ¨ç”»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSåŠ¨ç”»-CATransitionç§»åŠ¨åŠ¨ç”»</title>
    <link href="/2018/10/01/iOS%E5%8A%A8%E7%94%BB-CATransition%E7%A7%BB%E5%8A%A8%E5%8A%A8%E7%94%BB/"/>
    <url>/2018/10/01/iOS%E5%8A%A8%E7%94%BB-CATransition%E7%A7%BB%E5%8A%A8%E5%8A%A8%E7%94%BB/</url>
    
    <content type="html"><![CDATA[<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs awk">/**<br> *  UIViewAnimationTransitionNone              <span class="hljs-regexp">//</span>æ²¡æœ‰æ•ˆæœ<br> *  UIViewAnimationTransitionFlipFromLeft      <span class="hljs-regexp">//</span>ä»å·¦æ°´å¹³ç¿»è½¬<br> *  UIViewAnimationTransitionFlipFromRight     <span class="hljs-regexp">//</span>ä»å³æ°´å¹³ç¿»è½¬<br> *  UIViewAnimationTransitionCurlUp            <span class="hljs-regexp">//</span>ç¿»ä¹¦ä¸Šæ€<br> *  UIViewAnimationTransitionCurlDown          <span class="hljs-regexp">//</span>ç¿»ä¹¦ä¸‹ç›–<br> *  UIViewAnimationTransitionCrossDissolve     <span class="hljs-regexp">//</span>èåˆ<br> *  UIViewAnimationTransitionFlipFromTop       <span class="hljs-regexp">//</span>ä»ä¸Šå‚ç›´ç¿»è½¬<br> *  UIViewAnimationTransitionFlipFromBottom    <span class="hljs-regexp">//</span>ä»ä¸‹å‚ç›´ç¿»è½¬<br> *<br> */<br><br>[UIView beginAnimations:@<span class="hljs-string">&quot;animation&quot;</span> context:nil];<br>[UIView setAnimationDuration:<span class="hljs-number">1.0</span>f];<br>[UIView setAnimationTransition:UIViewAnimationTransitionNone forView:containerView cache:YES];<br>[UIView setAnimationCurve:UIViewAnimationCurveEaseInOut];<br><span class="hljs-regexp">//</span> äº¤æ¢å±‚çº§å…³ç³»<br>[containerView exchangeSubviewAtIndex:<span class="hljs-number">0</span> withSubviewAtIndex:<span class="hljs-number">1</span>];<br>[UIView commitAnimations];<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>åŠ¨ç”»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŠ¨ç”»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSåŠ¨ç”»-Transitionè½¬åœºåŠ¨ç”»</title>
    <link href="/2018/09/01/iOS%E5%8A%A8%E7%94%BB-Transition%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/"/>
    <url>/2018/09/01/iOS%E5%8A%A8%E7%94%BB-Transition%E8%BD%AC%E5%9C%BA%E5%8A%A8%E7%94%BB/</url>
    
    <content type="html"><![CDATA[<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs awk">/**<br> *  UIViewAnimationOptionTransitionNone              <span class="hljs-regexp">//</span>æ²¡æœ‰æ•ˆæœ<br> *  UIViewAnimationOptionTransitionFlipFromLeft      <span class="hljs-regexp">//</span>ä»å·¦æ°´å¹³ç¿»è½¬<br> *  UIViewAnimationOptionTransitionFlipFromRight     <span class="hljs-regexp">//</span>ä»å³æ°´å¹³ç¿»è½¬<br> *  UIViewAnimationOptionTransitionCurlUp            <span class="hljs-regexp">//</span>ç¿»ä¹¦ä¸Šæ€<br> *  UIViewAnimationOptionTransitionCurlDown          <span class="hljs-regexp">//</span>ç¿»ä¹¦ä¸‹ç›–<br> *  UIViewAnimationOptionTransitionCrossDissolve     <span class="hljs-regexp">//</span>èåˆ<br> *  UIViewAnimationOptionTransitionFlipFromTop       <span class="hljs-regexp">//</span>ä»ä¸Šå‚ç›´ç¿»è½¬<br> *  UIViewAnimationOptionTransitionFlipFromBottom    <span class="hljs-regexp">//</span>ä»ä¸‹å‚ç›´ç¿»è½¬<br> *<br> */<br><br>[UIView transitionWithView:UIApplication.sharedApplication.keyWindow<br>                  duration:<span class="hljs-number">0.5</span><br>                   options:UIViewAnimationOptionTransitionFlipFromLeft<br>                animations:^&#123;<br>                <br>                 <span class="hljs-regexp">//</span> TODO: é¡µé¢è·³è½¬<br>                       <br>              &#125; completion:^(BOOL finished) &#123;<br>    <br>&#125;];<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>åŠ¨ç”»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åŠ¨ç”»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOS é¢è¯•é¢˜ï¼ˆå…«ï¼‰</title>
    <link href="/2018/08/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-008/"/>
    <url>/2018/08/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-008/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-f0679730c4864b7b.jpeg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><h3 id="property"><a href="#property" class="headerlink" title="@property"></a>@property</h3><p>é»˜è®¤æ ¼å¼ï¼š<code>@syntheszie var = _var;</code></p><p><code>ARC</code>ä¸­ï¼Œé»˜è®¤ä¿®é¥°<br></p><ul><li>åŸºæœ¬æ•°æ®ç±»å‹<code>@property (atomic, assign)</code><br></li><li>å¯¹è±¡æ•°æ®ç±»å‹<code>@property (atomic, strong)</code></li></ul><h3 id="ä¿®é¥°è¯è§£é‡Š"><a href="#ä¿®é¥°è¯è§£é‡Š" class="headerlink" title="ä¿®é¥°è¯è§£é‡Š"></a>ä¿®é¥°è¯è§£é‡Š</h3><ul><li><p><code>nonatomic</code> éåŸå­æ€§è®¿é—®ï¼Œä¸å¯¹setæ–¹æ³•åŠ é”ï¼Œä¸æ˜¯å®‰å…¨çº¿ç¨‹ï¼Œä½†æ˜¯æ€§èƒ½é«˜ã€‚</p></li><li><p><code>atomic</code> åŸå­æ€§è®¿é—®ï¼Œå¯¹ç”Ÿæˆçš„ set æ–¹æ³•åŠ äº’æ–¥é” @synchronized(é”å¯¹è±¡ï¼‰ï¼Œå®‰å…¨çº¿ç¨‹ï¼ˆä¸æ˜¯ç»å¯¹å®‰å…¨çº¿ç¨‹ï¼‰,æ€§èƒ½å·®ã€‚</p></li><li><p><code>strong</code>ARCä¸­ä½¿ç”¨ï¼Œä¿®é¥°OCå¯¹è±¡ï¼Œ<code>æ‹¥æœ‰å…³ç³»</code>ï¼Œå¼•ç”¨è®¡æ•°å™¨+1ã€‚</p></li><li><p><code>reatain</code>MRCä¸­ä½¿ç”¨ï¼Œä¿®é¥°OCå¯¹è±¡ï¼Œ<code>æ‹¥æœ‰å…³ç³»</code>ï¼Œå¼•ç”¨è®¡æ•°å™¨+1ã€‚</p></li><li><p><code>assign</code>ä¿®é¥°åŸºç¡€æ•°æ®ç±»å‹ï¼Œç›´æ¥èµ‹å€¼ï¼Œ<code>éæ‹¥æœ‰å…³ç³»</code>ï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°å™¨ã€‚</p></li><li><p><code>weak</code>ä¿®é¥°åè®®ï¼Œæ§ä»¶ï¼Œ<code>éæ‹¥æœ‰å…³ç³»</code>ï¼ŒæŒ‡å‘çš„å¯¹è±¡é”€æ¯ï¼ŒæŒ‡é’ˆä¼šè‡ªåŠ¨ç½®ä¸ºnilï¼Œä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°å™¨ã€‚</p></li><li><p><code>unsafe_unretained</code>ä¸weakç±»ä¼¼ï¼Œä¸ä¼šè‡ªåŠ¨nilåŒ–ï¼Œå¦‚æœæ‰€æŒ‡å‘çš„å†…å­˜åŒºåŸŸè¢«é‡Šæ”¾äº†ï¼Œè¿™ä¸ªæŒ‡é’ˆå°±æ˜¯ä¸€ä¸ªé‡æŒ‡é’ˆã€‚</p></li><li><p><code>copy</code>åœ¨ MRC æ—¶æ˜¯è¿™æ ·åšçš„ release æ—§å¯¹è±¡( æ—§å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ -1 ) , copy æ–°å¯¹è±¡( æ–°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ +1 ) , ç„¶åæŒ‡å‘æ–°å¯¹è±¡ .ï¼ˆæ–°å¯¹è±¡æ˜¯æŒ‡æœ€ç»ˆæŒ‡å‘çš„é‚£ä¸ªå¯¹è±¡ï¼Œä¸ç®¡æ·±æ‹·è´è¿˜æ˜¯æµ…æ‹·è´ï¼‰ï¼Œåœ¨ ARC æ—¶æ˜¯è¿™ä¹ˆå¹²çš„ copy æ–°å¯¹è±¡( æ–°å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å™¨ +1 ) , ç„¶åæŒ‡å‘æ–°å¯¹è±¡ã€‚</p></li><li><p><code>readonly</code>åªç”Ÿæˆgetæ–¹æ³•ï¼Œä¸æƒ³æŠŠæš´éœ²çš„å±æ€§è¢«äººéšä¾¿æ›¿æ¢æ—¶ , å¯ä»¥ä½¿ç”¨ã€‚</p></li><li><p><code>readwrite</code>ç”Ÿæˆget/setæ–¹æ³•ã€‚</p></li></ul><h3 id="dynamic"><a href="#dynamic" class="headerlink" title="@dynamic"></a>@dynamic</h3><p>å‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯)</p><h3 id="synthesize"><a href="#synthesize" class="headerlink" title="@synthesize"></a>@synthesize</h3><p>å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p><h3 id="synchronized"><a href="#synchronized" class="headerlink" title="@synchronized"></a>@synchronized</h3><p>çº¿ç¨‹åŒæ­¥é”</p><h3 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h3><p>ï¼ˆ1ï¼‰ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Ÿç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒ?</p><ul><li>ä½¿ç”¨<blockquote><ol><li>åè®®å£°æ˜ä½¿ç”¨weak</li><li>IBOutlet ä½¿ç”¨weak</li></ol></blockquote></li><li>weak å’Œ assign çš„ä¸åŒç‚¹:<blockquote><p>weak ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,ç³»ç»Ÿä¼šå°† weak ä¿®é¥°çš„å±æ€§å¯¹è±¡çš„æŒ‡é’ˆæŒ‡å‘ nil,åœ¨ OC ç»™ nil å‘æ¶ˆæ¯æ˜¯ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜çš„;å¦‚æœä½¿ç”¨ assign ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,å±æ€§å¯¹è±¡æŒ‡é’ˆè¿˜æŒ‡å‘åŸæ¥çš„å¯¹è±¡,ç”±äºå¯¹è±¡å·²ç»è¢«é”€æ¯,è¿™æ—¶å€™å°±äº§ç”Ÿäº†é‡æŒ‡é’ˆ,å¦‚æœè¿™æ—¶å€™åœ¨ç»™æ­¤å¯¹è±¡å‘é€æ¶ˆæ¯,å¾ˆå®¹é€ æˆç¨‹åºå¥”æºƒassigin å¯ä»¥ç”¨äºä¿®é¥°é OC å¯¹è±¡,è€Œ weak å¿…é¡»ç”¨äº OC å¯¹è±¡ã€‚</p></blockquote></li></ul><p>ï¼ˆ2ï¼‰ä½¿ç”¨ atomic ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—?</p><ul><li>ä¸æ˜¯,atomic çš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<blockquote><p>ä¾‹å¦‚ï¼š å£°æ˜ä¸€ä¸ª NSMutableArray çš„åŸå­å±æ€§ stuff,æ­¤æ—¶ self.stuff å’Œ self.stuff =othersulf éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯,ä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,éœ€è¦ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚</p></blockquote></li></ul><p>ï¼ˆ3ï¼‰@synthesize å’Œ @dynamic åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨</p><ul><li><p>@property æœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯,ä¸€ä¸ªæ˜¯@synthesize,ä¸€ä¸ªæ˜¯@dynamicã€‚<br>å¦‚æœ@synthesize å’Œ@dynamic éƒ½æ²¡å†™,é‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯<br>@syntheszie var = _var;</p></li><li><p>@synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</p></li><li><p>@dynamic å‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯)</p></li><li><p>å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º@dynamic varï¼›ç„¶åä½ æ²¡æœ‰æä¾›@setter æ–¹æ³•å’Œ@getter æ–¹æ³•,ç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜,ä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ° instance.var = someVar,ç”±äºç¼º setteræ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ;<br>æˆ–è€…å½“è¿è¡Œåˆ° someVar = instance.var æ—¶,ç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚</p></li></ul><p>ï¼ˆ4ï¼‰ARC ä¸‹,ä¸æ˜¾å¼æŒ‡å®šä»»ä½•å±æ€§å…³é”®å­—æ—¶,é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›?</p><ul><li><p>åŸºæœ¬æ•°æ®ï¼š  <code>atomic,readwrite,assign</code></p></li><li><p>æ™®é€šçš„ OC å¯¹è±¡: <code>atomic,readwrite,strong</code></p></li></ul><p>ï¼ˆ5ï¼‰ç”¨@property å£°æ˜çš„ NSString(æˆ– NSArray,NSDictionary)ç»å¸¸ä½¿ç”¨ copy å…³é”®å­—,ä¸ºä»€ä¹ˆ?å¦‚æœæ”¹ç”¨ strong å…³é”®å­—,å¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜?</p><blockquote><p>å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨ copy çš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨ copy æ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯ strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§.</p></blockquote><p>ï¼ˆ6ï¼‰è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜: @property(copy)NSMutableArray *array;</p><blockquote><p>å› ä¸º copy ç­–ç•¥æ‹·è´å‡ºæ¥çš„æ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡,ç„¶è€Œå´æŠŠå®ƒå½“æˆå¯å˜å¯¹è±¡ä½¿ç”¨,å¾ˆå®¹æ˜“é€ æˆç¨‹åºå¥”æºƒè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜,è¯¥å±æ€§ä½¿ç”¨äº†åŒæ­¥é”,ä¼šåœ¨åˆ›å»ºæ—¶ç”Ÿæˆä¸€äº›é¢å¤–çš„ä»£ç ç”¨äºå¸®åŠ©ç¼–å†™å¤šçº¿ç¨‹ç¨‹åº,è¿™ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜,é€šè¿‡å£°æ˜ nonatomic å¯ä»¥èŠ‚çœè¿™äº›è™½ç„¶<br>å¾ˆå°ä½†æ˜¯ä¸å¿…è¦é¢å¤–å¼€é”€,åœ¨ iOS å¼€å‘ä¸­åº”è¯¥ä½¿ç”¨ nonatomic æ›¿ä»£ atomic.</p></blockquote><p>ï¼ˆ7ï¼‰å¦‚ä½•è®©è‡ªå®šä¹‰ç±»å¯ä»¥ç”¨ copy ä¿®é¥°ç¬¦?å¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setter?</p><blockquote><p>è‹¥æƒ³ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½,åˆ™éœ€å®ç° NSCopying åè®®ã€‚</p></blockquote><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">// å®ç°ä¸å¯å˜ç‰ˆæœ¬æ‹·è´</span><br>- (<span class="hljs-keyword">id</span>)copyWithZone:(<span class="hljs-built_in">NSZone</span> *)zone; <span class="hljs-comment">// å®ç°å¯å˜ç‰ˆæœ¬æ‹·è´</span><br>- (<span class="hljs-keyword">id</span>)mutableCopyWithZone:(<span class="hljs-built_in">NSZone</span> *)zone;<br><span class="hljs-comment">// é‡å†™å¸¦ copy å…³é”®å­—çš„ setter</span><br>- (<span class="hljs-keyword">void</span>)setName:(<span class="hljs-built_in">NSString</span> *)name &#123;<br>    _name = [name <span class="hljs-keyword">copy</span>];<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ·±æ‹·è´å’Œæµ…æ‹·è´"><a href="#æ·±æ‹·è´å’Œæµ…æ‹·è´" class="headerlink" title="æ·±æ‹·è´å’Œæµ…æ‹·è´"></a>æ·±æ‹·è´å’Œæµ…æ‹·è´</h3><h4 id="copy-å’Œ-mutableCopy"><a href="#copy-å’Œ-mutableCopy" class="headerlink" title="copy å’Œ mutableCopy"></a>copy å’Œ mutableCopy</h4><ul><li><p><code>copy</code>æ‹·è´å‡ºæ¥çš„å¯¹è±¡ç±»å‹æ€»æ˜¯ä¸å¯å˜ç±»å‹(ä¾‹å¦‚, NSString, NSDictionary, NSArrayç­‰ç­‰)</p></li><li><p><code>mutableCopy</code>æ‹·è´å‡ºæ¥çš„å¯¹è±¡ç±»å‹æ€»æ˜¯å¯å˜ç±»å‹(ä¾‹å¦‚, NSMutableString, NSMutableDictionary, NSMutableArrayç­‰ç­‰)</p></li></ul><hr><ul><li><code>copy</code> å¯¹äºå¯å˜å¯¹è±¡ä¸ºæ·±æ‹·è´ï¼Œå¯¹äºä¸å¯å˜å¯¹è±¡ä¸ºæµ…æ‹·è´</li><li><code>mutableCopy</code> å§‹ç»ˆæ˜¯æ·±æ‹·è´</li></ul>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>é¢è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOS é¢è¯•é¢˜ï¼ˆ ä¸ƒï¼‰</title>
    <link href="/2018/07/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-007/"/>
    <url>/2018/07/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-007/</url>
    
    <content type="html"><![CDATA[<h3 id="çº¿ç¨‹æ­»é”çš„å¿…è¦æ¡ä»¶"><a href="#çº¿ç¨‹æ­»é”çš„å¿…è¦æ¡ä»¶" class="headerlink" title="çº¿ç¨‹æ­»é”çš„å¿…è¦æ¡ä»¶"></a>çº¿ç¨‹æ­»é”çš„å¿…è¦æ¡ä»¶</h3><ol><li>äº’æ–¥æ¡ä»¶ : ä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚</li><li>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ : ä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li><li>ä¸å‰¥å¤ºæ¡ä»¶ : è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚</li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶ : è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚</li></ol><h4 id="å¤šå›¾ä¸‹è½½ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªå›¾ç‰‡çš„æ–¹å¼"><a href="#å¤šå›¾ä¸‹è½½ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªå›¾ç‰‡çš„æ–¹å¼" class="headerlink" title="å¤šå›¾ä¸‹è½½ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªå›¾ç‰‡çš„æ–¹å¼"></a>å¤šå›¾ä¸‹è½½ï¼Œæœ€ååˆå¹¶æˆä¸€ä¸ªå›¾ç‰‡çš„æ–¹å¼</h4><ol><li>dispatch_group</li><li>ä¿¡å·é‡</li><li>NSOperationQueue</li></ol><h3 id="çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»"><a href="#çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»" class="headerlink" title="çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»"></a>çº¿ç¨‹ä¸è¿›ç¨‹çš„å…³ç³»</h3><ol><li>è¿›ç¨‹æ˜¯èµ„æºçš„åˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•å…ƒï¼Œè€Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•å…ƒ</li><li>åŒä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”çº¿ç¨‹å…±äº«æ•´ä¸ªè¿›ç¨‹çš„èµ„æºï¼ˆå¯„å­˜å™¨ã€å †æ ˆã€ä¸Šä¸‹æ–‡ï¼‰ï¼Œä¸€ä¸ªè¿›è¡Œè‡³å°‘åŒ…æ‹¬ä¸€ä¸ªçº¿ç¨‹ã€‚</li><li>è¿›ç¨‹çš„åˆ›å»ºè°ƒç”¨forkæˆ–è€…vforkï¼Œè€Œçº¿ç¨‹çš„åˆ›å»ºè°ƒç”¨pthread_createï¼Œè¿›ç¨‹ç»“æŸåå®ƒæ‹¥æœ‰çš„æ‰€æœ‰çº¿ç¨‹éƒ½å°†é”€æ¯ï¼Œè€Œçº¿ç¨‹çš„ç»“æŸä¸ä¼šå½±å“åŒä¸ªè¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹çš„ç»“æŸ</li><li>çº¿ç¨‹æ˜¯è½»ä¸¤çº§çš„è¿›ç¨‹ï¼Œå®ƒçš„åˆ›å»ºå’Œé”€æ¯æ‰€éœ€è¦çš„æ—¶é—´æ¯”è¿›ç¨‹å°å¾ˆå¤šï¼Œæ‰€æœ‰æ“ä½œç³»ç»Ÿä¸­çš„æ‰§è¡ŒåŠŸèƒ½éƒ½æ˜¯åˆ›å»ºçº¿ç¨‹å»å®Œæˆçš„</li><li>çº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ä¸€èˆ¬éƒ½è¦è¿›è¡ŒåŒæ­¥å’Œäº’æ–¥ï¼Œå› ä¸ºä»–ä»¬å…±äº«åŒä¸€è¿›ç¨‹çš„æ‰€æœ‰èµ„æº</li><li>çº¿ç¨‹æœ‰è‡ªå·±çš„ç§æœ‰å±æ€§TCBï¼Œçº¿ç¨‹idï¼Œå¯„å­˜å™¨ã€ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼Œè€Œè¿›ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰å±æ€§è¿›ç¨‹æ§åˆ¶å—PCBï¼Œè¿™äº›ç§æœ‰å±æ€§æ˜¯ä¸è¢«å…±äº«çš„ï¼Œç”¨æ¥æ ‡ç¤ºä¸€ä¸ªè¿›ç¨‹æˆ–ä¸€ä¸ªçº¿ç¨‹çš„æ ‡å¿—</li></ol><h3 id="çº¿ç¨‹ä¸Runloopçš„å…³ç³»"><a href="#çº¿ç¨‹ä¸Runloopçš„å…³ç³»" class="headerlink" title="çº¿ç¨‹ä¸Runloopçš„å…³ç³»"></a>çº¿ç¨‹ä¸Runloopçš„å…³ç³»</h3><ol><li>RunLoop çš„ä½œç”¨å°±æ˜¯æ¥ç®¡ç†çº¿ç¨‹çš„ï¼Œå½“çº¿ç¨‹çš„ RunLoopå¼€å¯åï¼Œçº¿ç¨‹å°±ä¼šåœ¨æ‰§è¡Œå®Œä»»åŠ¡åï¼Œå¤„äºä¼‘çœ çŠ¶æ€ï¼Œéšæ—¶ç­‰å¾…æ¥å—æ–°çš„ä»»åŠ¡ï¼Œè€Œä¸æ˜¯é€€å‡ºã€‚</li><li>åªæœ‰ä¸»çº¿ç¨‹çš„RunLoopæ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€ä»¥ç¨‹åºåœ¨å¼€å¯åï¼Œä¼šä¸€ç›´è¿è¡Œï¼Œä¸ä¼šé€€å‡ºã€‚å…¶ä»–çº¿ç¨‹çš„RunLoopå¦‚æœéœ€è¦å¼€å¯ï¼Œå°±æ‰‹åŠ¨å¼€å¯ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>é¢è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOS é¢è¯•é¢˜ï¼ˆå…­ï¼‰</title>
    <link href="/2018/06/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-006/"/>
    <url>/2018/06/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-006/</url>
    
    <content type="html"><![CDATA[<h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><ul><li><p>å¦‚ä½•æ˜¯è‡ªå·±å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½</p><blockquote><p> éœ€å®ç° NSCopying åè®®ã€‚</p></blockquote></li><li><p>è¯´è¯´ä½ å¦‚ä½•ç†è§£weakå±æ€§</p><blockquote><p>Runtimeç»´æŠ¤äº†ä¸€ä¸ªweakè¡¨ï¼Œç”¨äºå­˜å‚¨æŒ‡å‘æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰weakæŒ‡é’ˆã€‚weakè¡¨å…¶å®æ˜¯ä¸€ä¸ªhashï¼ˆå“ˆå¸Œï¼‰è¡¨ï¼ŒKeyæ˜¯æ‰€æŒ‡å¯¹è±¡çš„åœ°å€ï¼ŒValueæ˜¯weakæŒ‡é’ˆçš„åœ°å€ï¼ˆè¿™ä¸ªåœ°å€çš„å€¼æ˜¯æ‰€æŒ‡å¯¹è±¡çš„åœ°å€ï¼‰æ•°ç»„ã€‚<br><br>1ã€åˆå§‹åŒ–æ—¶ï¼šruntimeä¼šè°ƒç”¨objc_initWeakå‡½æ•°ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„weakæŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„åœ°å€ã€‚<br><br>2ã€æ·»åŠ å¼•ç”¨æ—¶ï¼šobjc_initWeakå‡½æ•°ä¼šè°ƒç”¨ objc_storeWeak() å‡½æ•°ï¼Œ objc_storeWeak() çš„ä½œç”¨æ˜¯æ›´æ–°æŒ‡é’ˆæŒ‡å‘ï¼Œåˆ›å»ºå¯¹åº”çš„å¼±å¼•ç”¨è¡¨ã€‚<br><br>3ã€é‡Šæ”¾æ—¶ï¼Œè°ƒç”¨clearDeallocatingå‡½æ•°ã€‚clearDeallocatingå‡½æ•°é¦–å…ˆæ ¹æ®å¯¹è±¡åœ°å€è·å–æ‰€æœ‰weakæŒ‡é’ˆåœ°å€çš„æ•°ç»„ï¼Œç„¶åéå†è¿™ä¸ªæ•°ç»„æŠŠå…¶ä¸­çš„æ•°æ®è®¾ä¸ºnilï¼Œæœ€åæŠŠè¿™ä¸ªentryä»weakè¡¨ä¸­åˆ é™¤ï¼Œæœ€åæ¸…ç†å¯¹è±¡çš„è®°å½•ã€‚</p></blockquote></li><li><p>UIViewå’ŒCALayerçš„å…³ç³»</p><blockquote><p>æ¯ä¸ªUIViewéƒ½å¯¹åº”ç€ä¸€ä¸ªCALayer,å½“æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªUIViewä¹‹åä¹Ÿä¼šåˆ›å»ºå¯¹åº”çš„CALayerã€‚UIViewä¹‹æ‰€ä»¥èƒ½å¤Ÿæ˜¾ç¤ºå†…å®¹ï¼Œå…¶å®è¿˜æ˜¯é CALayeræ¥ç»˜åˆ¶çš„ã€‚UIViewæœ¬èº«å°±åƒæ˜¯CALayerçš„ç®¡ç†è€…ï¼Œè®¿é—®UIViewçš„åæ ‡ï¼Œä¾‹å¦‚ï¼šframeï¼Œcenterç­‰ï¼Œå…¶å®æ˜¯è®¿é—®å†…éƒ¨layerçš„frameã€positionç­‰ç›¸å…³å±æ€§ã€‚</p></blockquote></li></ul><ul><li><p>@synthesizeå’Œ@dynamicåˆ†åˆ«ä»€ä¹ˆä½œç”¨?</p><blockquote><p>1ã€@propertyæœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯ï¼Œä¸€ä¸ªæ˜¯ @synthesizeï¼Œä¸€ä¸ªæ˜¯ @dynamicã€‚å¦‚æœ @synthesizeå’Œ @dynamicéƒ½æ²¡å†™ï¼Œé‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯@syntheszie var = _var;<br><br>2ã€@synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚<br><br>3ã€@dynamic å‘Šè¯‰ç¼–è¯‘å™¨ï¼šå±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°ï¼Œä¸è‡ªåŠ¨ç”Ÿæˆã€‚ï¼ˆå½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯ï¼‰ã€‚å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º @dynamic varï¼Œç„¶åä½ æ²¡æœ‰æä¾› @setteræ–¹æ³•å’Œ @getter æ–¹æ³•ï¼Œç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜ï¼Œä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ°Â instance.var = someVarï¼Œç”±äºç¼º setter æ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼›æˆ–è€…å½“è¿è¡Œåˆ°Â someVar = varÂ æ—¶ï¼Œç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚ç¼–è¯‘æ—¶æ²¡é—®é¢˜ï¼Œè¿è¡Œæ—¶æ‰æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„åŠ¨æ€ç»‘å®šã€‚</p></blockquote></li><li><p>åŠ¨æ€ç»‘å®š</p></li><li><p>Category(ç±»åˆ«)ã€Extension(æ‰©å±•)å’Œç»§æ‰¿çš„åŒºåˆ«</p><blockquote><p>1ã€Categoryï¼šåˆ†ç±»å°±æ˜¯å¯¹ä¸€ä¸ªç±»çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•,,è®©è¿™ä¸ªç±»èƒ½å¤Ÿé€‚åº”ä¸ä¸åŒæƒ…å†µçš„éœ€æ±‚.åœ¨ä¸€èˆ¬çš„å®é™…å¼€å‘ä¸­,æˆ‘ä»¬éƒ½ä¼šå¯¹ç³»ç»Ÿçš„ä¸€äº›å¸¸ç”¨ç±»è¿›è¡Œæ‰©å±•,æ¯”å¦‚,NSString,Button,Labelç­‰ç­‰,ç®€å•æ¥è¯´ç±»åˆ«æ˜¯ä¸€ç§ä¸ºç°æœ‰çš„ç±»æ·»åŠ æ–°æ–¹æ³•çš„æ–¹å¼ã€‚<br><br><br>2ã€Extensionï¼šæ˜¯Categoryçš„ä¸€ä¸ªç‰¹ä¾‹<br>ä½œç”¨:ä¸ºä¸€ä¸ªç±»å¢åŠ ç§æœ‰æ–¹æ³•,å±æ€§æˆ–æˆå‘˜å˜é‡,ä¹Ÿå°±æ˜¯è¯´åªèƒ½è¿™äº›åªèƒ½åœ¨æœ¬æ–‡ä»¶ä¸­è¢«ä½¿ç”¨å…¶åå­—ä¸ºåŒ¿å(ä¸ºç©º),<br>å¹¶ä¸”æ–°æ·»åŠ çš„æ–¹æ³•ä¸€å®šè¦äºˆä»¥å®ç°ã€‚(Categoryæ²¡æœ‰è¿™ä¸ªé™åˆ¶)<br><br><br>3ã€ç»§æ‰¿ï¼šå¤šä¸ªç±»å…·æœ‰ç›¸åŒçš„å®ä¾‹å˜é‡å’Œæ–¹æ³•æ—¶ï¼Œè€ƒè™‘ç”¨ç»§æ‰¿ã€‚å³å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»çš„ç›¸åŒç‰¹æ€§ã€‚å¦‚animalå…·æœ‰å¹´é¾„å’Œä½“é‡ä¸¤ä¸ªå±æ€§ï¼Œdogä¹Ÿå…·æœ‰å¹´é¾„å’Œä½“é‡ä¸¤ ä¸ªå±æ€§ï¼Œdogå¯ä»¥ç»§æ‰¿animalçš„è¿™ä¸¤ä¸ªå±æ€§ï¼Œå³ä¸ºç»§æ‰¿ã€‚</p></blockquote></li><li><p>ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿdelegateå’ŒDataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŸBlockå’Œä»£ç†çš„åŒºåˆ«ï¼Ÿ</p></li></ul><ul><li><p>idå’ŒNSObject *çš„åŒºåˆ«</p><blockquote><p>1ã€NSObjectåŒ…å«äº†ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œéœ€è¦å®ç°NSObjectåè®®ï¼Œå¯ä»¥ç”¨NSObjectæ¥è¡¨ç¤ºidï¼Œä½†æ˜¯ä¸èƒ½ç”¨idæ¥è¡¨ç¤ºNSObjectã€‚<br><br>2ã€idå…³é”®å­—åœ¨ç¼–è¯‘çš„æ—¶å€™ä¸ä¼šè¢«æ£€æŸ¥ï¼Œè€ŒNSObjectåœ¨ç¼–è¯‘çš„æ—¶å€™è¢«è¢«æ£€æŸ¥æ˜¯å¦å«æœ‰ä¸€äº›é”™è¯¯çš„æ–¹æ³•<br><br>3ã€idå¯ä»¥æ˜¯ä»»ä½•å¯¹è±¡ï¼ŒåŒ…æ‹¬ä¸æ˜¯NSObjectçš„å¯¹è±¡<br><br>4ã€å®šä¹‰idçš„æ—¶å€™ä¸éœ€è¦*ï¼Œè€Œå®šä¹‰NSOjectçš„æ—¶å€™éœ€è¦ã€‚</p></blockquote></li><li><p>é’ˆå¯¹ç³»ç»Ÿæä¾›çš„Block APIï¼Œæ˜¯å¦ä¹Ÿè¦è€ƒè™‘å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Ÿ</p><blockquote><p>ç³»ç»Ÿçš„æŸäº›block apiä¸­ï¼ŒUIViewçš„blockç‰ˆæœ¬å†™åŠ¨ç”»æ—¶ä¸éœ€è¦è€ƒè™‘ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›api éœ€è¦è€ƒè™‘ã€‚<br>ä»¥ä¸‹è¿™äº›ä½¿ç”¨æ–¹å¼ä¸ä¼šå¼•èµ·å¾ªç¯å¼•ç”¨çš„é—®é¢˜</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs clojure">[UIView animateWithDuration:1.2 animations:<span class="hljs-comment">^&#123;</span><br><span class="hljs-comment">        [self.view layoutIfNeeded];</span><br><span class="hljs-comment">    &#125;</span>]<span class="hljs-comment">;</span><br>    <br>    [[NSOperationQueue mainQueue] addOperationWithBlock:<span class="hljs-comment">^&#123;</span><br><span class="hljs-comment">       // Do Some Thing</span><br><span class="hljs-comment">    &#125;</span>]<span class="hljs-comment">;</span><br>    <br>    [[NSNotificationCenter defaultCenter] addObserverForName:@<span class="hljs-string">&quot;someNotification&quot;</span> object:nil queue:[NSOperationQueue mainQueue] usingBlock:^(<span class="hljs-name">NSNotification</span> * _Nonnull note) &#123;<br>         // Do Some Thing<br>    &#125;]<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>ä½†å¦‚æœæ–¹æ³•ä¸­çš„ä¸€äº›å‚æ•°æ˜¯ æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆå¯ä»¥é€ æˆå¾ªç¯å¼•ç”¨ï¼Œå¦‚ GCD ã€NSNotificationCenterè°ƒç”¨å°±è¦å°å¿ƒä¸€ç‚¹ï¼Œæ¯”å¦‚ GCD å†…éƒ¨å¦‚æœå¼•ç”¨äº† selfï¼Œè€Œä¸” GCD çš„å‚æ•°æ˜¯ æˆå‘˜å˜é‡ï¼Œåˆ™è¦è€ƒè™‘åˆ°å¾ªç¯å¼•ç”¨ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š<br><br>GCD-&gt;åˆ†æï¼šselfâ€“&gt;_operationsQueueâ€“&gt;blockâ€“&gt;selfå½¢æˆé—­ç¯ï¼Œå°±é€ æˆäº†å¾ªç¯å¼•ç”¨</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs less">&gt;<span class="hljs-selector-tag">dispatch_group_async</span>(_operationsGroup, _operationsQueue, ^&#123;<br>       <span class="hljs-comment">// Do Some Thing</span><br>&gt;&#125;);<br></code></pre></td></tr></table></figure><p>NSNotificationCenter-&gt;åˆ†æ:selfâ€“&gt;_observerâ€“&gt;blockâ€“&gt;selfå½¢æˆé—­ç¯ï¼Œå°±é€ æˆäº†å¾ªç¯å¼•ç”¨</p><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs objectivec">&gt;_observer = [[<span class="hljs-built_in">NSNotificationCenter</span> defaultCenter] addObserverForName:<span class="hljs-string">@&quot;testKey&quot;</span> object:<span class="hljs-literal">nil</span> queue:<span class="hljs-literal">nil</span> usingBlock:^(<span class="hljs-built_in">NSNotification</span> *note)&#123;<br><span class="hljs-comment">// Do Some Thing</span><br>&gt;&#125;];<br></code></pre></td></tr></table></figure></blockquote></li><li><p>åœ¨@propertyä¸­ä¸ºä»€ä¹ˆ NSString ï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ä½¿ç”¨copyå…³é”®å­—ï¼Ÿæ”¹æˆStrongæœ‰å¯èƒ½ä¼šé€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><blockquote><p>1ã€å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨copyçš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨copyæ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.<br><br>2ã€å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§.</p></blockquote></li><li><p>å…³é”®å­—const/static/externã€UIKIT_EXTERNåŒºåˆ«å’Œç”¨æ³•</p><blockquote><p>1ã€const<br><br>ï¼ˆ1ï¼‰constç”¨æ¥ä¿®é¥°å³è¾¹çš„åŸºæœ¬å˜é‡æˆ–æŒ‡é’ˆå˜é‡<br><br>ï¼ˆ2ï¼‰è¢«ä¿®é¥°çš„å˜é‡åªè¯»ï¼Œä¸èƒ½è¢«ä¿®æ”¹<br><br> <br>2ã€static<br><br>ï¼ˆ1ï¼‰ä¿®é¥°å±€éƒ¨å˜é‡<br><br>ï¼ˆ2ï¼‰ä¿®é¥°å…¨å±€å˜é‡<br><br>ï¼ˆ3ï¼‰ä¿®é¥°å‡½æ•°<br><br><br>3ã€extern<br><br>ï¼ˆ1ï¼‰å£°æ˜å¤–éƒ¨å…¨å±€å˜é‡ã€‚è¿™é‡Œéœ€è¦ç‰¹åˆ«æ³¨æ„externåªèƒ½å£°æ˜ï¼Œä¸èƒ½ç”¨äºå®ç°ï¼Œè€Œä¸”å®šä¹‰å’Œåˆ†é…å†…å­˜éƒ½åœ¨åŸæ¥ç±»ä¸­ã€‚<br><br><br>4ã€UIKIT_EXTERN<br><br>ï¼ˆ1ï¼‰å°†å‡½æ•°ä¿®é¥°ä¸ºå…¼å®¹ä»¥å¾€Cç¼–è¯‘æ–¹å¼çš„ã€å…·æœ‰externå±æ€§(æ–‡ä»¶å¤–å¯è§æ€§)ã€publicä¿®é¥°çš„æ–¹æ³•æˆ–å˜é‡åº“å¤–ä»å¯è§çš„å±æ€§</p></blockquote><h3 id="åº•å±‚"><a href="#åº•å±‚" class="headerlink" title="åº•å±‚"></a>åº•å±‚</h3></li><li><p>main()ä¹‹å‰æœ‰å“ªäº›è¿‡ç¨‹ï¼Ÿ</p></li><li><p>KVOçš„åŸç†</p></li></ul><blockquote><p>å½“è§‚å¯ŸæŸå¯¹è±¡æ—¶ï¼ŒKVOåŠ¨æ€åˆ›å»ºè¯¥å¯¹è±¡çš„å­ç±»ï¼Œå¹¶é‡å†™å­ç±»è¢«è§‚å¯Ÿå±æ€§setteræ–¹æ³•ï¼Œéšåé€šçŸ¥è§‚å¯Ÿè€…è¯¥å±æ€§çš„å˜åŒ–çŠ¶å†µã€‚</p></blockquote><ul><li><p>Swiftå¦‚ä½•ä½¿ç”¨KVOï¼Ÿ</p></li><li><p>Swiftæœ‰å“ªäº›åŒ¹é…æ¨¡å¼ï¼Ÿ</p></li><li><p>Objcå‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p><blockquote><p>Runtimeåº“ä¼šæ ¹æ®å¯¹è±¡çš„isaæŒ‡é’ˆæ‰¾åˆ°è¯¥å¯¹è±¡å®é™…æ‰€å±çš„ç±»ï¼Œç„¶ååœ¨è¯¥ç±»ä¸­çš„æ–¹æ³•åˆ—è¡¨ä»¥åŠå…¶çˆ¶ç±»æ–¹æ³•åˆ—è¡¨ä¸­å¯»æ‰¾æ–¹æ³•è¿è¡Œï¼Œç„¶ååœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œobjc_msgSendæ–¹æ³•ä¸ä¼šè¿”å›å€¼ï¼Œæ‰€è°“çš„è¿”å›å†…å®¹éƒ½æ˜¯å…·ä½“è°ƒç”¨æ—¶æ‰§è¡Œçš„ã€‚</p></blockquote></li><li><p>é™æ€åº“çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿä½ æœ‰æ²¡æœ‰å†™è¿‡å“ªäº›é™æ€åº“? é‡åˆ°å“ªäº›é—®é¢˜ï¼Ÿ</p></li><li><p>Runloopæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿrunloopå’Œçº¿ç¨‹çš„å…³ç³»ï¼Ÿä¸»çº¿ç¨‹é»˜è®¤å¼€å§‹runloopäº†å—ï¼Ÿ å­çº¿ç¨‹å‘¢ï¼Ÿ</p><blockquote></blockquote></li><li><p>ä¸æ‰‹åŠ¨æŒ‡å®šautoreleasepoolçš„å‰æä¸‹ï¼Œautoreleasepoolåœ¨ä»€ä¹ˆä»€ä¹ˆæ—¶åˆ»é‡Šæ”¾ï¼Ÿï¼ˆæ¯”å¦‚åœ¨vcçš„viewDidLoadä¸­åˆ›å»ºï¼‰</p><blockquote><ul><li>æ‰‹åŠ¨å¹²é¢„é‡Šæ”¾æ—¶æœº - æŒ‡å®šautoreleasepoolå°±æ˜¯æ‰€è°“çš„ï¼šå½“å‰ä½œç”¨åŸŸå¤§æ‹¬å·ç»“æŸæ—¶é‡Šæ”¾ã€‚</li><li>ç³»ç»Ÿè‡ªåŠ¨å»é‡Šæ”¾ - ä¸æ‰‹åŠ¨æŒ‡å®šautoreleasepool<br>Autoreleaseå¯¹è±¡å‡ºäº†ä½œç”¨åŸŸä¹‹åï¼Œä¼šè¢«æ·»åŠ åˆ°æœ€è¿‘ä¸€æ¬¡åˆ›å»ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œå¹¶ä¼šåœ¨å½“å‰çš„ runloop è¿­ä»£ç»“æŸæ—¶é‡Šæ”¾ã€‚<br>å¦‚æœåœ¨ä¸€ä¸ªvcçš„viewDidLoadä¸­åˆ›å»ºä¸€ä¸ª Autoreleaseå¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡ä¼šåœ¨ viewDidAppear æ–¹æ³•æ‰§è¡Œå‰å°±è¢«é”€æ¯äº†ã€‚</li></ul></blockquote></li></ul><ul><li><p>OCä¸­çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶+ä»£ç å®ç°</p><blockquote></blockquote></li><li><p>ä»¥ + scheduledTimerWithTimeIntervalâ€¦çš„æ–¹å¼è§¦å‘çš„NSTimerï¼Œåœ¨æ»‘åŠ¨çš„åˆ—è¡¨æ—¶ï¼Œtimerä¼šæš‚æ—¶å›è°ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</p><blockquote></blockquote></li><li><p>å¦‚ä½•æ‰‹åŠ¨è§¦å‘ä¸€ä¸ªvalueçš„KVOï¼Ÿ</p><blockquote><p>è‡ªåŠ¨è§¦å‘ï¼š</p><blockquote><p>è‡ªåŠ¨è§¦å‘æ˜¯æŒ‡ç±»ä¼¼çš„è¿™ç§åœºæ™¯ï¼šåœ¨æ³¨å†ŒKVOä¹‹å‰è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼Œ<br>æ³¨å†Œä¹‹åè®¾ç½®ä¸€ä¸ªä¸ä¸€æ ·çš„å€¼ï¼Œå°±å¯ä»¥è§¦å‘äº†ã€‚</p></blockquote></blockquote></li></ul><blockquote><p>æ‰‹åŠ¨è§¦å‘ï¼š</p><blockquote><p>é”®å€¼è§‚å¯Ÿé€šçŸ¥ä¾èµ–äºNSObjectçš„ä¸¤ä¸ªæ–¹æ³•ï¼š<br>willChangeValueForKeyï¼šå’ŒdidChangeValueForKeyï¼šã€‚<br>åœ¨ä¸€ä¸ªè¢«è§‚å¯Ÿå±æ€§å‘ç”Ÿæ”¹å˜ä¹‹å‰ï¼ŒwillChangeValueForKeyï¼šä¸€å®šä¼šè¢«è°ƒç”¨ï¼Œè¿™å°±ä¼šè®°å½•æ—§çš„å€¼ã€‚<br>è€Œå½“æ”¹å˜å‘ç”Ÿåï¼ŒdidChangeValueForKeyï¼šä¼šè¢«è°ƒç”¨ï¼Œ<br>ç»§è€ŒobjectServeValueForKeyï¼šofObjectï¼šchangeï¼šcontentï¼šä¹Ÿä¼šè¢«è°ƒç”¨ã€‚<br>å¦‚æœå¯ä»¥æ‰‹åŠ¨å®ç°è¿™äº›è°ƒç”¨ï¼Œå°±å¯ä»¥å®ç°â€œæ‰‹åŠ¨è§¦å‘â€äº†ã€‚</p></blockquote></blockquote><ul><li>å¦‚ä½•å®šä½å’Œåˆ†æé¡¹ç›®ä¸­å½±å“æ€§èƒ½çš„åœ°æ–¹ï¼Ÿä»¥åŠå¦‚ä½•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Ÿ</li><li>ä¸²è¡Œå¹¶è¡Œï¼Œå¼‚æ­¥åŒæ­¥çš„åŒºåˆ«<blockquote><ul><li>ä¸²è¡Œå¹¶è¡Œ<blockquote><p>æŒ‡çš„æ˜¯èƒ½å¦å¼€å¯æ–°çš„çº¿ç¨‹ã€‚åŒæ­¥ä¸èƒ½å¼€å¯æ–°çš„çº¿ç¨‹ï¼Œå¼‚æ­¥å¯ä»¥ã€‚</p></blockquote></li><li>å¼‚æ­¥åŒæ­¥<blockquote><p>æŒ‡çš„æ˜¯ä»»åŠ¡çš„æ‰§è¡Œæ–¹å¼ã€‚ä¸²è¡Œæ˜¯æŒ‡å¤šä¸ªä»»åŠ¡æ—¶ï¼Œå„ä¸ªä»»åŠ¡æŒ‰é¡ºåºæ‰§è¡Œï¼Œå®Œæˆä¸€ä¸ªä¹‹åæ‰èƒ½è¿›è¡Œä¸‹ä¸€ä¸ªã€‚å¹¶è¡ŒæŒ‡çš„æ˜¯å¤šä¸ªä»»åŠ¡å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚å¼‚æ­¥æ˜¯å¤šä¸ªä»»åŠ¡å¹¶è¡Œçš„å‰ææ¡ä»¶ã€‚</p></blockquote></li></ul></blockquote></li></ul><ul><li>çº¿ç¨‹æ˜¯ä»€ä¹ˆï¼Ÿè¿›ç¨‹æ˜¯ä»€ä¹ˆï¼ŸäºŒè€…æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ï¼Ÿ<blockquote><ul><li>çº¿ç¨‹æ˜¯CPUç‹¬ç«‹è¿è¡Œå’Œç‹¬ç«‹è°ƒåº¦çš„åŸºæœ¬å•ä½</li><li>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼›</li><li>ä¸¤è€…çš„è”ç³»ï¼šè¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯æ“ä½œç³»ç»Ÿæ‰€è¿è¡Œçš„ç¨‹åºè¿è¡Œçš„åŸºæœ¬å•å…ƒã€‚</li><li>åŒºåˆ«ï¼š<blockquote><ul><li>è¿›ç¨‹å…·æœ‰ç‹¬ç«‹çš„ç©ºé—´åœ°å€ï¼Œä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶å®ƒè¿›ç¨‹äº§ç”Ÿå½±å“ã€‚</li><li>çº¿ç¨‹åªæ˜¯ä¸€ä¸ªè¿›ç¨‹çš„ä¸åŒæ‰§è¡Œè·¯å¾„ï¼Œçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡ï¼Œä½†çº¿ç¨‹ä¹‹é—´æ²¡æœ‰å•ç‹¬çš„åœ°å€ç©ºé—´ï¼Œä¸€ä¸ªçº¿ç¨‹æ­»æ‰å°±ç­‰äºæ•´ä¸ªè¿›ç¨‹æ­»æ‰ã€‚</li></ul></blockquote></li></ul></blockquote></li></ul>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>é¢è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOS é¢è¯•é¢˜ï¼ˆäº”ï¼‰</title>
    <link href="/2018/05/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-005/"/>
    <url>/2018/05/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-005/</url>
    
    <content type="html"><![CDATA[<p><img src="https://upload-images.jianshu.io/upload_images/3334769-4869f853f408a4d9.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="é•‡æ¥¼ä¸“ç”¨"></p><h2 id="åŸºç¡€é¢è¯•é¢˜"><a href="#åŸºç¡€é¢è¯•é¢˜" class="headerlink" title="åŸºç¡€é¢è¯•é¢˜"></a>åŸºç¡€é¢è¯•é¢˜</h2><h3 id="ä¸€ã€ä¸¤ç§æ‹·è´çš„å·®åˆ«"><a href="#ä¸€ã€ä¸¤ç§æ‹·è´çš„å·®åˆ«" class="headerlink" title="ä¸€ã€ä¸¤ç§æ‹·è´çš„å·®åˆ«"></a>ä¸€ã€ä¸¤ç§æ‹·è´çš„å·®åˆ«</h3><ul><li><p>æµ…æ‹·è´ï¼šæŒ‡é’ˆï¼ˆåœ°å€ï¼‰æ‹·è´ï¼Œä¸ä¼šäº§ç”Ÿæ–°å¯¹è±¡</p></li><li><p>æ·±æ‹·è´ï¼šå†…å®¹æ‹·è´ï¼Œä¼šäº§ç”Ÿæ–°å¯¹è±¡</p></li></ul><h3 id="äºŒã€Categoryå’ŒExtensionçš„å·®åˆ«"><a href="#äºŒã€Categoryå’ŒExtensionçš„å·®åˆ«" class="headerlink" title="äºŒã€Categoryå’ŒExtensionçš„å·®åˆ«"></a>äºŒã€Categoryå’ŒExtensionçš„å·®åˆ«</h3><ul><li><p>åˆ†ç±»æ˜¯æœ‰åç§°çš„ï¼Œç±»æ‰©å±•æ²¡æœ‰åç§°</p></li><li><p>åˆ†ç±»åªèƒ½æ‰©å……æ–¹æ³•ã€ä¸èƒ½æ‰©å……æˆå‘˜å˜é‡ï¼ˆéœ€è¦åˆ©ç”¨RunTimeé‡å†™setã€getæ–¹æ³•ï¼‰ï¼›ç±»æ‰©å±•å¯ä»¥æ‰©å……æ–¹æ³•å’Œæˆå‘˜å˜é‡</p></li><li><p>ç±»æ‰©å±•ä¸€èˆ¬å°±å†™åœ¨.mæ–‡ä»¶ä¸­ï¼Œç”¨æ¥æ‰©å……ç§æœ‰çš„æ–¹æ³•å’Œæˆå‘˜å˜é‡ï¼ˆå±æ€§ï¼‰</p></li></ul><h3 id="ä¸‰ã€KVOå’ŒKVCçš„å·®åˆ«"><a href="#ä¸‰ã€KVOå’ŒKVCçš„å·®åˆ«" class="headerlink" title="ä¸‰ã€KVOå’ŒKVCçš„å·®åˆ«"></a>ä¸‰ã€KVOå’ŒKVCçš„å·®åˆ«</h3><ul><li>KVCæ˜¯é”®å€¼ç¼–ç ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªå­—ç¬¦ä¸²çš„keyï¼ˆå±æ€§åï¼‰ä¿®æ”¹å¯¹è±¡çš„å±æ€§å€¼</li><li></li><li>KVOæ˜¯é”®å€¼ç›‘å¬ï¼Œå¯ä»¥ç›‘å¬ä¸€ä¸ªå¯¹è±¡å±æ€§å€¼çš„æ”¹å˜</li></ul><h3 id="å››ã€propertyå±æ€§ä»‹ç»"><a href="#å››ã€propertyå±æ€§ä»‹ç»" class="headerlink" title="å››ã€propertyå±æ€§ä»‹ç»"></a>å››ã€propertyå±æ€§ä»‹ç»</h3><ul><li><p>copyæ˜¯åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä¸¤ä¸ªå¯¹è±¡å†…å®¹ç›¸åŒï¼Œæ—§å¯¹è±¡æ²¡æœ‰å˜åŒ–ã€‚æ–°çš„å¯¹è±¡retainä¸º1ï¼Œä¸æ—§æœ‰å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸å˜ã€‚æ—§å¯¹è±¡å‘ç”Ÿæ”¹å˜ä¸å½±å“æ–°å¯¹è±¡ï¼Œcopyå‡å°‘å¯¹è±¡å¯¹ä¸Šä¸‹æ–‡çš„ä¾èµ–ã€‚NSStringã€Blockç­‰ç±»å‹</p></li><li><p>retainå±æ€§è¡¨ç¤ºä¸¤ä¸ªå¯¹è±¡åœ°å€ç›¸åŒï¼ˆå»ºç«‹ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆæ‹·è´ï¼‰ï¼Œå†…å®¹ç›¸åŒï¼Œè¿™ä¸ªå¯¹è±¡çš„retainå€¼+1ã€‚ä¸¤ä¸ªå¯¹è±¡è¦æ”¹å˜å°±ä¸€èµ·æ”¹å˜ã€‚</p></li><li><p>weakå…¶å®ç±»ä¼¼äºassignï¼Œå«å¼±å¼•ç”¨ï¼Œä¹Ÿæ˜¯ä¸å¢åŠ å¼•ç”¨è®¡æ•°ã€‚ä¸€èˆ¬åªæœ‰åœ¨é˜²æ­¢å¾ªç¯å¼•ç”¨æ—¶ä½¿ç”¨ï¼Œæ¯”å¦‚çˆ¶ç±»å¼•ç”¨äº†å­ç±»ï¼Œå­ç±»åˆå»å¼•ç”¨çˆ¶ç±»ã€‚IBOutletã€Delegateä¸€èˆ¬ç”¨çš„å°±æ˜¯weakï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬ä¼šåœ¨ç±»å¤–éƒ¨è¢«è°ƒç”¨ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚</p></li><li><p>assignï¼šéOCå¯¹è±¡ç±»å‹ï¼Œ åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨çš„æ—¶å€™ï¼Œä¸€ç«¯ç”¨retainï¼Œ ä¸€ç«¯ç”¨assignï¼‰</p></li><li><p>strongå°±ç±»ä¼¼ä¸retainäº†ï¼Œå«å¼ºå¼•ç”¨ï¼Œä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œç±»å†…éƒ¨ä½¿ç”¨çš„å±æ€§ä¸€èˆ¬éƒ½æ˜¯strongä¿®é¥°çš„ï¼Œç°åœ¨ARCå·²ç»åŸºæœ¬æ›¿ä»£äº†MRCï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¸¸è§çš„å°±æ˜¯strongäº†ã€‚retainï¼šOCå¯¹è±¡ç±»å‹</p></li><li><p>nonatomic åœ¨ä¿®é¥°å±æ€§æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€è¿˜ä¼šåŠ ä¸€ä¸ªnonatomicï¼Œè¿™åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒçš„åå­—å«éåŸå­è®¿é—®ã€‚å¯¹åº”çš„æœ‰atomicï¼Œæ˜¯åŸå­æ€§çš„è®¿é—®ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä½¿ç”¨å¤šçº¿ç¨‹æ—¶ä¸ºäº†é¿å…åœ¨å†™æ“ä½œæ—¶åŒæ—¶è¿›è¡Œå†™å¯¼è‡´é—®é¢˜ï¼Œç»å¸¸ä¼šå¯¹è¦å†™çš„å¯¹è±¡è¿›è¡ŒåŠ é”ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹å»æ“ä½œå®ƒã€‚å¦‚æœä¸€ä¸ªå±æ€§æ˜¯ç”±atomicä¿®é¥°çš„ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±ä¼šè¿›è¡Œçº¿ç¨‹ä¿æŠ¤ï¼Œé˜²æ­¢å¤šä¸ªå†™æ“ä½œåŒæ—¶è¿›è¡Œã€‚è¿™æœ‰å¥½å¤„ï¼Œä½†ä¹Ÿæœ‰åå¤„ï¼Œé‚£å°±æ˜¯æ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥å¯¹äºiPhoneè¿™ç§å°å‹è®¾å¤‡ï¼Œå¦‚æœä¸æ˜¯è¿›è¡Œå¤šçº¿ç¨‹çš„å†™æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨nonatomicï¼Œå–æ¶ˆçº¿ç¨‹ä¿æŠ¤ï¼Œæé«˜æ€§èƒ½ã€‚</p></li></ul><h3 id="äº”ã€ä»£ç†ï¼Œé€šçŸ¥ï¼Œå’Œblockçš„åŒºåˆ«"><a href="#äº”ã€ä»£ç†ï¼Œé€šçŸ¥ï¼Œå’Œblockçš„åŒºåˆ«" class="headerlink" title="äº”ã€ä»£ç†ï¼Œé€šçŸ¥ï¼Œå’Œblockçš„åŒºåˆ«"></a>äº”ã€ä»£ç†ï¼Œé€šçŸ¥ï¼Œå’Œblockçš„åŒºåˆ«</h3><ul><li><p>é€šçŸ¥ï¼šNotificationCenter é€šçŸ¥ä¸­å¿ƒï¼šâ€œä¸€å¯¹å¤šâ€ï¼Œåœ¨APPä¸­ï¼Œå¾ˆå¤šæ§åˆ¶å™¨éƒ½éœ€è¦çŸ¥é“ä¸€ä¸ªäº‹ä»¶ï¼Œåº”è¯¥ç”¨é€šçŸ¥ï¼›</p></li><li><p>ä»£ç†ï¼šä¸€å¯¹ä¸€â€ï¼Œå¯¹åŒä¸€ä¸ªåè®®ï¼Œä¸€ä¸ªå¯¹è±¡åªèƒ½è®¾ç½®ä¸€ä¸ªä»£ç†delegateï¼Œæ‰€ä»¥å•ä¾‹å¯¹è±¡å°±ä¸èƒ½ç”¨ä»£ç†ï¼›ä»£ç†æ›´æ³¨é‡è¿‡ç¨‹ä¿¡æ¯çš„ä¼ è¾“ï¼šæ¯”å¦‚å‘èµ·ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå¯èƒ½æƒ³è¦çŸ¥é“æ­¤æ—¶è¯·æ±‚æ˜¯å¦å·²ç»å¼€å§‹ã€æ˜¯å¦æ”¶åˆ°äº†æ•°æ®ã€æ•°æ®æ˜¯å¦å·²ç»æ¥å—å®Œæˆã€æ•°æ®æ¥æ”¶å¤±è´¥</p></li><li><p>blockï¼šdelegateä¸€æ ·ï¼Œä¸€èˆ¬éƒ½æ˜¯â€œä¸€å¯¹ä¸€â€ä¹‹é—´é€šä¿¡äº¤äº’ï¼Œç›¸æ¯”ä»£ç†blockæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><pre><code>          1ã€å†™æ³•æ›´ç®€ç»ƒï¼Œä¸éœ€è¦å†™protocolã€å‡½æ•°ç­‰ç­‰          2ã€blockæ³¨é‡ç»“æœçš„ä¼ è¾“ï¼šæ¯”å¦‚å¯¹äºä¸€ä¸ªäº‹ä»¶ï¼Œåªæƒ³çŸ¥é“æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“è¿›è¡Œäº†å¤šå°‘æˆ–è€…é¢å¤–çš„ä¸€äº›ä¿¡æ¯          3ã€blockéœ€è¦æ³¨æ„é˜²æ­¢å¾ªç¯å¼•ç”¨</code></pre></li></ul><h3 id="å…­ã€ç½‘ç»œ"><a href="#å…­ã€ç½‘ç»œ" class="headerlink" title="å…­ã€ç½‘ç»œ"></a>å…­ã€ç½‘ç»œ</h3><ul><li><p>HTTPï¼ˆHyperText Transfer Protocolã€è¶…æ–‡æœ¬ä¼ è¾“åè®®)æ˜¯OSIä¸ƒå±‚ä¸­åº”ç”¨å±‚çš„åè®®ã€‚HTTP æ˜¯åŸºäº TCP/IPåè®®çš„åº”ç”¨å±‚åè®®ã€‚å®ƒä¸æ¶‰åŠæ•°æ®åŒ…ï¼ˆpacketï¼‰ä¼ è¾“ï¼Œä¸»è¦è§„å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ ¼å¼ï¼Œé»˜è®¤ä½¿ç”¨80ç«¯å£ã€‚</p></li><li><p>TCPï¼ˆTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯OSIä¸ƒå±‚ä¸­ä¼ è¾“å±‚çš„åè®®ã€‚TCPï¼ˆTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰æ˜¯åŸºäºè¿æ¥çš„åè®®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ­£å¼æ”¶å‘æ•°æ®å‰ï¼Œå¿…é¡»å’Œå¯¹æ–¹å»ºç«‹å¯é çš„è¿æ¥ã€‚TCPæä¾›è¶…æ—¶é‡å‘ï¼Œä¸¢å¼ƒé‡å¤æ•°æ®ï¼Œæ£€éªŒæ•°æ®ï¼Œæµé‡æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œä¿è¯æ•°æ®èƒ½ä»ä¸€ç«¯ä¼ åˆ°å¦ä¸€ç«¯ã€‚ ç†æƒ³çŠ¶æ€ä¸‹ï¼ŒTCPè¿æ¥ä¸€æ—¦å»ºç«‹ï¼Œåœ¨é€šä¿¡åŒæ–¹ä¸­çš„ä»»ä½•ä¸€æ–¹ä¸»åŠ¨å…³é—­è¿æ¥å‰ï¼ŒTCP è¿æ¥éƒ½å°†è¢«ä¸€ç›´ä¿æŒä¸‹å»ã€‚æ–­å¼€è¿æ¥æ—¶æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å‡å¯ä»¥ä¸»åŠ¨å‘èµ·æ–­å¼€TCPè¿æ¥çš„è¯·æ±‚</p></li><li><p>UDP (User Datagram Protocol,ç”¨æˆ·æ•°æ®æŠ¥åè®®)æ˜¯OSIå‚è€ƒæ¨¡å‹ä¸­æ— è¿æ¥çš„ä¼ è¾“å±‚åè®®.UDPç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œæ˜¯ä¸€ä¸ªæ— è¿æ¥çš„ç®€å•çš„é¢å‘æ•°æ®æŠ¥çš„è¿è¾“å±‚åè®®ã€‚UDPä¸æä¾›å¯é æ€§ï¼Œå®ƒåªæ˜¯æŠŠåº”ç”¨ç¨‹åºä¼ ç»™IPå±‚çš„æ•°æ®æŠ¥å‘é€å‡ºå»ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯å®ƒä»¬èƒ½åˆ°è¾¾ç›®çš„åœ°ã€‚ç”±äºUDPåœ¨ä¼ è¾“æ•°æ®æŠ¥å‰ä¸ç”¨åœ¨å®¢æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œä¸”æ²¡æœ‰è¶…æ—¶é‡å‘ç­‰æœºåˆ¶ï¼Œæ•…è€Œä¼ è¾“é€Ÿåº¦å¾ˆå¿«ã€‚</p></li><li><p>socketæ˜¯å¯¹TCPæˆ–è€…UDPåè®®çš„å°è£…å’Œå®ç°ï¼Œsocketå¹¶ä¸æ˜¯åè®®ï¼Œå·®ä¸å¤šæ¯ä¸€ç§è¯­è¨€éƒ½å®ç°äº†å¯¹TCPå’ŒUDPå°è£…å’Œå®ç°çš„Socketä»£ç åº“ï¼Œæ–¹ä¾¿å¼€å‘ç¨‹åºå‘˜ä½¿ç”¨ï¼Œsocketæ˜¯å¯¹TCPæˆ–è€…UDPåè®®çš„å°è£…å’Œå®ç°ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥åŸºäºä½ æ‰€ä½¿ç”¨è¯­è¨€çš„Socketæ¥å®ç°æ›´å¤šçš„åŠŸèƒ½ï¼Œæœ‰åŸºäºSocket TCPçš„HTTPè¯·æ±‚ï¼Œæœ‰åŸºäºSocket TCPé•¿è¿æ¥çš„æ¶ˆæ¯æ¨é€ï¼Œä¹Ÿå¯ä»¥åŸºäºSocket TCP/UDPè‡ªå®šä¹‰ä¸€å¥—è‡ªå·±çš„é€šä¿¡åè®®ã€‚<br>ï¼ˆ5ï¼‰å…³ç³»â€”&gt; HTTPåŸºäºTCPï¼ŒHTTPè¯·æ±‚éœ€è¦ä½¿ç”¨Socket TCPæ¥å®Œæˆã€‚</p></li></ul><h3 id="ä¸ƒã€å¤šçº¿ç¨‹"><a href="#ä¸ƒã€å¤šçº¿ç¨‹" class="headerlink" title="ä¸ƒã€å¤šçº¿ç¨‹"></a>ä¸ƒã€å¤šçº¿ç¨‹</h3><ul><li><p>è¿›ç¨‹ï¼šè¿›ç¨‹æ˜¯èµ„æºï¼ˆCPUã€å†…å­˜ç­‰ï¼‰åˆ†é…çš„åŸºæœ¬å•ä½ï¼Œå®ƒæ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„ä¸€ä¸ªå®ä¾‹ã€‚</p></li><li><p>çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„æœ€å°å•ä½ï¼Œå®ƒæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªæ‰§è¡Œæµï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç”±å¾ˆå¤šä¸ªçº¿ç¨‹ç»„æˆï¼Œçº¿ç¨‹é—´å…±äº«è¿›ç¨‹çš„æ‰€æœ‰èµ„æºï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡ã€‚</p></li><li><p>pthreadï¼šCè¯­è¨€ç¼–ç¨‹ï¼Œæ‰‹åŠ¨ç®¡ç†çº¿ç¨‹å‘¨æœŸï¼Œä½¿ç”¨éš¾åº¦å¤§ï¼Œä¸å¸¸ç”¨ã€‚</p></li><li><p>NSThreadï¼šOCè¯­è¨€ç¼–ç¨‹ï¼Œæ‰‹åŠ¨ç®¡ç†çº¿ç¨‹å‘¨æœŸï¼Œé¢å‘å¯¹è±¡ï¼Œå¶å°”ä½¿ç”¨</p></li><li><p>GCDï¼šCè¯­è¨€ç¼–ç¨‹ï¼Œæ”¯æŒå¤šæ ¸ï¼Œè‡ªåŠ¨ç®¡ç†çº¿ç¨‹å‘¨æœŸï¼Œå¸¸ç”¨</p></li><li><p>NSOperationï¼šOCè¯­è¨€ç¼–ç¨‹ï¼ŒåŸºäºGCDï¼Œæ¯”GCDæ–°å¢æ–°åŠŸèƒ½ï¼Œå¸¸ç”¨</p></li><li><p>çº¿ç¨‹é”ï¼šçº¿ç¨‹æ­»é”æœ‰â€œäº’ç­‰â€ï¼Œç„¶åå¡ä½çš„æ„æ€,ä¹Ÿç”±äºå’ŒåŒ/å¼‚æ­¥å¤„ç†é¡ºåºï¼Œçº¿ç¨‹çš„ç­‰å¾…å¯¼è‡´é˜Ÿåˆ—åŠ å…¥çš„é¡ºåºä¸é˜Ÿåˆ—çš„FIFOåŸåˆ™(å…ˆè¿›å…ˆå‡ºï¼‰å†²çªå¼•èµ·ã€‚</p></li><li><p>å¹¶è¡Œï¼šå¹¶è¡ŒæŒ‡çš„æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œä¸€ä¸ªåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡çš„æŠ€æœ¯ã€‚å®ƒæè¿°äº†ä¸€ç§èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡çš„èƒ½åŠ›ï¼Œä¾§é‡ç‚¹åœ¨äºâ€œè¿è¡Œâ€ã€‚</p></li><li><p>ä¸²è¡Œï¼šè¡¨ç¤ºä»»åŠ¡å¿…é¡»æŒ‰é¡ºåºæ¥ï¼Œä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œï¼Œå‰ä¸€ä¸ªæ‰§è¡Œå®Œäº†æ‰èƒ½æ‰§è¡Œåä¸€ä¸ªã€‚</p></li><li><p>å¹¶å‘ï¼šå¹¶å‘æŒ‡çš„æ˜¯ä¸€ç§ç°è±¡ï¼Œä¸€ç§ç»å¸¸å‡ºç°ï¼Œæ— å¯é¿å…çš„ç°è±¡ã€‚å®ƒæè¿°çš„æ˜¯â€œå¤šä¸ªä»»åŠ¡åŒæ—¶å‘ç”Ÿï¼Œéœ€è¦è¢«å¤„ç†â€è¿™ä¸€ç°è±¡ã€‚å®ƒçš„ä¾§é‡ç‚¹åœ¨äºâ€œå‘ç”Ÿâ€ã€‚</p></li><li><p>é˜Ÿåˆ—ï¼šä¸ç®¡æ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼ˆSerialQueueï¼‰è¿˜æ˜¯å¹¶è¡Œé˜Ÿåˆ—ï¼ˆConcurrencyQueueï¼‰ï¼Œéƒ½æ˜¯FIFOé˜Ÿåˆ—ã€‚ä¹Ÿå°±æ„å‘³ç€ï¼Œä»»åŠ¡ä¸€å®šæ˜¯ä¸€ä¸ªä¸€ä¸ªåœ°ï¼ŒæŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ¥è°ƒåº¦ã€‚</p></li><li><p>åŒæ­¥ï¼šå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ªè°ƒç”¨æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†ã€‚</p></li><li><p>å¼‚æ­¥ï¼šè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>é¢è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOS é¢è¯•é¢˜ï¼ˆä¸‰ï¼‰</title>
    <link href="/2018/03/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-003/"/>
    <url>/2018/03/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-003/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€ã€UIè§†å›¾"><a href="#ä¸€ã€UIè§†å›¾" class="headerlink" title="ä¸€ã€UIè§†å›¾"></a>ä¸€ã€UIè§†å›¾</h2><h3 id="æ‹¬äº‹ä»¶ä¼ é€’"><a href="#æ‹¬äº‹ä»¶ä¼ é€’" class="headerlink" title="æ‹¬äº‹ä»¶ä¼ é€’"></a>æ‹¬äº‹ä»¶ä¼ é€’</h3><h3 id="è§†å›¾å“åº”"><a href="#è§†å›¾å“åº”" class="headerlink" title="è§†å›¾å“åº”"></a>è§†å›¾å“åº”</h3><h3 id="UIå¸ƒå±€"><a href="#UIå¸ƒå±€" class="headerlink" title="UIå¸ƒå±€"></a>UIå¸ƒå±€</h3><h3 id="UIç»˜åˆ¶"><a href="#UIç»˜åˆ¶" class="headerlink" title="UIç»˜åˆ¶"></a>UIç»˜åˆ¶</h3><h3 id="UITableviewé‡ç”¨æœºåˆ¶çš„ç†è§£ç­‰åŸºæœ¬æŠ€æœ¯ç‚¹"><a href="#UITableviewé‡ç”¨æœºåˆ¶çš„ç†è§£ç­‰åŸºæœ¬æŠ€æœ¯ç‚¹" class="headerlink" title="UITableviewé‡ç”¨æœºåˆ¶çš„ç†è§£ç­‰åŸºæœ¬æŠ€æœ¯ç‚¹"></a>UITableviewé‡ç”¨æœºåˆ¶çš„ç†è§£ç­‰åŸºæœ¬æŠ€æœ¯ç‚¹</h3><h3 id="ç¦»å±æ¸²æŸ“"><a href="#ç¦»å±æ¸²æŸ“" class="headerlink" title="ç¦»å±æ¸²æŸ“"></a>ç¦»å±æ¸²æŸ“</h3><h3 id="æµå¼é¡µé¢çš„æ€§èƒ½ä¼˜åŒ–"><a href="#æµå¼é¡µé¢çš„æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æµå¼é¡µé¢çš„æ€§èƒ½ä¼˜åŒ–"></a>æµå¼é¡µé¢çš„æ€§èƒ½ä¼˜åŒ–</h3><h3 id="å¼‚æ­¥ç»˜åˆ¶"><a href="#å¼‚æ­¥ç»˜åˆ¶" class="headerlink" title="å¼‚æ­¥ç»˜åˆ¶"></a>å¼‚æ­¥ç»˜åˆ¶</h3><h3 id="UIæ¸²æŸ“æœºåˆ¶"><a href="#UIæ¸²æŸ“æœºåˆ¶" class="headerlink" title="UIæ¸²æŸ“æœºåˆ¶"></a>UIæ¸²æŸ“æœºåˆ¶</h3><h2 id="Objective-Cè¯­è¨€"><a href="#Objective-Cè¯­è¨€" class="headerlink" title="Objective-Cè¯­è¨€"></a>Objective-Cè¯­è¨€</h2><h3 id="KVO"><a href="#KVO" class="headerlink" title="KVO"></a>KVO</h3><h3 id="KVC"><a href="#KVC" class="headerlink" title="KVC"></a>KVC</h3><h3 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h3><h3 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h3><h3 id="å…³è”å¯¹è±¡"><a href="#å…³è”å¯¹è±¡" class="headerlink" title="å…³è”å¯¹è±¡"></a>å…³è”å¯¹è±¡</h3><h3 id="NSNotification"><a href="#NSNotification" class="headerlink" title="NSNotification"></a>NSNotification</h3><h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><h3 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h3><h2 id="ä¸‰ã€Runtime"><a href="#ä¸‰ã€Runtime" class="headerlink" title="ä¸‰ã€Runtime"></a>ä¸‰ã€Runtime</h2><h3 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h3><h3 id="ç±»å¯¹è±¡"><a href="#ç±»å¯¹è±¡" class="headerlink" title="ç±»å¯¹è±¡"></a>ç±»å¯¹è±¡</h3><h3 id="åŸç±»å¯¹è±¡"><a href="#åŸç±»å¯¹è±¡" class="headerlink" title="åŸç±»å¯¹è±¡"></a>åŸç±»å¯¹è±¡</h3><h3 id="æ¶ˆæ¯ä¼ é€’æœºåˆ¶"><a href="#æ¶ˆæ¯ä¼ é€’æœºåˆ¶" class="headerlink" title="æ¶ˆæ¯ä¼ é€’æœºåˆ¶"></a>æ¶ˆæ¯ä¼ é€’æœºåˆ¶</h3><h3 id="æ¶ˆæ¯è½¬å‘æµç¨‹"><a href="#æ¶ˆæ¯è½¬å‘æµç¨‹" class="headerlink" title="æ¶ˆæ¯è½¬å‘æµç¨‹"></a>æ¶ˆæ¯è½¬å‘æµç¨‹</h3><h3 id="Method-Swizzling"><a href="#Method-Swizzling" class="headerlink" title="Method-Swizzling"></a>Method-Swizzling</h3><h3 id="ISA-swizzling"><a href="#ISA-swizzling" class="headerlink" title="ISA-swizzling"></a>ISA-swizzling</h3><h3 id="åŠ¨æ€æ–¹æ³•è§£æ"><a href="#åŠ¨æ€æ–¹æ³•è§£æ" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æ"></a>åŠ¨æ€æ–¹æ³•è§£æ</h3><h3 id="åŠ¨æ€æ·»åŠ æ–¹æ³•"><a href="#åŠ¨æ€æ·»åŠ æ–¹æ³•" class="headerlink" title="åŠ¨æ€æ·»åŠ æ–¹æ³•"></a>åŠ¨æ€æ·»åŠ æ–¹æ³•</h3><h2 id="å››ã€å†…å­˜ç®¡ç†"><a href="#å››ã€å†…å­˜ç®¡ç†" class="headerlink" title="å››ã€å†…å­˜ç®¡ç†"></a>å››ã€å†…å­˜ç®¡ç†</h2><h3 id="weakè‡ªåŠ¨ç½®nil"><a href="#weakè‡ªåŠ¨ç½®nil" class="headerlink" title="weakè‡ªåŠ¨ç½®nil"></a>weakè‡ªåŠ¨ç½®nil</h3><h3 id="ARC"><a href="#ARC" class="headerlink" title="ARC"></a>ARC</h3><h3 id="MRC"><a href="#MRC" class="headerlink" title="MRC"></a>MRC</h3><h3 id="è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†"><a href="#è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†" class="headerlink" title="è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†"></a>è‡ªåŠ¨é‡Šæ”¾æ± çš„å®ç°åŸç†</h3><h3 id="å¾ªç¯å¼•ç”¨"><a href="#å¾ªç¯å¼•ç”¨" class="headerlink" title="å¾ªç¯å¼•ç”¨"></a>å¾ªç¯å¼•ç”¨</h3><h3 id="å¼•ç”¨è®¡æ•°ç®¡ç†"><a href="#å¼•ç”¨è®¡æ•°ç®¡ç†" class="headerlink" title="å¼•ç”¨è®¡æ•°ç®¡ç†"></a>å¼•ç”¨è®¡æ•°ç®¡ç†</h3><h2 id="äº”ã€Block"><a href="#äº”ã€Block" class="headerlink" title="äº”ã€Block"></a>äº”ã€Block</h2><h3 id="æˆªè·å˜é‡ç‰¹æ€§"><a href="#æˆªè·å˜é‡ç‰¹æ€§" class="headerlink" title="æˆªè·å˜é‡ç‰¹æ€§"></a>æˆªè·å˜é‡ç‰¹æ€§</h3><h3 id="Blockå…³é”®å­—"><a href="#Blockå…³é”®å­—" class="headerlink" title="__Blockå…³é”®å­—"></a>__Blockå…³é”®å­—</h3><h3 id="Blockçš„æœ¬è´¨"><a href="#Blockçš„æœ¬è´¨" class="headerlink" title="Blockçš„æœ¬è´¨"></a>Blockçš„æœ¬è´¨</h3><h3 id="Blockçš„å†…å­˜ç®¡ç†"><a href="#Blockçš„å†…å­˜ç®¡ç†" class="headerlink" title="Blockçš„å†…å­˜ç®¡ç†"></a>Blockçš„å†…å­˜ç®¡ç†</h3><h3 id="å¾ªç¯å¼•ç”¨-1"><a href="#å¾ªç¯å¼•ç”¨-1" class="headerlink" title="å¾ªç¯å¼•ç”¨"></a>å¾ªç¯å¼•ç”¨</h3><h2 id="å…­ã€å¤šçº¿ç¨‹"><a href="#å…­ã€å¤šçº¿ç¨‹" class="headerlink" title="å…­ã€å¤šçº¿ç¨‹"></a>å…­ã€å¤šçº¿ç¨‹</h2><h3 id="NSOperation-amp-NSOperationQueue-NSThread"><a href="#NSOperation-amp-NSOperationQueue-NSThread" class="headerlink" title="NSOperation&amp;NSOperationQueue ### NSThread"></a>NSOperation&amp;NSOperationQueue ### NSThread</h3><h3 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h3><h3 id="NSLock"><a href="#NSLock" class="headerlink" title="NSLock"></a>NSLock</h3><h3 id="é€’å½’é”"><a href="#é€’å½’é”" class="headerlink" title="é€’å½’é”"></a>é€’å½’é”</h3><h3 id="è‡ªæ—‹é”"><a href="#è‡ªæ—‹é”" class="headerlink" title="è‡ªæ—‹é”"></a>è‡ªæ—‹é”</h3><h3 id="æ¡ä»¶é”"><a href="#æ¡ä»¶é”" class="headerlink" title="æ¡ä»¶é”"></a>æ¡ä»¶é”</h3><h2 id="ä¸ƒã€RunLoop"><a href="#ä¸ƒã€RunLoop" class="headerlink" title="ä¸ƒã€RunLoop"></a>ä¸ƒã€RunLoop</h2><h3 id="RunLoopä¸ºä»€ä¹ˆä¼šæœ‰äº‹åšäº‹æ²¡äº‹ä¼‘æ¯ï¼Œç³»ç»Ÿæ˜¯æ€æ ·å®ç°çš„"><a href="#RunLoopä¸ºä»€ä¹ˆä¼šæœ‰äº‹åšäº‹æ²¡äº‹ä¼‘æ¯ï¼Œç³»ç»Ÿæ˜¯æ€æ ·å®ç°çš„" class="headerlink" title="RunLoopä¸ºä»€ä¹ˆä¼šæœ‰äº‹åšäº‹æ²¡äº‹ä¼‘æ¯ï¼Œç³»ç»Ÿæ˜¯æ€æ ·å®ç°çš„"></a>RunLoopä¸ºä»€ä¹ˆä¼šæœ‰äº‹åšäº‹æ²¡äº‹ä¼‘æ¯ï¼Œç³»ç»Ÿæ˜¯æ€æ ·å®ç°çš„</h3><h3 id="æ€æ ·å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹"><a href="#æ€æ ·å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹" class="headerlink" title="æ€æ ·å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹"></a>æ€æ ·å®ç°ä¸€ä¸ªå¸¸é©»çº¿ç¨‹</h3><h3 id="RunLoopå’Œçº¿ç¨‹çš„å…³ç³»æ˜¯æ€æ ·"><a href="#RunLoopå’Œçº¿ç¨‹çš„å…³ç³»æ˜¯æ€æ ·" class="headerlink" title="RunLoopå’Œçº¿ç¨‹çš„å…³ç³»æ˜¯æ€æ ·"></a>RunLoopå’Œçº¿ç¨‹çš„å…³ç³»æ˜¯æ€æ ·</h3><h2 id="å…«ã€ç½‘ç»œ"><a href="#å…«ã€ç½‘ç»œ" class="headerlink" title="å…«ã€ç½‘ç»œ"></a>å…«ã€ç½‘ç»œ</h2><h3 id="HTTPç›¸å…³çš„ä¸­é—´äººæ”»å‡»"><a href="#HTTPç›¸å…³çš„ä¸­é—´äººæ”»å‡»" class="headerlink" title="HTTPç›¸å…³çš„ä¸­é—´äººæ”»å‡»"></a>HTTPç›¸å…³çš„ä¸­é—´äººæ”»å‡»</h3><h3 id="HTTPSçš„è¿æ¥å»ºç«‹æµç¨‹"><a href="#HTTPSçš„è¿æ¥å»ºç«‹æµç¨‹" class="headerlink" title="HTTPSçš„è¿æ¥å»ºç«‹æµç¨‹"></a>HTTPSçš„è¿æ¥å»ºç«‹æµç¨‹</h3><h3 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h3><h3 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h3><h3 id="DNSåŠ«æŒ"><a href="#DNSåŠ«æŒ" class="headerlink" title="DNSåŠ«æŒ"></a>DNSåŠ«æŒ</h3><h3 id="TCPçš„æ»‘åŠ¨çª—å£åè®®"><a href="#TCPçš„æ»‘åŠ¨çª—å£åè®®" class="headerlink" title="TCPçš„æ»‘åŠ¨çª—å£åè®®"></a>TCPçš„æ»‘åŠ¨çª—å£åè®®</h3><h3 id="å¯é ä¼ è¾“æ˜¯æ€æ ·ä¿è¯çš„"><a href="#å¯é ä¼ è¾“æ˜¯æ€æ ·ä¿è¯çš„" class="headerlink" title="å¯é ä¼ è¾“æ˜¯æ€æ ·ä¿è¯çš„"></a>å¯é ä¼ è¾“æ˜¯æ€æ ·ä¿è¯çš„</h3><h3 id="TCPçš„æ…¢å¯åŠ¨ç‰¹ç‚¹"><a href="#TCPçš„æ…¢å¯åŠ¨ç‰¹ç‚¹" class="headerlink" title="TCPçš„æ…¢å¯åŠ¨ç‰¹ç‚¹"></a>TCPçš„æ…¢å¯åŠ¨ç‰¹ç‚¹</h3><h3 id="Session-Cookieçš„åŒºåˆ«"><a href="#Session-Cookieçš„åŒºåˆ«" class="headerlink" title="Session/Cookieçš„åŒºåˆ«"></a>Session/Cookieçš„åŒºåˆ«</h3><h2 id="ä¹ã€è®¾è®¡æ¨¡å¼"><a href="#ä¹ã€è®¾è®¡æ¨¡å¼" class="headerlink" title="ä¹ã€è®¾è®¡æ¨¡å¼"></a>ä¹ã€è®¾è®¡æ¨¡å¼</h2><h3 id="è½¯ä»¶è®¾è®¡åŸåˆ™"><a href="#è½¯ä»¶è®¾è®¡åŸåˆ™" class="headerlink" title="è½¯ä»¶è®¾è®¡åŸåˆ™"></a>è½¯ä»¶è®¾è®¡åŸåˆ™</h3><h3 id="è´£ä»»é“¾"><a href="#è´£ä»»é“¾" class="headerlink" title="è´£ä»»é“¾"></a>è´£ä»»é“¾</h3><h3 id="é€‚é…å™¨"><a href="#é€‚é…å™¨" class="headerlink" title="é€‚é…å™¨"></a>é€‚é…å™¨</h3><h3 id="æ¡¥æ¥"><a href="#æ¡¥æ¥" class="headerlink" title="æ¡¥æ¥"></a>æ¡¥æ¥</h3><h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><h3 id="å•ä¾‹"><a href="#å•ä¾‹" class="headerlink" title="å•ä¾‹"></a>å•ä¾‹</h3><h3 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h3><h2 id="åã€æ¶æ„-æ¡†æ¶"><a href="#åã€æ¶æ„-æ¡†æ¶" class="headerlink" title="åã€æ¶æ„/æ¡†æ¶"></a>åã€æ¶æ„/æ¡†æ¶</h2><h3 id="æ€æ ·è®¾è®¡å›¾ç‰‡ç¼“å­˜æ¡†æ¶"><a href="#æ€æ ·è®¾è®¡å›¾ç‰‡ç¼“å­˜æ¡†æ¶" class="headerlink" title="æ€æ ·è®¾è®¡å›¾ç‰‡ç¼“å­˜æ¡†æ¶"></a>æ€æ ·è®¾è®¡å›¾ç‰‡ç¼“å­˜æ¡†æ¶</h3><h3 id="ç½‘ç»œæ¡†æ¶"><a href="#ç½‘ç»œæ¡†æ¶" class="headerlink" title="ç½‘ç»œæ¡†æ¶"></a>ç½‘ç»œæ¡†æ¶</h3><h3 id="å®¢æˆ·ç«¯çš„æ•´ä½“æ¶æ„æ€æ ·å®ç°"><a href="#å®¢æˆ·ç«¯çš„æ•´ä½“æ¶æ„æ€æ ·å®ç°" class="headerlink" title="å®¢æˆ·ç«¯çš„æ•´ä½“æ¶æ„æ€æ ·å®ç°"></a>å®¢æˆ·ç«¯çš„æ•´ä½“æ¶æ„æ€æ ·å®ç°</h3><h3 id="å¸¸è§çš„è§£è€¦æ–¹å¼æœ‰å“ªäº›"><a href="#å¸¸è§çš„è§£è€¦æ–¹å¼æœ‰å“ªäº›" class="headerlink" title="å¸¸è§çš„è§£è€¦æ–¹å¼æœ‰å“ªäº›"></a>å¸¸è§çš„è§£è€¦æ–¹å¼æœ‰å“ªäº›</h3>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>é¢è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOS é¢è¯•é¢˜ï¼ˆå››ï¼‰</title>
    <link href="/2018/03/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-004/"/>
    <url>/2018/03/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-004/</url>
    
    <content type="html"><![CDATA[<p>1ã€swiftå’Œocçš„åŒºåˆ«</p><p>2ã€ç¼–è¯‘é“¾æ¥</p><p>3ã€synthesize &amp; denamic</p><p>4ã€åœ¨é¡¹ç›®å¼€å‘ä¸­å¸¸ç”¨çš„å¼€å‘å·¥å…·æœ‰å“ªäº›ï¼Ÿ</p><p>5ã€UITableView &amp; UICollection</p><p>6ã€NSProxy &amp; NSObject</p><p>7ã€Object &amp; Swift</p><p>8ã€ä¼ å€¼é€šçŸ¥ &amp; æ¨é€é€šçŸ¥ï¼ˆæœ¬åœ°&amp;è¿œç¨‹ï¼‰</p><p>9ã€ç¬¬ä¸‰æ–¹åº“ &amp; ç¬¬ä¸‰æ–¹å¹³å°</p><p>10ã€NSCache &amp; NSDcitionary</p><p>11ã€ UIViewçš„setNeedsDisplayå’ŒsetNeedsLayoutæ–¹æ³•</p><p>12ã€UILayer &amp; UIView</p><p>13ã€layoutSubViews &amp; drawRects</p><p>14ã€UDID &amp; UUID</p><p>15ã€CPU &amp; GPU</p><p>16ã€ç‚¹ï¼ˆptï¼‰&amp; åƒç´ ï¼ˆpxï¼‰</p><p>17ã€å±æ€§ä¸æˆå‘˜å˜é‡</p><p>18ã€intå’ŒNSIntegerçš„åŒºåˆ«</p><p>ï¼ˆ1ï¼‰importå’Œinclude</p><p>ï¼ˆ2ï¼‰@class</p><p>ï¼ˆ3ï¼‰å…¨å±€ &amp; é™æ€å˜é‡</p><p>19ã€ç±»å’Œå¯¹è±¡</p><p>ï¼ˆ1ï¼‰åˆ†ç±»æ‹“å±•åè®®ä¸­å“ªäº›å¯ä»¥å£°æ˜å±æ€§?</p><p>ï¼ˆ2ï¼‰ç»§æ‰¿å’Œç±»åˆ«çš„åŒºåˆ«</p><p>ï¼ˆ3ï¼‰åˆ†ç±»çš„ä½œç”¨</p><p>ï¼ˆ4ï¼‰åˆ†ç±»çš„å±€é™æ€§</p><p>20ã€category &amp; extension</p><p>21ã€Foundation</p><p>ï¼ˆ1ï¼‰å­—ç¬¦ä¸²</p><p>ï¼ˆ2ï¼‰å­—ç¬¦ä¸²æˆªå–</p><p>ï¼ˆ3ï¼‰æ ¼å¼</p><p>22ã€NSArrayå’ŒNSDictionary</p><p>ï¼ˆ1ï¼‰iOSéå†æ•°ç»„/å­—å…¸çš„æ–¹æ³•</p><p>ï¼ˆ2ï¼‰NSValue NSNumber</p><p>ï¼ˆ3ï¼‰å…¶å®ƒ</p><p>ï¼ˆ4ï¼‰å¦‚ä½•é¿å…å¾ªç¯å¼•ç”¨</p><p>23ã€CFSocketä½¿ç”¨æœ‰å“ªå‡ ä¸ªæ­¥éª¤</p><p>24ã€Core Foundationä¸­æä¾›äº†å“ªå‡ ç§æ“ä½œSocketçš„æ–¹æ³•ï¼Ÿ</p><p>25ã€è§£æXMLæ–‡ä»¶æœ‰å“ªå‡ ç§æ–¹å¼ï¼Ÿ</p><p>26ã€ä»€ä¹ˆæ˜¯æ²™ç›’æ¨¡å‹ï¼Ÿå“ªäº›æ“ä½œæ˜¯å±äºç§æœ‰apièŒƒç•´?</p><p>27ã€åœ¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•é‡Œé¢ï¼šself.name= â€œobjectâ€ï¼›å’Œ name =â€objectâ€ æœ‰ä»€ä¹ˆä¸åŒå—?</p><p>28ã€è¯·ç®€è¦è¯´æ˜viewDidLoadå’ŒviewDidUnloadä½•æ—¶è°ƒç”¨</p><p>29ã€åˆ›å»ºæ§åˆ¶å™¨ã€è§†å›¾çš„æ–¹å¼</p><p>30ã€ç®€è¿°å†…å­˜åˆ†åŒºæƒ…å†µ</p><p>31ã€é˜Ÿåˆ—å’Œæ ˆæœ‰ä»€ä¹ˆåŒºåˆ«</p><p>32ã€iOSçš„ç³»ç»Ÿæ¶æ„</p><p>33ã€æ§ä»¶ä¸»è¦å“åº”3ç§äº‹ä»¶</p><p>34ã€xibæ–‡ä»¶çš„æ„æˆåˆ†ä¸ºå“ª3ä¸ªå›¾æ ‡ï¼Ÿéƒ½å…·æœ‰ä»€ä¹ˆåŠŸèƒ½</p><p>35ã€ç®€è¿°è§†å›¾æ§ä»¶å™¨çš„ç”Ÿå‘½å‘¨æœŸ</p><p>36ã€app é¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸ</p><p>ï¼ˆ1ï¼‰åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸ</p><p>ï¼ˆ2ï¼‰ç®€è¦è¯´æ˜ä¸€ä¸‹APPçš„å¯åŠ¨è¿‡ç¨‹ï¼Œmainæ–‡ä»¶è¯´èµ·ï¼Œmainå‡½æ•°ä¸­æœ‰ä»€ä¹ˆå‡½æ•°ï¼Ÿä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>ï¼ˆ3ï¼‰UIApplicationMainå‡½æ•°ä½œç”¨</p><p>ï¼ˆ4ï¼‰mainå‡½æ•°ä½œç”¨</p><p>37ã€ åŠ¨ç”»æœ‰åŸºæœ¬ç±»å‹æœ‰å“ªå‡ ç§ï¼›è¡¨è§†å›¾æœ‰å“ªå‡ ç§åŸºæœ¬æ ·å¼ã€‚</p><p>38ã€å®ç°ç®€å•çš„è¡¨æ ¼æ˜¾ç¤ºéœ€è¦è®¾ç½®UITableViewçš„ä»€ä¹ˆå±æ€§ã€å®ç°ä»€ä¹ˆåè®®ï¼Ÿ</p><p>39ã€Cocoa Touchæä¾›äº†å“ªå‡ ç§Core Animationè¿‡æ¸¡ç±»å‹ï¼Ÿ</p><p>40ã€UIViewä¸CLayeræœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>41ã€Quatrz 2Dçš„ç»˜å›¾åŠŸèƒ½çš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯ä»€ä¹ˆå¹¶ç®€è¿°å…¶ä½œç”¨</p><p>42ã€iPhone OSä¸»è¦æä¾›äº†å‡ ç§æ’­æ”¾éŸ³é¢‘çš„æ–¹æ³•ï¼Ÿ</p><p>43ã€ä½¿ç”¨AVAudioPlayerç±»è°ƒç”¨å“ªä¸ªæ¡†æ¶ã€ä½¿ç”¨æ­¥éª¤ï¼Ÿ</p><p>44ã€æœ‰å“ªå‡ ç§æ‰‹åŠ¿é€šçŸ¥æ–¹æ³•ã€å†™æ¸…æ¥šæ–¹æ³•åï¼Ÿ</p><p>45ã€ViewControllerçš„didReceiveMemoryWarningæ€ä¹ˆè¢«è°ƒç”¨</p><p>46ã€ä»€ä¹ˆæ—¶å€™ç”¨delegate,ä»€ä¹ˆæ—¶å€™ç”¨Notification?</p><p>47ã€ç”¨é¢„å¤„ç†æŒ‡ä»¤#defineå£°æ˜ä¸€ä¸ªå¸¸æ•°ï¼Œç”¨ä»¥è¡¨æ˜1å¹´ä¸­æœ‰å¤šå°‘ç§’ï¼ˆå¿½ç•¥é—°å¹´é—®é¢˜ï¼‰</p><p>48ã€å†™ä¸€ä¸ªâ€æ ‡å‡†â€å®MIN ï¼Œè¿™ä¸ªå®è¾“å…¥ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›è¾ƒå°çš„ä¸€ä¸ªã€‚</p><p>49ã€å…³é”®å­—constæœ‰ä»€ä¹ˆå«æ„ï¼Ÿä¿®é¥°ç±»å‘¢?staticçš„ä½œç”¨,ç”¨äºç±»å‘¢?è¿˜æœ‰extern cçš„ä½œç”¨</p><p>50ã€å…³é”®å­—volatileæœ‰ä»€ä¹ˆå«æ„?å¹¶ç»™å‡ºä¸‰ä¸ªä¸åŒçš„ä¾‹å­</p><p>51ã€ä¸€ä¸ªå‚æ•°æ—¢å¯ä»¥æ˜¯constè¿˜å¯ä»¥æ˜¯volatileå—ï¼Ÿ ä¸€ä¸ªæŒ‡é’ˆå¯ä»¥æ˜¯volatile å—ï¼Ÿè§£é‡Šä¸ºä»€ä¹ˆã€‚</p><p>52ã€static å…³é”®å­—çš„ä½œç”¨</p><p>53ã€åˆ—ä¸¾å‡ ç§è¿›ç¨‹çš„åŒæ­¥æœºåˆ¶ï¼Œå¹¶æ¯”è¾ƒå…¶ä¼˜ç¼ºç‚¹ã€‚</p><p>54ã€è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„é€”å¾„</p><p>55ã€è¿›ç¨‹æ­»é”çš„åŸå› </p><p>56ã€æ­»é”çš„4ä¸ªå¿…è¦æ¡ä»¶</p><p>57ã€æ­»é”çš„å¤„ç†</p><p>58ã€cocoa touchæ¡†æ¶</p><p>59ã€è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯ä»€ä¹ˆ,å¦‚ä½•å·¥ä½œ</p><p>60ã€sprintf,strcpy,memcpyä½¿ç”¨ä¸Šæœ‰ä»€ä¹ˆè¦æ³¨æ„çš„åœ°æ–¹</p><p>61ã€ä½ äº†è§£svn,cvsç­‰ç‰ˆæœ¬æ§åˆ¶å·¥å…·ä¹ˆï¼Ÿ</p><p>62ã€ä»€ä¹ˆæ˜¯push</p><p>63ã€é™æ€é“¾æ¥åº“</p><p>64ã€OCä¸‰å¤§ç‰¹æ€§</p><p>ï¼ˆ1ï¼‰å°è£…_ç‚¹è¯­æ³•</p><p>ï¼ˆ2ï¼‰ç»§æ‰¿</p><p>ï¼ˆ3ï¼‰å¤šæ€</p><p>65ã€OCä¸­å¦‚ä½•å®ç°å¤šæ€</p><p>66ã€Objective-Cçš„ä¼˜ç¼ºç‚¹</p><p>67ã€å¯¹äºOC,ä½ è®¤ä¸ºæœ€å¤§çš„ä¼˜ç‚¹å’Œæœ€å¤§çš„ä¸è¶³æ˜¯ä»€ä¹ˆï¼Ÿå¯¹äºä¸è¶³ä¹‹å¤„ï¼Œç°åœ¨æœ‰æ²¡æœ‰å¯ç”¨çš„æ–¹æ³•ç»•è¿‡è¿™äº›ä¸è¶³æ¥å®ç°éœ€æ±‚ã€‚å¦‚æœå¯ä»¥è¯ï¼Œæœ‰æ²¡æœ‰è€ƒè™‘æˆ–è€…å®ç°è¿‡é‡æ–°å®ç°OCçš„åŠŸèƒ½ï¼Œå¦‚æœæœ‰ï¼Œå…·ä½“æ€ä¹ˆåšï¼Ÿ</p><p>68ã€ocä¸­å¯ä¿®æ”¹å’Œä¸å¯ä»¥ä¿®æ”¹ç±»å‹</p><p>69ã€æˆ‘ä»¬è¯´çš„ocæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€?</p><p>70ã€é€šçŸ¥å’Œåè®®çš„ä¸åŒä¹‹å¤„?</p><p>71ã€ä»€ä¹ˆæ˜¯æ¨é€æ¶ˆæ¯?</p><p>72ã€å…³äºå¤šæ€æ€§</p><p>73ã€ä»€ä¹ˆæ˜¯è°“è¯?</p><p>74ã€åšè¿‡çš„é¡¹ç›®æ˜¯å¦æ¶‰åŠç½‘ç»œè®¿é—®åŠŸèƒ½ï¼Œä½¿ç”¨ä»€ä¹ˆå¯¹è±¡å®Œæˆç½‘ç»œåŠŸèƒ½?</p><p>75ã€ç®€å•ä»‹ç»ä¸‹NSURLConnectionç±»åŠ+sendSynchronousRequest:returningResponse:error:ä¸â€“ initWithRequest:delegate:ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«?</p><p>76ã€è°ˆè°ˆObject-Cçš„å†…å­˜ç®¡ç†æ–¹å¼åŠè¿‡ç¨‹ï¼Ÿ</p><p>77ã€Object-Cæœ‰ç§æœ‰æ–¹æ³•å—ï¼Ÿç§æœ‰å˜é‡å‘¢ï¼Ÿ</p><p>78ã€è¯´è¯´å“åº”é“¾</p><p>79ã€æ—¶é—´ä¼ é€’ &amp; å“åº”è€…é“¾</p><p>80ã€frameå’Œboundsæœ‰ä»€ä¹ˆä¸åŒ?</p><p>81ã€æ–¹æ³•å’Œé€‰æ‹©å™¨æœ‰ä½•ä¸åŒ?</p><p>82ã€OCçš„åƒåœ¾å›æ”¶æœºåˆ¶?</p><p>83ã€ä»€ä¹ˆæ˜¯å»¶è¿ŸåŠ è½½?</p><p>84ã€æ˜¯å¦åœ¨ä¸€ä¸ªè§†å›¾æ§åˆ¶å™¨ä¸­åµŒå…¥ä¸¤ä¸ªtableviewæ§åˆ¶å™¨?</p><p>85ã€ä¸€ä¸ªtableViewæ˜¯å¦å¯ä»¥å…³è”ä¸¤ä¸ªä¸åŒçš„æ•°æ®æº?ä½ ä¼šæ€ä¹ˆå¤„ç†?</p><p>86ã€ä»€ä¹ˆæ—¶å€™ä½¿ç”¨NSMutableArrayï¼Œä»€ä¹ˆæ—¶å€™ä½¿ç”¨NSArray?</p><p>87ã€ç»™å‡ºå§”æ‰˜æ–¹æ³•çš„å®ä¾‹ï¼Œå¹¶ä¸”è¯´å‡ºUITableVIewçš„Data Sourceæ–¹æ³•</p><p>88ã€åœ¨åº”ç”¨ä¸­å¯ä»¥åˆ›å»ºå¤šå°‘autoreleaseå¯¹è±¡ï¼Œæ˜¯å¦æœ‰é™åˆ¶?</p><p>89ã€å¦‚æœæˆ‘ä»¬ä¸åˆ›å»ºå†…å­˜æ± ï¼Œæ˜¯å¦æœ‰å†…å­˜æ± æä¾›ç»™æˆ‘ä»¬?</p><p>90ã€ä»€ä¹ˆæ—¶å€™éœ€è¦åœ¨ç¨‹åºä¸­åˆ›å»ºå†…å­˜æ± ?</p><p>91ã€ç±»NSObjectçš„é‚£äº›æ–¹æ³•ç»å¸¸è¢«ä½¿ç”¨?</p><p>92ã€ä»€ä¹ˆæ˜¯ç®€ä¾¿æ„é€ æ–¹æ³•?</p><p>93ã€å¦‚ä½•ä½¿ç”¨Xcodeè®¾è®¡é€šç”¨åº”ç”¨?</p><p>94ã€ UIViewçš„åŠ¨ç”»æ•ˆæœæœ‰é‚£äº›?</p><p>95ã€Object-Cæœ‰å¤šç»§æ‰¿å—ï¼Ÿæ²¡æœ‰çš„è¯ç”¨ä»€ä¹ˆä»£æ›¿ï¼Ÿcocoa ä¸­æ‰€æœ‰çš„ç±»éƒ½æ˜¯NSObject çš„å­ç±»</p><p>96ã€å†…å­˜ç®¡ç† Autoreleaseã€retainã€copyã€assignçš„setæ–¹æ³•å’Œå«ä¹‰ï¼Ÿ</p><p>97ã€Cå’Œobj-c å¦‚ä½•æ··ç”¨</p><p>98ã€ç±»åˆ«çš„ä½œç”¨?ç»§æ‰¿å’Œç±»åˆ«åœ¨å®ç°ä¸­æœ‰ä½•åŒºåˆ«?</p><p>99ã€ç±»åˆ«å’Œç±»æ‰©å±•çš„åŒºåˆ«ã€‚</p><p>100ã€ocä¸­çš„åè®®å’Œjavaä¸­çš„æ¥å£æ¦‚å¿µæœ‰ä½•ä¸åŒ?</p><p>101ã€æ·±æ‹·è´ä¸å‰æ‹·è´åŒºåˆ«</p><p>ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯æ·±æ‹·è´æµ…æ‹·è´</p><p>ï¼ˆ2ï¼‰å­—ç¬¦ä¸²ä»€ä¹ˆæ—¶å€™ä½¿ç”¨copy,strong</p><p>ï¼ˆ3ï¼‰å­—ç¬¦ä¸²æ‰€åœ¨å†…å­˜åŒºåŸŸ</p><p>ï¼ˆ4ï¼‰mutablecopyå’Œcopy @property(copy) NSMutableArray *arr;è¿™æ ·å†™æœ‰ä»€ä¹ˆé—®é¢˜</p><p>ï¼ˆ5ï¼‰å¦‚ä½•è®©è‡ªå®šä¹‰ç±»å¯ä»¥ä½¿ç”¨copyä¿®é¥°ç¬¦</p><p>102ã€å¯¹äºè¯­å¥NSString*obj = [[NSData alloc] init]; objåœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶åˆ†åˆ«æ—¶ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼Ÿ</p><p>103ã€#import è·Ÿ#include åˆä»€ä¹ˆåŒºåˆ«ï¼Œ@classå‘¢, ï¼ƒimport&lt;&gt; è·Ÿ #importâ€â€åˆä»€ä¹ˆåŒºåˆ«ï¼Ÿ</p><p>104ã€Objective-Cçš„ç±»å¯ä»¥å¤šé‡ç»§æ‰¿ä¹ˆ?å¯ä»¥å®ç°å¤šä¸ªæ¥å£ä¹ˆ?Categoryæ˜¯ä»€ä¹ˆ?é‡å†™ä¸€ä¸ªç±»çš„æ–¹æ³•ç”¨ç»§æ‰¿å¥½è¿˜æ˜¯åˆ†ç±»å¥½?ä¸ºä»€ä¹ˆ?</p><p>105ã€ #import è·Ÿ#include åˆä»€ä¹ˆåŒºåˆ«ï¼Œ@classå‘¢, #import&lt;&gt; è·Ÿ #importâ€â€åˆä»€ä¹ˆåŒºåˆ«?</p><p>106ã€å†™ä¸€ä¸ªsetteræ–¹æ³•ç”¨äºå®Œæˆ@property (nonatomic,retain)NSString name,å†™ä¸€ä¸ªsetteræ–¹æ³•ç”¨äºå®Œæˆ@property(nonatomicï¼Œcopy)NSString name</p><p>107ã€å¸¸è§çš„Objective-Cçš„æ•°æ®ç±»å‹æœ‰é‚£äº›ï¼Œ å’ŒCçš„åŸºæœ¬æ•°æ®ç±»å‹æœ‰ä»€ä¹ˆåŒºåˆ«?å¦‚ï¼šNSIntegerå’Œint</p><p>108ã€id å£°æ˜çš„å¯¹è±¡æœ‰ä»€ä¹ˆç‰¹æ€§?</p><p>109ã€Objective-Cå¦‚ä½•å¯¹å†…å­˜ç®¡ç†çš„,è¯´è¯´ä½ çš„çœ‹æ³•å’Œè§£å†³æ–¹æ³•?</p><p>110ã€åŸå­(atomic)è·ŸéåŸå­(non-atomic)å±æ€§æœ‰ä»€ä¹ˆåŒºåˆ«?</p><p>111ã€çœ‹ä¸‹é¢çš„ç¨‹åº,ç¬¬ä¸€ä¸ªNSLogä¼šè¾“å‡ºä»€ä¹ˆ?è¿™æ—¶strçš„retainCountæ˜¯å¤šå°‘?ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‘¢? ä¸ºä»€ä¹ˆ?</p><p>112ã€å†…å­˜ç®¡ç†çš„å‡ æ¡åŸåˆ™æ—¶ä»€ä¹ˆ?æŒ‰ç…§é»˜è®¤æ³•åˆ™.é‚£äº›å…³é”®å­—ç”Ÿæˆçš„å¯¹è±¡éœ€è¦æ‰‹åŠ¨é‡Šæ”¾?åœ¨å’Œpropertyç»“åˆçš„æ—¶å€™æ€æ ·æœ‰æ•ˆçš„é¿å…å†…å­˜æ³„éœ²?</p><p>113ã€å¦‚ä½•å¯¹iOSè®¾å¤‡è¿›è¡Œæ€§èƒ½æµ‹è¯•?</p><p>114ã€è®¾è®¡æ¨¡å¼</p><p>ï¼ˆ1ï¼‰mvcæ¨¡å¼</p><p>ï¼ˆ2ï¼‰å•ä¾‹æ¨¡å¼</p><p>ï¼ˆ3ï¼‰mvvmæ¨¡å¼</p><p>ï¼ˆ4ï¼‰è§‚å¯Ÿè€…æ¨¡å¼</p><p>ï¼ˆ5ï¼‰å·¥å‚æ¨¡å¼</p><p>ï¼ˆ6ï¼‰ä»£ç†æ¨¡å¼</p><p>ï¼ˆ7ï¼‰ç­–ç•¥æ¨¡å¼</p><p>ï¼ˆ8ï¼‰é€‚é…å™¨æ¨¡å¼</p><p>ï¼ˆ9ï¼‰æ¨¡ç‰ˆæ¨¡å¼</p><p>ï¼ˆ10ï¼‰å¤–è§‚æ¨¡å¼</p><p>ï¼ˆ11ï¼‰åˆ›å»ºæ¨¡å¼</p><p>ï¼ˆ12ï¼‰MVPæ¨¡å¼</p><p>115ã€MVVMæ¨¡å¼åŸç†åˆ†æ</p><p>116ã€è¯´è¯´å¸¸ç”¨çš„å‡ ç§ä¼ å€¼æ–¹å¼</p><p>117ã€ä»€ä¹ˆæ—¶å€™ç”¨delegateï¼Œä»€ä¹ˆæ—¶å€™ç”¨Notification</p><p>118ã€å¯¹äºå•ä¾‹çš„ç†è§£</p><p>119ã€ä»è®¾è®¡æ¨¡å¼è§’åº¦åˆ†æä»£ç†ï¼Œé€šçŸ¥å’ŒKVOåŒºåˆ«ï¼Ÿios SDK æä¾› çš„frameworkä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼ï¼Œä¸ºä»€ä¹ˆä½¿ç”¨ï¼Ÿæœ‰å“ªäº›å¥½å¤„å’Œåå¤„?</p><p>120ã€KVOï¼ŒNSNotificationï¼ŒdelegateåŠblockåŒºåˆ«</p><p>121ã€è¿è¡Œæ—¶ï¼ˆrunTimeï¼‰</p><p>122ã€runtime/æ¶ˆæ¯è½¬å‘æœºåˆ¶</p><p>ï¼ˆ1ï¼‰runtime</p><p>1.1ã€ä»€ä¹ˆæ˜¯runtime</p><p>1.2ã€runtimeå¹²ä»€ä¹ˆç”¨ï¼Œä½¿ç”¨åœºæ™¯</p><p>ï¼ˆ2ï¼‰æ¶ˆæ¯æœºåˆ¶</p><p>2.1ã€æ¶ˆæ¯è½¬å‘çš„åŸç†</p><p>2.2ã€SEL isa super cmd æ˜¯ä»€ä¹ˆ</p><p>ï¼ˆ3ï¼‰åŠ¨æ€ç»‘å®š</p><p>123ã€ä½¿ç”¨buglyè¿›è¡Œå´©æºƒåˆ†æ</p><p>124ã€jenkens æŒç»­æ‰“åŒ…</p><p>125ã€KVO &amp; KVC</p><p>ï¼ˆ1ï¼‰åº•å±‚å®ç°</p><p>ï¼ˆ2ï¼‰KVOæ¦‚è¿°</p><p>ï¼ˆ3ï¼‰KVCæ¦‚è¿°</p><p>126ã€ä»€ä¹ˆæ˜¯KVOå’ŒKVC?</p><p>KVOå’ŒKVC</p><p>ï¼ˆ1ï¼‰å¦‚ä½•è°ƒç”¨ç§æœ‰å˜é‡ï¼Œå¦‚ä½•ä¿®æ”¹ç³»ç»Ÿçš„åªè¯»å±æ€§ï¼ŒKVCçš„æŸ¥æ‰¾é¡ºåº</p><p>ï¼ˆ2ï¼‰ä»€ä¹ˆæ˜¯é”®-å€¼,é”®è·¯å¾„æ˜¯ä»€ä¹ˆ</p><p>ï¼ˆ3ï¼‰kvoçš„å®ç°æœºåˆ¶</p><p>ï¼ˆ4ï¼‰KVOè®¡ç®—å±æ€§ï¼Œè®¾ç½®ä¾èµ–é”®</p><p>ï¼ˆ5ï¼‰KVOé›†åˆå±æ€§</p><p>ï¼ˆ6ï¼‰kvoä½¿ç”¨åœºæ™¯</p><p>127ã€SDWebImage(SDWebImageçš„å®ç°æœºåˆ¶ï¼‰</p><p>ï¼ˆ1ï¼‰ä¸»è¦åŠŸèƒ½</p><p>ï¼ˆ2ï¼‰ç¼“å­˜</p><p>ï¼ˆ3ï¼‰å†…å­˜ç¼“å­˜ä¸ç£ç›˜ç¼“å­˜</p><p>128ã€æ¡†æ¶ SDWebimageçš„ç¼“å­˜æœºåˆ¶</p><p>129ã€ç½‘ç»œå®‰å…¨</p><p>å¯†ç çš„å®‰å…¨åŸåˆ™</p><p>130ã€å¤šçº¿ç¨‹</p><p>ï¼ˆ1ï¼‰å¤šçº¿ç¨‹æ¦‚å¿µ</p><p>ï¼ˆ2ï¼‰å¤šçº¿ç¨‹çš„ä½œç”¨</p><p>ï¼ˆ3ï¼‰ä½¿ç”¨åœºæ™¯</p><p>131ã€NSOperationQueueå’ŒGCDçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><p>132ã€GCDä¸NSThreadçš„åŒºåˆ«</p><p>133ã€è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ä¸è”ç³»æ˜¯ä»€ä¹ˆ?</p><p>134ã€åˆ«å¼‚æ­¥æ‰§è¡Œä¸¤ä¸ªè€—æ—¶æ“ä½œï¼Œç­‰ä¸¤æ¬¡è€—æ—¶æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•å,å†å›åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œ. ä½¿ç”¨é˜Ÿåˆ—ç»„(dispatch_group_t)å¿«é€Ÿ,é«˜æ•ˆçš„å®ç°ä¸Šè¿°éœ€æ±‚</p><p>135ã€åœ¨é¡¹ç›®ä»€ä¹ˆæ—¶å€™é€‰æ‹©ä½¿ç”¨GCDï¼Œä»€ä¹ˆæ—¶å€™é€‰æ‹©NSOperation?</p><p>136ã€å¯¹æ¯”iOSä¸­çš„å¤šçº¿ç¨‹æŠ€æœ¯</p><p>137ã€å¤šçº¿ç¨‹ä¼˜ç¼ºç‚¹</p><p>138ã€iOSä¸­çš„å»¶è¿Ÿæ“ä½œ</p><p>139ã€ä¸²è¡Œé˜Ÿåˆ—åŒæ­¥æ‰§è¡Œå’Œå¼‚æ­¥ä¸»é˜Ÿåˆ—</p><p>140ã€èµ„æºæŠ¢å¤ºè§£å†³æ–¹æ¡ˆ</p><p>141ã€dispatch_barrier_asyncçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>142ã€åœ¨å¤šçº¿ç¨‹Core Dataä¸­ï¼ŒNSC,MOC,NSObjectModelå“ªäº›éœ€è¦åœ¨çº¿ç¨‹ä¸­åˆ›å»ºæˆ–è€…ä¼ é€’ï¼Ÿä½ æ˜¯ç”¨ä»€ä¹ˆç­–è¶Šæ¥å®ç°çš„ï¼Ÿ</p><p>143ã€+(void)loadä¸ +(void)initializeåŒºåˆ«load å’Œ initializeæ–¹æ³•çš„åŒºåˆ«</p><p>144ã€httpçš„postä¸åŒºåˆ«ä¸è”ç³»ï¼Œå®è·µä¸­å¦‚ä½•é€‰æ‹©å®ƒä»¬ï¼Ÿ</p><p>145ã€è¯´è¯´å…³äºUDP/TCPçš„åŒºåˆ«ï¼Ÿ</p><p>146ã€httpå’Œscoketé€šä¿¡çš„åŒºåˆ«?socketè¿æ¥ç›¸å…³åº“,TCP,UDPçš„è¿æ¥æ–¹æ³•,HTTPçš„å‡ ç§å¸¸ç”¨æ–¹å¼?</p><p>147ã€HTTPè¯·æ±‚å¸¸ç”¨çš„å‡ ç§æ–¹å¼</p><p>148ã€block</p><p>ï¼ˆ1ï¼‰ä½¿ç”¨blockæ—¶ä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿå¼•ç”¨å¾ªç¯ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</p><p>ï¼ˆ2ï¼‰åœ¨blockå†…å¦‚ä½•ä¿®æ”¹blockå¤–éƒ¨å˜é‡ï¼Ÿ</p><p>ï¼ˆ3ï¼‰Block &amp; MRC-Block</p><p>ï¼ˆ4ï¼‰ä»€ä¹ˆæ˜¯block</p><p>ï¼ˆ5ï¼‰block å®ç°åŸç†</p><p>ï¼ˆ6ï¼‰å…³äºblock</p><p>ï¼ˆ7ï¼‰ä½¿ç”¨blockå’Œä½¿ç”¨delegateå®Œæˆå§”æ‰˜æ¨¡å¼æœ‰ä»€ä¹ˆä¼˜ç‚¹</p><p>ï¼ˆ8ï¼‰å¤šçº¿ç¨‹ä¸block</p><p>ï¼ˆ9ï¼‰è°ˆè°ˆå¯¹Block çš„ç†è§£?å¹¶å†™å‡ºä¸€ä¸ªä½¿ç”¨Blockæ‰§è¡ŒUIVewåŠ¨ç”»?</p><p>ï¼ˆ10ï¼‰å†™å‡ºä¸Šé¢ä»£ç çš„Blockçš„å®šä¹‰ï¼ˆæ¥ä¸Šé¢˜ï¼‰</p><p>149ã€Weakã€strongã€copyã€assign ä½¿ç”¨</p><p>ï¼ˆ1ï¼‰ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Œç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p><p>ï¼ˆ2ï¼‰æ€ä¹ˆç”¨ copy å…³é”®å­—ï¼Ÿ</p><p>ï¼ˆ3ï¼‰weak &amp; strong</p><p>ï¼ˆ4ï¼‰è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜ï¼š @property (copy) NSMutableArray *array</p><p>ï¼ˆ5ï¼‰ å¦‚ä½•è®©è‡ªå·±çš„ç±»ç”¨ copy ä¿®é¥°ç¬¦ï¼Ÿå¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setterï¼Ÿ</p><p>ï¼ˆ6ï¼‰ @property çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿivarã€getterã€setter æ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„</p><p>ï¼ˆ7ï¼‰ivarã€getterã€setter æ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„?</p><p>ï¼ˆ8ï¼‰ç”¨@propertyå£°æ˜çš„NSStringï¼ˆæˆ–NSArrayï¼ŒNSDictionaryï¼‰ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚æœæ”¹ç”¨strongå…³é”®å­—ï¼Œå¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>ï¼ˆ9ï¼‰@protocol å’Œ category ä¸­å¦‚ä½•ä½¿ç”¨ @property</p><p>ï¼ˆ10ï¼‰runtimeå¦‚ä½•é€šè¿‡selectoræ‰¾åˆ°å¯¹åº”çš„IMPåœ°å€ï¼Ÿ</p><p>ï¼ˆ11ï¼‰retainå’ŒcopyåŒºåˆ«</p><p>ï¼ˆ12ï¼‰copyå’Œstrongçš„ä½¿ç”¨ï¼Ÿ</p><p>ï¼ˆ13ï¼‰NSStringå’ŒNSMutableStringï¼Œå‰è€…çº¿ç¨‹å®‰å…¨ï¼Œåè€…çº¿ç¨‹ä¸å®‰å…¨ã€‚</p><p>ï¼ˆ14ï¼‰readwriteï¼Œreadonlyï¼Œassignï¼Œretainï¼Œcopyï¼Œweak ,strong,nonatomic å±æ€§çš„ä½œç”¨</p><p>150ã€OCä¸JSçš„äº¤äº’ï¼ˆiOSä¸H5æ··ç¼–ï¼‰</p><p>TableViewæ€§èƒ½ä¼˜åŒ–</p><p>UITableViewæ ¸å¿ƒæ€æƒ³</p><p>UITableViewçš„ä¼˜åŒ–ä¸»è¦ä»ä¸‰ä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p><p>151ã€TableViewä¸ºä»€ä¹ˆä¼šå¡ï¼Ÿ</p><p>152ã€UITableView</p><p>ï¼ˆ1ï¼‰UITableViewæœ€æ ¸å¿ƒçš„æ€æƒ³</p><p>ï¼ˆ2ï¼‰å®šä¹‰é«˜åº¦</p><p>ï¼ˆ3ï¼‰è‡ªå®šä¹‰é«˜åº¦åŸç†</p><p>ï¼ˆ4ï¼‰è€ç”Ÿå¸¸è°ˆä¹‹UITableViewçš„æ€§èƒ½ä¼˜åŒ–</p><p>ï¼ˆ5ï¼‰cellé«˜åº¦çš„è®¡ç®—</p><p>ï¼ˆ5.1ï¼‰å®šé«˜çš„cellå’ŒåŠ¨æ€é«˜åº¦çš„cell</p><p>ï¼ˆ6ï¼‰TableViewæ¸²æŸ“</p><p>ï¼ˆ7ï¼‰å‡å°‘è§†å›¾çš„æ•°ç›®</p><p>ï¼ˆ8ï¼‰å‡å°‘å¤šä½™çš„ç»˜åˆ¶æ“ä½œ</p><p>ï¼ˆ9ï¼‰ä¸è¦ç»™cellåŠ¨æ€æ·»åŠ subView</p><p>ï¼ˆ10ï¼‰å¼‚æ­¥åŒ–UIï¼Œä¸è¦é˜»å¡ä¸»çº¿ç¨‹</p><p>ï¼ˆ11ï¼‰æ»‘åŠ¨æ—¶æŒ‰éœ€åŠ è½½å¯¹åº”çš„å†…å®¹</p><p>ï¼ˆ12ï¼‰ç¦»å±æ¸²æŸ“çš„é—®é¢˜</p><p>ï¼ˆ13ï¼‰ç¦»å±æ¸²æŸ“ä¼˜åŒ–æ–¹æ¡ˆ</p><p>153ã€ç¯ä¿¡SDKä½¿ç”¨</p><p>154ã€è“ç‰™</p><p>155ã€åœ¨iPhoneåº”ç”¨ä¸­å¦‚ä½•ä¿å­˜æ•°æ®?</p><p>156ã€ä»€ä¹ˆæ˜¯coredata?</p><p>157ã€ ä»€ä¹ˆæ˜¯NSManagedObjectæ¨¡å‹?</p><p>158ã€ä»€ä¹ˆæ˜¯NSManagedobjectContext?</p><p>159ã€ iOSå¹³å°æ€ä¹ˆåšæ•°æ®çš„æŒä¹…åŒ–?coredata å’Œsqliteæœ‰æ— å¿…ç„¶è”ç³»ï¼Ÿcoredataæ˜¯ä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“å—ï¼Ÿ</p><p>160ã€CoreData &amp; SQLite3</p><p>161ã€æ•°æ®å­˜å‚¨</p><p>ï¼ˆ1ï¼‰æ•°æ®å­˜å‚¨æŠ€æœ¯</p><p>ï¼ˆ1.1ï¼‰æ•°æ®å­˜å‚¨çš„å‡ ç§æ–¹å¼</p><p>ï¼ˆ1.2ï¼‰å„è‡ªç‰¹ç‚¹ï¼ˆé¢è¯•è€ƒç‚¹ï¼‰</p><p>ï¼ˆ1.3ï¼‰åå¥½è®¾ç½®ï¼ˆé¢è¯•è€ƒç‚¹ï¼‰</p><p>ï¼ˆ1.4ï¼‰å½’æ¡£ï¼ˆé¢è¯•è€ƒç‚¹ï¼‰</p><p>ï¼ˆ2ï¼‰æ•°æ®åº“æŠ€æœ¯ï¼ˆSQLite&amp;CoreDataï¼‰</p><p>162ã€Objective-Cå †å’Œæ ˆçš„åŒºåˆ«ï¼Ÿ</p><p>163ã€å†…å­˜æ³„éœ² &amp; å†…å­˜æº¢å‡º</p><p>164ã€å † &amp; æ ˆ</p><p>ï¼ˆ1ï¼‰å †æ ˆç©ºé—´åˆ†é…åŒºåˆ«</p><p>ï¼ˆ2ï¼‰å †æ ˆç¼“å­˜æ–¹å¼åŒºåˆ«</p><p>ï¼ˆ3ï¼‰å †æ ˆæ•°æ®ç»“æ„åŒºåˆ«</p><p>165ã€å†…å­˜ç®¡ç†</p><p>ï¼ˆ1ï¼‰å†…å­˜åŒºåŸŸ</p><p>ï¼ˆ1.1ï¼‰å †å’Œæ ˆçš„åŒºåˆ«</p><p>ï¼ˆ1.2ï¼‰iOSå†…å­˜åŒºåŸŸ</p><p>ï¼ˆ2ï¼‰å­—ç¬¦ä¸²çš„å†…å­˜ç®¡ç†</p><p>ï¼ˆ3ï¼‰ä½ æ˜¯å¦‚ä½•ä¼˜åŒ–å†…å­˜ç®¡ç†</p><p>ï¼ˆ4ï¼‰å¾ªç¯å¼•ç”¨</p><p>ï¼ˆ5ï¼‰autoreleaseçš„ä½¿ç”¨</p><p>ï¼ˆ5.1ï¼‰å·¥å‚æ–¹æ³•ä¸ºä»€ä¹ˆä¸é‡Šæ”¾å¯¹è±¡</p><p>ï¼ˆ5.2ï¼‰ARCä¸‹autoreleaseçš„ä½¿ç”¨åœºæ™¯</p><p>ï¼ˆ5.3ï¼‰è‡ªåŠ¨é‡Šæ”¾æ± å¦‚ä½•å·¥ä½œ</p><p>ï¼ˆ5.4ï¼‰é¿å…å†…å­˜å³°å€¼</p><p>ï¼ˆ5.5ï¼‰ARCå’ŒMRCçš„æ··ç”¨</p><p>ï¼ˆ5.6ï¼‰NSTimerçš„å†…å­˜ç®¡ç†</p><p>ï¼ˆ5.7ï¼‰ARCçš„å®ç°åŸç†</p><p>166ã€Runloop</p><p>167ã€fmmpegæ¡†æ¶</p><p>168ã€fmdbæ¡†æ¶</p><p>169ã€320æ¡†æ¶</p><p>170ã€UIKitå’ŒCoreAnimationå’ŒCoreGraphicsçš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿåœ¨å¼€å‘ä¸­æ˜¯å¦ä½¿ç”¨è¿‡CoreAnimationå’ŒCoreGraphics?</p><p>171ã€trasform</p><p>172ã€ç‚¹è®²åŠ¨ç”»å’Œlayer ,viewçš„åŒºåˆ«</p><p>173ã€å›¾å±‚ä¸è§†å›¾</p><p>174ã€å¹³è¡Œçš„å±‚çº§å…³ç³»</p><p>175ã€å›¾å±‚çš„èƒ½åŠ›</p><p>176ã€ä½¿ç”¨å›¾å±‚</p><p>177ã€æ ¸å¿ƒç»˜å›¾</p><p>ï¼ˆ1ï¼‰Viewå’Œlayerçš„åŒºåˆ«</p><p>ï¼ˆ2ï¼‰newå’Œalloc initçš„åŒºåˆ«</p><p>178ã€åŠ¨ç”»</p><p>179ã€UICollectionView</p><p>ï¼ˆ1ï¼‰ä½•å®ç°ç€‘å¸ƒæµ,æµæ°´å¸ƒå±€</p><p>ï¼ˆ2ï¼‰å’ŒUITableViewçš„ä½¿ç”¨åŒºåˆ«</p><p>180ã€UIImage</p><p>181ã€webview</p><p>182ã€æè¿°ä¹å®«æ ¼ç®—æ³•</p><p>183ã€å®ç°å›¾ç‰‡è½®æ’­å›¾</p><p>184ã€iOSç½‘ç»œæ¡†æ¶</p><p>185ã€ç½‘ç»œ</p><p>ï¼ˆ1ï¼‰ç½‘ç»œåŸºç¡€</p><p>ï¼ˆ2ï¼‰ç½‘ç»œä¼ è¾“</p><p>ï¼ˆ3ï¼‰AFN</p><p>186ã€AFNetworking &amp; ASIHttpRequest &amp; MKNetWorking</p><p>ï¼ˆ1ï¼‰åº•å±‚å®ç°</p><p>ï¼ˆ2ï¼‰å¯¹æœåŠ¡å™¨è¿”å›çš„æ•°æ®å¤„ç†</p><p>ï¼ˆ3ï¼‰ç›‘å¬è¯·æ±‚è¿‡ç¨‹</p><p>ï¼ˆ4ï¼‰åœ¨æ–‡ä»¶ä¸‹è½½å’Œæ–‡ä»¶ä¸Šä¼ çš„ä½¿ç”¨éš¾æ˜“åº¦</p><p>ï¼ˆ5ï¼‰ç½‘ç»œç›‘æ§</p><p>ï¼ˆ6ï¼‰ASIæä¾›çš„å…¶ä»–å®ç”¨åŠŸèƒ½</p><p>ï¼ˆ7ï¼‰MKNetworkKit</p><p>187ã€æ€§èƒ½ä¼˜åŒ–</p><p>188ã€ç®—æ³•</p>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>é¢è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOS é¢è¯•é¢˜ï¼ˆäºŒï¼‰</title>
    <link href="/2018/02/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-002/"/>
    <url>/2018/02/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-002/</url>
    
    <content type="html"><![CDATA[<h2 id="æ¶æ„æ¨¡å¼-ç¼–ç¨‹æ€æƒ³-è®¾è®¡æ¨¡å¼"><a href="#æ¶æ„æ¨¡å¼-ç¼–ç¨‹æ€æƒ³-è®¾è®¡æ¨¡å¼" class="headerlink" title="æ¶æ„æ¨¡å¼,ç¼–ç¨‹æ€æƒ³,è®¾è®¡æ¨¡å¼"></a>æ¶æ„æ¨¡å¼,ç¼–ç¨‹æ€æƒ³,è®¾è®¡æ¨¡å¼</h2><h3 id="1ã€æ¶æ„æ¨¡å¼"><a href="#1ã€æ¶æ„æ¨¡å¼" class="headerlink" title="1ã€æ¶æ„æ¨¡å¼"></a>1ã€æ¶æ„æ¨¡å¼</h3><ul><li>MVC:<blockquote><p>MVCå³Model-VIew-Controllerã€‚MVCæ¨¡å¼è‡´åŠ›äºå…³æ³¨ç‚¹çš„åˆ‡åˆ†ï¼Œè¿™æ„å‘³ç€modelå’Œcontrollerçš„é€»è¾‘æ˜¯ä¸ä¸ç”¨æˆ·ç•Œé¢ï¼ˆViewï¼‰æŒ‚é’©çš„ã€‚Modelå±‚ä»£è¡¨äº†æè¿°ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®çš„ä¸€ç³»åˆ—ç±»çš„é›†åˆã€‚å®ƒä¹Ÿå®šä¹‰äº†æ•°æ®ä¿®æ”¹å’Œæ“ä½œçš„ä¸šåŠ¡è§„åˆ™ã€‚Viewä»£è¡¨äº†UIç»„ä»¶ï¼ŒåƒUIViewï¼ŒUIButtonï¼ŒUITableViewç­‰ã€‚ä»–åªè´Ÿè´£å±•ç¤ºä»controlleræ¥æ”¶åˆ°çš„æ•°æ®ã€‚å› æ­¤ï¼Œç»´æŠ¤å’Œæµ‹è¯•ç¨‹åºå˜å¾—æ›´åŠ ç®€å•å®¹æ˜“ã€‚ç„¶è€Œåœ¨Cocoaçš„MVCæ¨¡å¼ä¸­Controllerç»å¸¸è¢«æ··æ‚åœ¨Viewçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå› æ­¤å¾ˆéš¾è¯´Viewå’ŒViewControlleræ˜¯åˆ†ç¦»çš„ï¼Œè¿™ä¹Ÿå¾€å¾€é©±ä½¿äººä»¬å†™å‡ºè‡ƒè‚¿çš„è§†å›¾æ§åˆ¶å™¨ï¼Œå°½ç®¡ä»å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è½¬æ¢åˆ°Modelï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹å½“éœ€è¦ä¸ºViewå‡è´Ÿçš„æ—¶å€™æˆ‘ä»¬å´æ— èƒ½ä¸ºåŠ›äº†ã€‚Viewçš„æœ€å¤§çš„ä»»åŠ¡å°±æ˜¯å‘Controllerä¼ é€’ç”¨æˆ·åŠ¨ä½œäº‹ä»¶ã€‚ViewControllerä¸å†æ‰¿æ‹…ä¸€åˆ‡ä»£ç†å’Œæ•°æ®æºçš„èŒè´£ï¼Œé€šå¸¸åªè´Ÿè´£ä¸€äº›åˆ†å‘å’Œå–æ¶ˆç½‘ç»œè¯·æ±‚ä»¥åŠä¸€äº›å…¶ä»–çš„ä»»åŠ¡ã€‚å½“åœ¨è¿›è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ä½ ä¼šå‘ç°é—®é¢˜è¶Šæ¥è¶Šæ˜æ˜¾ã€‚å› ä¸ºä½ çš„ViewControllerå’ŒViewæ˜¯ç´§å¯†è€¦åˆçš„ï¼Œå¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•å°±æ˜¾å¾—å¾ˆè‰°éš¾ã€‚Cocoa MVCçœ‹æ¥å¹¶ä¸æ˜¯æˆ‘ä»¬å®šä¹‰ä¸­ç†æƒ³çš„æ¶æ„æ¨¡å¼ã€‚</p></blockquote></li><li>MVVM:<blockquote><p>å³Model-View-View Modelã€‚è¿™ä¸ªæ¨¡å¼æä¾›å¯¹Viewå’ŒView Modelçš„åŒå‘æ•°æ®ç»‘å®šã€‚è¿™ä½¿å¾—View Modelçš„çŠ¶æ€æ”¹å˜å¯ä»¥è‡ªåŠ¨ä¼ é€’ç»™Viewã€‚å…¸å‹çš„æƒ…å†µæ˜¯ï¼ŒView Modelé€šè¿‡ä½¿ç”¨obseveræ¨¡å¼ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰æ¥å°†View Modelçš„å˜åŒ–é€šçŸ¥ç»™modelã€‚View Modelè´Ÿè´£æš´æ¼æ–¹æ³•ï¼Œå‘½ä»¤ï¼Œå…¶ä»–å±æ€§æ¥æ“ä½œVIewçš„çŠ¶æ€ï¼Œç»„è£…modelä½œä¸ºViewåŠ¨ä½œçš„ç»“æœï¼Œå¹¶ä¸”è§¦å‘Viewè‡ªå·±çš„äº‹ä»¶ã€‚å®ƒå’ŒMVPæ¨¡å¼çœ‹èµ·æ¥éå¸¸åƒ:MVVMå°†ViewControllerè§†ä½œView,Viewå’ŒModelä¹‹é—´æ²¡æœ‰ç´§å¯†çš„è”ç³»ã€‚åœ¨ä½¿ç”¨MVVMæ¨¡å¼æ—¶ï¼Œè‡ªç„¶è€Œç„¶ä¼šæƒ³åˆ°ReactiveCocaï¼Œåä¹‹äº¦ç„¶ã€‚å°½ç®¡é€šè¿‡ç®€å•çš„ç»‘å®šæ¥ä½¿ç”¨MVVMæ˜¯å¯å®ç°çš„ï¼Œä½†æ˜¯ReactiveCocoaå´èƒ½æ›´å¥½çš„å‘æŒ¥MVVMæ¨¡å¼çš„ç‰¹ç‚¹ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ä¸ªæ¡†æ¶æœ‰ä¸ªéš¾ä»¥å¿½ç•¥çš„äº‹å®ï¼šå½“ä½ åˆšå¼€å§‹ä½¿ç”¨ReactiveCocaçš„æ—¶å€™æœ‰å¾ˆå¤§çš„å¯èƒ½å°±ä¼šæŠŠäº‹æƒ…æç ¸ã€‚æ¢å¥è¯æ¥è¯´å°±æ˜¯ï¼Œå¦‚æœå‘ç°äº†ä¸€äº›é”™è¯¯ï¼Œå½“ä½ è¯•å›¾æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆæ—¶ä½ å¯èƒ½ä¼šå–Šï¼šâ€œå¤©å“ªï¼Œå¥½æ·±çš„å‡½æ•°è°ƒç”¨æ ˆâ€œï¼è°ƒè¯•å‡ºè¿™ä¸ªbugå¯èƒ½ä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ã€‚MVVMå¾ˆè¯±äººï¼Œå› ä¸ºå®ƒé›†åˆäº†ä¸Šè¿°æ–¹æ³•çš„ä¼˜ç‚¹ï¼Œå¹¶ä¸”ç”±äºåœ¨Viewå±‚çš„ç»‘å®šï¼Œå®ƒå¹¶ä¸éœ€è¦å…¶ä»–é™„åŠ çš„ä»£ç æ¥æ›´æ–°Viewï¼Œå°½ç®¡è¿™æ ·ï¼Œå¯æµ‹è¯•æ€§ä¾ç„¶å¾ˆå¼ºâ€”â€”ç¬¦åˆæˆ‘ä»¬ç†æƒ³ä¸­å¥½æ¶æ„æ¨¡å¼çš„å®šä¹‰ã€‚</p></blockquote></li><li>MVP:<blockquote><p>è¿™ä¸ªæ¨¡å¼æŠŠPresenteræ¢æˆControllerå°±å’ŒMVCéå¸¸ç›¸åƒäº†ã€‚è¿™ä¸ªè®¾è®¡æ¨¡å¼æŠŠåº”ç”¨ç¨‹åºåˆ†æˆäº†3ä¸ªä¸»è¦æ–¹é¢ï¼šModelã€Viewå’ŒPresenter,å…¶ä¸­çš„Modelå’ŒViewä¸MVCæ¨¡ä¸­çš„è§’è‰²ç›¸åŒã€‚Presenterè´Ÿè´£å¤„ç†ViewèƒŒåæ‰€æœ‰çš„UIäº‹ä»¶ã€‚å®ƒé€šè¿‡Viewæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œä¹‹ååˆ©ç”¨Modelæ¥å¤„ç†ç”¨æˆ·çš„æ•°æ®ï¼Œæœ€åæŠŠç»“æœè¿”å›ç»™Viewã€‚ä¸Viewå’ŒControllerä¸åŒï¼ŒViewå’ŒPresenterä¹‹é—´æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œä»–ä»¬é€šè¿‡æ¥å£æ¥äº¤äº’ã€‚å¦å¤–ï¼Œpresenterä¸åƒcontrollerå¤„ç†è¿›å…¥çš„è¯·æ±‚ã€‚è¿™ä¸æ˜¯æ­£è§£å†³äº†Cocoa MVCä¸­ViewControllerå’ŒViewçš„è€¦åˆé—®é¢˜å—ï¼Ÿå°±MVPæ¨¡å¼è€Œè¨€ï¼ŒUIViewControllerçš„å­ç±»å®é™…ä¸Šå°±æ˜¯Viewså¹¶ä¸æ˜¯Presentersã€‚è¿™ç‚¹åŒºåˆ«ä½¿å¾—è¿™ç§æ¨¡å¼çš„å¯æµ‹è¯•æ€§å¾—åˆ°äº†æå¤§çš„æé«˜ï¼Œä»˜å‡ºçš„ä»£ä»·æ˜¯å¼€å‘é€Ÿåº¦çš„ä¸€äº›é™ä½ï¼Œå› ä¸ºå¿…é¡»è¦åšä¸€äº›æ‰‹åŠ¨çš„æ•°æ®å’Œäº‹ä»¶ç»‘å®šã€‚ä½†æ˜¯è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å°†æœ€ä¸»è¦çš„ä»»åŠ¡åˆ’åˆ†åˆ°Presenterå’ŒModelï¼Œè€ŒViewçš„åŠŸèƒ½è¾ƒå°‘â€”â€”å„ä¸ªå®ä½“ä»»åŠ¡é‡åˆ†é…ä¸å‡è¡¡ã€‚</p></blockquote></li><li>Viperæ¶æ„æ¨¡å¼:<blockquote><p>ç”±è§†å›¾ (View)ï¼Œäº¤äº’å™¨ (Interactor)ï¼Œå±•ç¤ºå™¨ (Presenter)ï¼Œå®ä½“ (Entity) ä»¥åŠè·¯ç”± (Routing) ç»„æˆã€‚<br><br>è§†å›¾ï¼šæ ¹æ®å±•ç¤ºå™¨çš„è¦æ±‚æ˜¾ç¤ºç•Œé¢ï¼Œå¹¶å°†ç”¨æˆ·è¾“å…¥åé¦ˆç»™å±•ç¤ºå™¨ã€‚<br><br>äº¤äº’å™¨ï¼šåŒ…å«ç”±ç”¨ä¾‹æŒ‡å®šçš„ä¸šåŠ¡é€»è¾‘ã€‚<br><br>å±•ç¤ºå™¨ï¼šåŒ…å«ä¸ºæ˜¾ç¤ºï¼ˆä»äº¤äº’å™¨æ¥å—çš„å†…å®¹ï¼‰åšçš„å‡†å¤‡å·¥ä½œçš„ç›¸å…³è§†å›¾é€»è¾‘ï¼Œå¹¶å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œåé¦ˆï¼ˆä»äº¤äº’å™¨è·å–æ–°æ•°æ®ï¼‰ã€‚<br><br>å®ä½“ï¼šåŒ…å«äº¤äº’å™¨è¦ä½¿ç”¨çš„åŸºæœ¬æ¨¡å‹å¯¹è±¡ã€‚<br><br>è·¯ç”±ï¼šåŒ…å«ç”¨æ¥æè¿°å±å¹•æ˜¾ç¤ºå’Œæ˜¾ç¤ºé¡ºåºçš„å¯¼èˆªé€»è¾‘ã€‚<br>Viperå°†åº”ç”¨ç¨‹åºçš„é€»è¾‘ç»“æ„åˆ’åˆ†ä¸ºä¸åŒçš„è´£ä»»å±‚ã€‚è¿™ä½¿å¾—å®ƒæ›´å®¹æ˜“éš”ç¦»ä¾èµ–é¡¹ (å¦‚æ•°æ®åº“)ï¼Œä¹Ÿæ›´å®¹æ˜“æµ‹è¯•å„å±‚é—´çš„è¾¹ç•Œå¤„çš„äº¤äº’ã€‚<br><br>Viperçš„ä¸åŒå±‚æä¾›äº†æ˜ç¡®çš„ç¨‹åºé€»è¾‘ä»¥åŠå¯¼èˆªæ§åˆ¶ä»£ç æ¥é¿å…è§†å›¾æ§åˆ¶å™¨å¤ªè¿‡äºè‡ƒè‚¿çš„é—®é¢˜ï¼Œåˆ©ç”¨ Viper ï¼Œè§†å›¾æ§åˆ¶å™¨å¯ä»¥ç®€æ´é«˜æ•ˆï¼Œæ„ä¹‰æ˜ç¡®åœ°æ§åˆ¶è§†å›¾ã€‚è§†å›¾æ§åˆ¶å™¨ä¸­ä»£ç å’Œæ‰€æœ‰çš„å…¶ä»–ç±»å¾ˆå®¹æ˜“ç†è§£ï¼Œå®¹æ˜“æµ‹è¯•ï¼Œç†æ‰€å½“ç„¶ä¹Ÿæ›´æ˜“ç»´æŠ¤ã€‚<br>æ¯«æ— ç–‘é—®ï¼ŒViperåœ¨åˆ’åˆ†è´£ä»»çš„ç²’åº¦ä¸Šæ¯”ä»¥ä¸Šå‡ ç§æ¨¡å¼éƒ½è¦ä¼˜ç§€ï¼Œè‡ªç„¶è€Œç„¶å°±æœ‰æ›´å¥½çš„å¯æµ‹è¯•æ€§ï¼Œå½“ç„¶ä½ å¿…é¡»ä¸ºå¾ˆå°åŠŸèƒ½çš„ç±»å†™å‡ºå¤§é‡çš„æ¥å£ã€‚å¦‚æœæ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ä½¿ç”¨Viperï¼ŒViperæ¶æ„æ¨¡å¼ç¬¦åˆæˆ‘ä»¬ç†æƒ³ä¸­å¥½æ¶æ„æ¨¡å¼çš„å®šä¹‰ã€‚</p></blockquote></li></ul><h3 id="2ã€ç¼–ç¨‹æ€æƒ³"><a href="#2ã€ç¼–ç¨‹æ€æƒ³" class="headerlink" title="2ã€ç¼–ç¨‹æ€æƒ³"></a>2ã€ç¼–ç¨‹æ€æƒ³</h3><h4 id="é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³"><a href="#é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³" class="headerlink" title="é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³"></a>é¢å‘å¯¹è±¡ç¼–ç¨‹æ€æƒ³</h4><blockquote><h5 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h5><p>åœ¨é¢å‘å¯¹è±¡çš„è¯­è¨€ä¸­ï¼Œå¯¹è±¡ã€ç±»ã€æ–¹æ³•éƒ½æ˜¯ä¸€ç§å°è£…ï¼Œå¯¹è±¡æ˜¯å°è£…çš„æœ€åŸºæœ¬å•ä½ã€‚<br><br>ç±»çš„å°è£…ä½“ç°åœ¨æ¯ä¸ªç±»éƒ½æœ‰.hå’Œ.mä¸¤ä¸ªæ–‡ä»¶ï¼Œå°†å®šä¹‰ä¸å®ç°åˆ†å¼€ï¼Œ.hå£°æ˜ï¼ˆç”¨æˆ·å¯è§çš„å¤–éƒ¨æ¥å£ï¼‰ï¼Œ.må®ç°ï¼ˆç”¨æˆ·ä¸å¯è§çš„å†…éƒ¨å®ç°ï¼‰ã€‚æ–¹æ³•çš„å°è£…ï¼Œæ˜¯æœ€å¸¸è§çš„ï¼Œæ¯ä¸ªæ–¹æ³•ä¸­å°è£…äº†ä¸€ä¸ªå°çš„åŠŸèƒ½ï¼Œè¿™æ˜¯å•ä¸€èŒè´£çš„å¾ˆå¥½ä½“ç°ï¼Œç¬¬ä¸‰æ–¹æ¡†æ¶å’Œä»£ç ä¹Ÿæ˜¯ä¸€ç§å°è£…ã€‚å°è£…ä½¿ç¨‹åºçš„ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œå°†å®ç°çš„ä¿¡æ¯å°è£…éšè—ï¼Œç”¨çš„æ—¶å€™ç›´æ¥è°ƒç”¨å°è£…å¥½çš„æ–¹æ³•æˆ–ç±»ï¼Œæé«˜æ•ˆç‡ã€‚æ­¤å¤–ï¼Œå¯ä»¥å‡å°‘ç¨‹åºé—´çš„ç›¸äº’ä¾èµ–ã€‚</p><h5 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h5><p>å­ç±»è‡ªåŠ¨å…±äº«çˆ¶ç±»éç§æœ‰æ•°æ®ç»“æ„å’Œæ–¹æ³•çš„æœºåˆ¶ï¼Œæ˜¯ç±»ä¹‹é—´çš„ä¸€ç§å…³ç³»ã€‚<br><br>ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡è¯­è¨€ç‰¹æœ‰çš„ï¼Œé¢å‘è¿‡ç¨‹çš„è¯­è¨€ä¸å…·æœ‰ç»§æ‰¿ç‰¹æ€§ï¼ŒOCæ˜¯å•ç»§æ‰¿ã€‚<br><br>ç»§æ‰¿æä¾›äº†ç±»çš„è§„èŒƒç­‰çº§ç»“æ„ï¼Œä½¿å…¬å…±çš„ç‰¹æ€§èƒ½å¤Ÿå…±äº«ï¼Œæé«˜çš„è½¯ä»¶çš„é‡ç”¨æ€§ã€‚<br><br>ç±»çš„ç»§æ‰¿æ€§ä½¿æ‰€å»ºçš„è½¯ä»¶å…·æœ‰å¼€å‘æ€§ã€å¯æ‰©å……æ€§ï¼Œç®€åŒ–äº†å¯¹è±¡ã€ç±»çš„åˆ›å»ºå·¥ä½œé‡ï¼Œæé«˜äº†ä»£ç çš„é‡ç”¨æ€§ã€‚</p><h5 id="å¤šæ€"><a href="#å¤šæ€" class="headerlink" title="å¤šæ€"></a>å¤šæ€</h5><p>ç”¨çˆ¶ç±»æŒ‡é’ˆæŒ‡å‘å­ç±»çš„å¯¹è±¡ã€‚é€šè¿‡ä¸åŒçš„å¯¹è±¡è°ƒç”¨ç›¸åŒçš„åç§°çš„æ–¹æ³•ï¼Œå´äº§ç”Ÿä¸åŒçš„ç»“æœã€‚<br><br>é€šè¿‡çˆ¶ç±»æŒ‡é’ˆå¾—åˆ°çš„å‡ ä¸ªå¯¹è±¡ï¼Œéƒ½è°ƒç”¨äº†çˆ¶ç±»ä¸­æŸä¸ªæ–¹æ³•ï¼Œä½†å®é™…ä¸Šåœ¨è¿è¡Œçš„æ—¶å€™ï¼Œæ˜¯æ‰§è¡Œçš„è‡ªå·±çœŸå®ç±»ä¸­çš„æ–¹æ³•ã€‚<br><br>å¤šæ€å¢å¼ºäº†è½¯ä»¶çš„çµæ´»æ€§å’Œé‡ç”¨æ€§ã€‚</p></blockquote><h4 id="é“¾å¼ç¼–ç¨‹æ€æƒ³"><a href="#é“¾å¼ç¼–ç¨‹æ€æƒ³" class="headerlink" title="é“¾å¼ç¼–ç¨‹æ€æƒ³"></a>é“¾å¼ç¼–ç¨‹æ€æƒ³</h4><blockquote><p>å°†å¤šä¸ªæ“ä½œï¼ˆå¤šè¡Œä»£ç ï¼‰é€šè¿‡ç‚¹å·(.)é“¾æ¥åœ¨ä¸€èµ·æˆä¸ºä¸€å¥ä»£ç ,ä½¿ä»£ç å¯è¯»æ€§å¥½ã€‚a(1).b(2).c(3)<br><br>é“¾å¼ç¼–ç¨‹ç‰¹ç‚¹ï¼šæ–¹æ³•çš„è¿”å›å€¼æ˜¯block,blockå¿…é¡»æœ‰è¿”å›å€¼ï¼ˆæœ¬èº«å¯¹è±¡ï¼‰ï¼Œblockå‚æ•°ï¼ˆéœ€è¦æ“ä½œçš„å€¼<br><br>ä»£è¡¨ï¼šMasonryæ¡†æ¶</p></blockquote><h4 id="å“åº”å¼ç¼–ç¨‹æ€æƒ³"><a href="#å“åº”å¼ç¼–ç¨‹æ€æƒ³" class="headerlink" title="å“åº”å¼ç¼–ç¨‹æ€æƒ³"></a>å“åº”å¼ç¼–ç¨‹æ€æƒ³</h4><blockquote><p>ä¸éœ€è¦è€ƒè™‘è°ƒç”¨é¡ºåºï¼Œåªéœ€è¦çŸ¥é“è€ƒè™‘ç»“æœï¼Œç±»ä¼¼äºè´è¶æ•ˆåº”ï¼Œäº§ç”Ÿä¸€ä¸ªäº‹ä»¶ï¼Œä¼šå½±å“å¾ˆå¤šä¸œè¥¿ï¼Œè¿™äº›äº‹ä»¶åƒæµä¸€æ ·çš„ä¼ æ’­å‡ºå»ï¼Œç„¶åå½±å“ç»“æœï¼Œå€Ÿç”¨é¢å‘å¯¹è±¡çš„ä¸€å¥è¯ï¼Œä¸‡ç‰©çš†æ˜¯æµã€‚<br></p></blockquote><blockquote><p>ä»£è¡¨ï¼šKVOè¿ç”¨ã€‚</p></blockquote><h4 id="å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³"><a href="#å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³" class="headerlink" title="å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³"></a>å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³</h4><blockquote><p>æ˜¯æŠŠæ“ä½œå°½é‡å†™æˆä¸€ç³»åˆ—åµŒå¥—çš„å‡½æ•°æˆ–è€…æ–¹æ³•è°ƒç”¨ã€‚<br><br>å‡½æ•°å¼ç¼–ç¨‹æœ¬è´¨:å°±æ˜¯å¾€æ–¹æ³•ä¸­ä¼ å…¥Block,æ–¹æ³•ä¸­åµŒå¥—Blockè°ƒç”¨ï¼ŒæŠŠä»£ç èšåˆèµ·æ¥ç®¡ç†<br><br>å‡½æ•°å¼ç¼–ç¨‹ç‰¹ç‚¹ï¼šæ¯ä¸ªæ–¹æ³•å¿…é¡»æœ‰è¿”å›å€¼ï¼ˆæœ¬èº«å¯¹è±¡ï¼‰,æŠŠå‡½æ•°æˆ–è€…Blockå½“åšå‚æ•°,blockå‚æ•°ï¼ˆéœ€è¦æ“ä½œçš„å€¼ï¼‰blockè¿”å›å€¼ï¼ˆæ“ä½œç»“æœï¼‰<br><br>ä»£è¡¨ï¼šReactiveCocoaã€‚</p></blockquote><h2 id="åº•å±‚è¿›é˜¶-æ·±å±‚ç†è§£"><a href="#åº•å±‚è¿›é˜¶-æ·±å±‚ç†è§£" class="headerlink" title="åº•å±‚è¿›é˜¶,æ·±å±‚ç†è§£"></a>åº•å±‚è¿›é˜¶,æ·±å±‚ç†è§£</h2><h2 id="ä¸‰æ–¹æ¡†æ¶è¦çŸ¥å…¶ç„¶-è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶"><a href="#ä¸‰æ–¹æ¡†æ¶è¦çŸ¥å…¶ç„¶-è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶" class="headerlink" title="ä¸‰æ–¹æ¡†æ¶è¦çŸ¥å…¶ç„¶,è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶"></a>ä¸‰æ–¹æ¡†æ¶è¦çŸ¥å…¶ç„¶,è€ŒçŸ¥å…¶æ‰€ä»¥ç„¶</h2><h3 id="1ã€AFNetworking"><a href="#1ã€AFNetworking" class="headerlink" title="1ã€AFNetworking"></a>1ã€AFNetworking</h3><p>AFNetworkingæœ‰5ä¸ªæ¨¡å—ï¼š</p><h4 id="NSURLSession-ç½‘ç»œè¯·æ±‚æ¨¡å—"><a href="#NSURLSession-ç½‘ç»œè¯·æ±‚æ¨¡å—" class="headerlink" title="NSURLSession ç½‘ç»œè¯·æ±‚æ¨¡å—"></a>NSURLSession ç½‘ç»œè¯·æ±‚æ¨¡å—</h4><blockquote><p>AFHTTPSessionManagerç»§æ‰¿è‡ªAFURLSessionManager<br><br>GET<br><br>POST<br><br>DELETE<br><br>PUT<br><br>PATCH<br><br>æ–‡ä»¶ä¸Šä¼ <br><br>AFURLSessionManager<br><br>ç®¡ç†æ‰€æœ‰çš„è¯·æ±‚ï¼Œè®¾ç½®äº†NSURLSessionTaskDelegate, NSRULSessionDataDelegate,NSURLSessionDownloadDelegateå®ç°è¯ä¹¦åˆæ³•æ€§æ ¡éªŒï¼Œæ•°æ®ä¼ è¾“è¿›åº¦æ£€æµ‹ï¼Œæ•°æ®è¯·æ±‚æˆåŠŸ/å¤±è´¥çš„å›è°ƒã€‚<br>ä½¿ç”¨Runtimeç”¨af_suspendæ›¿æ¢ suspend, ç”¨af_resumeæ›¿æ¢äº†resume å½“è°ƒç”¨è€…ä¸¤ä¸ªæ–¹æ³•æ—¶å¾€ä¸Šå±‚å‘é€é€šçŸ¥ AFNetworkingTaskDidSuspendNotification AFNetworkingTaskDidResumeNotification<br>è¯·æ±‚æœåŠ¡å™¨æ•°æ®<br><br>ä¸Šä¼ æ•°æ®<br><br>å¤šçº¿ç¨‹ä¸‹è½½æ•°æ®</p></blockquote><h4 id="Reachability-ç›‘æµ‹ç½‘ç»œçŠ¶æ€æ¨¡å—"><a href="#Reachability-ç›‘æµ‹ç½‘ç»œçŠ¶æ€æ¨¡å—" class="headerlink" title="Reachability ç›‘æµ‹ç½‘ç»œçŠ¶æ€æ¨¡å—"></a>Reachability ç›‘æµ‹ç½‘ç»œçŠ¶æ€æ¨¡å—</h4><blockquote><p>AFNetworkReachabilityManager</p></blockquote><h4 id="Security-å®‰å…¨ç­–ç•¥æ¨¡å—"><a href="#Security-å®‰å…¨ç­–ç•¥æ¨¡å—" class="headerlink" title="Security å®‰å…¨ç­–ç•¥æ¨¡å—"></a>Security å®‰å…¨ç­–ç•¥æ¨¡å—</h4><blockquote><p>AFSecurityPolicy:iOSé¡¹ç›®å°†æœåŠ¡å™¨ç«¯çš„è¯ä¹¦ä¿å­˜å¯¼å…¥åˆ°é¡¹ç›®ä¸­ï¼ŒAFNæ ¹æ®é¡¹ç›®ä¸­çš„æœåŠ¡å™¨è¯ä¹¦æ¥è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯æœåŠ¡å™¨ï¼Œä¿è¯è®¿é—®æœåŠ¡å™¨çš„å®‰å…¨æ€§ã€‚<br><br>éªŒè¯è¯ä¹¦çš„æ¨¡å¼æœ‰ä¸‰ç§ï¼š<br><br>AFSSLPinningModeNone ä¸éªŒè¯<br><br>AFSSLPinningModePublicKey åªéªŒè¯å…¬é’¥<br><br>AFSSLPinningModeCertificate éªŒè¯è¯ä¹¦çš„æ‰€æœ‰å†…å®¹</p></blockquote><h4 id="Serialization-åºåˆ—åŒ–"><a href="#Serialization-åºåˆ—åŒ–" class="headerlink" title="Serialization åºåˆ—åŒ–"></a>Serialization åºåˆ—åŒ–</h4><blockquote><p>AFURLRequestSerialization<br><br>AFURLResponseSerialization</p></blockquote><h4 id="UIKit-UIç›¸å…³çš„ä¸€äº›ç±»ç›®"><a href="#UIKit-UIç›¸å…³çš„ä¸€äº›ç±»ç›®" class="headerlink" title="UIKit UIç›¸å…³çš„ä¸€äº›ç±»ç›®"></a>UIKit UIç›¸å…³çš„ä¸€äº›ç±»ç›®</h4><h4 id="åŸç†æ¦‚è¿°"><a href="#åŸç†æ¦‚è¿°" class="headerlink" title="åŸç†æ¦‚è¿°"></a>åŸç†æ¦‚è¿°</h4><blockquote><p>AFNetworking æ˜¯å¯¹NSURLSessionTaskçš„å°è£…ã€‚AFHTTPSessionManagerç»§æ‰¿AFURLSessionManagerå¯¹ç½‘ç»œè¯·æ±‚è¿›è¡Œç®¡ç†ï¼Œä½¿ç”¨AFURLRequestSerializationå¯¹ç½‘ç»œè¯·æ±‚è¿›è¡Œå°è£…ï¼Œä½¿ç”¨AFURLResponseSerializationå¯¹å“åº”ä½“è¿›è¡Œå¤„ç†ï¼Œä½¿ç”¨AFSecurityPolicyå¯¹æœåŠ¡å™¨è¯ä¹¦è¿›è¡Œæ ¡éªŒã€‚æ”¯æŒHTTPSåè®®ï¼Œæ”¯æŒæœ¬åœ°è¯ä¹¦å’ŒæœåŠ¡å™¨è¯ä¹¦è¿›è¡Œå¯¹æ¯”éªŒè¯ã€‚AFNæ•°æ®ä¼ é€’ä¸»è¦ä½¿ç”¨blockå’Œnotifacationæ–¹å¼ã€‚</p></blockquote><h4 id="è¯·æ±‚è¿‡ç¨‹"><a href="#è¯·æ±‚è¿‡ç¨‹" class="headerlink" title="è¯·æ±‚è¿‡ç¨‹"></a>è¯·æ±‚è¿‡ç¨‹</h4><blockquote><p>GET/POSTç­‰æ–¹æ³•è°ƒç”¨æŠ½è±¡çš„è¯·æ±‚æ–¹æ³•ï¼ŒæŒ‡æ˜è¯·æ±‚å‚æ•°ï¼Œè°ƒç”¨å…¨èƒ½æ•°æ®è¯·æ±‚æ–¹æ³•ï¼ŒæŒ‡æ˜æ•°æ®è¯·æ±‚æ–¹å¼å’Œå‚æ•°ã€‚<br>å¯¹è¯·æ±‚è¿›è¡Œåºåˆ—åŒ–ï¼Œå¦‚æœåºåˆ—åŒ–å¤±è´¥ï¼Œå°±æ‰§è¡Œfailure blockã€‚<br>ä¸ºæ¯ä¸€ä¸ªNSURLSessionDataTaskçš„dataTaskå¢åŠ ä»£ç†ã€‚<br>å¯¹æ¯ä¸€ä¸ªNSURLSessionDataTaskçš„dataTaskå¢åŠ ä»£ç†çš„å…·ä½“å®ç°ï¼Œå¯¹dataTaskè®¾ç½®è¯·æ±‚ä¹‹åçš„å›è°ƒdelegateå’Œå¤„ç†blockã€‚</p></blockquote><h3 id="2ã€SDWebImage"><a href="#2ã€SDWebImage" class="headerlink" title="2ã€SDWebImage"></a>2ã€SDWebImage</h3><h4 id="ç¼“å­˜æœºåˆ¶"><a href="#ç¼“å­˜æœºåˆ¶" class="headerlink" title="ç¼“å­˜æœºåˆ¶"></a>ç¼“å­˜æœºåˆ¶</h4><h5 id="SDImageCache"><a href="#SDImageCache" class="headerlink" title="SDImageCache"></a>SDImageCache</h5><p>åœ¨SDImageCacheï¼Œå›¾ç‰‡é‡‡ç”¨äº†äºŒçº§ç¼“å­˜ç­–ç•¥ã€‚å›¾ç‰‡ç¼“å­˜æ—¶ï¼Œåœ¨å†…å­˜æœ‰ç¼“å­˜ï¼Œåœ¨ç£ç›˜ä¸­ä¹Ÿæœ‰ç¼“å­˜ã€‚å…¶ä¸­ï¼Œå†…å­˜ç¼“å­˜æ˜¯é€šè¿‡NSCacheå®ç°çš„ã€‚<br></p><h5 id="ç¼“å­˜æ­¥éª¤"><a href="#ç¼“å­˜æ­¥éª¤" class="headerlink" title="ç¼“å­˜æ­¥éª¤"></a>ç¼“å­˜æ­¥éª¤</h5><blockquote><ol><li>å°†å›¾ç‰‡ç¼“å­˜åœ¨å†…å­˜ä¸­</li><li>åˆ¤æ–­å›¾ç‰‡çš„æ ¼å¼æ˜¯pngæˆ–æ˜¯jpegï¼Œå°†å›¾ç‰‡è½¬åŒ–ä¸ºNSDataæ•°æ®</li><li>å¦‚æœæ˜¯åœ¨mac_osç³»ç»Ÿä¸­ï¼Œç›´æ¥å°†å›¾ç‰‡è½¬åŒ–ä¸ºNSBitmapImageRepæ•°æ®</li><li>è·å–å›¾ç‰‡çš„å­˜å‚¨è·¯å¾„ï¼Œå…¶ä¸­å›¾ç‰‡çš„æ–‡ä»¶åæ˜¯é€šè¿‡ä¼ å…¥çš„keyç»è¿‡md5åŠ å¯†åè·å¾—çš„ã€‚</li><li>å°†å›¾ç‰‡å­˜å‚¨ç£ç›˜ä¸­</li></ol></blockquote><h5 id="è·å–å›¾ç‰‡æ­¥éª¤"><a href="#è·å–å›¾ç‰‡æ­¥éª¤" class="headerlink" title="è·å–å›¾ç‰‡æ­¥éª¤"></a>è·å–å›¾ç‰‡æ­¥éª¤</h5><blockquote><ol><li>å…ˆåœ¨å†…å­˜ç¼“å­˜ä¸­å¯»æ‰¾</li><li>å¦‚æœå†…å­˜ä¸­æ‰¾ä¸åˆ°å›¾ç‰‡ï¼Œåˆ™åœ¨é»˜è®¤çš„ç£ç›˜æ ¹ç›®å½•ä¸­å¯»æ‰¾ï¼Œå¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œå†ä»è‡ªå®šä¹‰çš„åªè¯»ç›®å½•è·¯å¾„ä¸­å¯»æ‰¾</li><li>è·å–å›¾ç‰‡æ•°æ®åï¼Œå°†å›¾ç‰‡æ•°æ®ä»NSDataè½¬åŒ–ä¸ºUIImage,è½¬åŒ–æ˜¯è¦æ ¹æ®å›¾ç‰‡çš„ç±»å‹è¿›è¡Œè½¬åŒ–ã€‚</li><li>é»˜è®¤å¯¹å›¾ç‰‡è¿›è¡Œè§£å‹ç¼©ï¼Œç”Ÿæˆä½å›¾å›¾ç‰‡ã€‚</li><li>å°†ä½å›¾å›¾ç‰‡è¿”å›ã€‚</li></ol></blockquote><h5 id="å›¾ç‰‡è§£å‹ç¼©æ­¥éª¤"><a href="#å›¾ç‰‡è§£å‹ç¼©æ­¥éª¤" class="headerlink" title="å›¾ç‰‡è§£å‹ç¼©æ­¥éª¤"></a>å›¾ç‰‡è§£å‹ç¼©æ­¥éª¤</h5><blockquote><ol><li>åˆ¤æ–­å›¾ç‰‡æ˜¯å¦æ˜¯åŠ¨æ€å›¾ç‰‡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸èƒ½è§£å‹ç¼©</li><li>åˆ¤æ–­å›¾ç‰‡æ˜¯å¦æ˜¯é€æ˜çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ä¸èƒ½è§£å‹ç¼©</li><li>åˆ¤æ–­å›¾ç‰‡çš„é¢œè‰²ç©ºé—´æ¨¡å‹æ˜¯ä¸æ˜¯RGBï¼Œå¦‚æœä¸æ˜¯ï¼Œä¸èƒ½è§£å‹ç¼©</li><li>æ ¹æ®å›¾ç‰‡çš„å¤§å°åˆ›å»ºä¸€ä¸ªä¸Šä¸‹æ–‡</li><li>å°†å›¾ç‰‡ç»˜åˆ¶åœ¨ä¸Šä¸‹æ–‡ä¸­ã€‚</li><li>ä»ä¸Šä¸‹æ–‡ä¸­è¯»å–ä¸€ä¸ªä¸é€æ˜çš„ä½å›¾å›¾åƒï¼Œè¯¥å›¾åƒå°±æ˜¯è§£å‹ç¼©åçš„å›¾åƒ</li><li>å°†ä½å›¾å›¾åƒè¿”å›</li></ol></blockquote><h5 id="å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾æ­¥éª¤"><a href="#å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾æ­¥éª¤" class="headerlink" title="å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾æ­¥éª¤"></a>å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾æ­¥éª¤</h5><blockquote><ol><li>å¦‚æœæ˜¯æ™®é€šå›¾åƒï¼Œåˆ™ç›´æ¥è¿›è¡Œç¼©æ”¾</li><li>å¦‚æœæ˜¯åŠ¨æ€å›¾åƒï¼Œåˆ™è¦å¯¹å›¾åƒä¸­çš„æ¯ä¸€å¼ å›¾åƒéƒ½è¿›è¡Œç¼©æ”¾<h5 id="ç£ç›˜ç¼“å­˜æ¸…ç†æ­¥éª¤"><a href="#ç£ç›˜ç¼“å­˜æ¸…ç†æ­¥éª¤" class="headerlink" title="ç£ç›˜ç¼“å­˜æ¸…ç†æ­¥éª¤"></a>ç£ç›˜ç¼“å­˜æ¸…ç†æ­¥éª¤</h5></li><li>è·å–ç£ç›˜ä¸­å›¾ç‰‡çš„æœ€åä¿®æ”¹æ—¥æœŸã€‚(ä¸ºäº†å‡å°‘ç£ç›˜å’Œå†…å­˜æ•°æ®äº¤æ¢ï¼Œè¯»å–æ˜¯å¹¶ä¸å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥å†…å­˜ï¼Œä»…ä»…å°†æ–‡ä»¶çš„ä¸€äº›å±æ€§è¯»å…¥å†…å­˜ä¸­ï¼ŒåŒ…æ‹¬æœ€åä¿®æ”¹æ—¥æœŸï¼Œè¯¥æ–‡ä»¶æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶çš„å¤§å°å’Œå¯¹åº”æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„)</li><li>æ ¹æ®æœ€åä¿®æ”¹æ—¥æœŸå°†å›¾ç‰‡è¿›è¡Œåˆ†ç±»ï¼Œå°†é‚£äº›å·²ç»å­˜æ”¾è¶…è¿‡æœ€é•¿å­˜æ”¾æ—¶é—´çš„æ–‡ä»¶å­˜å‚¨åœ¨åˆ é™¤æ•°ç»„ï¼Œå…¶ä»–çš„æ–‡ä»¶ä¿¡æ¯å­˜å‚¨åœ¨å¦ä¸€ä¸ªå­—å…¸ä¸­ã€‚å¹¶è®¡ç®—é™¤å»è¦åˆ é™¤çš„æ–‡ä»¶ä¹‹å¤–çš„æ‰€æœ‰æ–‡ä»¶å¤§å°</li><li>æ ¹æ®åˆ é™¤æ•°ç»„ä¸­çš„æ–‡ä»¶è·¯å¾„ï¼Œå°†å¯¹åº”çš„æ–‡ä»¶åˆ é™¤ã€‚</li><li>åˆ¤æ–­å‰©ä¸‹çš„æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡ç”¨æˆ·ç°åœ¨çš„ç£ç›˜æœ€å¤§å®¹é‡ã€‚</li><li>å¦‚æœè¶…è¿‡ï¼Œåˆ™å°†å‰©ä½™çš„æ–‡ä»¶è¿›è¡Œå®‰ä¿®æ”¹æ—¶é—´è¿›è¡Œå‡åºæ’åˆ—ï¼Œç„¶ååˆ é™¤ä¿®æ”¹æ—¶é—´æœ€æ—©çš„æ–‡ä»¶ï¼Œç›´åˆ°ç”šå‰©ä½™æ–‡ä»¶å¤§å°å°äºæœ€å¤§ç£ç›˜å®¹é‡çš„ä¸€åŠã€‚</li></ol></blockquote><h5 id="å›¾ç‰‡ç¼“å­˜æ¸…ç†æ—¶æœº"><a href="#å›¾ç‰‡ç¼“å­˜æ¸…ç†æ—¶æœº" class="headerlink" title="å›¾ç‰‡ç¼“å­˜æ¸…ç†æ—¶æœº"></a>å›¾ç‰‡ç¼“å­˜æ¸…ç†æ—¶æœº</h5><blockquote><ol><li>å½“ç³»ç»Ÿå‘å‡ºå†…å­˜ä¸è¶³é€šçŸ¥æ—¶ï¼Œä¼šå°†å†…å­˜ä¸­çš„æ‰€æœ‰å›¾ç‰‡ç¼“å­˜éƒ½åˆ é™¤æ‰ã€‚</li><li>å½“ç¨‹åºè¿›å…¥åå°æ—¶ï¼Œä¼šå¯¹ç£ç›˜çš„æ–‡ä»¶æ•°æ®è¿›è¡Œæ¸…ç†ã€‚</li><li>å½“æ”¶åˆ°ç¨‹åºå…³é—­é€šçŸ¥æ—¶ï¼Œä¼šå¯¹ç£ç›˜ä¸­çš„æ–‡ä»¶æ•°æ®è¿›è¡Œæ¸…ç†ã€‚</li></ol></blockquote><h3 id="å¤šçº¿ç¨‹ä¸ç½‘ç»œ"><a href="#å¤šçº¿ç¨‹ä¸ç½‘ç»œ" class="headerlink" title="å¤šçº¿ç¨‹ä¸ç½‘ç»œ"></a>å¤šçº¿ç¨‹ä¸ç½‘ç»œ</h3><h3 id="å†…å­˜ç®¡ç†-æ€§èƒ½ä¼˜åŒ–"><a href="#å†…å­˜ç®¡ç†-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="å†…å­˜ç®¡ç†,æ€§èƒ½ä¼˜åŒ–"></a>å†…å­˜ç®¡ç†,æ€§èƒ½ä¼˜åŒ–</h3><h4 id="1ã€å†…å­˜ç®¡ç†"><a href="#1ã€å†…å­˜ç®¡ç†" class="headerlink" title="1ã€å†…å­˜ç®¡ç†"></a>1ã€å†…å­˜ç®¡ç†</h4><h4 id="2ã€æ€§èƒ½ä¼˜åŒ–"><a href="#2ã€æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="2ã€æ€§èƒ½ä¼˜åŒ–"></a>2ã€æ€§èƒ½ä¼˜åŒ–</h4><h5 id="é€»è¾‘ä¼˜åŒ–"><a href="#é€»è¾‘ä¼˜åŒ–" class="headerlink" title="é€»è¾‘ä¼˜åŒ–"></a>é€»è¾‘ä¼˜åŒ–</h5><ol><li>ä»£ç å°è£…ä¼˜åŒ–</li><li>ä»£ç æ‰§è¡Œæ•ˆç‡ä¼˜åŒ–<h5 id="ç•Œé¢ä¼˜åŒ–"><a href="#ç•Œé¢ä¼˜åŒ–" class="headerlink" title="ç•Œé¢ä¼˜åŒ–"></a>ç•Œé¢ä¼˜åŒ–</h5></li><li>ç¦»å±æ¸²æŸ“ä¼˜åŒ–<blockquote><ol><li>shouldRasterizeï¼ˆå…‰æ …åŒ–ï¼‰</li><li>maskï¼ˆé®ç½©å±‚ï¼‰</li><li>shadowsï¼ˆé˜´å½±ï¼‰</li><li>EdgeAnntialiasingï¼ˆæŠ—é”¯é½¿ï¼‰</li><li>GroupOpacityï¼ˆä¸é€æ˜ï¼‰</li><li>å¤æ‚å½¢çŠ¶æ¯”å¦‚åœ†è§’ç­‰</li><li>æ¸å˜<br></li></ol></blockquote></li><li>ç•Œé¢åŠ è½½ä¼˜åŒ–</li></ol><h3 id="æ•°æ®ç»“æ„å’Œç®—æ³•"><a href="#æ•°æ®ç»“æ„å’Œç®—æ³•" class="headerlink" title="æ•°æ®ç»“æ„å’Œç®—æ³•"></a>æ•°æ®ç»“æ„å’Œç®—æ³•</h3><h3 id="éŸ³è§†é¢‘æ–¹å‘"><a href="#éŸ³è§†é¢‘æ–¹å‘" class="headerlink" title="éŸ³è§†é¢‘æ–¹å‘"></a>éŸ³è§†é¢‘æ–¹å‘</h3><h3 id="é€†å‘æ–¹å‘"><a href="#é€†å‘æ–¹å‘" class="headerlink" title="é€†å‘æ–¹å‘"></a>é€†å‘æ–¹å‘</h3>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>é¢è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOS é¢è¯•é¢˜ï¼ˆä¸€ï¼‰</title>
    <link href="/2018/01/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-001/"/>
    <url>/2018/01/01/iOS%E9%9D%A2%E8%AF%95%E9%A2%98-001/</url>
    
    <content type="html"><![CDATA[<h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><h4 id="1-å±æ€§ä¿®é¥°è¯"><a href="#1-å±æ€§ä¿®é¥°è¯" class="headerlink" title="1. å±æ€§ä¿®é¥°è¯"></a>1. å±æ€§ä¿®é¥°è¯</h4><h4 id="nonatomic"><a href="#nonatomic" class="headerlink" title="nonatomic"></a>nonatomic</h4><p>éåŸå­æ€§è®¿é—®ï¼Œå¤šçº¿ç¨‹å¹¶å‘è®¿é—®ä¼šæé«˜æ€§èƒ½ã€‚</p><h4 id="atomic"><a href="#atomic" class="headerlink" title="atomic:"></a>atomic:</h4><p>åŸå­æ€§è®¿é—®ã€‚</p><h4 id="strong"><a href="#strong" class="headerlink" title="strong"></a>strong</h4><p>ARCæ—¶ä¸­ä½¿ç”¨ï¼Œç›¸å½“äºretainã€‚</p><h4 id="weak"><a href="#weak" class="headerlink" title="weak"></a>weak</h4><p>ç›¸å½“äºassignï¼Œå¯ä»¥æŠŠå¯¹åº”çš„æŒ‡é’ˆå˜é‡ç½®ä¸ºnilã€‚</p><h4 id="assgin"><a href="#assgin" class="headerlink" title="assgin"></a>assgin</h4><p>ä¸ä¼šä½¿å¼•ç”¨è®¡æ•°åŠ 1ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥èµ‹å€¼ã€‚</p><h4 id="copy"><a href="#copy" class="headerlink" title="copy"></a>copy</h4><p>å»ºç«‹ä¸€ä¸ªç´¢å¼•è®¡æ•°ä¸º1çš„å¯¹è±¡ï¼Œåœ¨èµ‹å€¼æ—¶ä½¿ç”¨ä¼ å…¥å€¼çš„ä¸€ä»½æ‹·è´ã€‚</p><h4 id="retain"><a href="#retain" class="headerlink" title="retain"></a>retain</h4><p>ä¼šä½¿å¼•ç”¨è®¡æ•°åŠ 1ã€‚</p><h4 id="readonly"><a href="#readonly" class="headerlink" title="readonly"></a>readonly</h4><p>æ­¤æ ‡è®°è¯´æ˜å±æ€§ä¼šè¢«å½“æˆè¯»å†™çš„ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å±æ€§ã€‚</p><h4 id="readwrite"><a href="#readwrite" class="headerlink" title="readwrite"></a>readwrite</h4><p>æ­¤æ ‡è®°è¯´æ˜å±æ€§åªå¯ä»¥è¯»ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è®¾ç½®ï¼Œå¯ä»¥è·å–ã€‚</p><h4 id="é—®é¢˜ï¼š"><a href="#é—®é¢˜ï¼š" class="headerlink" title="é—®é¢˜ï¼š"></a>é—®é¢˜ï¼š</h4><p>ï¼ˆ1ï¼‰ä»€ä¹ˆæƒ…å†µä½¿ç”¨ weak å…³é”®å­—ï¼Ÿç›¸æ¯” assign æœ‰ä»€ä¹ˆä¸åŒ?</p><ul><li>ä½¿ç”¨<blockquote><ol><li>åè®®å£°æ˜ä½¿ç”¨weak</li><li>IBOutlet ä½¿ç”¨weak</li></ol></blockquote></li><li>weak å’Œ assign çš„ä¸åŒç‚¹:<blockquote><p>weak ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,ç³»ç»Ÿä¼šå°† weak ä¿®é¥°çš„å±æ€§å¯¹è±¡çš„æŒ‡é’ˆæŒ‡å‘ nil,åœ¨ OC ç»™ nil å‘æ¶ˆæ¯æ˜¯ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜çš„;å¦‚æœä½¿ç”¨ assign ç­–ç•¥åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶,å±æ€§å¯¹è±¡æŒ‡é’ˆè¿˜æŒ‡å‘åŸæ¥çš„å¯¹è±¡,ç”±äºå¯¹è±¡å·²ç»è¢«é”€æ¯,è¿™æ—¶å€™å°±äº§ç”Ÿäº†é‡æŒ‡é’ˆ,å¦‚æœè¿™æ—¶å€™åœ¨ç»™æ­¤å¯¹è±¡å‘é€æ¶ˆæ¯,å¾ˆå®¹é€ æˆç¨‹åºå¥”æºƒassigin å¯ä»¥ç”¨äºä¿®é¥°é OC å¯¹è±¡,è€Œ weak å¿…é¡»ç”¨äº OC å¯¹è±¡ã€‚</p></blockquote></li></ul><p>ï¼ˆ2ï¼‰ä½¿ç”¨ atomic ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—?</p><ul><li>ä¸æ˜¯,atomic çš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„,å¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚<blockquote><p>ä¾‹å¦‚ï¼š å£°æ˜ä¸€ä¸ª NSMutableArray çš„åŸå­å±æ€§ stuff,æ­¤æ—¶ self.stuff å’Œ self.stuff =othersulf éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯,ä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„,éœ€è¦ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚</p></blockquote></li></ul><p>ï¼ˆ3ï¼‰@synthesize å’Œ @dynamic åˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨</p><blockquote><ul><li>@property æœ‰ä¸¤ä¸ªå¯¹åº”çš„è¯,ä¸€ä¸ªæ˜¯@synthesize,ä¸€ä¸ªæ˜¯@dynamicã€‚<br>å¦‚æœ@synthesize å’Œ@dynamic éƒ½æ²¡å†™,é‚£ä¹ˆé»˜è®¤çš„å°±æ˜¯<br>@syntheszie var = _var;</li><li>@synthesize çš„è¯­ä¹‰æ˜¯å¦‚æœä½ æ²¡æœ‰æ‰‹åŠ¨å®ç° setter æ–¹æ³•å’Œ getter æ–¹æ³•,é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºä½ åŠ ä¸Šè¿™ä¸¤ä¸ªæ–¹æ³•ã€‚</li><li>@dynamic å‘Šè¯‰ç¼–è¯‘å™¨:å±æ€§çš„ setter ä¸ getter æ–¹æ³•ç”±ç”¨æˆ·è‡ªå·±å®ç°,ä¸è‡ªåŠ¨ç”Ÿæˆã€‚(å½“ç„¶å¯¹äº readonly çš„å±æ€§åªéœ€æä¾› getter å³å¯)</li><li>å‡å¦‚ä¸€ä¸ªå±æ€§è¢«å£°æ˜ä¸º@dynamic varï¼›ç„¶åä½ æ²¡æœ‰æä¾›@setter æ–¹æ³•å’Œ@getter æ–¹æ³•,ç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜,ä½†æ˜¯å½“ç¨‹åºè¿è¡Œåˆ° instance.var = someVar,ç”±äºç¼º setteræ–¹æ³•ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ;<br>æˆ–è€…å½“è¿è¡Œåˆ° someVar = instance.var æ—¶,ç”±äºç¼º getter æ–¹æ³•åŒæ ·ä¼šå¯¼è‡´å´©æºƒã€‚</li></ul></blockquote><p>ï¼ˆ4ï¼‰ARC ä¸‹,ä¸æ˜¾å¼æŒ‡å®šä»»ä½•å±æ€§å…³é”®å­—æ—¶,é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›?</p><blockquote><ul><li>åŸºæœ¬æ•°æ®ï¼š  <code>atomic,readwrite,assign</code></li><li>æ™®é€šçš„ OC å¯¹è±¡: <code>atomic,readwrite,strong</code></li></ul></blockquote><p>ï¼ˆ5ï¼‰ç”¨@property å£°æ˜çš„ NSString(æˆ– NSArray,NSDictionary)ç»å¸¸ä½¿ç”¨ copy å…³é”®å­—,ä¸ºä»€ä¹ˆ?å¦‚æœæ”¹ç”¨ strong å…³é”®å­—,å¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜?</p><blockquote><p>å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨ copy çš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨ copy æ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯ strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§.</p></blockquote><p>ï¼ˆ6ï¼‰è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜: @property(copy)NSMutableArray *array;</p><blockquote><p>å› ä¸º copy ç­–ç•¥æ‹·è´å‡ºæ¥çš„æ˜¯ä¸€ä¸ªä¸å¯å˜å¯¹è±¡,ç„¶è€Œå´æŠŠå®ƒå½“æˆå¯å˜å¯¹è±¡ä½¿ç”¨,å¾ˆå®¹æ˜“é€ æˆç¨‹åºå¥”æºƒè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜,è¯¥å±æ€§ä½¿ç”¨äº†åŒæ­¥é”,ä¼šåœ¨åˆ›å»ºæ—¶ç”Ÿæˆä¸€äº›é¢å¤–çš„ä»£ç ç”¨äºå¸®åŠ©ç¼–å†™å¤šçº¿ç¨‹ç¨‹åº,è¿™ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜,é€šè¿‡å£°æ˜ nonatomic å¯ä»¥èŠ‚çœè¿™äº›è™½ç„¶<br>å¾ˆå°ä½†æ˜¯ä¸å¿…è¦é¢å¤–å¼€é”€,åœ¨ iOS å¼€å‘ä¸­åº”è¯¥ä½¿ç”¨ nonatomic æ›¿ä»£ atomic.</p></blockquote><p>ï¼ˆ7ï¼‰å¦‚ä½•è®©è‡ªå®šä¹‰ç±»å¯ä»¥ç”¨ copy ä¿®é¥°ç¬¦?å¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setter?</p><blockquote><p>è‹¥æƒ³ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½,åˆ™éœ€å®ç° NSCopying åè®®ã€‚</p></blockquote><figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs objectivec"><span class="hljs-comment">// å®ç°ä¸å¯å˜ç‰ˆæœ¬æ‹·è´</span><br>- (<span class="hljs-keyword">id</span>)copyWithZone:(<span class="hljs-built_in">NSZone</span> *)zone; <span class="hljs-comment">// å®ç°å¯å˜ç‰ˆæœ¬æ‹·è´</span><br>- (<span class="hljs-keyword">id</span>)mutableCopyWithZone:(<span class="hljs-built_in">NSZone</span> *)zone;<br><span class="hljs-comment">// é‡å†™å¸¦ copy å…³é”®å­—çš„ setter</span><br>- (<span class="hljs-keyword">void</span>)setName:(<span class="hljs-built_in">NSString</span> *)name &#123;<br>    _name = [name <span class="hljs-keyword">copy</span>];<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-æˆ‘ä»¬è¯´çš„Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"><a href="#2-æˆ‘ä»¬è¯´çš„Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ" class="headerlink" title="2. æˆ‘ä»¬è¯´çš„Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ"></a>2. æˆ‘ä»¬è¯´çš„Objective-Cæ˜¯åŠ¨æ€è¿è¡Œæ—¶è¯­è¨€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</h4><blockquote><ul><li>åŠ¨æ€ç±»å‹ã€‚ å¦‚idç±»å‹ã€‚å®é™…ä¸Šé™æ€ç±»å‹å› ä¸ºå…¶å›ºå®šæ€§å’Œå¯é¢„çŸ¥æ€§è€Œä½¿ç”¨å¾—æ›´åŠ å¹¿æ³›ã€‚é™æ€ç±»å‹æ˜¯å¼ºç±»å‹ï¼Œè€ŒåŠ¨æ€ç±»å‹å±äºå¼±ç±»å‹ã€‚è¿è¡Œæ—¶å†³å®šæ¥æ”¶è€…ã€‚</li><li>åŠ¨æ€ç»‘å®šã€‚è®©ä»£ç åœ¨è¿è¡Œæ—¶åˆ¤æ–­éœ€è¦è°ƒç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ã€‚ä¸å…¶ä»–é¢å‘å¯¹è±¡è¯­è¨€ä¸€æ ·ï¼Œæ–¹æ³•è°ƒç”¨å’Œä»£ç å¹¶æ²¡æœ‰åœ¨ç¼–è¯‘æ—¶è¿æ¥åœ¨ä¸€èµ·ï¼Œè€Œæ˜¯åœ¨æ¶ˆæ¯å‘é€æ—¶æ‰è¿›è¡Œè¿æ¥ã€‚è¿è¡Œæ—¶å†³å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚</li><li> åŠ¨æ€è½½å…¥ã€‚è®©ç¨‹åºåœ¨è¿è¡Œæ—¶æ·»åŠ ä»£ç æ¨¡å—ä»¥åŠå…¶ä»–èµ„æºã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦åŠ è½½ä¸€äº›å¯æ‰§è¡Œä»£ç å’Œèµ„æºï¼Œè€Œä¸æ˜¯åœ¨å¯åŠ¨æ—¶å°±åŠ è½½æ‰€æœ‰ç»„ä»¶ã€‚å¯æ‰§è¡Œä»£ç ä¸­å¯ä»¥å«æœ‰å’Œç¨‹åºè¿è¡Œæ—¶æ•´åˆçš„æ–°ç±»ã€‚</li></ul></blockquote><h4 id="3-è®²ä¸€ä¸‹MVCå’ŒMVVMï¼ŒMVPï¼Ÿ"><a href="#3-è®²ä¸€ä¸‹MVCå’ŒMVVMï¼ŒMVPï¼Ÿ" class="headerlink" title="3. è®²ä¸€ä¸‹MVCå’ŒMVVMï¼ŒMVPï¼Ÿ"></a>3. è®²ä¸€ä¸‹MVCå’ŒMVVMï¼ŒMVPï¼Ÿ</h4><ul><li>MVC:<blockquote><p>MVCå³Model-VIew-Controllerã€‚MVCæ¨¡å¼è‡´åŠ›äºå…³æ³¨ç‚¹çš„åˆ‡åˆ†ï¼Œè¿™æ„å‘³ç€modelå’Œcontrollerçš„é€»è¾‘æ˜¯ä¸ä¸ç”¨æˆ·ç•Œé¢ï¼ˆViewï¼‰æŒ‚é’©çš„ã€‚Modelå±‚ä»£è¡¨äº†æè¿°ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®çš„ä¸€ç³»åˆ—ç±»çš„é›†åˆã€‚å®ƒä¹Ÿå®šä¹‰äº†æ•°æ®ä¿®æ”¹å’Œæ“ä½œçš„ä¸šåŠ¡è§„åˆ™ã€‚Viewä»£è¡¨äº†UIç»„ä»¶ï¼ŒåƒUIViewï¼ŒUIButtonï¼ŒUITableViewç­‰ã€‚ä»–åªè´Ÿè´£å±•ç¤ºä»controlleræ¥æ”¶åˆ°çš„æ•°æ®ã€‚å› æ­¤ï¼Œç»´æŠ¤å’Œæµ‹è¯•ç¨‹åºå˜å¾—æ›´åŠ ç®€å•å®¹æ˜“ã€‚ç„¶è€Œåœ¨Cocoaçš„MVCæ¨¡å¼ä¸­Controllerç»å¸¸è¢«æ··æ‚åœ¨Viewçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå› æ­¤å¾ˆéš¾è¯´Viewå’ŒViewControlleræ˜¯åˆ†ç¦»çš„ï¼Œè¿™ä¹Ÿå¾€å¾€é©±ä½¿äººä»¬å†™å‡ºè‡ƒè‚¿çš„è§†å›¾æ§åˆ¶å™¨ï¼Œå°½ç®¡ä»å¯ä»¥å°†ä¸šåŠ¡é€»è¾‘å’Œæ•°æ®è½¬æ¢åˆ°Modelï¼Œä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹å½“éœ€è¦ä¸ºViewå‡è´Ÿçš„æ—¶å€™æˆ‘ä»¬å´æ— èƒ½ä¸ºåŠ›äº†ã€‚Viewçš„æœ€å¤§çš„ä»»åŠ¡å°±æ˜¯å‘Controllerä¼ é€’ç”¨æˆ·åŠ¨ä½œäº‹ä»¶ã€‚ViewControllerä¸å†æ‰¿æ‹…ä¸€åˆ‡ä»£ç†å’Œæ•°æ®æºçš„èŒè´£ï¼Œé€šå¸¸åªè´Ÿè´£ä¸€äº›åˆ†å‘å’Œå–æ¶ˆç½‘ç»œè¯·æ±‚ä»¥åŠä¸€äº›å…¶ä»–çš„ä»»åŠ¡ã€‚å½“åœ¨è¿›è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ä½ ä¼šå‘ç°é—®é¢˜è¶Šæ¥è¶Šæ˜æ˜¾ã€‚å› ä¸ºä½ çš„ViewControllerå’ŒViewæ˜¯ç´§å¯†è€¦åˆçš„ï¼Œå¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•å°±æ˜¾å¾—å¾ˆè‰°éš¾ã€‚Cocoa MVCçœ‹æ¥å¹¶ä¸æ˜¯æˆ‘ä»¬å®šä¹‰ä¸­ç†æƒ³çš„æ¶æ„æ¨¡å¼ã€‚</p></blockquote></li><li>MVVM:<blockquote><p>å³Model-View-View Modelã€‚è¿™ä¸ªæ¨¡å¼æä¾›å¯¹Viewå’ŒView Modelçš„åŒå‘æ•°æ®ç»‘å®šã€‚è¿™ä½¿å¾—View Modelçš„çŠ¶æ€æ”¹å˜å¯ä»¥è‡ªåŠ¨ä¼ é€’ç»™Viewã€‚å…¸å‹çš„æƒ…å†µæ˜¯ï¼ŒView Modelé€šè¿‡ä½¿ç”¨obseveræ¨¡å¼ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰æ¥å°†View Modelçš„å˜åŒ–é€šçŸ¥ç»™modelã€‚View Modelè´Ÿè´£æš´æ¼æ–¹æ³•ï¼Œå‘½ä»¤ï¼Œå…¶ä»–å±æ€§æ¥æ“ä½œVIewçš„çŠ¶æ€ï¼Œç»„è£…modelä½œä¸ºViewåŠ¨ä½œçš„ç»“æœï¼Œå¹¶ä¸”è§¦å‘Viewè‡ªå·±çš„äº‹ä»¶ã€‚å®ƒå’ŒMVPæ¨¡å¼çœ‹èµ·æ¥éå¸¸åƒ:MVVMå°†ViewControllerè§†ä½œView,Viewå’ŒModelä¹‹é—´æ²¡æœ‰ç´§å¯†çš„è”ç³»ã€‚åœ¨ä½¿ç”¨MVVMæ¨¡å¼æ—¶ï¼Œè‡ªç„¶è€Œç„¶ä¼šæƒ³åˆ°ReactiveCocaï¼Œåä¹‹äº¦ç„¶ã€‚å°½ç®¡é€šè¿‡ç®€å•çš„ç»‘å®šæ¥ä½¿ç”¨MVVMæ˜¯å¯å®ç°çš„ï¼Œä½†æ˜¯ReactiveCocoaå´èƒ½æ›´å¥½çš„å‘æŒ¥MVVMæ¨¡å¼çš„ç‰¹ç‚¹ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ä¸ªæ¡†æ¶æœ‰ä¸ªéš¾ä»¥å¿½ç•¥çš„äº‹å®ï¼šå½“ä½ åˆšå¼€å§‹ä½¿ç”¨ReactiveCocaçš„æ—¶å€™æœ‰å¾ˆå¤§çš„å¯èƒ½å°±ä¼šæŠŠäº‹æƒ…æç ¸ã€‚æ¢å¥è¯æ¥è¯´å°±æ˜¯ï¼Œå¦‚æœå‘ç°äº†ä¸€äº›é”™è¯¯ï¼Œå½“ä½ è¯•å›¾æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ ˆæ—¶ä½ å¯èƒ½ä¼šå–Šï¼šâ€œå¤©å“ªï¼Œå¥½æ·±çš„å‡½æ•°è°ƒç”¨æ ˆâ€œï¼è°ƒè¯•å‡ºè¿™ä¸ªbugå¯èƒ½ä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ã€‚MVVMå¾ˆè¯±äººï¼Œå› ä¸ºå®ƒé›†åˆäº†ä¸Šè¿°æ–¹æ³•çš„ä¼˜ç‚¹ï¼Œå¹¶ä¸”ç”±äºåœ¨Viewå±‚çš„ç»‘å®šï¼Œå®ƒå¹¶ä¸éœ€è¦å…¶ä»–é™„åŠ çš„ä»£ç æ¥æ›´æ–°Viewï¼Œå°½ç®¡è¿™æ ·ï¼Œå¯æµ‹è¯•æ€§ä¾ç„¶å¾ˆå¼ºâ€”â€”ç¬¦åˆæˆ‘ä»¬ç†æƒ³ä¸­å¥½æ¶æ„æ¨¡å¼çš„å®šä¹‰ã€‚</p></blockquote></li><li>MVP:<blockquote><p>è¿™ä¸ªæ¨¡å¼æŠŠPresenteræ¢æˆControllerå°±å’ŒMVCéå¸¸ç›¸åƒäº†ã€‚è¿™ä¸ªè®¾è®¡æ¨¡å¼æŠŠåº”ç”¨ç¨‹åºåˆ†æˆäº†3ä¸ªä¸»è¦æ–¹é¢ï¼šModelã€Viewå’ŒPresenter,å…¶ä¸­çš„Modelå’ŒViewä¸MVCæ¨¡ä¸­çš„è§’è‰²ç›¸åŒã€‚Presenterè´Ÿè´£å¤„ç†ViewèƒŒåæ‰€æœ‰çš„UIäº‹ä»¶ã€‚å®ƒé€šè¿‡Viewæ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œä¹‹ååˆ©ç”¨Modelæ¥å¤„ç†ç”¨æˆ·çš„æ•°æ®ï¼Œæœ€åæŠŠç»“æœè¿”å›ç»™Viewã€‚ä¸Viewå’ŒControllerä¸åŒï¼ŒViewå’ŒPresenterä¹‹é—´æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œä»–ä»¬é€šè¿‡æ¥å£æ¥äº¤äº’ã€‚å¦å¤–ï¼Œpresenterä¸åƒcontrollerå¤„ç†è¿›å…¥çš„è¯·æ±‚ã€‚è¿™ä¸æ˜¯æ­£è§£å†³äº†Cocoa MVCä¸­ViewControllerå’ŒViewçš„è€¦åˆé—®é¢˜å—ï¼Ÿå°±MVPæ¨¡å¼è€Œè¨€ï¼ŒUIViewControllerçš„å­ç±»å®é™…ä¸Šå°±æ˜¯Viewså¹¶ä¸æ˜¯Presentersã€‚è¿™ç‚¹åŒºåˆ«ä½¿å¾—è¿™ç§æ¨¡å¼çš„å¯æµ‹è¯•æ€§å¾—åˆ°äº†æå¤§çš„æé«˜ï¼Œä»˜å‡ºçš„ä»£ä»·æ˜¯å¼€å‘é€Ÿåº¦çš„ä¸€äº›é™ä½ï¼Œå› ä¸ºå¿…é¡»è¦åšä¸€äº›æ‰‹åŠ¨çš„æ•°æ®å’Œäº‹ä»¶ç»‘å®šã€‚ä½†æ˜¯è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å°†æœ€ä¸»è¦çš„ä»»åŠ¡åˆ’åˆ†åˆ°Presenterå’ŒModelï¼Œè€ŒViewçš„åŠŸèƒ½è¾ƒå°‘â€”â€”å„ä¸ªå®ä½“ä»»åŠ¡é‡åˆ†é…ä¸å‡è¡¡ã€‚</p></blockquote></li></ul><h4 id="4-ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿblockå’Œä»£ç†çš„åŒºåˆ«"><a href="#4-ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿblockå’Œä»£ç†çš„åŒºåˆ«" class="headerlink" title="4. ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿblockå’Œä»£ç†çš„åŒºåˆ«?"></a>4. ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weakï¼Ÿä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿblockå’Œä»£ç†çš„åŒºåˆ«?</h4><blockquote><ol><li>ä¸ºä»€ä¹ˆä»£ç†è¦ç”¨weak? <blockquote><p>é˜²æ­¢å¾ªç¯å¼•ç”¨ã€‚ä¾‹å¦‚Viewæœ‰ä¸€ä¸ªåè®®ï¼Œéœ€è¦ä¸€ä¸ªä»£ç†å®ç°å›è°ƒã€‚ä¸€ä¸ªControlleræ·»åŠ è¿™ä¸ªViewï¼Œå¹¶ä¸”éµå®ˆåè®®ï¼Œæˆä¸ºViewçš„ä»£ç†ã€‚å¦‚æœä¸ç”¨weekï¼Œç”¨strongï¼ŒController -&gt;View -&gt; delegate -&gt; Controllerï¼Œå°±å¾ªç¯å¼•ç”¨äº†ã€‚</p></blockquote></li><li>ä»£ç†çš„delegateå’ŒdataSourceæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<blockquote><p> delegateåé‡äºä¸ç”¨æˆ·äº¤äº’çš„å›è°ƒï¼Œæœ‰é‚£äº›æ–¹æ³•å¯ä»¥ä¾›æˆ‘ä½¿ç”¨ï¼Œä¾‹å¦‚UITableviewDelegateï¼›dataSourceåé‡äºæ•°æ®çš„å›è°ƒï¼Œviewé‡Œé¢æœ‰ä»€ä¹ˆä¸œè¥¿ï¼Œå±æ€§éƒ½æ˜¯ä»€ä¹ˆï¼Œä¾‹å¦‚UITableviewDatasourceï¼›</p></blockquote></li><li>blockå’Œä»£ç†çš„åŒºåˆ«?<blockquote><p>ä»£ç†å’Œblockçš„å…±åŒç‰¹æ€§æ˜¯å›è°ƒæœºåˆ¶ï¼Œä¸åŒçš„æ˜¯ï¼Œä»£ç†çš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œæ¯”è¾ƒåˆ†æ•£ã€‚ä½¿ç”¨blockçš„ä»£ç æ¯”è¾ƒé›†ä¸­ç»Ÿä¸€ã€‚</p></blockquote></li></ol></blockquote><h4 id="5-å±æ€§çš„å®è´¨æ˜¯ä»€ä¹ˆï¼ŸåŒ…æ‹¬å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿå±æ€§é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ-dynamicå…³é”®å­—å’Œ-synthesizeå…³é”®å­—æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ"><a href="#5-å±æ€§çš„å®è´¨æ˜¯ä»€ä¹ˆï¼ŸåŒ…æ‹¬å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿå±æ€§é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ-dynamicå…³é”®å­—å’Œ-synthesizeå…³é”®å­—æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ" class="headerlink" title="5. å±æ€§çš„å®è´¨æ˜¯ä»€ä¹ˆï¼ŸåŒ…æ‹¬å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿå±æ€§é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ@dynamicå…³é”®å­—å’Œ@synthesizeå…³é”®å­—æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ"></a>5. å±æ€§çš„å®è´¨æ˜¯ä»€ä¹ˆï¼ŸåŒ…æ‹¬å“ªå‡ ä¸ªéƒ¨åˆ†ï¼Ÿå±æ€§é»˜è®¤çš„å…³é”®å­—éƒ½æœ‰å“ªäº›ï¼Ÿ@dynamicå…³é”®å­—å’Œ@synthesizeå…³é”®å­—æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ</h4><blockquote><ol><li>@property = ivar + getter + setter; (å®ä¾‹å˜é‡+getæ–¹æ³•+ setæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨@propertyç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆsetterå’Œgetteræ–¹æ³•;) <br></li><li>@synthesize propertyName = _propertyName; (è¿™è¡Œä»£ç ä¼šåˆ›é€ ä¸€ä¸ªå¸¦ä¸‹åˆ’çº¿å‰ç¼€çš„å®ä¾‹å˜é‡åï¼ŒåŒæ—¶ä½¿ç”¨è¿™ä¸ªå±æ€§ç”Ÿæˆgetter å’Œ setter æ–¹æ³•ã€‚) <br></li><li>ç¦æ­¢@synthesize:å¦‚æœæŸå±æ€§å·²ç»åœ¨æŸå¤„å®ç°äº†è‡ªå·±çš„ setter/getter ,å¯ä»¥ä½¿ç”¨ @dynamic æ¥é˜»æ­¢ @synthesize è‡ªåŠ¨ç”Ÿæˆæ–°çš„ setter/getter è¦†ç›–ã€‚</li></ol></blockquote><h4 id="6-å±æ€§çš„é»˜è®¤å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#6-å±æ€§çš„é»˜è®¤å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="6. å±æ€§çš„é»˜è®¤å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Ÿ"></a>6. å±æ€§çš„é»˜è®¤å…³é”®å­—æ˜¯ä»€ä¹ˆï¼Ÿ</h4><blockquote><p>åŸºæœ¬ç±»å‹ @property (atomic, assign) <br><br>å¯¹è±¡ç±»å‹ @property (atomic, strong)</p></blockquote><h4 id="7-NSStringä¸ºä»€ä¹ˆè¦ç”¨copyå…³é”®å­—ï¼Œå¦‚æœç”¨strongä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰è¯´ç”¨strongå°±ä¸€å®šä¸è¡Œã€‚ä½¿ç”¨copyå’Œstrongæ˜¯çœ‹æƒ…å†µè€Œå®šçš„ï¼‰"><a href="#7-NSStringä¸ºä»€ä¹ˆè¦ç”¨copyå…³é”®å­—ï¼Œå¦‚æœç”¨strongä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰è¯´ç”¨strongå°±ä¸€å®šä¸è¡Œã€‚ä½¿ç”¨copyå’Œstrongæ˜¯çœ‹æƒ…å†µè€Œå®šçš„ï¼‰" class="headerlink" title="7. NSStringä¸ºä»€ä¹ˆè¦ç”¨copyå…³é”®å­—ï¼Œå¦‚æœç”¨strongä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰è¯´ç”¨strongå°±ä¸€å®šä¸è¡Œã€‚ä½¿ç”¨copyå’Œstrongæ˜¯çœ‹æƒ…å†µè€Œå®šçš„ï¼‰"></a>7. NSStringä¸ºä»€ä¹ˆè¦ç”¨copyå…³é”®å­—ï¼Œå¦‚æœç”¨strongä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿï¼ˆæ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰è¯´ç”¨strongå°±ä¸€å®šä¸è¡Œã€‚ä½¿ç”¨copyå’Œstrongæ˜¯çœ‹æƒ…å†µè€Œå®šçš„ï¼‰</h4><blockquote><ol><li>å› ä¸ºçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡,ä½¿ç”¨copyçš„ç›®çš„æ˜¯ä¸ºäº†è®©æœ¬å¯¹è±¡çš„å±æ€§ä¸å—å¤–ç•Œå½±å“,ä½¿ç”¨copyæ— è®ºç»™æˆ‘ä¼ å…¥æ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡è¿˜æ˜¯ä¸å¯å¯¹è±¡,æˆ‘æœ¬èº«æŒæœ‰çš„å°±æ˜¯ä¸€ä¸ªä¸å¯å˜çš„å‰¯æœ¬.</li><li>å¦‚æœæˆ‘ä»¬ä½¿ç”¨æ˜¯strong,é‚£ä¹ˆè¿™ä¸ªå±æ€§å°±æœ‰å¯èƒ½æŒ‡å‘ä¸€ä¸ªå¯å˜å¯¹è±¡,å¦‚æœè¿™ä¸ªå¯å˜å¯¹è±¡åœ¨å¤–éƒ¨è¢«ä¿®æ”¹äº†,é‚£ä¹ˆä¼šå½±å“è¯¥å±æ€§.</li></ol></blockquote><h4 id="8-å¦‚ä½•ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½"><a href="#8-å¦‚ä½•ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½" class="headerlink" title="8. å¦‚ä½•ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½?"></a>8. å¦‚ä½•ä»¤è‡ªå·±æ‰€å†™çš„å¯¹è±¡å…·æœ‰æ‹·è´åŠŸèƒ½?</h4><blockquote><ol><li>éœ€å£°æ˜è¯¥ç±»éµä» NSCopying åè®®</li><li>å®ç° NSCopying åè®®ã€‚è¯¥åè®®åªæœ‰ä¸€ä¸ªæ–¹æ³•: <code>- (id)copyWithZone:(NSZone *)zone;</code></li></ol></blockquote><h4 id="9-ç®€è¿°kvoã€kvcã€Delegateä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ"><a href="#9-ç®€è¿°kvoã€kvcã€Delegateä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="9. ç®€è¿°kvoã€kvcã€Delegateä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ"></a>9. ç®€è¿°kvoã€kvcã€Delegateä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Ÿ</h4><blockquote><ol><li>KVOï¼ˆKey-Value- Observingï¼‰ï¼šä¸€å¯¹å¤š, è§‚å¯Ÿè€…æ¨¡å¼, æ˜¯é”®å€¼ç›‘å¬,é”®å€¼è§‚å¯Ÿæœºåˆ¶, KVOçš„æœ¬è´¨æ˜¯å½“è§‚å¯Ÿè€…ä¸ºä¸€ä¸ªå¯¹è±¡çš„å±æ€§è¿›è¡Œäº†æ³¨å†Œï¼Œè¢«è§‚å¯Ÿå¯¹è±¡çš„isaæŒ‡é’ˆè¢«ä¿®æ”¹çš„æ—¶å€™ï¼ŒisaæŒ‡é’ˆå°±ä¼šæŒ‡å‘ä¸€ä¸ªä¸­é—´ç±»ï¼Œè€Œä¸æ˜¯çœŸå®çš„ç±»ã€‚æ‰€ä»¥Â isaæŒ‡é’ˆå…¶å®ä¸éœ€è¦æŒ‡å‘å®ä¾‹å¯¹è±¡çœŸå®çš„ç±»ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ç¨‹åºæœ€å¥½ä¸è¦ä¾èµ–äºisaæŒ‡é’ˆã€‚åœ¨è°ƒç”¨ç±»çš„æ–¹æ³•çš„æ—¶å€™ï¼Œæœ€å¥½è¦æ˜ç¡®å¯¹è±¡å®ä¾‹çš„ç±»åã€‚</li><li>KVC(Key-Value-Coding)å†…éƒ¨çš„å®ç°ï¼šæ˜¯é”®å€¼ç¼–ç , ä¸€ä¸ªå¯¹è±¡åœ¨è°ƒç”¨setValueçš„æ—¶å€™ï¼Œï¼ˆ1ï¼‰é¦–å…ˆæ ¹æ®æ–¹æ³•åæ‰¾åˆ°è¿è¡Œæ–¹æ³•çš„æ—¶å€™æ‰€éœ€è¦çš„ç¯ å¢ƒå‚æ•°ã€‚ï¼ˆ2ï¼‰ä»–ä¼šä»è‡ªå·±isaæŒ‡é’ˆç»“åˆç¯å¢ƒå‚æ•°ï¼Œæ‰¾åˆ°å…·ä½“çš„æ–¹æ³•å®ç°çš„æ¥å£ã€‚ï¼ˆ3ï¼‰å†ç›´æ¥æŸ¥æ‰¾å¾—æ¥çš„å…·ä½“çš„æ–¹æ³•å®ç°ã€‚</li><li>Delegate: é€šå¸¸å‘é€è€…å’Œæ¥æ”¶è€…çš„å…³ç³»æ˜¯ç›´æ¥çš„ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ä»£ç†çš„ç›®çš„æ˜¯æ”¹å˜æˆ–ä¼ é€’æ§åˆ¶é“¾ã€‚å…è®¸ä¸€ä¸ªç±»åœ¨æŸäº›ç‰¹å®šæ—¶åˆ»é€šçŸ¥åˆ°å…¶ä»–ç±»ï¼Œè€Œä¸éœ€è¦è·å–åˆ°é‚£äº›ç±»çš„æŒ‡é’ˆã€‚å¯ä»¥å‡å°‘æ¡†æ¶å¤æ‚åº¦ã€‚æ¶ˆæ¯çš„å‘é€è€…(sender)å‘ŠçŸ¥æ¥æ”¶è€…(receiver)æŸä¸ªäº‹ä»¶å°†è¦å‘ç”Ÿï¼ŒdelegateåŒæ„ç„¶ç„¶åå‘é€è€…å“åº”äº‹ä»¶ï¼Œdelegateæœºåˆ¶ä½¿å¾—æ¥æ”¶è€…å¯ä»¥æ”¹å˜å‘é€è€…çš„è¡Œä¸ºã€‚</li><li>Notification: è§‚å¯Ÿè€…æ¨¡å¼, é€šå¸¸å‘é€è€…å’Œæ¥æ”¶è€…çš„å…³ç³»æ˜¯é—´æ¥çš„å¤šå¯¹å¤šå…³ç³»ã€‚ æ¶ˆæ¯çš„å‘é€è€…å‘ŠçŸ¥æ¥æ”¶è€…äº‹ä»¶å·²ç»å‘ç”Ÿæˆ–è€…å°†è¦å‘é€ï¼Œä»…æ­¤è€Œå·²ï¼Œæ¥æ”¶è€…å¹¶ä¸èƒ½åè¿‡æ¥å½±å“å‘é€è€…çš„è¡Œä¸ºã€‚<blockquote><p>(1) æ•ˆç‡è‚¯å®šæ˜¯delegateæ¯”NSNotificationé«˜ã€‚<br></p><p>(2) delegateæ–¹æ³•æ¯”notificationæ›´åŠ ç›´æ¥ï¼Œæœ€å…¸å‹çš„ç‰¹å¾æ˜¯ï¼Œdelegateæ–¹æ³•å¾€å¾€éœ€è¦å…³æ³¨è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯delegateæ–¹æ³•çš„ç»“æœã€‚æ¯”å¦‚-windowShouldClose:ï¼Œéœ€è¦å…³å¿ƒè¿”å›çš„æ˜¯yesè¿˜æ˜¯noã€‚æ‰€ä»¥delegateæ–¹æ³•å¾€å¾€åŒ…å«shouldè¿™ä¸ªå¾ˆä¼ ç¥çš„è¯ã€‚ä¹Ÿå°±æ˜¯å¥½æ¯”ä½ åšæˆ‘çš„delegateï¼Œæˆ‘ä¼šé—®ä½ æˆ‘æƒ³å…³é—­çª—å£ä½ æ„¿æ„å—ï¼Ÿä½ éœ€è¦ç»™æˆ‘ä¸€ä¸ªç­”æ¡ˆï¼Œæˆ‘æ ¹æ®ä½ çš„ç­”æ¡ˆæ¥å†³å®šå¦‚ä½•åšä¸‹ä¸€æ­¥ã€‚ç›¸åçš„ï¼Œnotificationæœ€å¤§çš„ç‰¹è‰²å°±æ˜¯ä¸å…³å¿ƒæ¥å—è€…çš„æ€åº¦ï¼Œæˆ‘åªç®¡æŠŠé€šå‘Šæ”¾å‡ºæ¥ï¼Œä½ æ¥å—ä¸æ¥å—å°±æ˜¯ä½ çš„äº‹æƒ…ï¼ŒåŒæ—¶æˆ‘ä¹Ÿä¸å…³å¿ƒç»“æœã€‚æ‰€ä»¥notificationå¾€å¾€ç”¨didè¿™ä¸ªè¯æ±‡ï¼Œæ¯”å¦‚NSWindowDidResizeNotificationï¼Œé‚£ä¹ˆnswindowå¯¹è±¡æ”¾å‡ºè¿™ä¸ªnotificationåå°±ä»€ä¹ˆéƒ½ä¸ç®¡äº†ä¹Ÿä¸ä¼šç­‰å¾…æ¥å—è€…çš„ååº”ã€‚</p></blockquote></li></ol></blockquote><h4 id="10-includeä¸-importçš„åŒºåˆ«ï¼Ÿ-importä¸-classçš„åŒºåˆ«ï¼Ÿ"><a href="#10-includeä¸-importçš„åŒºåˆ«ï¼Ÿ-importä¸-classçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="10. includeä¸#importçš„åŒºåˆ«ï¼Ÿ#importä¸@classçš„åŒºåˆ«ï¼Ÿ"></a>10. includeä¸#importçš„åŒºåˆ«ï¼Ÿ#importä¸@classçš„åŒºåˆ«ï¼Ÿ</h4><blockquote><ol><li>#importæŒ‡ä»¤æ˜¯Object-Cé’ˆå¯¹@includeçš„æ”¹è¿›ç‰ˆæœ¬ï¼Œèƒ½ç¡®ä¿å¼•ç”¨çš„æ–‡ä»¶åªä¼šè¢«å¼•ç”¨ä¸€æ¬¡ï¼Œä¸ä¼šé™·å…¥é€’å½’åŒ…å«çš„é—®é¢˜ä¸­ï¼›</li><li>@importä¸@classçš„åŒºåˆ«ï¼š<blockquote><p>#importä¼šé“¾å…¥è¯¥å¤´æ–‡ä»¶çš„å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ä½“å˜é‡å’Œæ–¹æ³•ç­‰ï¼›äºŒ@classåªæ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå…¶åé¢å£°æ˜çš„åç§°æ˜¯ç±»çš„åç§°ï¼Œè‡³äºè¿™äº›ç±»å¦‚ä½•å®šä¹‰çš„ï¼Œæš‚æ—¶ä¸ç”¨è€ƒè™‘ã€‚åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œä¸€èˆ¬åªéœ€è¦çŸ¥é“è¢«å¼•ç”¨çš„ç±»çš„åç§°å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦çŸ¥é“å…¶å†…éƒ¨çš„å®ä½“å˜é‡å’Œæ–¹æ³•ï¼Œæ‰€ä»¥åœ¨å¤´æ–‡ä»¶ä¸­ä¸€èˆ¬ä½¿ç”¨@classæ¥å£°æ˜è¿™ä¸ªåç§°æ˜¯ç±»çš„åç§°ï¼›è€Œåœ¨å®ç°ç±»é‡Œé¢ï¼Œå› ä¸ºä¼šç”¨åˆ°è¿™ä¸ªå¼•ç”¨ç±»çš„å†…éƒ¨çš„å®ä½“å˜é‡å’Œæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨#importç±»åŒ…å«è¿™ä¸ªè¢«å¼•ç”¨ç±»çš„å¤´æ–‡ä»¶ã€‚@classè¿˜å¯ä»¥è§£å†³å¾ªç¯åŒ…å«çš„é—®é¢˜</p></blockquote></li><li>#import&lt;&gt;è·Ÿ#importâ€â€çš„åŒºåˆ«ï¼š<blockquote><p>#import&lt;&gt;ç”¨æ¥åŒ…å«ç³»ç»Ÿè‡ªå¸¦çš„æ–‡ä»¶ï¼Œ#importâ€â€ç”¨æ¥åŒ…å«è‡ªå®šä¹‰çš„æ–‡ä»¶</p></blockquote></li></ol></blockquote><h4 id="11-nonatomicå’Œatomicçš„åŒºåˆ«ï¼Ÿatomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£åº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ"><a href="#11-nonatomicå’Œatomicçš„åŒºåˆ«ï¼Ÿatomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£åº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="11. nonatomicå’Œatomicçš„åŒºåˆ«ï¼Ÿatomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£åº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ"></a>11. nonatomicå’Œatomicçš„åŒºåˆ«ï¼Ÿatomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿå¦‚æœä¸æ˜¯ï¼Œé‚£åº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ</h4><blockquote><ol><li>nonatomicå’Œatomicçš„åŒºåˆ«<blockquote><p>nonatomicå’Œatomicç”¨æ¥å†³å®šç¼–è¯‘å™¨ç”Ÿæˆçš„getterå’Œsetteræ“ä½œæ˜¯å¦ä¸ºåŸå­æ“ä½œã€‚</p></blockquote></li><li>atomicæ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ä¹ˆï¼Ÿ<blockquote><p>atomicä¸æ˜¯ç»å¯¹çš„çº¿ç¨‹å®‰å…¨ã€‚atomicçš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚ï¼š<br>å£°æ˜ä¸€ä¸ªNSMutableArrayçš„åŸå­å±æ€§stuffï¼Œæ­¤æ—¶self.stuff å’Œ self.stuff = otherstufféƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯ä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚éœ€è¦ç”¨äº’æ–¥é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚</p></blockquote></li><li>å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨<blockquote><p>ä½¿ç”¨çº¿ç¨‹é”</p></blockquote></li></ol></blockquote><h4 id="12-UICollectionViewè‡ªå®šä¹‰layoutå¦‚ä½•å®ç°ï¼Ÿ"><a href="#12-UICollectionViewè‡ªå®šä¹‰layoutå¦‚ä½•å®ç°ï¼Ÿ" class="headerlink" title="12. UICollectionViewè‡ªå®šä¹‰layoutå¦‚ä½•å®ç°ï¼Ÿ"></a>12. UICollectionViewè‡ªå®šä¹‰layoutå¦‚ä½•å®ç°ï¼Ÿ</h4><blockquote><ol><li><code> -(void)prepareLayout;</code> æ–¹æ³•é‡å†™ï¼Œå¹¶è®¾ç½®åˆå§‹æ ·å¼</li><li><code> - (CGRect)collectionViewContentSize;</code> æ–¹æ³•é‡å†™ï¼Œ å¹¶ä½¿ç”¨å®ƒæ¥è¿”å›CollectionViewè§†å›¾å†…å®¹çš„å®½é«˜ï¼Œ</li><li>å››ä¸ªæ–¹æ³•æ¥ç¡®å®šå¸ƒå±€ä¿¡æ¯<blockquote><ul><li><p><code> - (NSArray&lt;__kindof UICollectionViewLayoutAttributes *&gt; *)layoutAttributesForElementsInRect:(CGRect)rect;</code></p></li><li><p><code>- (UICollectionViewLayoutAttributes *)layoutAttributesForItemAtIndexPath:(NSIndexPath *)indexPath;</code></p></li><li><p><code> - (UICollectionViewLayoutAttributes *)layoutAttributesForSupplementaryViewOfKind:(NSString *)elementKind atIndexPath:(NSIndexPath *)indexPath;</code></p></li><li><p><code> - (UICollectionViewLayoutAttributes *)layoutAttributesForDecorationViewOfKind:(NSString*)elementKind atIndexPath:(NSIndexPath *)indexPath;</code></p></li></ul></blockquote></li><li><code> - (BOOL)shouldInvalidateLayoutForBoundsChange:(CGRect)newBounds;</code>å¦‚æœè¿”å›YESï¼Œé‚£ä¹ˆcollectionViewæ˜¾ç¤ºçš„èŒƒå›´å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°±ä¼šé‡æ–°åˆ·æ–°å¸ƒå±€</li></ol></blockquote><h4 id="13-è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼ŸåŒæ­¥å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿå¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ"><a href="#13-è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼ŸåŒæ­¥å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿå¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="13. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼ŸåŒæ­¥å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿå¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ"></a>13. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«ï¼ŸåŒæ­¥å¼‚æ­¥çš„åŒºåˆ«ï¼Ÿå¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«ï¼Ÿ</h4><blockquote><ol><li>è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«<blockquote><ul><li>è¿›ç¨‹æ˜¯èµ„æºçš„åˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•å…ƒï¼Œè€Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„åŸºæœ¬å•å…ƒ</li><li>åŒä¸€ä¸ªè¿›ç¨‹ä¸­å¯ä»¥åŒ…æ‹¬å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”çº¿ç¨‹å…±äº«æ•´ä¸ªè¿›ç¨‹çš„èµ„æºï¼ˆå¯„å­˜å™¨ã€å †æ ˆã€ä¸Šä¸‹æ–‡ï¼‰ï¼Œä¸€ä¸ªè¿›è¡Œè‡³å°‘åŒ…æ‹¬ä¸€ä¸ªçº¿ç¨‹ã€‚</li><li>è¿›ç¨‹çš„åˆ›å»ºè°ƒç”¨forkæˆ–è€…vforkï¼Œè€Œçº¿ç¨‹çš„åˆ›å»ºè°ƒç”¨pthread_createï¼Œè¿›ç¨‹ç»“æŸåå®ƒæ‹¥æœ‰çš„æ‰€æœ‰çº¿ç¨‹éƒ½å°†é”€æ¯ï¼Œè€Œçº¿ç¨‹çš„ç»“æŸä¸ä¼šå½±å“åŒä¸ªè¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹çš„ç»“æŸ</li><li>çº¿ç¨‹æ˜¯è½»ä¸¤çº§çš„è¿›ç¨‹ï¼Œå®ƒçš„åˆ›å»ºå’Œé”€æ¯æ‰€éœ€è¦çš„æ—¶é—´æ¯”è¿›ç¨‹å°å¾ˆå¤šï¼Œæ‰€æœ‰æ“ä½œç³»ç»Ÿä¸­çš„æ‰§è¡ŒåŠŸèƒ½éƒ½æ˜¯åˆ›å»ºçº¿ç¨‹å»å®Œæˆçš„</li><li>çº¿ç¨‹ä¸­æ‰§è¡Œæ—¶ä¸€èˆ¬éƒ½è¦è¿›è¡ŒåŒæ­¥å’Œäº’æ–¥ï¼Œå› ä¸ºä»–ä»¬å…±äº«åŒä¸€è¿›ç¨‹çš„æ‰€æœ‰èµ„æº</li><li>çº¿ç¨‹æœ‰è‡ªå·±çš„ç§æœ‰å±æ€§TCBï¼Œçº¿ç¨‹idï¼Œå¯„å­˜å™¨ã€ç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼Œè€Œè¿›ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰å±æ€§è¿›ç¨‹æ§åˆ¶å—PCBï¼Œè¿™äº›ç§æœ‰å±æ€§æ˜¯ä¸è¢«å…±äº«çš„ï¼Œç”¨æ¥æ ‡ç¤ºä¸€ä¸ªè¿›ç¨‹æˆ–ä¸€ä¸ªçº¿ç¨‹çš„æ ‡å¿—</li></ul></blockquote></li><li>åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«<blockquote><ul><li>åŒæ­¥(synchronous)ï¼šè¿›ç¨‹ä¹‹é—´çš„å…³ç³»ä¸æ˜¯ç›¸äº’æ’æ–¥ä¸´ç•Œèµ„æºçš„å…³ç³»ï¼Œè€Œæ˜¯ç›¸äº’ä¾èµ–çš„å…³ç³»ã€‚è¿›ä¸€æ­¥çš„è¯´æ˜ï¼šå°±æ˜¯å‰ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ï¼Œå½“ç¬¬ä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰è¾“å‡ºæ—¶ç¬¬äºŒä¸ªè¿›ç¨‹å¿…é¡»ç­‰å¾…ã€‚å…·æœ‰åŒæ­¥å…³ç³»çš„ä¸€ç»„å¹¶å‘è¿›ç¨‹ç›¸äº’å‘é€çš„ä¿¡æ¯ç§°ä¸ºæ¶ˆæ¯æˆ–äº‹ä»¶ã€‚</li><li>å¼‚æ­¥(asynchronous)ï¼šå¼‚æ­¥å’ŒåŒæ­¥æ˜¯ç›¸å¯¹çš„ï¼ŒåŒæ­¥å°±æ˜¯é¡ºåºæ‰§è¡Œï¼Œæ‰§è¡Œå®Œä¸€ä¸ªå†æ‰§è¡Œä¸‹ä¸€ä¸ªï¼Œéœ€è¦ç­‰å¾…ã€åè°ƒè¿è¡Œã€‚å¼‚æ­¥å°±æ˜¯å½¼æ­¤ç‹¬ç«‹,åœ¨ç­‰å¾…æŸäº‹ä»¶çš„è¿‡ç¨‹ä¸­ç»§ç»­åšè‡ªå·±çš„äº‹ï¼Œä¸éœ€è¦ç­‰å¾…è¿™ä¸€äº‹ä»¶å®Œæˆåå†å·¥ä½œã€‚çº¿ç¨‹å°±æ˜¯å®ç°å¼‚æ­¥çš„ä¸€ä¸ªæ–¹å¼ã€‚å¼‚æ­¥æ˜¯è®©è°ƒç”¨æ–¹æ³•çš„ä¸»çº¿ç¨‹ä¸éœ€è¦åŒæ­¥ç­‰å¾…å¦ä¸€çº¿ç¨‹çš„å®Œæˆï¼Œä»è€Œå¯ä»¥è®©ä¸»çº¿ç¨‹å¹²å…¶å®ƒçš„äº‹æƒ…ã€‚</li></ul></blockquote></li><li>å¹¶è¡Œå’Œå¹¶å‘çš„åŒºåˆ«<blockquote><ul><li>å¹¶å‘ï¼šåœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œæ˜¯æŒ‡ä¸€ä¸ªæ—¶é—´æ®µä¸­æœ‰å‡ ä¸ªç¨‹åºéƒ½å¤„äºå·²å¯åŠ¨è¿è¡Œåˆ°è¿è¡Œå®Œæ¯•ä¹‹é—´ï¼Œä¸”è¿™ä¸ªå‡ ä¸ªç¨‹åºéƒ½æ˜¯åœ¨åŒä¸€ä¸ªå¤„ç†æœºä¸Šè¿è¡Œã€‚å…¶ä¸­ä¸¤ç§å¹¶å‘å…³ç³»åˆ†åˆ«æ˜¯åŒæ­¥å’Œäº’æ–¥ã€‚ <blockquote><ol><li>äº’æ–¥ï¼šè¿›ç¨‹é—´ç›¸äº’æ’æ–¥çš„ä½¿ç”¨ä¸´ç•Œèµ„æºçš„ç°è±¡</li><li>åŒæ­¥ï¼šè¿›ç¨‹ä¹‹é—´çš„å…³ç³»ä¸æ˜¯ç›¸äº’æ’æ–¥ä¸´ç•Œèµ„æºçš„å…³ç³»ï¼Œè€Œæ˜¯ç›¸äº’ä¾èµ–çš„å…³ç³»ã€‚è¿›ä¸€æ­¥è¯´æ˜å°±æ˜¯å‰ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ï¼Œå½“ç¬¬ä¸€ä¸ªè¿›ç¨‹æ²¡æœ‰è¾“å‡ºæ—¶ç¬¬äºŒä¸ªè¿›ç¨‹å¿…é¡»ç­‰å¾…ã€‚å…·æœ‰åŒæ­¥å…³ç³»çš„ä¸€ç»„å¹¶å‘è¿›ç¨‹ç›¸äº’å‘é€çš„ä¿¡æ¯ç§°ä¸ºæ¶ˆæ¯æˆ–äº‹ä»¶ã€‚<br>å…¶ä¸­å¹¶å‘åˆæœ‰ä¼ªå¹¶å‘å’ŒçœŸå¹¶å‘ï¼Œä¼ªå¹¶å‘æ˜¯æŒ‡å•æ ¸å¤„ç†å™¨çš„å¹¶å‘ï¼ŒçœŸå¹¶å‘æ˜¯æŒ‡å¤šæ ¸å¤„ç†å™¨çš„å¹¶å‘ã€‚</li></ol></blockquote></li><li>å¹¶è¡Œ(parallelism)ï¼šåœ¨å•å¤„ç†å™¨ä¸­å¤šé“ç¨‹åºè®¾è®¡ç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹è¢«äº¤æ›¿æ‰§è¡Œï¼Œè¡¨ç°å‡ºä¸€ç§å¹¶å‘çš„å¤–éƒ¨ç‰¹ç§ï¼›åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹ä¸ä»…å¯ä»¥äº¤æ›¿æ‰§è¡Œï¼Œè€Œä¸”å¯ä»¥é‡å æ‰§è¡Œã€‚åœ¨å¤šå¤„ç†å™¨ä¸Šçš„ç¨‹åºæ‰å¯å®ç°å¹¶è¡Œå¤„ç†ã€‚ä»è€Œå¯çŸ¥ï¼Œå¹¶è¡Œæ˜¯é’ˆå¯¹å¤šå¤„ç†å™¨è€Œè¨€çš„ã€‚å¹¶è¡Œæ˜¯åŒæ—¶å‘ç”Ÿçš„å¤šä¸ªå¹¶å‘äº‹ä»¶ï¼Œå…·æœ‰å¹¶å‘çš„å«ä¹‰ï¼Œä½†å¹¶å‘ä¸ä¸€å®šå¹¶è¡Œï¼Œä¹Ÿäº¦æ˜¯è¯´å¹¶å‘äº‹ä»¶ä¹‹é—´ä¸ä¸€å®šè¦åŒä¸€æ—¶åˆ»å‘ç”Ÿã€‚ </li></ul></blockquote></li></ol></blockquote><h4 id="14-çº¿ç¨‹é—´é€šä¿¡ï¼Ÿ"><a href="#14-çº¿ç¨‹é—´é€šä¿¡ï¼Ÿ" class="headerlink" title="14. çº¿ç¨‹é—´é€šä¿¡ï¼Ÿ"></a>14. çº¿ç¨‹é—´é€šä¿¡ï¼Ÿ</h4><blockquote><ol><li><code>NSThread</code><blockquote><ol><li> <code>- (void)performSelectorOnMainThread:(SEL)aSelector withObject:(nullable id)arg waitUntilDone:(BOOL)wait;</code></li><li><code>- (void)performSelector:(SEL)aSelector onThread:(NSThread *)thr withObject:(nullable id)arg waitUntilDone:(BOOL)wait;</code></li></ol></blockquote></li><li><code>CGD</code><blockquote><p> dispatch_async(dispatch_get_global_queue(0, 0), ^{â€¦});</p></blockquote></li></ol></blockquote><h4 id="15-GCDçš„ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ï¼Ÿï¼ˆgroupï¼Œbarrierï¼Œä¿¡å·é‡ï¼Œçº¿ç¨‹åŒæ­¥ï¼‰"><a href="#15-GCDçš„ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ï¼Ÿï¼ˆgroupï¼Œbarrierï¼Œä¿¡å·é‡ï¼Œçº¿ç¨‹åŒæ­¥ï¼‰" class="headerlink" title="15. GCDçš„ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ï¼Ÿï¼ˆgroupï¼Œbarrierï¼Œä¿¡å·é‡ï¼Œçº¿ç¨‹åŒæ­¥ï¼‰"></a>15. GCDçš„ä¸€äº›å¸¸ç”¨çš„å‡½æ•°ï¼Ÿï¼ˆgroupï¼Œbarrierï¼Œä¿¡å·é‡ï¼Œçº¿ç¨‹åŒæ­¥ï¼‰</h4><h4 id="16-å¦‚ä½•è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªç±»çš„ç§æœ‰å±æ€§ï¼Ÿ"><a href="#16-å¦‚ä½•è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªç±»çš„ç§æœ‰å±æ€§ï¼Ÿ" class="headerlink" title="16. å¦‚ä½•è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªç±»çš„ç§æœ‰å±æ€§ï¼Ÿ"></a>16. å¦‚ä½•è®¿é—®å¹¶ä¿®æ”¹ä¸€ä¸ªç±»çš„ç§æœ‰å±æ€§ï¼Ÿ</h4><blockquote><ol><li>KVO + KVC</li><li>runtime (class_copyIvarList, object_setIvar)</li></ol></blockquote><h4 id="17-æ•°æ®æŒä¹…åŒ–çš„å‡ ä¸ªæ–¹æ¡ˆï¼ˆfmdbç”¨æ²¡ç”¨è¿‡ï¼‰"><a href="#17-æ•°æ®æŒä¹…åŒ–çš„å‡ ä¸ªæ–¹æ¡ˆï¼ˆfmdbç”¨æ²¡ç”¨è¿‡ï¼‰" class="headerlink" title="17. æ•°æ®æŒä¹…åŒ–çš„å‡ ä¸ªæ–¹æ¡ˆï¼ˆfmdbç”¨æ²¡ç”¨è¿‡ï¼‰"></a>17. æ•°æ®æŒä¹…åŒ–çš„å‡ ä¸ªæ–¹æ¡ˆï¼ˆfmdbç”¨æ²¡ç”¨è¿‡ï¼‰</h4><blockquote><ol><li>CoreData</li><li>Sqlite 3</li><li>FMDB ï¼ˆSqlite 3å°è£…ï¼‰</li><li>é’¥åŒ™ä¸²</li><li>NSUserDefualt</li><li>NSKeyedArchiver</li><li>NSCache</li><li>æ²™ç›’</li></ol></blockquote><h4 id="18-è¯´ä¸€ä¸‹AppDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼Ÿä»åå°åˆ°å‰å°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿç¬¬ä¸€æ¬¡å¯åŠ¨è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿä»å‰å°åˆ°åå°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿ"><a href="#18-è¯´ä¸€ä¸‹AppDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼Ÿä»åå°åˆ°å‰å°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿç¬¬ä¸€æ¬¡å¯åŠ¨è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿä»å‰å°åˆ°åå°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿ" class="headerlink" title="18. è¯´ä¸€ä¸‹AppDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼Ÿä»åå°åˆ°å‰å°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿç¬¬ä¸€æ¬¡å¯åŠ¨è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿä»å‰å°åˆ°åå°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿ"></a>18. è¯´ä¸€ä¸‹AppDelegateçš„å‡ ä¸ªæ–¹æ³•ï¼Ÿä»åå°åˆ°å‰å°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿç¬¬ä¸€æ¬¡å¯åŠ¨è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿä»å‰å°åˆ°åå°è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Ÿ</h4><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">1</span>.å½“åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥éæ´»åŠ¨çŠ¶æ€æ‰§è¡Œï¼Œåœ¨æ­¤æœŸé—´ï¼Œåº”ç”¨ç¨‹åºä¸æ¥å—æ¶ˆæ¯æˆ–äº‹ä»¶ï¼Œæ¯”å¦‚æ¥ç”µ<br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">applicationWillResignActive</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> &#123;<br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥éæ´»åŠ¨çŠ¶æ€ï¼Œå³å°†è¿›å…¥åå°&quot;</span>);<br>&#125;<br><br><span class="hljs-selector-tag">2</span>.åº”ç”¨ç¨‹åºå·²ç»è¿›å…¥åå°è¿è¡Œ<br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">applicationDidEnterBackground</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> &#123;<br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;å¦‚æœåº”ç”¨ç¨‹åºæ”¯æŒåå°è¿è¡Œï¼Œåˆ™åº”ç”¨ç¨‹åºå·²ç»è¿›å…¥åå°è¿è¡Œ&quot;</span>); <span class="hljs-comment">//å¦‚æœéœ€è¦é€€å‡ºåå°,åˆ™åœ¨è¿™é‡ŒåŠ ä¸Š:exit(0);</span><br>&#125;<br><br><span class="hljs-selector-tag">3</span>.åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥æ´»åŠ¨çŠ¶æ€æ‰§è¡Œ<br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">applicationWillEnterForeground</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> &#123;<br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;åº”ç”¨ç¨‹åºå°†è¦è¿›å…¥æ´»åŠ¨çŠ¶æ€ï¼Œå³å°†è¿›å…¥å‰å°è¿è¡Œ&quot;</span>);<br>&#125;<br><br><span class="hljs-selector-tag">4</span>.åº”ç”¨ç¨‹åºå·²ç»è¿›å…¥æ´»åŠ¨çŠ¶æ€<br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">applicationDidBecomeActive</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> &#123;<br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;åº”ç”¨ç¨‹åºå·²è¿›å…¥å‰å°ï¼Œå¤„äºæ´»åŠ¨çŠ¶æ€&quot;</span>);<br>&#125;<br><br><span class="hljs-selector-tag">5</span>.åº”ç”¨ç¨‹åºå°†è¦é€€å‡ºï¼Œé€šå¸¸ç”¨äºä¿å­˜æ•°æ®å’Œä¸€äº›é€€å‡ºå‰çš„æ¸…ç†å·¥ä½œ<br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">applicationWillTerminate</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> &#123;<br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;åº”ç”¨ç¨‹åºå°†è¦é€€å‡ºï¼Œé€šå¸¸ç”¨äºä¿å­˜æ•°æ®å’Œä¸€äº›é€€å‡ºå‰çš„æ¸…ç†å·¥ä½œ&quot;</span>);<br>&#125;<br><br><span class="hljs-selector-tag">6</span>.å½“è®¾å¤‡ä¸ºåº”ç”¨ç¨‹åºåˆ†é…äº†å¤ªå¤šçš„å†…å­˜ï¼Œæ“ä½œç³»ç»Ÿä¼šç»ˆæ­¢åº”ç”¨ç¨‹åºçš„è¿è¡Œï¼Œåœ¨ç»ˆæ­¢å‰ä¼šæ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œé€šå¸¸å¯ä»¥åœ¨è¿™é‡Œè¿›è¡Œå†…å­˜æ¸…ç†å·¥ä½œï¼Œé˜²æ­¢ç¨‹åºè¢«ç»ˆæ­¢<br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">applicationDidReceiveMemoryWarning</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> &#123;<br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;ç³»ç»Ÿå†…å­˜ä¸è¶³ï¼Œéœ€è¦è¿›è¡Œæ¸…ç†å·¥ä½œ&quot;</span>);<br>&#125;<br><br><span class="hljs-selector-tag">7</span>.å½“ç³»ç»Ÿæ—¶é—´å‘ç”Ÿæ”¹å˜æ—¶æ‰§è¡Œ<br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">applicationSignificantTimeChange</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> &#123;<br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;å½“ç³»ç»Ÿæ—¶é—´å‘ç”Ÿæ”¹å˜æ—¶æ‰§è¡Œ&quot;</span>);<br>&#125;<br><br><span class="hljs-selector-tag">8</span>.æ¨é€æ¶ˆæ¯æ—¶ï¼Œè·å–è®¾å¤‡çš„<span class="hljs-selector-tag">tokenid</span><br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">application</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> <span class="hljs-selector-tag">didRegisterForRemoteNotificationsWithDeviceToken</span>:(NSData *)<span class="hljs-selector-tag">deviceToken</span> &#123;<br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;%@&quot;</span>,deviceToken);<br>&#125;<br><br><span class="hljs-selector-tag">9</span><span class="hljs-selector-class">.tokenid</span>è·å–å¤±è´¥æ—¶,åšç›¸åº”å¤„ç†<br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">application</span>:(UIApplication *)<span class="hljs-selector-tag">app</span> <span class="hljs-selector-tag">didFailToRegisterForRemoteNotificationsWithError</span>:(NSError *)<span class="hljs-selector-tag">error</span> &#123;<br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;fail to register for remoteNotifications: %@&quot;</span>, [err description]);<br>&#125;<br><br><span class="hljs-selector-tag">10</span>.æ¥æ”¶åˆ°æ¨é€æ¶ˆæ¯å¤„ç†<br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">application</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> <span class="hljs-selector-tag">didReceiveRemoteNotification</span>:(NSDictionary *)<span class="hljs-selector-tag">userInfo</span> &#123;<br>    <span class="hljs-comment">//è®¾ç½®iconä¸Šçš„æ ‡è®°æ•°å­—è®¾ç½®ä¸º0ï¼›</span><br>    <span class="hljs-comment">//application.applicationIconBadgeNumber = 0;</span><br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;%@&quot;</span>,userInfo);<br>&#125;<br><br><span class="hljs-selector-tag">11</span>.å½“ç¨‹åºè½½å…¥åæ‰§è¡Œ<br><br><span class="hljs-selector-tag">-</span> (void)<span class="hljs-selector-tag">applicationDidFinishLaunching</span>:(UIApplication *)<span class="hljs-selector-tag">application</span> &#123;<br>    <span class="hljs-selector-tag">NSLog</span>(@<span class="hljs-string">&quot;å½“ç¨‹åºè½½å…¥åæ‰§è¡Œ&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="19-NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼Ÿ"><a href="#19-NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼Ÿ" class="headerlink" title="19. NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼Ÿ"></a>19. NSCacheä¼˜äºNSDictionaryçš„å‡ ç‚¹ï¼Ÿ</h4><blockquote><p>NSCache æ˜¯ä¸€ä¸ªå®¹å™¨ç±»ï¼Œç±»ä¼¼äºNSDIctionary,é€šè¿‡key-value å½¢å¼å­˜å‚¨å’ŒæŸ¥è¯¢å€¼ï¼Œç”¨äºä¸´æ—¶å­˜å‚¨å¯¹è±¡ã€‚</p><p>æ³¨æ„ä¸€ç‚¹å®ƒå’ŒNSDictionaryåŒºåˆ«å°±æ˜¯ï¼ŒNSCache ä¸­çš„keyä¸å¿…å®ç°copyï¼ŒNSDictionaryä¸­çš„keyå¿…é¡»å®ç°copy</p><p>NSCacheä¸­å­˜å‚¨çš„å¯¹è±¡ä¹Ÿä¸å¿…å®ç°NSCodingåè®®ï¼Œå› ä¸ºæ¯•ç«Ÿæ˜¯ä¸´æ—¶å­˜å‚¨ï¼Œç±»ä¼¼äºå†…å­˜ç¼“å­˜ï¼Œç¨‹åºé€€å‡ºåå°±è¢«é‡Šæ”¾äº†ã€‚</p></blockquote><h4 id="20-çŸ¥ä¸çŸ¥é“Designated-Initializerï¼Ÿä½¿ç”¨å®ƒçš„æ—¶å€™æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Ÿ"><a href="#20-çŸ¥ä¸çŸ¥é“Designated-Initializerï¼Ÿä½¿ç”¨å®ƒçš„æ—¶å€™æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="20. çŸ¥ä¸çŸ¥é“Designated Initializerï¼Ÿä½¿ç”¨å®ƒçš„æ—¶å€™æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Ÿ"></a>20. çŸ¥ä¸çŸ¥é“Designated Initializerï¼Ÿä½¿ç”¨å®ƒçš„æ—¶å€™æœ‰ä»€ä¹ˆéœ€è¦æ³¨æ„çš„é—®é¢˜ï¼Ÿ</h4><h4 id="21-å®ç°descriptionæ–¹æ³•èƒ½å–åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ"><a href="#21-å®ç°descriptionæ–¹æ³•èƒ½å–åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ" class="headerlink" title="21. å®ç°descriptionæ–¹æ³•èƒ½å–åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ"></a>21. å®ç°descriptionæ–¹æ³•èƒ½å–åˆ°ä»€ä¹ˆæ•ˆæœï¼Ÿ</h4><blockquote><p>å¯ä»¥è¾“å‡ºå¯¹è±¡å†…éƒ¨çš„ä¸€äº›æˆå˜é‡çš„å€¼</p></blockquote><h4 id="22-objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ"><a href="#22-objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ" class="headerlink" title="22. objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ"></a>22. objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜ï¼Ÿ</h4><blockquote><p>ARC (automatic reference counting)<br>MRC (manual retain-release)</p></blockquote><h2 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h2><ol><li>blockçš„å®è´¨æ˜¯ä»€ä¹ˆï¼Ÿä¸€å…±æœ‰å‡ ç§blockï¼Ÿéƒ½æ˜¯ä»€ä¹ˆæƒ…å†µä¸‹ç”Ÿæˆçš„ï¼Ÿ</li><li>ä½¿ç”¨ç³»ç»Ÿçš„æŸäº›block apiï¼Œæ˜¯å¦è€ƒè™‘å¼•ç”¨å¾ªç¯é—®é¢˜ï¼Ÿ</li><li>è°ˆè°ˆblockçš„ç†è§£ï¼Ÿå¹¶å†™å‡ºä¸€ä¸ªä½¿ç”¨blockæ‰§è¡ŒUIVewåŠ¨ç”»ï¼Ÿ</li></ol><h2 id="Runtime"><a href="#Runtime" class="headerlink" title="Runtime"></a>Runtime</h2><ol><li>runtimeå¦‚ä½•å®ç°weakå±æ€§ï¼Ÿ</li><li>runtimeå¦‚ä½•é€šè¿‡selectoræ‰¾åˆ°å¯¹åº”çš„IMPåœ°å€ï¼Ÿ</li><li>èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼Ÿèƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li><li>runtimeå¦‚ä½•å®ç°weakå˜é‡çš„è‡ªåŠ¨ç½®nilï¼Ÿ</li><li>åœ¨å¼€å‘ä¸­å¦‚ä½•ä½¿ç”¨runtimeï¼Ÿä»€ä¹ˆåº”ç”¨åœºæ™¯ï¼Ÿ</li></ol><h2 id="ç±»ç»“æ„"><a href="#ç±»ç»“æ„" class="headerlink" title="ç±»ç»“æ„"></a>ç±»ç»“æ„</h2><ol><li>isaæŒ‡é’ˆï¼Ÿï¼ˆå¯¹è±¡çš„isaï¼Œç±»å¯¹è±¡çš„isaï¼Œå…ƒç±»çš„isaéƒ½è¦è¯´ï¼‰</li><li>ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li><li>ä»‹ç»ä¸€ä¸‹åˆ†ç±»ï¼Œèƒ½ç”¨åˆ†ç±»åšä»€ä¹ˆï¼Ÿå†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿå®ƒä¸ºä»€ä¹ˆä¼šè¦†ç›–æ‰åŸæ¥çš„æ–¹æ³•ï¼Ÿ</li><li>è¿è¡Œæ—¶èƒ½å¢åŠ æˆå‘˜å˜é‡ä¹ˆï¼Ÿèƒ½å¢åŠ å±æ€§ä¹ˆï¼Ÿå¦‚æœèƒ½ï¼Œå¦‚ä½•å¢åŠ ï¼Ÿå¦‚æœä¸èƒ½ï¼Œä¸ºä»€ä¹ˆï¼Ÿ</li><li>objcä¸­å‘ä¸€ä¸ªnilå¯¹è±¡å‘é€æ¶ˆæ¯å°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿï¼ˆè¿”å›å€¼æ˜¯å¯¹è±¡ï¼Œæ˜¯æ ‡é‡ï¼Œç»“æ„ä½“ï¼‰</li></ol><h2 id="é«˜çº§"><a href="#é«˜çº§" class="headerlink" title="é«˜çº§"></a>é«˜çº§</h2><ol><li>UITableviewçš„ä¼˜åŒ–æ–¹æ³•ï¼ˆç¼“å­˜é«˜åº¦ï¼Œå¼‚æ­¥ç»˜åˆ¶ï¼Œå‡å°‘å±‚çº§ï¼Œhideï¼Œé¿å…ç¦»å±æ¸²æŸ“ï¼‰</li><li>æœ‰æ²¡æœ‰ç”¨è¿‡è¿è¡Œæ—¶ï¼Œç”¨å®ƒéƒ½èƒ½åšä»€ä¹ˆï¼Ÿï¼ˆäº¤æ¢æ–¹æ³•ï¼Œåˆ›å»ºç±»ï¼Œç»™æ–°åˆ›å»ºçš„ç±»å¢åŠ æ–¹æ³•ï¼Œæ”¹å˜isaæŒ‡é’ˆï¼‰</li><li>çœ‹è¿‡å“ªäº›ç¬¬ä¸‰æ–¹æ¡†æ¶çš„æºç ï¼Ÿéƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿï¼ˆå¦‚æœæ²¡æœ‰ï¼Œé—®ä¸€ä¸‹å¤šå›¾ä¸‹è½½çš„è®¾è®¡ï¼‰</li><li>SDWebImageçš„ç¼“å­˜ç­–ç•¥ï¼Ÿ</li><li>AFNä¸ºä»€ä¹ˆæ·»åŠ ä¸€æ¡å¸¸é©»çº¿ç¨‹ï¼Ÿ</li><li>KVOçš„ä½¿ç”¨ï¼Ÿå®ç°åŸç†ï¼Ÿï¼ˆä¸ºä»€ä¹ˆè¦åˆ›å»ºå­ç±»æ¥å®ç°ï¼‰</li><li>KVCçš„ä½¿ç”¨ï¼Ÿå®ç°åŸç†ï¼Ÿï¼ˆKVCæ‹¿åˆ°keyä»¥åï¼Œæ˜¯å¦‚ä½•èµ‹å€¼çš„ï¼ŸçŸ¥ä¸çŸ¥é“é›†åˆæ“ä½œç¬¦ï¼Œèƒ½ä¸èƒ½è®¿é—®ç§æœ‰å±æ€§ï¼Œèƒ½ä¸èƒ½ç›´æ¥è®¿é—®_ivarï¼‰</li></ol><h2 id="iOSçš„æ²™ç›’ç›®å½•ç»“æ„"><a href="#iOSçš„æ²™ç›’ç›®å½•ç»“æ„" class="headerlink" title="iOSçš„æ²™ç›’ç›®å½•ç»“æ„"></a>iOSçš„æ²™ç›’ç›®å½•ç»“æ„</h2><ol><li>AppName.app</li><li>Documents</li><li>Library â€“&gt; 3.1 Preferences 3.2 Caches</li><li>tmp</li></ol>]]></content>
    
    
    <categories>
      
      <category>iOS</category>
      
      <category>é¢è¯•</category>
      
    </categories>
    
    
    <tags>
      
      <tag>é¢è¯•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2018/01/01/hello-world/"/>
    <url>/2018/01/01/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
